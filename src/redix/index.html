<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Redix Universal Browser</title>
    <link rel="stylesheet" href="./redix.css" />
  </head>
  <body>
    <div id="redix-app">
      <header class="redix-header">
        <div class="redix-nav">
          <button id="redix-back" class="redix-button" aria-label="Back">←</button>
          <button id="redix-forward" class="redix-button" aria-label="Forward">→</button>
          <button id="redix-reload" class="redix-button" aria-label="Reload">↻</button>
          <input 
            type="text" 
            id="redix-omnibar" 
            class="redix-omnibar" 
            placeholder="Enter URL or search query..."
            aria-label="Address bar"
          />
          <button id="redix-go" class="redix-button redix-button-primary">Go</button>
        </div>
      </header>
      
      <main id="redix-content" class="redix-content-area">
        <div class="redix-welcome">
          <h1>Redix Universal Browser</h1>
          <p>Ultra-lightweight browser for any device</p>
          <p class="redix-capabilities" id="redix-capabilities">Detecting capabilities...</p>
        </div>
      </main>
      
      <footer class="redix-footer">
        <div class="redix-status" id="redix-status">Ready</div>
      </footer>
    </div>
    
    <script type="module" src="./index.ts"></script>
    <script>
      // Initialize Redix when script loads
      window.addEventListener('DOMContentLoaded', () => {
        if (window.Redix) {
          const browser = window.Redix.init();
          const caps = browser.getCapabilities();
          
          // Display capabilities
          const capsEl = document.getElementById('redix-capabilities');
          if (capsEl) {
            capsEl.textContent = `WASM: ${caps.hasWASM ? 'Yes' : 'No'} | RAM: ~${caps.ramEstimate}GB | Cores: ${caps.cpuCores} | ${caps.isLowEnd ? 'Low-end' : 'Standard'} device`;
          }
          
          // Setup navigation
          const omnibar = document.getElementById('redix-omnibar');
          const goButton = document.getElementById('redix-go');
          const contentArea = document.getElementById('redix-content');
          
          const navigate = async () => {
            const url = omnibar?.value?.trim() || '';
            if (!url) return;
            
            const statusEl = document.getElementById('redix-status');
            if (statusEl) statusEl.textContent = 'Loading...';
            
            try {
              // Normalize URL
              let normalizedUrl = url;
              if (!url.startsWith('http://') && !url.startsWith('https://')) {
                if (url.includes('.') && !url.includes(' ')) {
                  normalizedUrl = 'https://' + url;
                } else {
                  // Search query - use DuckDuckGo
                  normalizedUrl = `https://duckduckgo.com/?q=${encodeURIComponent(url)}`;
                }
              }
              
              if (contentArea) {
                contentArea.innerHTML = ''; // Clear previous content
                await browser.navigate(normalizedUrl, contentArea);
              }
              
              if (statusEl) statusEl.textContent = 'Ready';
              if (omnibar) omnibar.value = normalizedUrl;
            } catch (error) {
              if (statusEl) statusEl.textContent = `Error: ${error instanceof Error ? error.message : 'Navigation failed'}`;
            }
          };
          
          if (goButton) {
            goButton.addEventListener('click', navigate);
          }
          
          if (omnibar) {
            omnibar.addEventListener('keypress', (e) => {
              if (e.key === 'Enter') {
                navigate();
              }
            });
          }
        }
      });
    </script>
  </body>
</html>


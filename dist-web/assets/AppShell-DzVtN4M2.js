const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./trustDashboardStore-CE7KmIta.js","./index-dj7m1cGj.js","./index-C-YwTlXb.css","./TopNav-DzgVy9Hm.js","./privacyStore-CknxRZFg.js","./proxy-C7NQ8sMs.js","./OmniDesk-XqA-NCuc.js","./index-D3V9pHtR.js","./sparkles-BXvEuSDZ.js","./copy-r_Uv8dWa.js","./x-kCWGjBIF.js","./loader-circle-B2cekLv2.js","./agentStreamStore-DATaLJlE.js","./cloud-RM87ovcD.js","./search-DY2JFyPs.js","./formatDistanceToNow-Ctx6mZEP.js","./clock-C2CbMN6U.js","./refresh-cw-81QnrOuz.js","./circle-check-J1xVWsPI.js","./brain-BOF2plVW.js","./gamepad-2-CkYAMJPd.js","./zap-BOkdKR3W.js","./use-ipc-event-Mlq2GWsh.js","./debounce-CrBEO-ON.js","./lock-Do5xV_Pm.js","./globe-CkFFXIIw.js","./shield-wz6Nan5a.js","./plus-BA3m4G4e.js","./profileStore-yzAJ5kKU.js","./download-B1WlPeuz.js","./eye-off-BihoSOdE.js","./sun-gjWoxaw5.js","./camera-CRUc-Z54.js","./settings-CRuJdu6q.js","./network-BKgZ1MJV.js","./circle-check-big-CnSYYo6U.js","./circle-x-DhN9FEyB.js","./chevron-right-De8SIpIA.js","./arrow-right-DHDEBQ_I.js","./activity-CJFxjceS.js","./Portal-Cws6ez_F.js","./external-link-uxSLXU_6.js","./triangle-alert-CX1V0b5r.js","./TabStrip-DVXyCuB-.js","./eye-K0nBXFUq.js","./moon-star-BoTlVUZg.js","./circle-play-C6hzx54j.js","./RightPanel-B1S9H2bk.js","./play-Cjit1YSa.js","./share-2-pOT6vdmO.js","./shield-check-Drnm7Ghu.js","./send-BYYA8fOY.js","./shield-alert-BDTTFe3x.js","./trash-2-WPlKMkyK.js","./BottomStatus-7raYbOXr.js","./cpu-DP5ZXhxc.js","./CommandPalette-ArfS-2IN.js","./PermissionPrompt-B3BbgKrY.js","./bell-CHeHJiZV.js","./hard-drive-Ba3Vv_NU.js","./ConsentPrompt-LtUiI6Ma.js","./AgentOverlay-C7U0aMp6.js","./ClipperOverlay-CjiV9pgX.js","./ReaderOverlay-B1odcI1m.js","./book-open-C70GiHUE.js","./refresh-ccw-LV4-9HT3.js","./TabGraphOverlay-BEADBYjw.js","./ConsentDashboard-C1h6NLba.js","./filter-DdeWeMTy.js","./ConsentDashboard-Fd0xVSp_.css","./TrustEthicsDashboard-DsogKPdI.js","./OnboardingTour-D44VOyeH.js"])))=>i.map(i=>d[i]);
import{c as se,i as N,r as a,a as we,j as e,_ as w,u as J,b as le,R as T,O as ce,d as ue}from"./index-dj7m1cGj.js";import{u as de}from"./use-ipc-event-Mlq2GWsh.js";import{V as je,P as D}from"./Portal-Cws6ez_F.js";import{O as Ee,R as Se}from"./OmniDesk-XqA-NCuc.js";import{c as me,m as k}from"./proxy-C7NQ8sMs.js";import{A as H}from"./index-D3V9pHtR.js";import{L as pe}from"./loader-circle-B2cekLv2.js";import{E as Ne}from"./external-link-uxSLXU_6.js";import{S as Te}from"./sparkles-BXvEuSDZ.js";import{X as _e}from"./x-kCWGjBIF.js";import{useTrustDashboardStore as ke}from"./trustDashboardStore-CE7KmIta.js";import{T as Ce}from"./triangle-alert-CX1V0b5r.js";import{f as Le}from"./formatDistanceToNow-Ctx6mZEP.js";const Re=me("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const De=me("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Oe=se((t,o)=>({visible:!1,loading:!1,error:null,data:null,focusedTabId:null,async open(){o().visible||t({visible:!0}),await o().refresh()},close(){t({visible:!1,focusedTabId:null})},async toggle(){o().visible?t({visible:!1,focusedTabId:null}):(t({visible:!0}),await o().refresh())},async refresh(){t({loading:!0,error:null});try{const n=await N.graph.tabs();if(!n||typeof n!="object")throw new Error("Graph data unavailable");t({data:n,loading:!1,error:null})}catch(n){t({loading:!1,error:n instanceof Error?n.message:String(n)})}},setFocusedTab(n){t({focusedTabId:n})},async focusTab(n){t({visible:!0,focusedTabId:n}),await o().refresh()}})),Ie=["ob://","about:","chrome://","edge://","app://","omnibrowser://"];function Pe(t){return t?Ie.some(o=>t.startsWith(o)):!0}function Ae({tab:t,overlayActive:o}){const n=a.useRef(null),m=a.useRef(null),u=a.useRef(null),f=we(),[j,h]=a.useState(!1),[_,v]=a.useState(null),[g,i]=a.useState(!1),c=a.useRef(null),y=a.useRef(0),d=a.useMemo(()=>{const l=t?.url;return!l||l==="about:blank"||Pe(l)?null:l},[t?.url]);a.useEffect(()=>{if(!f||!m.current||!d)return;const l=m.current,C=3e4,p=()=>{h(!0),v(null),y.current=0,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{h(!1),v("This page is taking too long to load. Check your connection or try refreshing.")},C)},A=()=>{c.current&&(clearTimeout(c.current),c.current=null),h(!1)},z=()=>{c.current&&(clearTimeout(c.current),c.current=null),h(!1),v(null),y.current=0},V=K=>{c.current&&(clearTimeout(c.current),c.current=null),h(!1);const F=K?.errorCode??-1,L=K?.errorDescription??"Unknown error";let O="Failed to load this page.";F===-105||L.includes("ERR_NAME_NOT_RESOLVED")?O="Could not resolve the website address. Check your internet connection.":F===-106||L.includes("ERR_INTERNET_DISCONNECTED")?O="No internet connection. Please check your network settings.":F===-118||L.includes("ERR_CONNECTION_TIMED_OUT")?O="Connection timed out. The server may be slow or unreachable.":L.includes("ERR_BLOCKED_BY_RESPONSE")?O="This site cannot be embedded for security reasons.":O=`Failed to load: ${L||"Unknown error"}`,v(O)};return l.addEventListener("did-start-loading",p),l.addEventListener("did-stop-loading",A),l.addEventListener("dom-ready",z),l.addEventListener("did-fail-load",V),()=>{c.current&&(clearTimeout(c.current),c.current=null),l.removeEventListener("did-start-loading",p),l.removeEventListener("did-stop-loading",A),l.removeEventListener("dom-ready",z),l.removeEventListener("did-fail-load",V)}},[f,d]),a.useEffect(()=>{if(f||!u.current||!d)return;const l=u.current,C=3e4;let p=null;const A=()=>{if(p&&(clearTimeout(p),p=null),h(!1),v(null),!!u.current)try{u.current.contentDocument?.title,i(!1)}catch{i(!0)}},z=()=>{p&&(clearTimeout(p),p=null),h(!1),v("Failed to load this page. Please check the URL or your connection."),i(!0)};return p=setTimeout(()=>{h(!1),v("This page is taking too long to load. Check your connection or try refreshing."),p=null},C),l.addEventListener("load",A),l.addEventListener("error",z),()=>{p&&(clearTimeout(p),p=null),l.removeEventListener("load",A),l.removeEventListener("error",z)}},[f,d]);const q=a.useCallback(()=>{if(d)try{window.open(d,"_blank","noopener,noreferrer")}catch(l){console.warn("[TabContentSurface] failed to open external window",l)}},[d]);a.useEffect(()=>{if(!d){h(!1),v(null),i(!1);return}if(f){const l=m.current;if(!l)return;try{l.getURL?.()!==d&&(h(!0),l.setAttribute("src",d))}catch(C){console.warn("[TabContentSurface] Failed to update webview src",C)}}else{const l=u.current;if(!l)return;l.src!==d&&(h(!0),l.src=d),i(!1)}},[f,d]);const G=t?.id?`tabpanel-${t.id}`:"tabpanel-empty",P=t?.id?`tab-${t.id}`:void 0,M=!t||!t.active;return d?e.jsxs(k.div,{ref:n,className:`relative h-full w-full bg-slate-950 ${o?"pointer-events-none":""}`,id:G,role:"tabpanel","aria-labelledby":P,"aria-hidden":M,initial:{opacity:.4},animate:{opacity:1},transition:{duration:.35,ease:"easeOut"},style:{position:"absolute",inset:0,zIndex:M?0:1},children:[f?e.jsx("webview",{ref:m,className:"h-full w-full",style:{width:"100%",height:"100%",display:M?"none":"block"},src:d,allowpopups:"true",autosize:"on",disablewebsecurity:"false","aria-label":t?.title?`Content for ${t.title}`:"Tab content"}):e.jsx("iframe",{ref:u,className:"h-full w-full",style:{width:"100%",height:"100%"},src:d??"about:blank",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups",allow:"fullscreen",title:t?.title??"Tab content","aria-label":t?.title?`Content for ${t.title}`:"Tab content"}),e.jsx(H,{children:j&&e.jsx(k.div,{className:"pointer-events-none absolute inset-0 z-10 flex items-center justify-center bg-slate-950/55 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},role:"status","aria-live":"polite","aria-label":"Loading page content",children:e.jsxs(k.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.2},className:"flex flex-col items-center gap-4 rounded-2xl border border-slate-700/60 bg-slate-900/90 px-6 py-5 text-sm text-slate-200 shadow-lg shadow-black/40",children:[e.jsx(k.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(pe,{className:"h-6 w-6 text-emerald-300","aria-hidden":"true"})}),e.jsxs("div",{className:"text-center w-full max-w-xs",children:[e.jsxs("div",{className:"font-medium mb-2",children:["Loading ",new URL(d).hostname,"…"]}),e.jsx("div",{className:"mt-1 text-xs text-slate-400 mb-3",children:"This may take a moment"}),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"h-1 w-full overflow-hidden rounded-full bg-slate-800/60",children:e.jsx(k.div,{className:"h-full bg-gradient-to-r from-emerald-500 via-cyan-500 to-emerald-500",initial:{x:"-100%",width:"40%"},animate:{x:["-100%","100%"]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})})})]})]})})}),e.jsx(H,{children:_&&e.jsx(k.div,{className:"pointer-events-auto absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},role:"alert","aria-live":"assertive",children:e.jsxs(k.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.18},className:"max-w-md space-y-3 rounded-2xl border border-amber-400/40 bg-amber-500/15 px-5 py-4 text-center text-sm text-amber-100 shadow-lg shadow-black/50",children:[e.jsx("div",{className:"font-medium",children:_}),e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("button",{type:"button",onClick:()=>{if(d&&f&&m.current){const l=m.current;v(null),h(!0),l.reload()}else d&&!f&&u.current&&(v(null),h(!0),u.current.src=d)},className:"rounded-lg border border-amber-400/60 bg-amber-500/20 px-3 py-1.5 text-xs font-medium text-amber-50 transition-colors hover:bg-amber-500/30",children:"Retry"})})]})})}),e.jsx(H,{children:!f&&g&&e.jsx(k.div,{className:"absolute inset-0 z-20 flex items-center justify-center bg-slate-950/85 px-6",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(k.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.92,opacity:0},transition:{duration:.22},className:"max-w-lg space-y-4 rounded-3xl border border-emerald-500/40 bg-emerald-500/15 p-6 text-center text-sm text-emerald-100 shadow-2xl shadow-black/50",children:[e.jsxs("div",{className:"text-lg font-semibold text-emerald-50",children:[new URL(d).hostname," works best in its own tab"]}),e.jsx("p",{className:"text-emerald-100/70",children:"This site blocks embedded views for security. Open it in a dedicated tab or use the Electron build for a fully integrated webview."}),e.jsxs("button",{type:"button",onClick:q,className:"inline-flex items-center gap-2 rounded-xl border border-emerald-400/60 bg-emerald-500/20 px-4 py-2 text-sm font-medium text-emerald-50 transition hover:border-emerald-300/70 hover:bg-emerald-500/30",children:[e.jsx(Ne,{size:16}),"Open ",new URL(d).hostname]})]})})})]},d):e.jsx(k.div,{id:G,role:"tabpanel","aria-labelledby":P,"aria-hidden":M,className:"h-full w-full overflow-hidden bg-[#1A1D28]",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},style:{position:"absolute",inset:0,zIndex:M?0:1,pointerEvents:"auto"},children:e.jsx(Ee,{variant:"split",forceShow:!0})})}function Me(){const[t,o]=a.useState(!1),[n,m]=a.useState([]),[u,f]=a.useState(null),[j,h]=a.useState(!1);a.useEffect(()=>{const g=()=>{const c=[{message:'Say "new tab" to open a fresh browsing session',priority:"low"},{message:'Try "search for regenerative design" to start research',priority:"medium"},{message:'Voice command: "switch to research mode"',priority:"low"},{message:'Ask "what trackers are blocked?" for privacy status',priority:"medium"},{message:'Say "show consent timeline" to review privacy decisions',priority:"high"}],y=c[Math.floor(Math.random()*c.length)];return y?{...y,id:`tip-${Date.now()}`,timestamp:Date.now()}:null},i=setInterval(()=>{if(!j&&n.length<3){const c=g();c&&m(y=>[...y,c].slice(-3))}},45e3);return()=>clearInterval(i)},[j,n.length]),a.useEffect(()=>{if(n.length>0){f(n[n.length-1]);const g=setTimeout(()=>{f(null),m(i=>i.slice(1))},8e3);return()=>clearTimeout(g)}},[n]);const _=a.useCallback(async g=>{const i=g.toLowerCase().trim();if(i.includes("new tab")||i.includes("open tab"))return await N.tabs.create("about:blank"),{success:!0,message:"Opened new tab"};if(i.includes("research mode")||i.includes("switch to research"))return window.location.hash="#/",{success:!0,message:"Switched to research mode"};if(i.includes("trackers")||i.includes("privacy")){const{useTrustDashboardStore:c}=await w(async()=>{const{useTrustDashboardStore:y}=await import("./trustDashboardStore-CE7KmIta.js");return{useTrustDashboardStore:y}},__vite__mapDeps([0,1,2]),import.meta.url);return c.getState().open(),{success:!0,message:"Opened privacy dashboard"}}if(i.includes("consent timeline")){const{useConsentOverlayStore:c}=await w(async()=>{const{useConsentOverlayStore:y}=await Promise.resolve().then(()=>Ve);return{useConsentOverlayStore:y}},void 0,import.meta.url);return c.getState().open(),{success:!0,message:"Opened consent timeline"}}return{success:!1,message:"Command not recognized"}},[]),v=a.useCallback(async()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){console.warn("[VoiceTips] Speech recognition not available");return}o(!0);const g=window.webkitSpeechRecognition||window.SpeechRecognition,i=new g;i.continuous=!1,i.interimResults=!1,i.lang="en-US",i.onresult=c=>{const y=c.results[0][0].transcript;_(y),o(!1)},i.onerror=()=>{o(!1)},i.onend=()=>{o(!1)},i.start()},[_]);return j?null:e.jsxs(e.Fragment,{children:[e.jsx(H,{children:u&&e.jsx(k.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"fixed bottom-24 left-1/2 z-50 -translate-x-1/2",children:e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-blue-500/40 bg-blue-500/15 px-4 py-3 text-sm text-blue-100 shadow-lg backdrop-blur-sm",children:[e.jsx(Te,{size:16,className:"text-blue-300"}),e.jsx("span",{children:u.message}),e.jsx("button",{type:"button",onClick:()=>{f(null),m(g=>g.filter(i=>i.id!==u.id))},className:"ml-2 rounded-lg p-1 hover:bg-blue-500/20","aria-label":"Dismiss tip",children:e.jsx(_e,{size:14})})]})})}),e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(k.button,{type:"button",onClick:()=>h(!j),className:"flex items-center justify-center rounded-full border border-slate-700/60 bg-slate-900/90 p-2.5 text-slate-200 shadow-lg backdrop-blur-sm hover:bg-slate-800/90",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":j?"Unmute voice tips":"Mute voice tips",children:j?e.jsx(je,{size:18}):e.jsx(Re,{size:18})}),!j&&e.jsx(k.button,{type:"button",onClick:v,disabled:t,className:`flex items-center justify-center rounded-full border p-3 shadow-lg backdrop-blur-sm transition-all ${t?"border-emerald-500/60 bg-emerald-500/20 text-emerald-200":"border-blue-500/60 bg-blue-500/20 text-blue-200 hover:bg-blue-500/30"}`,whileHover:{scale:1.05},whileTap:{scale:.95},animate:t?{scale:[1,1.1,1]}:{},transition:{duration:1.5,repeat:t?1/0:0},"aria-label":"Start voice command",children:e.jsx(De,{size:20})})]})})]})}const Q="omnibrowser:onboarding:completed",te={isCompleted(){try{return window.localStorage.getItem(Q)==="1"}catch{return!1}},setCompleted(){try{window.localStorage.setItem(Q,"1")}catch{}},clear(){try{window.localStorage.removeItem(Q)}catch{}}},Y=se(t=>({visible:!1,start:()=>{t({visible:!0})},finish:()=>{te.setCompleted(),t({visible:!1})},reset:()=>{te.clear(),t({visible:!0})}}));typeof window<"u"&&(window.__STORE={...window.__STORE,onboarding:Y});async function ze(t){const o={};t.type&&t.type!=="all"&&(o.type=t.type),t.status&&t.status!=="all"&&(t.status==="pending"?o.approved=!1:(t.status==="approved"||t.status==="revoked")&&(o.approved=!0));const n=await N.consent.list(Object.keys(o).length>0?o:void 0);if(!Array.isArray(n))return[];let m=n;return t.status==="pending"?m=m.filter(u=>!u.approved):t.status==="approved"?m=m.filter(u=>u.approved&&!u.revokedAt):t.status==="revoked"&&(m=m.filter(u=>!!u.revokedAt)),m.sort((u,f)=>f.timestamp-u.timestamp)}const fe=se((t,o)=>({visible:!1,loading:!1,error:null,filter:{type:"all",status:"all"},records:[],async open(){o().visible||t({visible:!0}),await o().refresh()},close(){t({visible:!1})},async toggle(){o().visible?t({visible:!1}):(t({visible:!0}),await o().refresh())},async refresh(){t({loading:!0,error:null});try{const n=await ze(o().filter);t({records:n,loading:!1,error:null})}catch(n){t({loading:!1,error:n instanceof Error?n.message:String(n)})}},async setFilter(n){t(m=>({filter:{...m.filter,...n}})),await o().refresh()},async approve(n){await N.consent.approve(n),await o().refresh()},async revoke(n){await N.consent.revoke(n),await o().refresh()}})),Ve=Object.defineProperty({__proto__:null,useConsentOverlayStore:fe},Symbol.toStringTag,{value:"Module"});var Fe=Object.defineProperty,Ke=(t,o,n)=>o in t?Fe(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,ee=(t,o,n)=>Ke(t,typeof o!="symbol"?o+"":o,n);class S extends T.Component{constructor(o){super(o),ee(this,"handleReload",()=>{window.location.reload()}),ee(this,"handleOpenLogs",async()=>{try{const n=await N.diagnostics.openLogs();this.setState({copyStatus:n?.success?"success":"error",copyMessage:n?.success?"Logs folder opened.":"Unable to open logs folder.",copying:!1})}catch(n){console.error("Failed to open logs folder from error boundary:",n),this.setState({copyStatus:"error",copyMessage:"Failed to open logs folder.",copying:!1})}}),ee(this,"handleCopyDiagnostics",async()=>{if(!this.state.copying){this.setState({copying:!0,copyStatus:null,copyMessage:void 0});try{const n=await N.diagnostics.copyDiagnostics();n?.diagnostics&&navigator?.clipboard?.writeText?(await navigator.clipboard.writeText(n.diagnostics),this.setState({copyStatus:"success",copyMessage:"Diagnostics copied to clipboard.",copying:!1})):(this.setState({copyStatus:"error",copyMessage:"Clipboard unavailable. Diagnostics logged to console.",copying:!1}),console.info("[Diagnostics] Summary:",n?.diagnostics))}catch(n){console.error("Failed to copy diagnostics from error boundary:",n),this.setState({copyStatus:"error",copyMessage:"Failed to copy diagnostics.",copying:!1})}}}),this.state={hasError:!1,copyStatus:null,copying:!1}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,n){console.error(`ErrorBoundary caught error${this.props.componentName?` in ${this.props.componentName}`:""}:`,o,n),this.setState({error:o,errorInfo:n.componentStack??void 0})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex min-h-screen w-full items-center justify-center bg-slate-950 px-6 py-12 text-gray-100",children:e.jsxs("div",{className:"w-full max-w-xl space-y-5 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-full bg-red-500/20 p-2 text-red-200",children:e.jsx(Ce,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-semibold text-red-200",children:["Something went wrong",this.props.componentName?` inside ${this.props.componentName}`:"","."]}),this.state.error?.message&&e.jsx("p",{className:"mt-2 text-sm text-red-100/80",children:this.state.error.message}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Try reloading the interface. You can also copy diagnostics or inspect the latest logs to share with the team."})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:this.handleReload,className:"rounded-lg border border-blue-500/50 bg-blue-500/10 px-4 py-2 text-sm font-medium text-blue-100 hover:border-blue-500/70 transition-colors",children:"Reload app"}),e.jsx("button",{onClick:this.handleCopyDiagnostics,disabled:this.state.copying,className:`rounded-lg border px-4 py-2 text-sm font-medium transition-colors ${this.state.copying?"border-indigo-500/30 bg-indigo-500/10 text-indigo-200/60 cursor-wait":"border-indigo-500/50 bg-indigo-500/10 text-indigo-100 hover:border-indigo-500/70"}`,children:this.state.copying?"Copying…":"Copy diagnostics"}),e.jsx("button",{onClick:this.handleOpenLogs,className:"rounded-lg border border-emerald-500/50 bg-emerald-500/10 px-4 py-2 text-sm font-medium text-emerald-100 hover:border-emerald-500/70 transition-colors",children:"Open logs folder"})]}),this.state.copyMessage&&e.jsx("div",{className:`text-sm ${this.state.copyStatus==="success"?"text-emerald-300":"text-red-300"}`,children:this.state.copyMessage}),ue()&&this.state.errorInfo&&e.jsxs("details",{className:"text-xs text-gray-400",children:[e.jsx("summary",{className:"cursor-pointer text-gray-300",children:"Stack trace"}),e.jsx("pre",{className:"mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded bg-black/40 p-3",children:this.state.errorInfo})]})]})}):this.props.children}}const $e=T.lazy(()=>w(()=>import("./TopNav-DzgVy9Hm.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,0,42]),import.meta.url).then(t=>({default:t.TopNav}))),Ue=T.lazy(()=>w(()=>import("./TabStrip-DVXyCuB-.js"),__vite__mapDeps([43,1,2,7,5,28,44,9,31,16,45,40,46,8,10,27,22,6,11,12,13,14,15,17,18,41,0,42]),import.meta.url).then(t=>({default:t.TabStrip}))),Be=T.lazy(()=>w(()=>import("./RightPanel-B1S9H2bk.js"),__vite__mapDeps([47,1,2,22,8,5,18,36,11,48,49,7,29,6,9,10,12,13,14,15,16,17,50,41,51,39,0,24,52,30,44,27,53,19,21,26,40,42]),import.meta.url).then(t=>({default:t.RightPanel}))),qe=T.lazy(()=>w(()=>import("./BottomStatus-7raYbOXr.js"),__vite__mapDeps([54,1,2,22,28,24,5,44,34,45,6,7,8,9,10,11,12,13,14,15,16,17,18,4,40,0,26,55,39,19,51,42,41]),import.meta.url).then(t=>({default:t.BottomStatus}))),Ge=T.lazy(()=>w(()=>import("./CommandPalette-ArfS-2IN.js"),__vite__mapDeps([56,1,2,6,5,7,8,9,10,11,12,13,14,15,16,17,18,38]),import.meta.url).then(t=>({default:t.CommandPalette}))),We=T.lazy(()=>w(()=>import("./PermissionPrompt-B3BbgKrY.js"),__vite__mapDeps([57,1,2,58,5,59,32,7,10,16,6,8,9,11,12,13,14,15,17,18,22,40,41,0,42]),import.meta.url).then(t=>({default:t.PermissionPrompt}))),He=T.lazy(()=>w(()=>import("./ConsentPrompt-LtUiI6Ma.js"),__vite__mapDeps([60,1,2,7,5,26,10,42,36,35]),import.meta.url).then(t=>({default:t.ConsentPrompt}))),Ye=T.lazy(()=>w(()=>import("./AgentOverlay-C7U0aMp6.js"),__vite__mapDeps([61,1,2,22,12,5,21,16,6,7,8,9,10,11,13,14,15,17,18,19,26,52,36]),import.meta.url).then(t=>({default:t.AgentOverlay}))),Xe=T.lazy(()=>w(()=>import("./ClipperOverlay-CjiV9pgX.js"),__vite__mapDeps([62,1,2,7,5]),import.meta.url).then(t=>({default:t.ClipperOverlay}))),Ze=T.lazy(()=>w(()=>import("./ReaderOverlay-B1odcI1m.js"),__vite__mapDeps([63,1,2,7,5,64,11,29,8,10,65,42,41]),import.meta.url).then(t=>({default:t.ReaderOverlay}))),Je=T.lazy(()=>w(()=>import("./TabGraphOverlay-BEADBYjw.js"),__vite__mapDeps([66,1,2,5,49,17,10,15,22,40,6,7,8,9,11,12,13,14,16,18,41,0,42]),import.meta.url).then(t=>({default:t.TabGraphOverlay}))),Qe=T.lazy(()=>w(()=>import("./ConsentDashboard-C1h6NLba.js"),__vite__mapDeps([67,1,2,50,5,17,29,42,52,10,68,15,22,40,6,7,8,9,11,12,13,14,16,18,41,0,69]),import.meta.url).then(t=>({default:t.ConsentDashboard}))),et=T.lazy(()=>w(()=>import("./TrustEthicsDashboard-DsogKPdI.js"),__vite__mapDeps([70,1,2,0,5,26,17,18,10,50,52,16,42,39,15,22,40,6,7,8,9,11,12,13,14,41]),import.meta.url).then(t=>({default:t.TrustEthicsDashboard}))),tt=T.lazy(()=>w(()=>import("./OnboardingTour-D44VOyeH.js"),__vite__mapDeps([71,1,2,6,5,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,26,22,40,41,0,42]),import.meta.url).then(t=>({default:t.OnboardingTour})));function st(){const[t,o]=a.useState(!1),[n,m]=a.useState(!1),[u,f]=a.useState(null),[j,h]=a.useState(null),[_,v]=a.useState(!1);a.useEffect(()=>{v(!1);const s=()=>{const x=!!(document.fullscreenElement||window.webkitFullscreenElement||window.mozFullScreenElement);x!==_&&v(x)},r=setTimeout(s,100);return document.addEventListener("fullscreenchange",s),document.addEventListener("webkitfullscreenchange",s),document.addEventListener("mozfullscreenchange",s),()=>{clearTimeout(r),document.removeEventListener("fullscreenchange",s),document.removeEventListener("webkitfullscreenchange",s),document.removeEventListener("mozfullscreenchange",s)}},[]);const[g,i]=a.useState(!1),[c,y]=a.useState(!1),d=Y(s=>s.visible),q=Y(s=>s.start);Y(s=>s.finish),a.useEffect(()=>{},[d]);const[G,P]=a.useState(!1);a.useEffect(()=>{let s=0;const r=E=>{const B=E.dataTransfer?.types;return B?Array.from(B).includes("application/x-omnibrowser-tab-id"):!1},x=E=>{r(E)&&(E.preventDefault(),s+=1,P(!0))},b=E=>{r(E)&&(E.preventDefault(),E.dataTransfer&&(E.dataTransfer.dropEffect="copy"))},R=E=>{r(E)&&(s=Math.max(0,s-1),s===0&&P(!1))},ne=()=>{s=0,P(!1)},oe=E=>{if(!r(E))return;E.preventDefault(),s=0,P(!1);const B=E.dataTransfer?.getData("application/x-omnibrowser-tab-id");if(B)try{Oe.getState().focusTab(B)}catch(ye){ue()&&console.warn("[AppShell] Failed to focus tab graph from drop",ye)}},ie=()=>{s=0,P(!1)};return document.addEventListener("dragenter",x),document.addEventListener("dragover",b),document.addEventListener("dragleave",R),document.addEventListener("dragend",ne),document.addEventListener("drop",oe),window.addEventListener("tabgraph:dragend",ie),()=>{document.removeEventListener("dragenter",x),document.removeEventListener("dragover",b),document.removeEventListener("dragleave",R),document.removeEventListener("dragend",ne),document.removeEventListener("drop",oe),window.removeEventListener("tabgraph:dragend",ie)}},[]);const M=fe(s=>s.visible),l=ke(s=>s.visible),C=J(),p=C.tabs.find(s=>s.id===C.activeId),[A,z]=a.useState(.62),[V,K]=a.useState(!1),F=n||!!u||!!j||g||c,L=p?.url??"",O=!!L&&!L.startsWith("ob://")&&!L.startsWith("about:")&&!L.startsWith("chrome://")&&!L.startsWith("edge://")&&!L.startsWith("app://"),he=a.useCallback(()=>{O&&K(!0)},[O]);a.useEffect(()=>{if(!V)return;const s=x=>{z(b=>{const R=x.clientX/window.innerWidth;return Number.isNaN(R)?b:Math.min(.85,Math.max(.25,R))})},r=()=>{K(!1)};return window.addEventListener("mousemove",s),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",r)}},[V]);const[I,W]=a.useState(null),[X,re]=a.useState(!1),[Z,ae]=a.useState("idle"),[$,U]=a.useState(null),be=a.useMemo(()=>{if(!I)return null;try{return Le(new Date(I.updatedAt),{addSuffix:!0})}catch{return null}},[I]);a.useEffect(()=>{if(typeof window>"u")return;const s=setTimeout(()=>{!te.isCompleted()&&!d&&q()},800);return()=>clearTimeout(s)},[d,q]),a.useEffect(()=>{if(X)return;let s=!1;return N.sessionState.summary().then(r=>{if(s)return;const x=r?.summary;x&&x.tabCount>0&&W(x)}).catch(()=>{s||W(null)}),()=>{s=!0}},[X]),a.useEffect(()=>{if(!$)return;const s=window.setTimeout(()=>{U(null)},6e3);return()=>{window.clearTimeout(s)}},[$]),de("permissions:request",s=>{f(s)},[]),de("agent:consent:request",s=>{if(!s||!s.id||!s.action)return;const r={id:s.id,action:{type:s.action.type,description:s.action.description,risk:s.action.risk??"medium"},callback:async x=>{try{x?await N.consent.approve(s.id):await N.consent.revoke(s.id)}catch(b){console.error("Failed to resolve consent:",b)}finally{h(null)}}};h(r)},[]),a.useEffect(()=>{const s=x=>{v(x.fullscreen)};return le.on("app:fullscreen-changed",s)},[]),a.useEffect(()=>{const s=r=>{const b=navigator.platform.toUpperCase().indexOf("MAC")>=0?r.metaKey:r.ctrlKey;if(b&&!r.shiftKey&&!r.altKey&&r.key.toLowerCase()==="k"){r.preventDefault(),m(!0);return}if(!(b&&!r.shiftKey&&!r.altKey&&r.key.toLowerCase()==="l")){if(b&&!r.shiftKey&&!r.altKey&&r.key.toLowerCase()==="t"){r.preventDefault(),N.tabs.create("about:blank").catch(console.error);return}if(b&&!r.shiftKey&&!r.altKey&&r.key.toLowerCase()==="w"){r.preventDefault();const R=J.getState();R.activeId&&N.tabs.close({id:R.activeId}).catch(console.error);return}if(b&&r.shiftKey&&!r.altKey&&r.key.toLowerCase()==="t"){r.preventDefault();return}if(b&&r.shiftKey&&!r.altKey&&r.key.toLowerCase()==="a"){r.preventDefault(),o(R=>!R);return}if(b&&r.shiftKey&&!r.altKey&&r.key.toLowerCase()==="h"){r.preventDefault(),J.getState().activeId&&i(!0);return}if(b&&r.altKey&&r.key.toLowerCase()==="p"){r.preventDefault(),document.querySelector("[data-network-button]")?.click();return}if(b&&r.altKey&&r.key.toLowerCase()==="s"){r.preventDefault(),document.querySelector("[data-shields-button]")?.click();return}if(!(b&&!r.shiftKey&&!r.altKey&&r.key.toLowerCase()==="f")&&r.key==="Escape"){g?i(!1):n?m(!1):u?f(null):j?h(null):t&&o(!1);return}}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[n,u,j,t,g]);const xe=async s=>{if(!p?.url){i(!1);return}try{const r=await N.research.getNotes(p.url),x=r?.notes??"",b=Array.isArray(r?.highlights)?r.highlights:[];await N.research.saveNotes(p.url,x,[...b,s]),le.emit("research:highlight-added",{url:p.url,highlight:s})}catch(r){console.error("Failed to save highlight:",r)}finally{i(!1)}},ve=async()=>{if(!(!I||Z==="restoring")){ae("restoring");try{const s=await N.sessionState.restore();if(s?.restored){const r=s.tabCount??I.tabCount??0;U({message:`Restored ${r} tab${r===1?"":"s"} from last session.`,variant:"success"}),W(null),re(!0)}else s?.error?U({message:`Restore failed: ${s.error}`,variant:"error"}):U({message:"No saved session snapshot available to restore.",variant:"error"})}catch(s){console.error("Failed to restore session snapshot:",s),U({message:"Failed to restore session snapshot.",variant:"error"})}finally{ae("idle")}}},ge=()=>{re(!0),W(null)};return e.jsxs("div",{className:"relative flex h-screen w-screen flex-col overflow-hidden bg-[#1A1D28] text-gray-100",children:[!_&&e.jsx("div",{className:"flex-none",children:e.jsx(a.Suspense,{fallback:e.jsx("div",{style:{height:"40px",backgroundColor:"#0f172a"}}),children:e.jsx(S,{componentName:"TopNav",fallback:e.jsx("div",{style:{height:"40px",backgroundColor:"#0f172a",padding:"8px",color:"#94a3b8"},children:"Navigation Error"}),children:e.jsx($e,{onAgentToggle:()=>o(!t),onCommandPalette:()=>m(!0),onClipperToggle:()=>{C.activeId&&i(!0)},onReaderToggle:()=>{C.activeId&&y(!0)}})})})}),e.jsxs("div",{className:"flex flex-1 min-h-0 w-full overflow-hidden",children:[e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col overflow-hidden",children:[!_&&I&&!X&&e.jsx("div",{className:"px-4 pt-3",children:e.jsxs("div",{className:"flex flex-col gap-3 rounded-xl border border-blue-500/40 bg-blue-500/10 px-4 py-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-100",children:"Restore your last browsing session?"}),e.jsxs("p",{className:"text-xs text-blue-200",children:["Last saved ",be??"recently"," • ",I.windowCount," window",I.windowCount===1?"":"s",", ",I.tabCount," tab",I.tabCount===1?"":"s"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:ve,disabled:Z==="restoring",className:"inline-flex items-center rounded-lg border border-blue-500/60 bg-blue-600/20 px-3 py-1.5 text-sm font-medium text-blue-100 transition-colors hover:bg-blue-600/30 disabled:cursor-not-allowed disabled:opacity-60",children:[Z==="restoring"?e.jsx(pe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Restore"]}),e.jsx("button",{type:"button",onClick:ge,className:"rounded-lg border border-slate-700 bg-slate-800/60 px-3 py-1.5 text-sm text-slate-300 transition-colors hover:bg-slate-700/80",children:"Dismiss"})]})]})}),!_&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(S,{componentName:"TabStrip",children:e.jsx(Ue,{})})}),O?e.jsxs("div",{className:"flex flex-1 min-h-0 min-w-0 overflow-hidden",children:[e.jsx("div",{className:"min-h-0 min-w-[320px] flex-shrink-0 flex-grow-0",style:{width:`${Math.round(A*100)}%`},children:e.jsx(Ae,{tab:p,overlayActive:F})}),e.jsx("div",{onMouseDown:he,className:"z-20 flex h-full w-[6px] cursor-col-resize items-center justify-center bg-slate-900/50 transition-colors hover:bg-slate-800",children:e.jsx("div",{className:"h-24 w-[2px] rounded-full bg-slate-700/80"})}),e.jsx("div",{className:"relative min-h-0 min-w-[260px] flex-1 overflow-hidden",style:{width:`${Math.round((1-A)*100)}%`},children:e.jsx("div",{className:"h-full min-h-0 overflow-auto border-l border-slate-800/60 bg-slate-950/40",children:e.jsx(ce,{})})})]}):e.jsx("div",{className:`relative flex-1 min-h-0 min-w-0 overflow-hidden ${_?"absolute inset-0":""}`,children:e.jsx("div",{className:`h-full min-h-0 overflow-auto ${F?"webview--masked":""}`,children:e.jsx(ce,{})})})]}),!_&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(S,{componentName:"RightPanel",children:e.jsx("div",{className:"h-full min-h-0 w-[340px] max-w-[380px] overflow-y-auto border-l border-slate-800/60",children:e.jsx(Be,{open:t,onClose:()=>o(!1)})})})})]}),!_&&e.jsx("div",{className:"flex-none",children:e.jsx(a.Suspense,{fallback:null,children:e.jsx(S,{componentName:"BottomStatus",children:e.jsx(qe,{})})})}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"AgentOverlay",children:e.jsx(Ye,{})})})}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"ClipperOverlay",children:e.jsx(Xe,{active:g,onCancel:()=>i(!1),onCreateHighlight:xe})})})}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"ReaderOverlay",children:e.jsx(Ze,{active:c,onClose:()=>y(!1),tabId:C.activeId,url:p?.url})})})}),G&&e.jsx(D,{children:e.jsx("div",{className:"pointer-events-none fixed inset-0 z-tour flex items-center justify-center",children:e.jsxs("div",{className:"rounded-3xl border border-purple-500/40 bg-purple-900/50 px-8 py-6 text-center shadow-[0_0_60px_rgba(168,85,247,0.35)] backdrop-blur-sm",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-purple-200/70",children:"Tab graph"}),e.jsx("div",{className:"mt-2 text-lg font-semibold text-purple-100",children:"Drop to map this tab's DNA"}),e.jsx("div",{className:"mt-1 text-xs text-purple-200/80",children:"Release anywhere to open the graph overlay."})]})})}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"TabGraphOverlay",children:e.jsx(Je,{})})})}),!_&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(S,{componentName:"VoiceTips",children:e.jsx(Me,{})})}),M&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"ConsentDashboard",children:e.jsx(Qe,{})})})}),l&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"TrustEthicsDashboard",children:e.jsx(et,{})})})}),d&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"OnboardingTour",children:e.jsx(tt,{onClose:()=>{}})})})}),n&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"CommandPalette",children:e.jsx(Ge,{onClose:()=>m(!1)})})})}),u&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"PermissionPrompt",children:e.jsx(We,{request:u,onClose:()=>f(null)})})})}),j&&e.jsx(a.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(S,{componentName:"ConsentPrompt",children:e.jsx(He,{request:j,onClose:()=>h(null)})})})}),$&&e.jsx(D,{children:e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("div",{className:`rounded-xl border px-4 py-3 text-sm shadow-xl shadow-black/40 ${$.variant==="success"?"border-emerald-400/40 bg-emerald-500/15 text-emerald-100":"border-amber-400/40 bg-amber-500/15 text-amber-100"}`,children:$.message})})})]})}const bt=Object.defineProperty({__proto__:null,AppShell:st},Symbol.toStringTag,{value:"Module"});export{bt as A,Re as M,Y as a,fe as b,De as c,Oe as u};
//# sourceMappingURL=AppShell-DzVtN4M2.js.map

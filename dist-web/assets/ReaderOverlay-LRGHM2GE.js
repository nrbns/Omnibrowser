import{r as a,u as G,j as e,i as u}from"./index-BquUM_dP.js";import{A as $}from"./index-TWPLI6s_.js";import{c as P,m as b}from"./proxy-BIEmBbur.js";import{B}from"./book-open-Cip1kOdb.js";import{L as y,S as R}from"./sparkles-B3IeNLsk.js";import{D}from"./download-B_E2bknD.js";import{X as O}from"./x-C_5K_ivr.js";import{R as U}from"./refresh-ccw-UxgP_6HK.js";import{T as V}from"./triangle-alert-CrRrQux7.js";import{E as _}from"./AppShell-BXhI_JTh.js";import"./ipc-events-CqodUROu.js";import"./use-ipc-event-CcVO0A42.js";import"./Portal-BzN9CTBx.js";import"./OmniDesk-BdBOPLft.js";import"./agentStreamStore-BcjkWHdN.js";import"./cloud-BWs6gXbb.js";import"./search-RYizLTqL.js";import"./formatDistanceToNow-Ctx6mZEP.js";import"./clock-gSt0ZU7N.js";import"./refresh-cw-BV6giV6D.js";import"./circle-check-DDsejJ4f.js";import"./trustDashboardStore-CKKody0H.js";const H=P("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);function pe({active:l,onClose:p,tabId:c,url:j}){const[r,v]=a.useState(null),[T,N]=a.useState(!1),[w,d]=a.useState(null),[z,g]=a.useState([]),[m,h]=a.useState(null),[o,S]=a.useState(!1),[f,x]=a.useState(null),[k,E]=a.useState(!1),[C,i]=a.useState(null),L=G(),n=a.useMemo(()=>L.tabs.find(t=>t.id===c),[L.tabs,c]);a.useEffect(()=>{if(!l){v(null),g([]),h(null),x(null),i(null);return}if(!c){d("No active tab to read.");return}(async()=>{N(!0),d(null),g([]),h(null),x(null);try{const s=await u.research.extractContent(c);if(!s||!s.content&&!s.html){d("Unable to extract article content for this page.");return}v({title:s.title||n?.title||n?.url||"Reader View",html:s.html||`<p>${Q(s.content)}</p>`,content:s.content||"",url:n?.url||j||void 0})}catch(s){console.error("Failed to load reader content:",s),d("Failed to load reader view for this page.")}finally{N(!1)}})()},[l,c,n,j]);const M=async()=>{if(r?.content){S(!0),x(null),i(null);try{const t=await u.reader.summarize({url:r.url,title:r.title,content:r.content,html:r.html});g(t.bullets),h(t.mode)}catch(t){console.error("Failed to summarize article:",t),x("Summarization failed. Try again or check AI settings.")}finally{S(!1)}}},F=async()=>{if(r?.html){E(!0),i(null);try{const t=await u.reader.export({url:r.url,title:r.title,html:r.html});t?.success?i(`Saved clean copy to ${t.path}`):i("Export failed. Please try again.")}catch(t){console.error("Failed to export reader view:",t),i("Export failed. Please try again.")}finally{E(!1)}}},A=t=>{t&&(u.tabs.create({url:t,mode:"normal"}).catch(console.error),p())};return l?e.jsx($,{children:l&&e.jsxs(e.Fragment,{children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:.6},exit:{opacity:0},className:"fixed inset-0 z-[70] bg-gray-950",onClick:p}),e.jsxs(b.div,{initial:{opacity:0,y:32},animate:{opacity:1,y:0},exit:{opacity:0,y:32},transition:{duration:.18},className:"fixed inset-8 z-[80] rounded-2xl border border-gray-800/70 bg-[#0B1120]/98 shadow-2xl backdrop-blur-xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-800/60 bg-gray-900/40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-500/20 border border-blue-500/30",children:e.jsx(B,{size:20,className:"text-blue-200"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:r?.title||n?.title||"Reader"}),e.jsx("div",{className:"text-xs text-gray-500",children:r?.url?q(r.url):n?.url})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:F,disabled:!r?.html||k,className:"flex items-center gap-2 px-3 py-2 text-sm rounded-lg border border-gray-700/60 bg-gray-800/50 hover:bg-gray-800/70 text-gray-200 disabled:opacity-60 disabled:cursor-not-allowed transition-colors",children:[k?e.jsx(y,{size:16,className:"animate-spin"}):e.jsx(D,{size:16}),"Export clean view"]}),e.jsxs("button",{onClick:()=>void M(),disabled:!r?.content||o,className:"flex items-center gap-2 px-3 py-2 text-sm rounded-lg bg-blue-600/70 hover:bg-blue-600 text-blue-50 border border-blue-500/40 disabled:opacity-60 disabled:cursor-not-allowed transition-colors",children:[o?e.jsx(y,{size:16,className:"animate-spin"}):e.jsx(R,{size:16}),"Cite-preserving summary"]}),e.jsx("button",{onClick:p,className:"p-2 rounded-lg hover:bg-gray-800/60 text-gray-400 hover:text-gray-200 transition-colors",title:"Close reader",children:e.jsx(O,{size:18})})]})]}),C&&e.jsxs("div",{className:"px-6 py-3 bg-emerald-500/10 border-b border-emerald-500/20 text-sm text-emerald-200 flex items-center justify-between",children:[e.jsx("span",{children:C}),e.jsx("button",{onClick:()=>i(null),className:"text-emerald-300 hover:text-emerald-100",children:"Dismiss"})]}),w?e.jsx("div",{className:"flex-1 flex items-center justify-center text-sm text-red-300 bg-red-500/10",children:w}):e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-[2fr_1fr] overflow-hidden",children:[e.jsxs("div",{className:"relative overflow-y-auto",children:[T&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-950/60 backdrop-blur-sm z-10",children:e.jsx(y,{size:32,className:"text-blue-400 animate-spin"})}),e.jsx("div",{className:"prose prose-invert max-w-none px-8 py-6",children:r?e.jsx("div",{className:"reader-article",dangerouslySetInnerHTML:{__html:r.html}}):e.jsx("div",{className:"text-center text-gray-500 text-sm py-12",children:"Preparing clean article view…"})})]}),e.jsxs("aside",{className:"border-l border-gray-800/60 bg-gray-900/30 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-800/50",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-100 flex items-center gap-2",children:[e.jsx(R,{size:16,className:"text-blue-300"}),"Summary with citations"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m==="local"&&"Generated locally (GGUF)",m==="cloud"&&"Generated via cloud model (with consent)",m==="extractive"&&"Extractive summary from source paragraphs",!m&&"Click summarize to generate key bullet points"]})]}),e.jsx("button",{onClick:()=>void M(),disabled:!r?.content||o,className:"p-2 rounded-lg border border-gray-700/50 text-gray-300 hover:text-gray-100 hover:bg-gray-800/60 disabled:opacity-50",title:"Refresh summary",children:e.jsx(U,{size:16,className:o?"animate-spin":""})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-4",children:[o&&e.jsxs("div",{className:"flex items-center justify-center h-full text-sm text-gray-400 gap-2",children:[e.jsx(y,{size:18,className:"animate-spin"}),"Generating summary…"]}),f&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-yellow-500/40 bg-yellow-500/10 text-yellow-200 px-3 py-2 text-sm",children:[e.jsx(V,{size:16}),f]}),!o&&!f&&z.length===0&&e.jsxs("div",{className:"text-sm text-gray-500",children:["The summary will include direct citations from the article to preserve attribution. Click"," ",e.jsx("span",{className:"text-blue-400",children:"“Cite-preserving summary”"})," to begin."]}),z.map((t,s)=>e.jsxs(b.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"rounded-xl border border-gray-700/50 bg-gray-900/50 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 text-gray-100",children:[e.jsx("div",{className:"flex items-center justify-center h-6 w-6 rounded-full bg-blue-500/20 border border-blue-500/40 text-xs text-blue-200",children:s+1}),e.jsx("p",{className:"text-sm leading-relaxed",children:t.summary})]}),t.citation&&e.jsxs("button",{onClick:()=>A(t.citation?.url),className:"mt-3 flex w-full items-start gap-2 rounded-lg bg-gray-900/70 border border-gray-800/70 px-3 py-2 text-xs text-gray-400 hover:text-gray-200 hover:border-gray-700 transition-colors text-left",children:[e.jsx(H,{size:14,className:"flex-shrink-0 text-gray-500"}),e.jsx("span",{className:"flex-1",children:t.citation.text.length>220?`${t.citation.text.slice(0,220)}…`:t.citation.text}),t.citation.url&&e.jsx(_,{size:12,className:"text-gray-500"})]})]},`${t.summary}-${s}`))]})]})]})]})]})}):null}function Q(l){return l.replace(/[<>]/g,"").replace(/\s+/g," ")}function q(l){try{return new URL(l).hostname}catch{return l}}export{pe as ReaderOverlay};
//# sourceMappingURL=ReaderOverlay-LRGHM2GE.js.map

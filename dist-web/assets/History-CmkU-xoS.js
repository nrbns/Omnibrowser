import{f as se,r as c,i as N,j as e}from"./index-dj7m1cGj.js";import{u as re}from"./use-ipc-event-Mlq2GWsh.js";import{C as ae}from"./clock-C2CbMN6U.js";import{c as le,m as q}from"./proxy-C7NQ8sMs.js";import{T as Q}from"./trash-2-WPlKMkyK.js";import{S as ie}from"./shield-check-Drnm7Ghu.js";import{T as ne}from"./triangle-alert-CX1V0b5r.js";import{S as D}from"./search-DY2JFyPs.js";import{L as oe}from"./loader-circle-B2cekLv2.js";import{X as P}from"./x-kCWGjBIF.js";import{F as ce}from"./filter-DdeWeMTy.js";import{G as $}from"./globe-CkFFXIIw.js";import{H as de}from"./hard-drive-Ba3Vv_NU.js";import{R as ue}from"./refresh-cw-81QnrOuz.js";import{E as xe}from"./external-link-uxSLXU_6.js";import{C as me}from"./copy-r_Uv8dWa.js";const he=le("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);function qe(){const r=se(),[i,n]=c.useState([]),[a,u]=c.useState(""),[h,o]=c.useState(!0),[g,v]=c.useState(null),[m,y]=c.useState("all"),[w,F]=c.useState(null),[W,A]=c.useState(!1),[T,G]=c.useState(null),[K,R]=c.useState("idle"),C=c.useRef(!0);c.useEffect(()=>()=>{C.current=!1},[]),c.useEffect(()=>{(async()=>{try{const t=await N.history.list();Array.isArray(t)?n(t):n([])}catch(t){console.error("Failed to load history:",t),n([])}finally{o(!1)}})()},[]),re("history:updated",()=>{N.history.list().then(s=>n(s||[])).catch(console.error)},[]),c.useEffect(()=>{const s=a.trim();if(s.length<2){F(null),A(!1);return}let t=!1;return A(!0),N.history.search(s).then(l=>{t||F(Array.isArray(l)?l:[])}).catch(l=>{t||(console.error("History search failed:",l),F([]))}).finally(()=>{t||A(!1)}),()=>{t=!0}},[a]);const k=c.useCallback(async()=>{if(!navigator?.storage?.estimate){C.current&&R("error");return}C.current&&R("loading");try{const{usage:s=0,quota:t=0}=await navigator.storage.estimate();if(!C.current)return;const l=t>0?s/t*100:0;G({usage:s,quota:t,percent:l,updatedAt:Date.now()}),R("idle")}catch(s){console.error("Failed to estimate storage:",s),C.current&&R("error")}},[]);c.useEffect(()=>{k();const s=window.setInterval(k,45e3);return()=>window.clearInterval(s)},[k]);const Y=c.useCallback(()=>{k()},[k]),S=c.useMemo(()=>{const s=new Set;let t=0,l=0,d=0;return i.forEach(f=>{try{const E=new URL(f.url);s.add(E.hostname),E.protocol==="https:"?t+=1:l+=1,M(f.url)&&(d+=1)}catch{}}),{total:i.length,uniqueDomains:s.size,secureCount:t,insecureCount:l,searchCount:d}},[i]),L=c.useMemo(()=>{const s=w??i;let t=s;if(!w&&a.trim()){const x=a.toLowerCase();t=s.filter(j=>j.title.toLowerCase().includes(x)||j.url.toLowerCase().includes(x))}m!=="all"&&(t=t.filter(x=>{switch(m){case"search":return!!M(x.url);case"secure":try{return new URL(x.url).protocol==="https:"}catch{return!1}case"insecure":try{return new URL(x.url).protocol!=="https:"}catch{return!1}default:return!0}}));const l={},d=Date.now(),f=1440*60*1e3,E=7*f,te=30*f;return t.forEach(x=>{const j=x.lastVisitTime??x.timestamp,b=d-j;let p;b<f?p="Today":b<f*2?p="Yesterday":b<E?p="This Week":b<te?p="This Month":p="Older",l[p]||(l[p]=[]),l[p].push(x)}),Object.entries(l).map(([x,j])=>({date:x,entries:j.sort((b,p)=>(p.lastVisitTime??p.timestamp)-(b.lastVisitTime??b.timestamp))})).sort((x,j)=>{const b=["Today","Yesterday","This Week","This Month","Older"];return b.indexOf(x.date)-b.indexOf(j.date)})},[i,w,a,m]),H=c.useMemo(()=>L.reduce((s,t)=>s+t.entries.length,0),[L]),X=async()=>{confirm("Are you sure you want to clear all browsing history?")&&(await N.history.clear(),n([]))},V=async s=>{await N.history.deleteUrl?.(s),n(i.filter(t=>t.url!==s)),v(t=>t?.url===s?null:t)},J=async s=>{try{await N.tabs.create(s)&&r("/")}catch(t){console.error("Failed to open history URL:",t),r("/"),setTimeout(()=>{N.tabs.create("about:blank").catch(console.error)},100)}},Z=s=>{if(Date.now()-s<1e3*60*60*24)return U(s);const l=new Date(s);return l.toLocaleDateString()+" "+l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},O=s=>{try{return`https://www.google.com/s2/favicons?domain=${new URL(s).hostname}&sz=32`}catch{return}},M=s=>{try{const t=new URL(s),l=t.hostname,d=t.searchParams;return l.includes("google")?d.get("q")||d.get("query"):l.includes("duckduckgo")||l.includes("bing.com")?d.get("q"):l.includes("search.yahoo.com")?d.get("p"):l.includes("youtube.com")||l.includes("youtu.be")?d.get("search_query"):l.includes("reddit.com")?d.get("q"):null}catch{return null}},_=(s,t)=>{if(!t)return s;const l=new RegExp(`(${ee(t)})`,"ig");return s.split(l).map((d,f)=>l.test(d)?e.jsx("mark",{className:"bg-blue-500/30 text-blue-100 rounded-sm px-0.5",children:d},f):e.jsx("span",{children:d},f))},ee=s=>s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return h?e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-[#1A1D28]",children:e.jsx(ae,{size:24,className:"text-blue-400 animate-spin"})}):e.jsxs("div",{className:"h-full w-full bg-[#1A1D28] text-gray-100 flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800/50",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"History"}),e.jsxs("span",{className:"text-xs uppercase tracking-[0.28em] text-gray-500 flex items-center gap-2",children:[e.jsx(he,{size:14}),S.total," visits · ",S.uniqueDomains," domains"]})]}),e.jsxs(q.button,{onClick:X,whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-900/60 hover:bg-red-600/20 border border-gray-700/50 text-gray-300 hover:text-red-400 transition-colors",children:[e.jsx(Q,{size:18}),e.jsx("span",{children:"Clear browsing data"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsx(I,{label:"Secure",value:S.secureCount,accent:"text-emerald-300",helper:"HTTPS pages",icon:e.jsx(ie,{size:16,className:"text-emerald-300"})}),e.jsx(I,{label:"Insecure",value:S.insecureCount,accent:"text-amber-300",helper:"HTTP pages",icon:e.jsx(ne,{size:16,className:"text-amber-300"})}),e.jsx(I,{label:"Searches",value:S.searchCount,accent:"text-blue-300",helper:"Recognised search queries",icon:e.jsx(D,{size:16,className:"text-blue-300"})}),e.jsx(ge,{usage:T?.usage??0,quota:T?.quota??0,percent:T?.percent??0,updatedAt:T?.updatedAt??0,status:K,onRefresh:Y})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),e.jsx("input",{type:"text",value:a,onChange:s=>u(s.target.value),placeholder:"Search history",className:"w-full h-10 pl-10 pr-4 bg-gray-900/60 border border-gray-700/50 rounded-lg text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50"}),W&&e.jsx(oe,{size:16,className:`absolute top-1/2 -translate-y-1/2 text-blue-400 animate-spin ${a?"right-9":"right-3"}`}),a&&e.jsx("button",{onClick:()=>u(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300",children:e.jsx(P,{size:18})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs text-gray-400",children:[e.jsx(ce,{size:14}),e.jsx(z,{active:m==="all",onClick:()=>y("all"),label:"All"}),e.jsx(z,{active:m==="search",onClick:()=>y("search"),label:"Search"}),e.jsx(z,{active:m==="secure",onClick:()=>y("secure"),label:"Secure"}),e.jsx(z,{active:m==="insecure",onClick:()=>y("insecure"),label:"Insecure"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 grid grid-cols-1 xl:grid-cols-[2fr_minmax(280px,1fr)] gap-4",children:[e.jsxs("div",{children:[w&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-xs text-blue-300",children:[e.jsx(D,{size:14}),e.jsxs("span",{children:["Showing ",H," high-relevance result",H===1?"":"s"," for “",a.trim(),"”"]})]}),L.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx($,{size:48,className:"text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:a?"No results found":"No history yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:a?"Try a different search term":"Pages you visit will appear here"})]}):e.jsx("div",{className:"space-y-6",children:L.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 mb-3 uppercase tracking-wide",children:s.date}),e.jsx("div",{className:"space-y-1",children:s.entries.map(t=>e.jsxs(q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`group flex items-center gap-3 p-3 rounded-lg bg-gray-900/60 hover:bg-gray-900/80 border transition-all cursor-pointer ${g?.id===t.id?"border-blue-500/40 shadow-[0_0_0_1px_rgba(59,130,246,0.35)]":"border-gray-800/50 hover:border-gray-700/50"}`,onClick:()=>v(t),children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-gray-800/50 rounded border border-gray-700/50",children:t.favicon||O(t.url)?e.jsx("img",{src:t.favicon||O(t.url),alt:"",className:"w-6 h-6",onError:l=>{l.target.style.display="none"}}):e.jsx($,{size:16,className:"text-gray-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-200 truncate",children:a?_(t.title||t.url,a):t.title||t.url}),e.jsx("span",{className:"text-xs text-gray-500 flex-shrink-0",children:Z(t.lastVisitTime??t.timestamp)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400 truncate",children:a?_(t.url,a):t.url}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.visitCount&&t.visitCount>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:[t.visitCount," visits"]}),M(t.url)&&e.jsx("span",{className:"text-[10px] uppercase tracking-wide px-2 py-0.5 rounded-full bg-blue-500/15 text-blue-300 border border-blue-500/30",children:"Search"}),(()=>{try{const l=new URL(t.url).protocol;return e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded-full border ${l==="https:"?"bg-emerald-500/15 text-emerald-300 border-emerald-500/30":"bg-amber-500/15 text-amber-200 border-amber-500/30"}`,children:l==="https:"?"Secure":"Insecure"})}catch{return null}})()]})]})]}),e.jsx(q.button,{onClick:l=>{l.stopPropagation(),V(t.url)},whileHover:{scale:1.1},whileTap:{scale:.9},className:"opacity-0 group-hover:opacity-100 flex-shrink-0 p-1.5 rounded-lg hover:bg-red-600/20 text-gray-500 hover:text-red-400 transition-all",title:"Remove from history",children:e.jsx(P,{size:16})})]},t.id))})]},s.date))})]}),e.jsx("aside",{className:"hidden xl:block",children:g?e.jsx(pe,{entry:g,detectSearchQuery:M,formatRelative:U,onOpen:()=>J(g.url),onCopy:()=>{navigator?.clipboard?.writeText&&navigator.clipboard.writeText(g.url).catch(console.error)},onRemove:()=>V(g.url)}):e.jsxs("div",{className:"sticky top-6 rounded-xl border border-gray-800/60 bg-gray-900/40 p-4 text-sm text-gray-500 flex flex-col items-center justify-center min-h-[240px]",children:[e.jsx($,{size:28,className:"text-gray-600 mb-3"}),e.jsx("p",{children:"Select a history item to see details, cached parameters, and quick actions."})]})})]})]})}function z({active:r,label:i,onClick:n}){return e.jsx("button",{type:"button",onClick:n,className:`flex items-center gap-1 px-2.5 py-1 rounded-full border text-xs transition-colors ${r?"border-blue-500/40 bg-blue-500/15 text-blue-200":"border-gray-700/60 bg-gray-900/40 text-gray-400 hover:border-gray-600 hover:text-gray-200"}`,children:i})}function I({label:r,value:i,helper:n,icon:a,accent:u}){return e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-gray-800/60 bg-gray-900/40 px-3 py-2 text-xs text-gray-400",children:[e.jsx("div",{className:"flex items-center justify-center h-8 w-8 rounded-md bg-gray-800/60 border border-gray-700/50",children:a}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"uppercase tracking-[0.24em] text-[10px] text-gray-500",children:r}),e.jsx("span",{className:`text-base font-semibold ${u}`,children:i}),e.jsx("span",{className:"text-[10px] text-gray-500",children:n})]})]})}function ge({usage:r,quota:i,percent:n,status:a,updatedAt:u,onRefresh:h}){const o=Number.isFinite(n)?Math.max(0,Math.min(100,n)):0,g=B(r),v=i>0?B(i):"—",m=`${o>=10?Math.round(o):o.toFixed(1)}%`,y=u?U(u):"moments ago";return e.jsxs("div",{className:"flex flex-col gap-2 rounded-lg border border-gray-800/60 bg-gray-900/40 px-3 py-2 text-xs text-gray-400 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center h-8 w-8 rounded-md bg-gray-800/60 border border-gray-700/50",children:e.jsx(de,{size:16,className:"text-indigo-300"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"uppercase tracking-[0.24em] text-[10px] text-gray-500",children:"Cache usage"}),e.jsx("span",{className:"text-base font-semibold text-indigo-200",children:g}),e.jsxs("span",{className:"text-[10px] text-gray-500",children:["of ",v," (",m,")"]})]})]}),e.jsx("button",{type:"button",onClick:h,disabled:a==="loading",className:"p-1.5 rounded-md border border-gray-700/60 text-gray-400 hover:text-indigo-200 hover:border-indigo-400/40 transition-colors disabled:opacity-60 disabled:cursor-not-allowed",title:"Refresh storage estimate",children:e.jsx(ue,{size:14,className:a==="loading"?"animate-spin text-indigo-200":"text-current"})})]}),e.jsx("div",{className:"w-full h-2 rounded-full bg-gray-800 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-400 to-blue-500 transition-[width] duration-300",style:{width:`${o}%`},"aria-valuenow":o,"aria-valuemin":0,"aria-valuemax":100})}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Updated ",a==="loading"?"…":y]}),a==="error"&&e.jsx("div",{className:"text-[10px] text-amber-300",children:"Storage estimate unavailable in this environment."})]})}function pe({entry:r,detectSearchQuery:i,formatRelative:n,onOpen:a,onCopy:u,onRemove:h}){let o=null;try{o=new URL(r.url)}catch{o=null}const g=o?i(r.url):null,v=o?Array.from(o.searchParams.entries()):[],m=r.lastVisitTime&&r.lastVisitTime>r.timestamp?r.lastVisitTime-r.timestamp:0;return e.jsxs("div",{className:"sticky top-6 rounded-xl border border-gray-800/60 bg-gray-900/50 p-4 shadow-[0_18px_45px_rgba(15,23,42,0.35)] text-sm text-gray-300 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-semibold text-gray-100",children:r.title||"Untitled page"}),e.jsx("p",{className:"text-xs text-gray-500 break-all",children:r.url})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("button",{type:"button",onClick:a,className:"p-1.5 rounded-md bg-blue-500/15 border border-blue-500/30 text-blue-200 hover:bg-blue-500/25 transition-colors",title:"Open in a new tab",children:e.jsx(xe,{size:14})}),e.jsx("button",{type:"button",onClick:u,className:"p-1.5 rounded-md bg-gray-800/60 border border-gray-700/60 text-gray-400 hover:text-gray-100 hover:bg-gray-800 transition-colors",title:"Copy URL",children:e.jsx(me,{size:14})}),e.jsx("button",{type:"button",onClick:h,className:"p-1.5 rounded-md bg-red-500/15 border border-red-500/40 text-red-200 hover:bg-red-500/25 transition-colors",title:"Remove from history",children:e.jsx(Q,{size:14})})]})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 uppercase tracking-[0.2em] text-[10px]",children:"First visit"}),e.jsx("span",{className:"text-gray-300",children:new Date(r.timestamp).toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:n(r.timestamp)})]}),r.lastVisitTime&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-gray-500 uppercase tracking-[0.2em] text-[10px]",children:"Last visit"}),e.jsx("span",{className:"text-gray-300",children:new Date(r.lastVisitTime).toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:n(r.lastVisitTime)})]}),r.visitCount&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 uppercase tracking-[0.2em] text-[10px]",children:"Visits"}),e.jsx("span",{className:"text-gray-300",children:r.visitCount})]}),m>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 uppercase tracking-[0.2em] text-[10px]",children:"Cache span"}),e.jsx("span",{className:"text-gray-300",children:ye(m)})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 uppercase tracking-[0.2em] text-[10px]",children:"Domain"}),e.jsx("span",{className:"text-gray-300",children:o.hostname})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-500 uppercase tracking-[0.2em] text-[10px]",children:"Protocol"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full border ${o.protocol==="https:"?"border-emerald-500/30 text-emerald-200 bg-emerald-500/15":"border-amber-500/30 text-amber-200 bg-amber-500/15"}`,children:o.protocol.replace(":","").toUpperCase()})]})]})]}),g&&e.jsxs("div",{className:"rounded-lg border border-blue-500/30 bg-blue-500/10 p-3 text-xs text-blue-100 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-blue-200",children:[e.jsx(D,{size:14}),"Recognised search query"]}),e.jsx("p",{className:"text-sm text-blue-100",children:g})]}),v.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-xs uppercase tracking-[0.24em] text-gray-500",children:"Query Parameters"}),e.jsx("div",{className:"space-y-1",children:v.map(([y,w])=>e.jsxs("div",{className:"flex items-start gap-2 rounded-md border border-gray-800/50 bg-gray-900/50 px-2 py-1 text-xs text-gray-400",children:[e.jsx("span",{className:"text-gray-300 font-medium min-w-[80px]",children:y}),e.jsx("span",{className:"break-all text-gray-400",children:w||"—"})]},y))})]})]})}const fe=[{unit:"year",ms:1e3*60*60*24*365},{unit:"month",ms:1e3*60*60*24*30},{unit:"week",ms:1e3*60*60*24*7},{unit:"day",ms:1e3*60*60*24},{unit:"hour",ms:1e3*60*60},{unit:"minute",ms:1e3*60},{unit:"second",ms:1e3}],be=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"});function U(r){const i=r-Date.now(),n=Math.abs(i);for(const{unit:a,ms:u}of fe)if(n>=u||a==="second"){const h=Math.round(i/u);return be.format(h,a)}return""}function B(r){if(!Number.isFinite(r)||r<=0)return"0 B";const i=["B","KB","MB","GB","TB"],n=Math.min(i.length-1,Math.floor(Math.log(r)/Math.log(1024))),a=r/Math.pow(1024,n);return`${a>=100?Math.round(a):Math.round(a*10)/10} ${i[n]}`}function ye(r){if(!Number.isFinite(r)||r<=0)return"—";let i=Math.floor(r/1e3);const n=[{label:"d",value:86400},{label:"h",value:3600},{label:"m",value:60}],a=[];for(const{label:u,value:h}of n)if(i>=h){const o=Math.floor(i/h);i-=o*h,a.push(`${o}${u}`)}return a.length===0&&a.push(`${Math.max(1,i)}s`),a.join(" ")}export{qe as default};
//# sourceMappingURL=History-CmkU-xoS.js.map

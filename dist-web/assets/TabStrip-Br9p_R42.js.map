{"version":3,"file":"TabStrip-Br9p_R42.js","sources":["../../node_modules/lucide-react/dist/esm/icons/flame.js","../../node_modules/lucide-react/dist/esm/icons/navigation.js","../../src/components/TopNav/TabHoverCard.tsx","../../src/state/peekStore.ts","../../src/components/layout/TabContextMenu.tsx","../../src/components/layout/PredictiveClusterChip.tsx","../../src/components/hologram/HolographicPreviewOverlay.tsx","../../src/components/layout/TabStrip.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Flame = createLucideIcon(\"Flame\", [\n  [\n    \"path\",\n    {\n      d: \"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z\",\n      key: \"96xj49\"\n    }\n  ]\n]);\n\nexport { Flame as default };\n//# sourceMappingURL=flame.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Navigation = createLucideIcon(\"Navigation\", [\n  [\"polygon\", { points: \"3 11 22 2 13 21 11 13 3 11\", key: \"1ltx0t\" }]\n]);\n\nexport { Navigation as default };\n//# sourceMappingURL=navigation.js.map\n","/**\r\n * TabHoverCard - Preview tab content on hover\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\n\r\ninterface TabHoverCardProps {\r\n  tabId: string;\r\n  children: React.ReactElement;\r\n}\r\n\r\nconst TabHoverCardComponent = React.forwardRef<HTMLDivElement, TabHoverCardProps>(\r\n  ({ tabId, children }, ref) => {\r\n    const [isHovered, setIsHovered] = useState(false);\r\n    const [preview, setPreview] = useState<{ title: string; url: string; thumbnail?: string } | null>(null);\r\n    const tabs = useTabsStore(s => s.tabs);\r\n    const tab = tabs.find(t => t.id === tabId);\r\n\r\n    useEffect(() => {\r\n      if (isHovered && tab) {\r\n        // Load preview data\r\n        setPreview({\r\n          title: tab.title || 'New Tab',\r\n          url: tab.url || 'about:blank',\r\n        });\r\n      }\r\n    }, [isHovered, tab]);\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        onMouseEnter={() => setIsHovered(true)}\r\n        onMouseLeave={() => setIsHovered(false)}\r\n        className=\"relative\"\r\n        style={{ pointerEvents: 'auto' }}\r\n        onClick={(e) => {\r\n          // Don't interfere with child clicks\r\n          if (e.target === e.currentTarget) {\r\n            e.stopPropagation();\r\n          }\r\n        }}\r\n      >\r\n        {children}\r\n        <AnimatePresence>\r\n          {isHovered && preview && (\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.95, y: 10 }}\r\n              animate={{ opacity: 1, scale: 1, y: 0 }}\r\n              exit={{ opacity: 0, scale: 0.95, y: 10 }}\r\n              className=\"absolute bottom-full left-0 mb-2 bg-gray-800 border border-gray-700 rounded-lg shadow-2xl z-[40] w-80 p-4\"\r\n              onMouseEnter={() => setIsHovered(true)}\r\n              onMouseLeave={() => setIsHovered(false)}\r\n              onClick={(e) => e.stopPropagation()}\r\n              onMouseDown={(e) => e.stopPropagation()}\r\n              style={{ pointerEvents: 'auto' }}\r\n            >\r\n              {preview.thumbnail && (\r\n                <img\r\n                  src={preview.thumbnail}\r\n                  alt={preview.title}\r\n                  className=\"w-full h-32 object-cover rounded mb-2\"\r\n                />\r\n              )}\r\n              <div className=\"text-sm font-medium text-gray-200 mb-1 truncate\">\r\n                {preview.title}\r\n              </div>\r\n              <div className=\"text-xs text-gray-400 truncate\">\r\n                {preview.url}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nTabHoverCardComponent.displayName = 'TabHoverCard';\r\n\r\nexport const TabHoverCard = TabHoverCardComponent;\r\n\r\n","import { create } from 'zustand';\r\nimport type { Tab } from './tabsStore';\r\n\r\ntype PeekState = {\r\n  visible: boolean;\r\n  tab: Tab | null;\r\n  open: (tab: Tab) => void;\r\n  close: () => void;\r\n  sync: (tab: Tab) => void;\r\n};\r\n\r\nexport const usePeekPreviewStore = create<PeekState>((set, get) => ({\r\n  visible: false,\r\n  tab: null,\r\n  open: (tab) => set({ visible: true, tab }),\r\n  close: () => set({ visible: false, tab: null }),\r\n  sync: (tab) => {\r\n    const current = get().tab;\r\n    if (current?.id === tab.id) {\r\n      set({ tab: { ...current, ...tab } });\r\n    }\r\n  },\r\n}));\r\n\r\n","/**\r\n * TabContextMenu - Right-click menu for tab actions (Ghost, Burn, etc.)\r\n */\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Ghost, Flame, Clock, Copy, Boxes, Eye, Sun, MoonStar } from 'lucide-react';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useProfileStore } from '../../state/profileStore';\r\nimport { useContainerStore } from '../../state/containerStore';\r\nimport { ContainerInfo } from '../../lib/ipc-events';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { usePeekPreviewStore } from '../../state/peekStore';\r\n\r\ninterface TabContextMenuProps {\r\n  tabId: string;\r\n  url: string;\r\n  containerId?: string;\r\n  containerName?: string;\r\n  containerColor?: string;\r\n  mode?: 'normal' | 'ghost' | 'private';\r\n  sleeping?: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function TabContextMenu({\r\n  tabId,\r\n  url,\r\n  containerId,\r\n  containerName,\r\n  containerColor,\r\n  mode,\r\n  sleeping,\r\n  onClose,\r\n}: TabContextMenuProps) {\r\n  const [position, setPosition] = useState({ x: 0, y: 0 });\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  const policy = useProfileStore((state) => state.policies[state.activeProfileId]);\r\n  const ghostDisabled = policy ? !policy.allowGhostTabs : false;\r\n  const privateDisabled = policy ? !policy.allowPrivateWindows : false;\r\n  const { containers, setContainers } = useContainerStore((state) => ({\r\n    containers: state.containers,\r\n    setContainers: state.setContainers,\r\n  }));\r\n  const tab = useTabsStore((state) => state.tabs.find((t) => t.id === tabId));\r\n  const openPeek = usePeekPreviewStore((state) => state.open);\r\n  const isSleeping = (sleeping ?? tab?.sleeping) ?? false;\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (e: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\r\n        onClose();\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, [onClose]);\r\n\r\n  useEffect(() => {\r\n    const storedPos = (window as any).__lastContextMenuPos || { x: 0, y: 0 };\r\n    setPosition({ x: storedPos.x, y: storedPos.y });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (containers.length === 0) {\r\n      ipc.containers\r\n        .list()\r\n        .then((list) => {\r\n          if (Array.isArray(list)) {\r\n            setContainers(list as ContainerInfo[]);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.error('Failed to load containers for context menu:', error);\r\n        });\r\n    }\r\n  }, [containers.length, setContainers]);\r\n\r\n  const resolveTab = () => ({\r\n    id: tab?.id ?? tabId,\r\n    title: tab?.title ?? tab?.url ?? url ?? 'New Tab',\r\n    url: tab?.url ?? url ?? 'about:blank',\r\n    containerId: tab?.containerId ?? containerId,\r\n    containerName: tab?.containerName ?? containerName,\r\n    containerColor: tab?.containerColor ?? containerColor,\r\n    mode: tab?.mode ?? mode,\r\n    createdAt: tab?.createdAt,\r\n    lastActiveAt: tab?.lastActiveAt,\r\n    sessionId: tab?.sessionId,\r\n    profileId: tab?.profileId,\r\n    sleeping: tab?.sleeping ?? sleeping ?? false,\r\n  });\r\n\r\n  const handleOpenAsGhost = async () => {\r\n    if (ghostDisabled) return;\r\n    try {\r\n      await ipc.private.createGhostTab({ url });\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to open as ghost:', error);\r\n    }\r\n  };\r\n\r\n  const handleBurnTab = async () => {\r\n    try {\r\n      if (confirm('Burn this tab? All data will be permanently deleted.')) {\r\n        await ipc.tabs.burn(tabId);\r\n        onClose();\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to burn tab:', error);\r\n    }\r\n  };\r\n\r\n  const handleStartTimer = async () => {\r\n    if (privateDisabled) return;\r\n    const minutes = prompt('Auto-close after (minutes):', '10');\r\n    if (minutes) {\r\n      try {\r\n        const ms = parseInt(minutes) * 60 * 1000;\r\n        await ipc.private.createWindow({ url, autoCloseAfter: ms });\r\n        onClose();\r\n      } catch (error) {\r\n        console.error('Failed to start timer:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDuplicate = async (targetContainerId?: string, activate = true) => {\r\n    try {\r\n      await ipc.tabs.create({\r\n        url: url || 'about:blank',\r\n        containerId: targetContainerId ?? containerId,\r\n        activate,\r\n      });\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to duplicate tab:', error);\r\n    }\r\n  };\r\n\r\n  const handleMoveToContainer = async (targetId: string) => {\r\n    if (!targetId || targetId === containerId) {\r\n      onClose();\r\n      return;\r\n    }\r\n    try {\r\n      const result = await ipc.tabs.setContainer(tabId, targetId);\r\n      if (!result?.success) {\r\n        console.warn('Failed to switch container:', result?.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to switch tab container:', error);\r\n    } finally {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handlePeek = () => {\r\n    openPeek(resolveTab());\r\n    onClose();\r\n  };\r\n\r\n  const handleWake = async () => {\r\n    try {\r\n      await ipc.tabs.wake(tabId);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to wake tab:', error);\r\n    }\r\n  };\r\n\r\n  const isGhost = mode === 'ghost';\r\n  const isPrivate = mode === 'private';\r\n\r\n  const menuItems = [\r\n    { icon: Eye, label: 'Peek preview', action: handlePeek },\r\n    { icon: Copy, label: 'Duplicate Tab', action: () => handleDuplicate(containerId, true), disabled: isGhost || isPrivate },\r\n    {\r\n      icon: Ghost,\r\n      label: 'Open as Ghost',\r\n      action: handleOpenAsGhost,\r\n      hide: isGhost,\r\n      disabled: ghostDisabled,\r\n      disabledReason: 'Disabled by profile policy',\r\n    },\r\n    { icon: Flame, label: 'Burn Tab', action: handleBurnTab, danger: true },\r\n    {\r\n      icon: Clock,\r\n      label: 'Start 10-min Timer',\r\n      action: handleStartTimer,\r\n      disabled: privateDisabled,\r\n      disabledReason: 'Disabled by profile policy',\r\n    },\r\n    {\r\n      icon: Sun,\r\n      label: 'Wake tab',\r\n      action: handleWake,\r\n      hide: !isSleeping,\r\n    },\r\n  ].filter(item => !item.hide);\r\n\r\n  const moveTargets = !isGhost && !isPrivate\r\n    ? containers.filter((c: ContainerInfo) => c.id !== containerId)\r\n    : [];\r\n\r\n  const openTargets = containers.filter((c: ContainerInfo) => c.id !== containerId);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        ref={menuRef}\r\n        initial={{ opacity: 0, scale: 0.95 }}\r\n        animate={{ opacity: 1, scale: 1 }}\r\n        exit={{ opacity: 0, scale: 0.95 }}\r\n        transition={{ duration: 0.15 }}\r\n        className=\"fixed z-50 bg-surface-elevated text-foreground border border-subtle rounded-lg shadow-elevated py-1 min-w-[200px]\"\r\n        style={{\r\n          left: `${position.x}px`,\r\n          top: `${position.y}px`,\r\n        }}\r\n      >\r\n        {isSleeping && (\r\n          <div className=\"px-3 py-2 text-xs text-amber-500 bg-amber-500/10 border-b border-subtle flex items-center gap-2\">\r\n            <MoonStar size={14} />\r\n            <span>Tab is hibernating</span>\r\n          </div>\r\n        )}\r\n\r\n        {(containerId || containerName) && (\r\n          <div className=\"px-3 py-2 text-xs text-muted border-b border-subtle flex items-center gap-2\">\r\n            <div\r\n              className=\"w-2.5 h-2.5 rounded-full border border-gray-500/30\"\r\n              style={{ backgroundColor: containerColor || '#6366f1' }}\r\n            />\r\n            <span>{containerName || (containerId === 'default' ? 'Default container' : containerId)}</span>\r\n          </div>\r\n        )}\r\n\r\n        {menuItems.map((item, idx) => {\r\n          const Icon = item.icon;\r\n          return (\r\n            <motion.button\r\n              key={idx}\r\n              whileHover={item.disabled ? undefined : { scale: 1.01 }}\r\n              onClick={item.action}\r\n              className={`w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors ${\r\n                item.danger\r\n                  ? 'text-red-500 hover:bg-red-500/10'\r\n                  : item.disabled\r\n                  ? 'text-muted cursor-not-allowed'\r\n                  : 'text-foreground hover:bg-[color:var(--surface-muted)]/45'\r\n              }`}\r\n              disabled={item.disabled}\r\n              title={\r\n                item.disabled\r\n                  ? item.disabledReason || 'Disabled by profile policy'\r\n                  : undefined\r\n              }\r\n            >\r\n              <Icon size={16} />\r\n              <span>{item.label}</span>\r\n            </motion.button>\r\n          );\r\n        })}\r\n\r\n        {openTargets.length > 0 && (\r\n          <div className=\"mt-1 border-t border-subtle pt-1.5\">\r\n            <div className=\"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2\">\r\n              <Boxes size={12} />\r\n              Open copy in container\r\n            </div>\r\n            <div className=\"flex flex-col\">\r\n              {openTargets.map((container) => (\r\n                <motion.button\r\n                  key={`open-${container.id}`}\r\n                  whileHover={{ scale: 1.01 }}\r\n                  onClick={() => handleDuplicate(container.id, true)}\r\n                  className=\"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors\"\r\n                >\r\n                  <span\r\n                    className=\"w-2.5 h-2.5 rounded-full border border-gray-500/30\"\r\n                    style={{ backgroundColor: container.color || '#6366f1' }}\r\n                  />\r\n                  <span className=\"truncate\">{container.name}</span>\r\n                </motion.button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {moveTargets.length > 0 && (\r\n          <div className=\"mt-1 border-t border-subtle pt-1.5\">\r\n            <div className=\"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2\">\r\n              <Boxes size={12} />\r\n              Move to container\r\n            </div>\r\n            <div className=\"flex flex-col\">\r\n              {moveTargets.map((container) => (\r\n                <motion.button\r\n                  key={container.id}\r\n                  whileHover={{ scale: 1.01 }}\r\n                  onClick={() => handleMoveToContainer(container.id)}\r\n                  className=\"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors\"\r\n                >\r\n                  <span\r\n                    className=\"w-2.5 h-2.5 rounded-full border border-gray-500/30\"\r\n                    style={{ backgroundColor: container.color || '#6366f1' }}\r\n                  />\r\n                  <span className=\"truncate\">{container.name}</span>\r\n                </motion.button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\n","import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { PlayCircle, Navigation } from 'lucide-react';\r\n\r\ntype Cluster = { id: string; label: string; tabIds: string[]; confidence?: number };\r\n\r\ntype PrefetchEntry = { tabId: string; url: string; reason: string; confidence?: number };\r\n\r\ninterface PredictiveClusterChipProps {\r\n  clusters: Cluster[];\r\n  summary?: string | null;\r\n  onApply: (clusterId: string) => void;\r\n}\r\n\r\nexport function PredictiveClusterChip({ clusters, summary, onApply }: PredictiveClusterChipProps) {\r\n  const [index, setIndex] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (!clusters.length) {\r\n      setIndex(0);\r\n    } else if (index >= clusters.length) {\r\n      setIndex(0);\r\n    }\r\n  }, [clusters, index]);\r\n\r\n  if (!clusters.length) return null;\r\n\r\n  const current = clusters[index];\r\n  const confidence = typeof current.confidence === 'number' ? Math.round(current.confidence * 100) : null;\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, x: -10 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: -10 }}\r\n      className=\"no-drag flex items-center gap-2 mr-3\"\r\n    >\r\n      <button\r\n        type=\"button\"\r\n        onClick={() => onApply(current.id)}\r\n        className=\"flex items-center gap-1.5 rounded-full border border-blue-500/40 bg-blue-500/15 px-3 py-1.5 text-xs text-blue-100 transition-colors hover:bg-blue-500/25\"\r\n        title={summary ?? 'Redix suggests regrouping these tabs into a focused workspace.'}\r\n      >\r\n        <PlayCircle size={12} />\r\n        <span className=\"font-semibold\">Regroup {current.label}</span>\r\n        {confidence !== null && <span className=\"text-[11px] text-blue-200/80\">{confidence}%</span>}\r\n      </button>\r\n      {clusters.length > 1 && (\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setIndex((prev) => (prev + 1) % clusters.length)}\r\n          className=\"rounded-full border border-slate-700/60 p-1.5 text-[10px] text-slate-300 transition-colors hover:text-slate-100\"\r\n          aria-label=\"Next suggested cluster\"\r\n        >\r\n          ●\r\n        </button>\r\n      )}\r\n    </motion.div>\r\n  );\r\n}\r\n\r\ninterface PredictivePrefetchHintProps {\r\n  entry: PrefetchEntry | null;\r\n  onOpen: (entry: PrefetchEntry) => void;\r\n}\r\n\r\nexport function PredictivePrefetchHint({ entry, onOpen }: PredictivePrefetchHintProps) {\r\n  if (!entry) return null;\r\n\r\n  let hostLabel = entry.url;\r\n  try {\r\n    hostLabel = new URL(entry.url).hostname.replace(/^www\\./, '');\r\n  } catch {\r\n    // keep original url\r\n  }\r\n\r\n  const confidence = typeof entry.confidence === 'number' ? Math.round(entry.confidence * 100) : null;\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, x: -10 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: -10 }}\r\n      className=\"no-drag flex items-center gap-2 mr-3\"\r\n    >\r\n      <button\r\n        type=\"button\"\r\n        onClick={() => onOpen(entry)}\r\n        className=\"flex items-center gap-1.5 rounded-full border border-emerald-500/40 bg-emerald-500/15 px-3 py-1.5 text-xs text-emerald-100 transition-colors hover:bg-emerald-500/25\"\r\n        title={entry.reason}\r\n      >\r\n        <Navigation size={12} />\r\n        <span className=\"font-semibold\">Scout {hostLabel}</span>\r\n        {confidence !== null && <span className=\"text-[11px] text-emerald-200/80\">{confidence}%</span>}\r\n      </button>\r\n    </motion.div>\r\n  );\r\n}\r\n","import { useEffect, useState, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface HologramOverlayProps {\r\n  visible: boolean;\r\n  tabId: string | null;\r\n  url?: string;\r\n  title?: string;\r\n  onClose: () => void;\r\n}\r\n\r\ndeclare global {\r\n  interface Window {\r\n    AFRAME?: unknown;\r\n  }\r\n}\r\n\r\nconst WEBXR_SUPPORTED = typeof navigator !== 'undefined' && 'xr' in navigator;\r\nconst AFRAME_CDN = 'https://unpkg.com/aframe@1.5.0/dist/aframe.min.js';\r\n\r\nasync function ensureAFrameRuntime(): Promise<boolean> {\r\n  if (typeof window === 'undefined') return false;\r\n  if (window.AFRAME) return true;\r\n\r\n  return new Promise<boolean>((resolve) => {\r\n    const existing = document.querySelector<HTMLScriptElement>(`script[data-hologram=\"aframe\"]`);\r\n    if (existing) {\r\n      existing.addEventListener('load', () => resolve(true), { once: true });\r\n      existing.addEventListener('error', () => resolve(false), { once: true });\r\n      return;\r\n    }\r\n\r\n    const script = document.createElement('script');\r\n    script.src = AFRAME_CDN;\r\n    script.async = true;\r\n    script.crossOrigin = 'anonymous';\r\n    script.dataset.hologram = 'aframe';\r\n    script.addEventListener('load', () => resolve(true), { once: true });\r\n    script.addEventListener('error', () => resolve(false), { once: true });\r\n    document.head.appendChild(script);\r\n  });\r\n}\r\n\r\nexport function HolographicPreviewOverlay({ visible, tabId, url, title, onClose }: HologramOverlayProps) {\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  const [xrSupported, setXrSupported] = useState(WEBXR_SUPPORTED);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    if (!visible || !containerRef.current) return;\r\n\r\n    if (!WEBXR_SUPPORTED) {\r\n      setXrSupported(false);\r\n      return;\r\n    }\r\n\r\n    (async () => {\r\n      const ok = await ensureAFrameRuntime();\r\n      if (cancelled) return;\r\n      if (ok) {\r\n        setXrSupported(true);\r\n      } else {\r\n        console.warn('[Hologram] Failed to load A-Frame runtime from CDN');\r\n        setXrSupported(false);\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [visible]);\r\n\r\n  if (!visible || !tabId) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-md\">\r\n        <motion.div\r\n          initial={{ opacity: 0, scale: 0.95 }}\r\n          animate={{ opacity: 1, scale: 1 }}\r\n          exit={{ opacity: 0, scale: 0.95 }}\r\n          transition={{ duration: 0.2 }}\r\n          className=\"relative w-[720px] max-w-[92vw] rounded-3xl border border-cyan-500/40 bg-cyan-950/90 p-6 shadow-[0_20px_80px_rgba(8,145,178,0.25)]\"\r\n        >\r\n          <div className=\"flex items-start justify-between gap-4\">\r\n            <div>\r\n              <div className=\"text-xs uppercase tracking-wide text-cyan-200/80\">Holographic Preview</div>\r\n              <div className=\"text-lg font-semibold text-cyan-100\">{title || 'Live Tab'}</div>\r\n              <div className=\"text-xs text-cyan-100/70 break-all\">{url}</div>\r\n            </div>\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"rounded-full border border-cyan-400/30 bg-cyan-500/10 px-3 py-1 text-xs text-cyan-100 hover:bg-cyan-500/20\"\r\n            >\r\n              Close\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"mt-4 overflow-hidden rounded-2xl border border-cyan-500/30 bg-cyan-900/60 p-4\">\r\n            {!xrSupported && (\r\n              <div className=\"flex flex-col items-center justify-center gap-2 py-16 text-center text-sm text-cyan-100/80\">\r\n                <p>WebXR holograms require a compatible browser/device.</p>\r\n                <p className=\"text-xs text-cyan-200/60\">Fallback: switch tabs to view this content directly.</p>\r\n              </div>\r\n            )}\r\n            {xrSupported && (\r\n              <div ref={containerRef} className=\"relative h-[360px] w-full\">\r\n                {/* A-Frame scene; keeps simple plane preview for now */}\r\n                <iframe\r\n                  src={`/hologram.html?tabId=${encodeURIComponent(tabId)}`}\r\n                  className=\"h-full w-full rounded-xl border-none\"\r\n                  allow=\"xr-spatial-tracking; vr; webxr\"\r\n                  title={`Holographic preview for tab ${tabId}`}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </motion.div>\r\n      </div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","/**\r\n * TabStrip - Floating tab bar with Arc-like design\r\n * Fully functional tab management with real-time updates\r\n */\r\n\r\n// @ts-nocheck\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Plus, Eye, Sparkles } from 'lucide-react';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { ipcEvents } from '../../lib/ipc-events';\r\nimport { TabHoverCard } from '../TopNav/TabHoverCard';\r\nimport { TabContextMenu } from './TabContextMenu';\r\nimport { usePeekPreviewStore } from '../../state/peekStore';\r\nimport { Portal } from '../common/Portal';\r\nimport { useTabGraphStore } from '../../state/tabGraphStore';\r\nimport { PredictiveClusterChip, PredictivePrefetchHint } from './PredictiveClusterChip';\r\nimport { HolographicPreviewOverlay } from '../hologram';\r\nimport { isDevEnv, isElectronRuntime } from '../../lib/env';\r\n\r\nconst TAB_GRAPH_DRAG_MIME = 'application/x-omnibrowser-tab-id';\r\nconst IS_DEV = isDevEnv();\r\nconst IS_ELECTRON = isElectronRuntime();\r\n\r\ninterface Tab {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  favicon?: string;\r\n  active: boolean;\r\n  mode?: 'normal' | 'ghost' | 'private';\r\n  containerId?: string;\r\n  containerName?: string;\r\n  containerColor?: string;\r\n  createdAt?: number;\r\n  lastActiveAt?: number;\r\n  sessionId?: string;\r\n  profileId?: string;\r\n  sleeping?: boolean;\r\n}\r\n\r\nconst mapTabsForStore = (list: Tab[]) =>\r\n  list.map((t) => ({\r\n    id: t.id,\r\n    title: t.title,\r\n    active: t.active,\r\n    url: t.url,\r\n    mode: t.mode,\r\n    containerId: t.containerId,\r\n    containerColor: t.containerColor,\r\n    containerName: t.containerName,\r\n    createdAt: t.createdAt,\r\n    lastActiveAt: t.lastActiveAt,\r\n    sessionId: t.sessionId,\r\n    profileId: t.profileId,\r\n    sleeping: t.sleeping,\r\n  }));\r\n\r\nexport function TabStrip() {\r\n  const { setAll: setAllTabs, setActive: setActiveTab, activeId } = useTabsStore();\r\n  const [tabs, setTabs] = useState<Tab[]>([]);\r\n  const [predictedClusters, setPredictedClusters] = useState<Array<{ id: string; label: string; tabIds: string[]; confidence?: number }>>([]);\r\n  const [prefetchEntries, setPrefetchEntries] = useState<Array<{ tabId: string; url: string; reason: string; confidence?: number }>>([]);\r\n  const [predictionSummary, setPredictionSummary] = useState<string | null>(null);\r\n  const [holographicPreviewTabId, setHolographicPreviewTabId] = useState<string | null>(null);\r\n  const [previewMetadata, setPreviewMetadata] = useState<{ url?: string; title?: string } | null>(null);\r\n  const [hologramSupported, setHologramSupported] = useState<boolean | null>(null);\r\n  const [handoffStatus, setHandoffStatus] = useState<{ platform: string; lastSentAt: number | null }>({ platform: 'desktop', lastSentAt: null });\r\n  const [contextMenu, setContextMenu] = useState<{\r\n    tabId: string;\r\n    url: string;\r\n    containerId?: string;\r\n    containerName?: string;\r\n    containerColor?: string;\r\n    mode?: 'normal' | 'ghost' | 'private';\r\n    sleeping?: boolean;\r\n    x: number;\r\n    y: number;\r\n  } | null>(null);\r\n  const [hasInitialized, setHasInitialized] = useState(false);\r\n  const isRestoringRef = useRef(false);\r\n  const isCreatingTabRef = useRef(false); // Prevent infinite tab creation loops\r\n  const previousTabIdsRef = useRef<string>(''); // Track tab IDs to prevent unnecessary updates\r\n  const currentActiveIdRef = useRef<string | null>(null); // Track active ID without causing re-renders\r\n  const activationInFlightRef = useRef<string | null>(null); // Track activations to avoid duplicate work\r\n  const stripRef = useRef<HTMLDivElement>(null);\r\n  const tabsRef = useRef<Tab[]>(tabs);\r\n  const openPeek = usePeekPreviewStore((state) => state.open);\r\n  const predictiveRequestRef = useRef<Promise<void> | null>(null);\r\n  const lastPredictionSignatureRef = useRef<string>('');\r\n  const fetchPredictiveSuggestionsRef = useRef<(options?: { force?: boolean }) => Promise<void> | void>();\r\n  \r\n  // Keep ref in sync with activeId (doesn't cause re-renders)\r\n  useEffect(() => {\r\n    currentActiveIdRef.current = activeId;\r\n  }, [activeId]);\r\n\r\n  const runPredictiveSuggestions = useCallback(\r\n    async (options?: { force?: boolean }) => {\r\n      if (!IS_ELECTRON) {\r\n        // Predictive suggestions require IPC/Electron – clear any stale hints\r\n        if (options?.force) {\r\n          setPredictedClusters([]);\r\n          setPrefetchEntries([]);\r\n          setPredictionSummary(null);\r\n        }\r\n        return;\r\n      }\r\n      if (predictiveRequestRef.current && !options?.force) {\r\n        return predictiveRequestRef.current;\r\n      }\r\n\r\n      const signature = tabsRef.current\r\n        .map((tab) => `${tab.id}:${tab.lastActiveAt ?? 0}`)\r\n        .sort()\r\n        .join('|');\r\n\r\n      if (!options?.force && signature && signature === lastPredictionSignatureRef.current && predictedClusters.length > 0) {\r\n        return;\r\n      }\r\n\r\n      const requestPromise = (async () => {\r\n        try {\r\n          const response = await ipc.tabs.predictiveGroups(options?.force ? { force: true } : {});\r\n          lastPredictionSignatureRef.current = signature;\r\n          if (!response) {\r\n            setPredictedClusters([]);\r\n            setPrefetchEntries([]);\r\n            setPredictionSummary(null);\r\n            return;\r\n          }\r\n\r\n          setPredictedClusters(Array.isArray(response.groups) ? response.groups : []);\r\n          setPrefetchEntries(Array.isArray(response.prefetch) ? response.prefetch : []);\r\n          setPredictionSummary(response.summary?.explanation ?? null);\r\n        } catch (error) {\r\n          if (IS_DEV) {\r\n            console.warn('[TabStrip] Predictive suggestions failed', error);\r\n          }\r\n          if (options?.force) {\r\n            setPredictedClusters([]);\r\n            setPrefetchEntries([]);\r\n            setPredictionSummary(null);\r\n          }\r\n        } finally {\r\n          if (predictiveRequestRef.current === requestPromise) {\r\n            predictiveRequestRef.current = null;\r\n          }\r\n        }\r\n      })();\r\n\r\n      predictiveRequestRef.current = requestPromise;\r\n      return requestPromise;\r\n    },\r\n    [predictedClusters.length]\r\n  );\r\n\r\n  useEffect(() => {\r\n    fetchPredictiveSuggestionsRef.current = runPredictiveSuggestions;\r\n  }, [runPredictiveSuggestions]);\r\n\r\n  useEffect(() => {\r\n    if (!hasInitialized) return;\r\n    fetchPredictiveSuggestionsRef.current?.({ force: true });\r\n  }, [hasInitialized]);\r\n\r\n  const refreshTabsFromMain = useCallback(async () => {\r\n    if (!IS_ELECTRON) {\r\n      return;\r\n    }\r\n    try {\r\n      const tabList = await ipc.tabs.list();\r\n      if (!Array.isArray(tabList)) return;\r\n\r\n      const mappedTabs = tabList.map((t: any) => ({\r\n        id: t.id,\r\n        title: t.title || 'New Tab',\r\n        url: t.url || 'about:blank',\r\n        active: t.active || false,\r\n        mode: t.mode || 'normal',\r\n        containerId: t.containerId,\r\n        containerName: t.containerName,\r\n        containerColor: t.containerColor,\r\n        createdAt: t.createdAt,\r\n        lastActiveAt: t.lastActiveAt,\r\n        sessionId: t.sessionId,\r\n        profileId: t.profileId,\r\n      }));\r\n\r\n      const ids = mappedTabs.map(t => t.id).sort().join(',');\r\n      previousTabIdsRef.current = ids;\r\n\r\n      setTabs(mappedTabs);\r\n      tabsRef.current = mappedTabs;\r\n      setAllTabs(mapTabsForStore(mappedTabs));\r\n\r\n      const activeTab = mappedTabs.find(t => t.active);\r\n      if (activeTab) {\r\n        setActiveTab(activeTab.id);\r\n        currentActiveIdRef.current = activeTab.id;\r\n      } else if (mappedTabs.length === 0) {\r\n        setActiveTab(null);\r\n        currentActiveIdRef.current = null;\r\n      }\r\n\r\n      fetchPredictiveSuggestionsRef.current?.();\r\n    } catch (error) {\r\n      if (IS_DEV) {\r\n        console.error('[TabStrip] Failed to refresh tabs from main process:', error);\r\n      }\r\n    }\r\n  }, [setActiveTab, setAllTabs]);\r\n\r\n  useEffect(() => {\r\n    const checkHologramSupport = () => {\r\n      const supported = typeof navigator !== 'undefined' && 'xr' in navigator;\r\n      setHologramSupported(supported);\r\n      if (supported) {\r\n        setHandoffStatus((prev) => ({ ...prev, platform: 'xr-ready' }));\r\n      }\r\n    };\r\n    checkHologramSupport();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!handoffStatus.lastSentAt) return;\r\n    void ipc.crossReality.sendHandoffStatus(handoffStatus);\r\n  }, [handoffStatus]);\r\n\r\n  // Wait for IPC to be ready before making calls\r\n  useEffect(() => {\r\n    if (!IS_ELECTRON) {\r\n      let isMounted = true;\r\n\r\n      const applyTabs = (list: Tab[]) => {\r\n        if (!isMounted) return;\r\n        const mapped = list.length\r\n          ? list\r\n          : [\r\n              {\r\n                id: 'local-initial',\r\n                title: 'Welcome',\r\n                url: 'https://omnibrowser.dev/',\r\n                active: true,\r\n                mode: 'normal',\r\n              },\r\n            ];\r\n        setTabs(mapped);\r\n        tabsRef.current = mapped;\r\n        previousTabIdsRef.current = mapped.map((t) => t.id).sort().join(',');\r\n        setAllTabs(mapTabsForStore(mapped));\r\n        const activeTab = mapped.find((t) => t.active) ?? mapped[0];\r\n        setActiveTab(activeTab ? activeTab.id : null);\r\n        currentActiveIdRef.current = activeTab ? activeTab.id : null;\r\n        setHasInitialized(true);\r\n      };\r\n\r\n      applyTabs(tabsRef.current.length > 0 ? tabsRef.current : tabs);\r\n\r\n      const unsubscribe = ipcEvents.on<TabUpdate[]>('tabs:updated', (tabList) => {\r\n        if (!isMounted) return;\r\n        if (!Array.isArray(tabList) || tabList.length === 0) {\r\n          applyTabs([]);\r\n          return;\r\n        }\r\n        const mappedTabs: Tab[] = tabList.map((t) => ({\r\n          id: t.id,\r\n          title: t.title || 'New Tab',\r\n          url: t.url || 'about:blank',\r\n          active: Boolean(t.active),\r\n          mode: (t as any).mode || 'normal',\r\n          containerId: t.containerId,\r\n          containerName: t.containerName,\r\n          containerColor: t.containerColor,\r\n          createdAt: t.createdAt,\r\n          lastActiveAt: t.lastActiveAt,\r\n          sessionId: t.sessionId,\r\n          profileId: t.profileId,\r\n          sleeping: (t as any).sleeping,\r\n        }));\r\n        applyTabs(mappedTabs);\r\n      });\r\n\r\n      return () => {\r\n        isMounted = false;\r\n        unsubscribe();\r\n      };\r\n    }\r\n\r\n    let isMounted = true;\r\n    let ipcReady = false;\r\n    \r\n    const waitForIPC = () => {\r\n      return new Promise<void>((resolve) => {\r\n        if (window.ipc && typeof (window.ipc as any).invoke === 'function') {\r\n          ipcReady = true;\r\n          resolve();\r\n          return;\r\n        }\r\n        \r\n        const checkIPC = () => {\r\n          if (window.ipc && typeof (window.ipc as any).invoke === 'function') {\r\n            ipcReady = true;\r\n            resolve();\r\n          }\r\n        };\r\n        \r\n        // Listen for IPC ready signal\r\n        window.addEventListener('ipc:ready', checkIPC, { once: true });\r\n        \r\n        // Also check periodically (fallback)\r\n        const interval = setInterval(() => {\r\n          if (window.ipc && typeof (window.ipc as any).invoke === 'function') {\r\n            clearInterval(interval);\r\n            ipcReady = true;\r\n            resolve();\r\n          }\r\n        }, 100);\r\n        \r\n        // Timeout after 5 seconds\r\n        setTimeout(() => {\r\n          clearInterval(interval);\r\n          if (!ipcReady) {\r\n            console.warn('IPC not ready after 5 seconds, proceeding anyway');\r\n            resolve();\r\n          }\r\n        }, 5000);\r\n      });\r\n    };\r\n    \r\n    const loadTabs = async (isInitialLoad = false) => {\r\n      if (!isMounted) return;\r\n      \r\n      // CRITICAL: Don't load tabs if we're creating one (prevents loops)\r\n      if (isCreatingTabRef.current && !isInitialLoad) {\r\n        return;\r\n      }\r\n      \r\n      // Wait for IPC to be ready\r\n      if (!ipcReady) {\r\n        await waitForIPC();\r\n      }\r\n      \r\n      if (!isMounted) return;\r\n      \r\n      try {\r\n        const tabList = await ipc.tabs.list();\r\n        if (!isMounted) return;\r\n        \r\n        if (Array.isArray(tabList) && tabList.length > 0) {\r\n          const mappedTabs = tabList.map((t: any) => ({\r\n            id: t.id,\r\n            title: t.title || 'New Tab',\r\n            url: t.url || 'about:blank',\r\n            active: t.active || false,\r\n            mode: t.mode || 'normal',\r\n            containerId: t.containerId,\r\n            containerName: t.containerName,\r\n            containerColor: t.containerColor,\r\n            createdAt: t.createdAt,\r\n            lastActiveAt: t.lastActiveAt,\r\n            sessionId: t.sessionId,\r\n            profileId: t.profileId,\r\n          }));\r\n          \r\n          // Update ref to track tab IDs and only update state if changed\r\n          const tabIds = mappedTabs.map(t => t.id).sort().join(',');\r\n          if (previousTabIdsRef.current !== tabIds) {\r\n            previousTabIdsRef.current = tabIds;\r\n            setTabs(mappedTabs);\r\n            setAllTabs(mapTabsForStore(mappedTabs));\r\n          }\r\n          \r\n          // Set active tab in store (only if changed - use ref to avoid dependency)\r\n          const activeTab = mappedTabs.find(t => t.active);\r\n          const currentActive = currentActiveIdRef.current;\r\n          if (activeTab && activeTab.id !== currentActive) {\r\n            setActiveTab(activeTab.id);\r\n          } else if (mappedTabs.length > 0 && !activeTab && mappedTabs[0] && mappedTabs[0].id !== currentActive) {\r\n            // No active tab, activate first one\r\n            await ipc.tabs.activate({ id: mappedTabs[0].id });\r\n            setActiveTab(mappedTabs[0].id);\r\n          }\r\n          \r\n          if (isInitialLoad) {\r\n            setHasInitialized(true);\r\n          }\r\n        } else {\r\n          // Only create initial tab on first mount, not every time tabs are empty\r\n          // AND only if we're not restoring from session\r\n          // AND only if we're not already creating a tab\r\n          // AND only if we haven't already initialized (prevent HMR duplicates)\r\n          if (isInitialLoad && !hasInitialized && !isRestoringRef.current && !isCreatingTabRef.current) {\r\n            // Always wait a bit to allow session restoration to complete\r\n            // This prevents creating duplicate tabs during HMR or session restore\r\n            setTimeout(async () => {\r\n              // Double-check conditions after delay\r\n              if (!isMounted || hasInitialized || isRestoringRef.current || isCreatingTabRef.current) {\r\n                return;\r\n              }\r\n              \r\n              // Check again if tabs exist after waiting (they might have been restored)\r\n              try {\r\n                const recheckTabs = await ipc.tabs.list();\r\n                if (Array.isArray(recheckTabs) && recheckTabs.length > 0) {\r\n                  // Tabs exist (restored from session or created elsewhere), don't create new one\r\n                  setHasInitialized(true);\r\n                  return;\r\n                }\r\n              } catch {\r\n                // Ignore errors, proceed to create tab\r\n              }\r\n              \r\n              // Still no tabs after waiting, create one\r\n              isCreatingTabRef.current = true;\r\n              setHasInitialized(true);\r\n              \r\n              try {\r\n                // Ensure IPC is ready\r\n                if (!window.ipc || typeof (window.ipc as any).invoke !== 'function') {\r\n                  await new Promise(resolve => setTimeout(resolve, 200));\r\n                }\r\n                \r\n                const result = await ipc.tabs.create('about:blank');\r\n                if (result && result.id) {\r\n                  if (IS_DEV) {\r\n                    console.log('[TabStrip] Initial tab created after wait:', result.id);\r\n                  }\r\n                }\r\n              } catch (error) {\r\n                if (IS_DEV) {\r\n                  console.error('[TabStrip] Failed to create initial tab:', error);\r\n                }\r\n              } finally {\r\n                setTimeout(() => {\r\n                  isCreatingTabRef.current = false;\r\n                }, 1000);\r\n              }\r\n            }, 300); // Wait 300ms to allow session restoration\r\n          } else {\r\n            // No tabs and we've already initialized - just clear state\r\n            if (isMounted) {\r\n              setTabs([]);\r\n              setAllTabs([]);\r\n              setActiveTab(null);\r\n              if (!hasInitialized) {\r\n                setHasInitialized(true);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } catch {\r\n        // Silently handle errors - don't auto-create tab on error\r\n        if (isInitialLoad && isMounted && !hasInitialized) {\r\n          setHasInitialized(true);\r\n        }\r\n      }\r\n    };\r\n\r\n    // Listen for session restoration state (only once)\r\n    const handleRestoring = (restoring: boolean) => {\r\n      if (isMounted) {\r\n        isRestoringRef.current = restoring;\r\n      }\r\n    };\r\n    \r\n    const unsubscribeRestoring = ipcEvents.on<boolean>('session:restoring', handleRestoring);\r\n    \r\n    // Listen for restore tab messages (only once)\r\n    const handleRestoreTab = async (tabState: any) => {\r\n      if (!isMounted || isCreatingTabRef.current) return;\r\n      \r\n      isCreatingTabRef.current = true;\r\n      try {\r\n        await ipc.tabs.create({\r\n          url: tabState.url || 'about:blank',\r\n          containerId: tabState.containerId,\r\n          mode: tabState.mode,\r\n          profileId: tabState.profileId,\r\n          tabId: tabState.id,\r\n          activate: Boolean(tabState.activate),\r\n          createdAt: tabState.createdAt,\r\n          lastActiveAt: tabState.lastActiveAt,\r\n          sessionId: tabState.sessionId,\r\n          fromSessionRestore: true,\r\n        });\r\n      } catch (error) {\r\n        if (IS_DEV) {\r\n          console.error('Failed to restore tab from session:', error);\r\n        }\r\n      } finally {\r\n        // Reset flag after a delay\r\n        setTimeout(() => {\r\n          isCreatingTabRef.current = false;\r\n        }, 500);\r\n      }\r\n    };\r\n    \r\n    const unsubscribeRestoreTab = ipcEvents.on<any>('session:restore-tab', handleRestoreTab);\r\n\r\n    // Initial load only - don't auto-create tabs on subsequent updates\r\n    // Add a small delay to ensure session restoration has a chance to complete first\r\n    const initTimer = setTimeout(() => {\r\n      loadTabs(true);\r\n    }, 100);\r\n\r\n    // Listen for tab updates via IPC events (more reliable)\r\n    // IPC events are the source of truth - always sync with them\r\n    const handleTabUpdate = (tabList: any[]) => {\r\n      // Don't process updates if component is unmounted or invalid data\r\n      if (!isMounted || !Array.isArray(tabList)) {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] handleTabUpdate: Invalid data or unmounted', { isMounted, tabList });\r\n        }\r\n        return;\r\n      }\r\n      \r\n      // Only log in development if there's a significant change or error\r\n      if (IS_DEV && false) { // Disabled to reduce console noise\r\n        console.log('[TabStrip] handleTabUpdate received:', tabList.map(t => ({ id: t.id, active: t.active })));\r\n      }\r\n      \r\n    const mappedTabs = tabList.map((t: any) => ({\r\n      id: t.id,\r\n      title: t.title || 'New Tab',\r\n      url: t.url || 'about:blank',\r\n      active: t.active || false,\r\n      containerId: t.containerId,\r\n      containerName: t.containerName,\r\n      containerColor: t.containerColor,\r\n      mode: t.mode,\r\n      createdAt: t.createdAt,\r\n      lastActiveAt: t.lastActiveAt,\r\n      sessionId: t.sessionId,\r\n      profileId: t.profileId,\r\n      sleeping: Boolean(t.sleeping),\r\n    }));\r\n\r\n    const peekState = usePeekPreviewStore.getState();\r\n    if (peekState.visible && peekState.tab) {\r\n      const updatedPeek = mappedTabs.find((t) => t.id === peekState.tab?.id);\r\n      if (updatedPeek) {\r\n        usePeekPreviewStore.getState().sync(updatedPeek);\r\n      }\r\n    }\r\n      \r\n      // Find the active tab from IPC (source of truth)\r\n      const activeTabFromIPC = mappedTabs.find(t => t.active);\r\n      const activeTabIdFromIPC = activeTabFromIPC?.id || null;\r\n      \r\n      // Compare tab IDs to detect if tabs were added/removed\r\n      const newTabIds = mappedTabs.map(t => t.id).sort().join(',');\r\n      const currentTabIds = previousTabIdsRef.current;\r\n      \r\n      // Always update tabs array to reflect current state from main process\r\n      // This ensures UI stays in sync even if optimistic updates were wrong\r\n      setTabs(mappedTabs);\r\n      tabsRef.current = mappedTabs;\r\n      setAllTabs(mapTabsForStore(mappedTabs));\r\n      \r\n      // Update previousTabIdsRef to track changes\r\n      if (currentTabIds !== newTabIds) {\r\n        previousTabIdsRef.current = newTabIds;\r\n      }\r\n      \r\n      // ALWAYS sync active tab with IPC (main process is source of truth)\r\n      // This overrides any optimistic updates\r\n      if (activeTabIdFromIPC) {\r\n        if (currentActiveIdRef.current !== activeTabIdFromIPC || activeId !== activeTabIdFromIPC) {\r\n          // Sync active tab from IPC (main process is source of truth)\r\n          setActiveTab(activeTabIdFromIPC);\r\n          currentActiveIdRef.current = activeTabIdFromIPC;\r\n        }\r\n      } else if (mappedTabs.length > 0) {\r\n        // No active tab in IPC, but tabs exist - activate first one\r\n        const firstTabId = mappedTabs[0].id;\r\n        if (currentActiveIdRef.current !== firstTabId && activeId !== firstTabId) {\r\n          // Don't call IPC here - main process should handle this\r\n          // Just update UI to match\r\n          setActiveTab(firstTabId);\r\n          currentActiveIdRef.current = firstTabId;\r\n        }\r\n      } else {\r\n        // No tabs at all\r\n        if (currentActiveIdRef.current !== null || activeId !== null) {\r\n          setActiveTab(null);\r\n          currentActiveIdRef.current = null;\r\n        }\r\n      }\r\n    };\r\n\r\n    // Subscribe to IPC events via the event bus (only once)\r\n    const unsubscribe = ipcEvents.on('tabs:updated', handleTabUpdate);\r\n      \r\n    // Fallback polling if events don't work (less frequent) - reduced frequency\r\n    // Only poll to sync state, don't auto-create tabs\r\n    // Note: We can poll even when creating tabs - loadTabs won't create duplicate tabs\r\n    const pollInterval = setInterval(() => {\r\n      if (isMounted && ipcReady && hasInitialized) {\r\n        // Only skip if actively creating to avoid race conditions during creation\r\n        if (!isCreatingTabRef.current) {\r\n          loadTabs(false).catch(() => {}); // Silent error handling\r\n        }\r\n      }\r\n    }, 10000); // Poll every 10 seconds as fallback (reduced frequency)\r\n      \r\n    return () => {\r\n      isMounted = false;\r\n      unsubscribe();\r\n      unsubscribeRestoring();\r\n      unsubscribeRestoreTab();\r\n      clearInterval(pollInterval);\r\n      clearTimeout(initTimer);\r\n    };\r\n  }, []); // Empty deps - only run on mount, IPC events handle all updates\r\n\r\n  const addTab = async () => {\r\n    if (!IS_ELECTRON) {\r\n      const baseTabs = (tabsRef.current.length > 0 ? tabsRef.current : tabs).map((t) => ({\r\n        ...t,\r\n        active: false,\r\n      }));\r\n      const newTab: Tab = {\r\n        id: `local-${Date.now()}`,\r\n        title: 'New Tab',\r\n        url: 'about:blank',\r\n        active: true,\r\n        mode: 'normal',\r\n      };\r\n      const updated = [...baseTabs, newTab];\r\n      setTabs(updated);\r\n      tabsRef.current = updated;\r\n      previousTabIdsRef.current = updated.map((t) => t.id).sort().join(',');\r\n      setAllTabs(mapTabsForStore(updated));\r\n      setActiveTab(newTab.id);\r\n      currentActiveIdRef.current = newTab.id;\r\n      ipcEvents.emit('tabs:updated', mapTabsForStore(updated));\r\n      return;\r\n    }\r\n\r\n    // Prevent multiple simultaneous tab creations (debounce)\r\n    if (isCreatingTabRef.current) {\r\n      if (IS_DEV) {\r\n        console.log('[TabStrip] Tab creation already in progress, skipping');\r\n      }\r\n      return;\r\n    }\r\n    \r\n    isCreatingTabRef.current = true;\r\n    try {\r\n      // Ensure IPC is ready\r\n      if (!window.ipc || typeof (window.ipc as any).invoke !== 'function') {\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n      }\r\n      \r\n      const result = await ipc.tabs.create('about:blank');\r\n      if (result && result.id) {\r\n        // Tab created successfully - IPC event will update the UI\r\n        if (IS_DEV) {\r\n          console.log('[TabStrip] Tab created via addTab:', result.id);\r\n        }\r\n      } else {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] Tab creation returned no ID:', result);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      if (IS_DEV) {\r\n        console.error('Failed to create tab:', error);\r\n      }\r\n    } finally {\r\n      // Reset flag quickly - IPC events will handle the update\r\n      // Don't wait too long or we'll block legitimate updates\r\n      setTimeout(() => {\r\n        isCreatingTabRef.current = false;\r\n      }, 100); // Reduced from 500ms to 100ms\r\n    }\r\n  };\r\n\r\n  const closeTab = async (tabId: string) => {\r\n    if (!IS_ELECTRON) {\r\n      const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n      const idx = currentTabs.findIndex((t) => t.id === tabId);\r\n      if (idx === -1) {\r\n        return;\r\n      }\r\n      const wasActive = currentTabs[idx]?.active;\r\n      const remaining = currentTabs.filter((t) => t.id !== tabId);\r\n      let updated = remaining;\r\n\r\n      if (remaining.length === 0) {\r\n        const fallbackTab: Tab = {\r\n          id: `local-${Date.now()}`,\r\n          title: 'New Tab',\r\n          url: 'about:blank',\r\n          active: true,\r\n          mode: 'normal',\r\n        };\r\n        updated = [fallbackTab];\r\n      } else if (wasActive) {\r\n        const nextIndex = Math.min(idx, remaining.length - 1);\r\n        updated = remaining.map((t, index) => ({\r\n          ...t,\r\n          active: index === nextIndex,\r\n        }));\r\n      }\r\n\r\n      const activeTab = updated.find((t) => t.active) ?? updated[0];\r\n\r\n      setTabs(updated);\r\n      tabsRef.current = updated;\r\n      previousTabIdsRef.current = updated.map((t) => t.id).sort().join(',');\r\n      setAllTabs(mapTabsForStore(updated));\r\n      setActiveTab(activeTab ? activeTab.id : null);\r\n      currentActiveIdRef.current = activeTab ? activeTab.id : null;\r\n      ipcEvents.emit('tabs:updated', mapTabsForStore(updated));\r\n      return;\r\n    }\r\n\r\n    // Prevent closing if already creating a tab\r\n    if (isCreatingTabRef.current) {\r\n      return;\r\n    }\r\n\r\n    // Get current tabs\r\n    const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n    const tabToClose = currentTabs.find(t => t.id === tabId);\r\n    if (!tabToClose) {\r\n      return;\r\n    }\r\n\r\n    const wasActive = tabToClose.active;\r\n    const tabIndex = currentTabs.findIndex(t => t.id === tabId);\r\n    const remainingTabs = currentTabs.filter(t => t.id !== tabId);\r\n    const snapshotTabs = currentTabs.map(t => ({ ...t }));\r\n    const previousActiveId = currentActiveIdRef.current;\r\n    \r\n    // Update UI immediately (optimistic update)\r\n    setTabs(remainingTabs);\r\n    tabsRef.current = remainingTabs;\r\n    previousTabIdsRef.current = remainingTabs.map(t => t.id).sort().join(',');\r\n    setAllTabs(mapTabsForStore(remainingTabs));\r\n\r\n    // If closing active tab, activate the next one\r\n    if (wasActive && remainingTabs.length > 0) {\r\n      const nextTabIndex = Math.min(tabIndex, remainingTabs.length - 1);\r\n      const nextTab = remainingTabs[nextTabIndex];\r\n      if (nextTab) {\r\n        setActiveTab(nextTab.id);\r\n        currentActiveIdRef.current = nextTab.id;\r\n      }\r\n    } else if (remainingTabs.length === 0) {\r\n      setActiveTab(null);\r\n      currentActiveIdRef.current = null;\r\n    }\r\n\r\n    if (IS_DEV) {\r\n      console.log('[TabStrip] Closing tab (optimistic):', tabId, 'previous active:', previousActiveId);\r\n    }\r\n\r\n    try {\r\n      const result = await Promise.race([\r\n        ipc.tabs.close({ id: tabId }),\r\n        new Promise<{ success: boolean; error?: string }>((resolve) =>\r\n          setTimeout(() => resolve({ success: false, error: 'Timeout' }), 2000)\r\n        ),\r\n      ]);\r\n\r\n      if (IS_DEV) {\r\n        console.log('[TabStrip] tabs.close result:', result);\r\n      }\r\n\r\n      if (!result || !result.success) {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] Tab close failed or timed out, reverting:', tabId, result?.error);\r\n        }\r\n\r\n        setTabs(snapshotTabs);\r\n        tabsRef.current = snapshotTabs;\r\n        previousTabIdsRef.current = snapshotTabs.map(t => t.id).sort().join(',');\r\n        setAllTabs(mapTabsForStore(snapshotTabs));\r\n\r\n        if (previousActiveId) {\r\n          setActiveTab(previousActiveId);\r\n          currentActiveIdRef.current = previousActiveId;\r\n        }\r\n\r\n        await refreshTabsFromMain();\r\n      }\r\n    } catch (error) {\r\n      if (IS_DEV) {\r\n        console.error('[TabStrip] Exception during tab close, reverting:', error);\r\n      }\r\n\r\n      setTabs(snapshotTabs);\r\n      tabsRef.current = snapshotTabs;\r\n      previousTabIdsRef.current = snapshotTabs.map(t => t.id).sort().join(',');\r\n      setAllTabs(mapTabsForStore(snapshotTabs));\r\n\r\n      if (previousActiveId) {\r\n        setActiveTab(previousActiveId);\r\n        currentActiveIdRef.current = previousActiveId;\r\n      }\r\n\r\n      await refreshTabsFromMain();\r\n    }\r\n  };\r\n\r\n  const activateTab = async (tabId: string) => {\r\n    if (!IS_ELECTRON) {\r\n      const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n      const tabToActivate = currentTabs.find((t) => t.id === tabId);\r\n      if (!tabToActivate) {\r\n        return;\r\n      }\r\n      const updated = currentTabs.map((t) => ({\r\n        ...t,\r\n        active: t.id === tabId,\r\n      }));\r\n      setTabs(updated);\r\n      tabsRef.current = updated;\r\n      previousTabIdsRef.current = updated.map((t) => t.id).sort().join(',');\r\n      setAllTabs(mapTabsForStore(updated));\r\n      setActiveTab(tabId);\r\n      currentActiveIdRef.current = tabId;\r\n      ipcEvents.emit('tabs:updated', mapTabsForStore(updated));\r\n      return;\r\n    }\r\n\r\n    // Prevent activating if already the active tab\r\n    if (activeId === tabId || activationInFlightRef.current === tabId) {\r\n      return;\r\n    }\r\n\r\n    // Get current tabs from ref (most up-to-date)\r\n    const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n    const tabToActivate = currentTabs.find(t => t.id === tabId);\r\n    if (!tabToActivate) {\r\n      if (IS_DEV) {\r\n        console.warn('[TabStrip] Tab not found for activation:', tabId, 'Available tabs:', currentTabs.map(t => t.id));\r\n      }\r\n      return;\r\n    }\r\n\r\n    activationInFlightRef.current = tabId;\r\n\r\n    // Optimistically update active tab for immediate feedback\r\n    // Note: IPC event will confirm/correct this, so we don't need to worry about conflicts\r\n    const previousActiveId = currentActiveIdRef.current;\r\n    const snapshotTabs = currentTabs.map(t => ({ ...t }));\r\n\r\n    // Update UI immediately for responsiveness\r\n    setActiveTab(tabId);\r\n    currentActiveIdRef.current = tabId;\r\n    \r\n    // Update tabs array to reflect active state optimistically\r\n    const updatedTabs = currentTabs.map(t => ({\r\n      ...t,\r\n      active: t.id === tabId\r\n    }));\r\n    setTabs(updatedTabs);\r\n    tabsRef.current = updatedTabs;\r\n    setAllTabs(mapTabsForStore(updatedTabs));\r\n\r\n    if (IS_DEV) {\r\n      console.log('[TabStrip] Activating tab (optimistic):', tabId, 'previous:', previousActiveId);\r\n    }\r\n\r\n    try {\r\n      const result = await Promise.race([\r\n        ipc.tabs.activate({ id: tabId }),\r\n        new Promise<{ success: boolean; error?: string }>((resolve) =>\r\n          setTimeout(() => resolve({ success: false, error: 'Timeout' }), 2000)\r\n        ),\r\n      ]);\r\n\r\n      if (IS_DEV) {\r\n        console.log('[TabStrip] tabs.activate result:', result);\r\n      }\r\n\r\n      if (!result || !result.success) {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] Tab activation failed or timed out, reverting:', tabId, result?.error);\r\n        }\r\n\r\n        // Revert optimistic update\r\n        setTabs(snapshotTabs);\r\n        tabsRef.current = snapshotTabs;\r\n        previousTabIdsRef.current = snapshotTabs.map(t => t.id).sort().join(',');\r\n        setAllTabs(mapTabsForStore(snapshotTabs));\r\n\r\n        if (previousActiveId) {\r\n          setActiveTab(previousActiveId);\r\n          currentActiveIdRef.current = previousActiveId;\r\n        }\r\n\r\n        await refreshTabsFromMain();\r\n      } else if (IS_DEV) {\r\n        console.log('[TabStrip] Tab activation acknowledged by IPC:', tabId);\r\n      }\r\n    } catch (error) {\r\n      if (IS_DEV) {\r\n        console.error('[TabStrip] Exception during tab activation, reverting:', error);\r\n      }\r\n\r\n      setTabs(snapshotTabs);\r\n      tabsRef.current = snapshotTabs;\r\n      previousTabIdsRef.current = snapshotTabs.map(t => t.id).sort().join(',');\r\n      setAllTabs(mapTabsForStore(snapshotTabs));\r\n\r\n      if (previousActiveId) {\r\n        setActiveTab(previousActiveId);\r\n        currentActiveIdRef.current = previousActiveId;\r\n      }\r\n\r\n      await refreshTabsFromMain();\r\n    } finally {\r\n      activationInFlightRef.current = null;\r\n    }\r\n  };\r\n\r\n  const handleApplyCluster = useCallback((clusterId: string) => {\r\n    const cluster = predictedClusters.find((c) => c.id === clusterId);\r\n    if (!cluster) return;\r\n    if (!cluster.tabIds.length) return;\r\n\r\n    const currentTabs = tabsRef.current;\r\n    const matching = currentTabs.filter((tab) => cluster.tabIds.includes(tab.id));\r\n    if (matching.length <= 1) return;\r\n\r\n    let etld = 'workspace';\r\n    try {\r\n      if (matching[0]?.url) {\r\n        etld = new URL(matching[0].url).hostname.replace(/^www\\./, '') || 'workspace';\r\n      }\r\n    } catch {\r\n      etld = 'workspace';\r\n    }\r\n\r\n    const label = matching.length >= 3 ? `${etld} cluster` : cluster.label;\r\n\r\n    void ipc.tabs.create({\r\n      url: 'about:blank',\r\n      containerId: etld,\r\n      activate: true,\r\n    }).then(async (result: any) => {\r\n      if (!result?.id) return;\r\n      for (const tab of matching) {\r\n        try {\r\n          await ipc.tabs.moveToWorkspace({ tabId: tab.id, workspaceId: result.id, label });\r\n        } catch (error) {\r\n          if (IS_DEV) {\r\n            console.warn('[TabStrip] Failed to regroup tab', error);\r\n          }\r\n        }\r\n      }\r\n      setTimeout(() => {\r\n        void useTabGraphStore.getState().refresh();\r\n      }, 300);\r\n      fetchPredictiveSuggestionsRef.current?.({ force: true });\r\n    });\r\n  }, [predictedClusters]);\r\n\r\n  const handlePrefetchOpen = useCallback(\r\n    (entry: { tabId: string; url: string; reason: string; confidence?: number }) => {\r\n      if (!entry?.url) return;\r\n      void ipc.tabs.create({ url: entry.url, activate: true }).then(() => {\r\n        fetchPredictiveSuggestionsRef.current?.({ force: true });\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  // Ensure active tab stays visible (only when activeId changes)\r\n  useEffect(() => {\r\n    if (!activeId || !stripRef.current) return;\r\n    try {\r\n      const el = stripRef.current.querySelector(`[data-tab=\"${CSS.escape(activeId)}\"]`);\r\n      (el as any)?.scrollIntoView?.({ block: 'nearest', inline: 'center', behavior: 'smooth' });\r\n    } catch {}\r\n  }, [activeId]); // Only depend on activeId, not tabs array\r\n\r\n  // Keyboard navigation (Left/Right/Home/End)\r\n  // Use refs to access current tabs/activeId without causing re-renders\r\n  const activeIdRef = useRef(activeId);\r\n  \r\n  useEffect(() => {\r\n    tabsRef.current = tabs;\r\n    activeIdRef.current = activeId;\r\n  }, [tabs, activeId]);\r\n  \r\n  useEffect(() => {\r\n    if (!stripRef.current || !activeId) {\r\n      return;\r\n    }\r\n\r\n    const target = stripRef.current.querySelector<HTMLDivElement>(\r\n      `[data-tab=\"${CSS.escape(activeId)}\"]`\r\n    );\r\n    target?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\r\n  }, [activeId, tabs.length]);\r\n\r\n  const handleKeyNavigation = useCallback(\r\n    (event: React.KeyboardEvent<HTMLDivElement>) => {\r\n      if (!['ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(event.key)) {\r\n        return;\r\n      }\r\n\r\n      const currentIndex = tabs.findIndex((t) => t.id === activeId);\r\n      if (currentIndex === -1) {\r\n        return;\r\n      }\r\n\r\n      event.preventDefault();\r\n\r\n      let nextIndex = currentIndex;\r\n      switch (event.key) {\r\n        case 'Home':\r\n          nextIndex = 0;\r\n          break;\r\n        case 'End':\r\n          nextIndex = tabs.length - 1;\r\n          break;\r\n        case 'ArrowLeft':\r\n          nextIndex = (currentIndex - 1 + tabs.length) % tabs.length;\r\n          break;\r\n        case 'ArrowRight':\r\n          nextIndex = (currentIndex + 1) % tabs.length;\r\n          break;\r\n      }\r\n\r\n      const nextTab = tabs[nextIndex];\r\n      if (nextTab) {\r\n        activateTab(nextTab.id);\r\n      }\r\n    },\r\n    [tabs, activeId, activateTab]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const handleModifiedShortcuts = (event: KeyboardEvent) => {\r\n      const isMac = navigator.platform.toUpperCase().includes('MAC');\r\n      const modifier = isMac ? event.metaKey : event.ctrlKey;\r\n\r\n      if (!modifier || event.key !== 'Tab') {\r\n        return;\r\n      }\r\n\r\n      const currentTabs = tabsRef.current;\r\n      const currentActiveId = activeIdRef.current;\r\n      if (!currentTabs.length || !currentActiveId) {\r\n        return;\r\n      }\r\n\r\n      event.preventDefault();\r\n      const currentIndex = currentTabs.findIndex((tab) => tab.id === currentActiveId);\r\n      if (currentIndex === -1) {\r\n        return;\r\n      }\r\n\r\n      const nextIndex = event.shiftKey\r\n        ? (currentIndex - 1 + currentTabs.length) % currentTabs.length\r\n        : (currentIndex + 1) % currentTabs.length;\r\n\r\n      const nextTab = currentTabs[nextIndex];\r\n      if (nextTab) {\r\n        activateTab(nextTab.id);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleModifiedShortcuts);\r\n    return () => window.removeEventListener('keydown', handleModifiedShortcuts);\r\n  }, [activateTab]);\r\n\r\n  return (\r\n    <>\r\n      <div \r\n        ref={stripRef} \r\n        role=\"tablist\"\r\n        aria-label=\"Browser tabs\"\r\n        className=\"no-drag flex items-center gap-1 px-3 py-2 bg-[#1A1D28] border-b border-gray-700/30 overflow-x-auto scrollbar-hide\"\r\n        style={{ pointerEvents: 'auto' }}\r\n        onKeyDown={handleKeyNavigation}\r\n        data-onboarding=\"tabstrip\"\r\n      >\r\n        <PredictivePrefetchHint entry={prefetchEntries[0] ?? null} onOpen={handlePrefetchOpen} />\r\n        <PredictiveClusterChip clusters={predictedClusters} onApply={handleApplyCluster} summary={predictionSummary} />\r\n        <div className=\"flex items-center gap-2 min-w-0 flex-1\" style={{ pointerEvents: 'auto' }}>\r\n          <AnimatePresence mode=\"popLayout\">\r\n            {tabs.length > 0 ? (\r\n              tabs.map((tab) => {\r\n                const prefetchForTab = prefetchEntries.find((entry) => entry.tabId === tab.id);\r\n                return (\r\n                <TabHoverCard key={tab.id} tabId={tab.id}>\r\n                  <motion.div\r\n                    data-tab={tab.id}\r\n                    role=\"tab\"\r\n                    aria-selected={tab.active}\r\n                    aria-label={`Tab: ${tab.title}${tab.mode === 'ghost' ? ' (Ghost tab)' : tab.mode === 'private' ? ' (Private tab)' : ''}${tab.sleeping ? ' (Hibernating)' : ''}`}\r\n                    tabIndex={tab.active ? 0 : -1}\r\n                    layout\r\n                    initial={{ opacity: 0, scale: 0.8 }}\r\n                    animate={{ opacity: 1, scale: 1 }}\r\n                    exit={{ opacity: 0, scale: 0.8 }}\r\n                    className={`\r\n                      relative flex items-center gap-2 px-4 py-2 rounded-lg\r\n                      min-w-[100px] max-w-[220px] cursor-pointer group\r\n                      transition-all duration-200\r\n                      focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\r\n                      ${tab.active\r\n                        ? 'bg-purple-600/20 border border-purple-500/40 shadow-lg shadow-purple-500/20'\r\n                        : 'bg-gray-800/30 hover:bg-gray-800/50 border border-transparent'\r\n                      }\r\n                      ${tab.mode === 'ghost' ? 'ring-1 ring-purple-500/40' : ''}\r\n                      ${tab.mode === 'private' ? 'ring-1 ring-emerald-500/40' : ''}\r\n                      ${tab.sleeping ? 'ring-1 ring-amber-400/40' : ''}\r\n                    `}\r\n                    style={{ pointerEvents: 'auto', zIndex: 1, userSelect: 'none' }}\r\n                    draggable\r\n                    onDragStart={(event) => {\r\n                      try {\r\n                        event.dataTransfer?.setData(TAB_GRAPH_DRAG_MIME, tab.id);\r\n                        if (tab.title) {\r\n                          event.dataTransfer?.setData('text/plain', tab.title);\r\n                        }\r\n                        if (event.dataTransfer) {\r\n                          event.dataTransfer.effectAllowed = 'copy';\r\n                        }\r\n                      } catch (error) {\r\n                        if (IS_DEV) {\r\n                          console.warn('[TabStrip] Drag start failed', error);\r\n                        }\r\n                      }\r\n                    }}\r\n                    onDragEnd={() => {\r\n                      window.dispatchEvent(new CustomEvent('tabgraph:dragend'));\r\n                    }}\r\n                    onClick={(e) => {\r\n                      // Primary click handler - ensure it fires\r\n                      e.preventDefault();\r\n                      e.stopPropagation();\r\n                      // Call activateTab immediately\r\n                      activateTab(tab.id);\r\n                    }}\r\n                    onKeyDown={(e) => {\r\n                      if (e.key === 'Enter' || e.key === ' ') {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        activateTab(tab.id);\r\n                        return;\r\n                      }\r\n\r\n                      if (['ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(e.key)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n\r\n                        const currentIndex = tabs.findIndex((t) => t.id === tab.id);\r\n                        if (currentIndex === -1) {\r\n                          return;\r\n                        }\r\n\r\n                        let nextIndex = currentIndex;\r\n                        switch (e.key) {\r\n                          case 'Home':\r\n                            nextIndex = 0;\r\n                            break;\r\n                          case 'End':\r\n                            nextIndex = tabs.length - 1;\r\n                            break;\r\n                          case 'ArrowLeft':\r\n                            nextIndex = (currentIndex - 1 + tabs.length) % tabs.length;\r\n                            break;\r\n                          case 'ArrowRight':\r\n                            nextIndex = (currentIndex + 1) % tabs.length;\r\n                            break;\r\n                        }\r\n\r\n                        const nextTab = tabs[nextIndex];\r\n                        if (nextTab) {\r\n                          activateTab(nextTab.id);\r\n                        }\r\n                      }\r\n                    }}\r\n                    onAuxClick={(e: any) => { \r\n                      e.preventDefault(); \r\n                      e.stopPropagation();\r\n                      if (e.button === 1) { // Middle click\r\n                        closeTab(tab.id); \r\n                      }\r\n                    }}\r\n                    onContextMenu={(e) => {\r\n                      e.preventDefault();\r\n                      (window as any).__lastContextMenuPos = { x: e.clientX, y: e.clientY };\r\n                      setContextMenu({\r\n                        tabId: tab.id,\r\n                        url: tab.url,\r\n                        containerId: tab.containerId,\r\n                      containerName: tab.containerName,\r\n                      containerColor: tab.containerColor,\r\n                        mode: tab.mode,\r\n                        sleeping: tab.sleeping,\r\n                        x: e.clientX,\r\n                        y: e.clientY,\r\n                      });\r\n                    }}\r\n                    onMouseEnter={() => {\r\n                      if (tab === tabs[tabs.length - 1]) {\r\n                        setHolographicPreviewTabId(tab.id);\r\n                        setPreviewMetadata({ url: tab.url, title: tab.title });\r\n                      }\r\n                    }}\r\n                    onMouseLeave={() => {\r\n                      if (holographicPreviewTabId === tab.id) {\r\n                        setHolographicPreviewTabId(null);\r\n                        setPreviewMetadata(null);\r\n                      }\r\n                    }}\r\n                  >\r\n                    {prefetchForTab && (\r\n                      <span\r\n                        className=\"absolute top-1 right-2 text-emerald-300 text-[11px] font-semibold\"\r\n                        title={`Suggested follow-up: ${prefetchForTab.reason}`}\r\n                      >\r\n                        ⚡\r\n                      </span>\r\n                    )}\r\n                  {hologramSupported !== false && holographicPreviewTabId === tab.id && (\r\n                    <motion.div\r\n                      initial={{ opacity: 0, y: 6 }}\r\n                      animate={{ opacity: 1, y: 0 }}\r\n                      exit={{ opacity: 0, y: 6 }}\r\n                      className=\"absolute -bottom-9 left-1/2 flex -translate-x-1/2 items-center gap-2\"\r\n                    >\r\n                      <motion.button\r\n                        type=\"button\"\r\n                        className=\"flex items-center gap-1 rounded-full border border-cyan-400/40 bg-cyan-500/15 px-3 py-1 text-[10px] text-cyan-100 shadow-lg backdrop-blur transition-colors hover:bg-cyan-500/25\"\r\n                        onClick={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          setHandoffStatus({ platform: 'xr', lastSentAt: Date.now() });\r\n                          window.dispatchEvent(\r\n                            new CustomEvent('tab:holographic-preview', {\r\n                              detail: { tabId: tab.id },\r\n                            }),\r\n                          );\r\n                          void ipc.crossReality.handoff(tab.id, 'xr');\r\n                        }}\r\n                      >\r\n                        <Sparkles size={12} /> XR Hologram\r\n                      </motion.button>\r\n                      <motion.button\r\n                        type=\"button\"\r\n                        className=\"flex items-center gap-1 rounded-full border border-amber-400/40 bg-amber-500/15 px-2.5 py-1 text-[10px] text-amber-100 shadow-lg backdrop-blur transition-colors hover:bg-amber-500/25\"\r\n                        onClick={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          setHandoffStatus({ platform: 'mobile', lastSentAt: Date.now() });\r\n                          void ipc.crossReality.handoff(tab.id, 'mobile');\r\n                        }}\r\n                      >\r\n                        <span role=\"img\" aria-label=\"mobile\">📱</span> Send\r\n                      </motion.button>\r\n                    </motion.div>\r\n                  )}\r\n                    {/* Favicon */}\r\n                    <div className=\"flex-shrink-0 w-4 h-4 bg-gray-600 rounded-full flex items-center justify-center\">\r\n                      {tab.favicon ? (\r\n                        <img src={tab.favicon} alt=\"\" className=\"w-full h-full rounded-full\" />\r\n                      ) : (\r\n                        <div className=\"w-2 h-2 bg-gray-400 rounded-full\" />\r\n                      )}\r\n                    </div>\r\n\r\n                    {tab.mode && tab.mode !== 'normal' && (\r\n                      <span\r\n                        className={`px-1.5 py-0.5 rounded-md text-[10px] font-medium border ${\r\n                          tab.mode === 'ghost'\r\n                            ? 'bg-purple-500/20 text-purple-200 border-purple-400/40'\r\n                            : 'bg-emerald-500/20 text-emerald-200 border-emerald-400/40'\r\n                        }`}\r\n                      >\r\n                        {tab.mode === 'ghost' ? 'Ghost' : 'Private'}\r\n                      </span>\r\n                    )}\r\n\r\n                    {tab.containerId && tab.containerId !== 'default' && (\r\n                      <div\r\n                        className=\"w-2.5 h-2.5 rounded-full border border-gray-700/60\"\r\n                        style={{ backgroundColor: tab.containerColor || '#6366f1' }}\r\n                        title={`${tab.containerName || 'Custom'} container`}\r\n                      />\r\n                    )}\r\n\r\n                    {tab.sleeping && (\r\n                      <span className=\"flex items-center\" title=\"Tab is hibernating\">\r\n                        <motion.span\r\n                          className=\"w-2 h-2 rounded-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.55)]\"\r\n                          animate={{ scale: [1, 1.25, 1], opacity: [0.7, 1, 0.7] }}\r\n                          transition={{ repeat: Infinity, duration: 1.8, ease: 'easeInOut' }}\r\n                        />\r\n                      </span>\r\n                    )}\r\n\r\n                    {/* Title */}\r\n                    <span className={`flex-1 text-sm truncate ${tab.active ? 'text-gray-100' : 'text-gray-400'}`}>\r\n                      {tab.title}\r\n                    </span>\r\n\r\n                    {/* Peek Button */}\r\n                    <motion.button\r\n                      type=\"button\"\r\n                      onClick={(e) => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        openPeek(tab);\r\n                      }}\r\n                      aria-label={`Peek preview: ${tab.title}`}\r\n                      className=\"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-gray-700/50 transition-opacity text-gray-400 hover:text-gray-100 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag ml-1\"\r\n                      style={{ pointerEvents: 'auto', zIndex: 2 }}\r\n                      whileHover={{ scale: 1.05 }}\r\n                      whileTap={{ scale: 0.96 }}\r\n                      title=\"Peek preview\"\r\n                    >\r\n                      <Eye size={14} />\r\n                    </motion.button>\r\n\r\n                    {/* Close Button */}\r\n                    <motion.button\r\n                      type=\"button\"\r\n                      onClick={(e) => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        closeTab(tab.id);\r\n                      }}\r\n                      onAuxClick={(e) => {\r\n                        if (e.button === 1) {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          closeTab(tab.id);\r\n                        }\r\n                      }}\r\n                      onMouseDown={(e) => {\r\n                        // Stop propagation but don't prevent default\r\n                        // Preventing default can interfere with click events\r\n                        e.stopPropagation();\r\n                      }}\r\n                      onKeyDown={(e) => {\r\n                        if (e.key === 'Enter' || e.key === ' ') {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          closeTab(tab.id);\r\n                        }\r\n                      }}\r\n                      aria-label={`Close tab: ${tab.title}`}\r\n                      className=\"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-gray-700/50 transition-opacity ml-1 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag\"\r\n                      style={{ pointerEvents: 'auto', zIndex: 2 }}\r\n                      whileHover={{ scale: 1.1 }}\r\n                      whileTap={{ scale: 0.9 }}\r\n                      title=\"Close tab (Middle click)\"\r\n                    >\r\n                      <X size={14} className=\"text-gray-400\" />\r\n                    </motion.button>\r\n                  </motion.div>\r\n                </TabHoverCard>\r\n              );\r\n            })\r\n          ) : null}\r\n          </AnimatePresence>\r\n\r\n          {/* New Tab Button */}\r\n          <motion.button\r\n            onClick={addTab}\r\n            onKeyDown={(e) => {\r\n              if (e.key === 'Enter' || e.key === ' ') {\r\n                e.preventDefault();\r\n                addTab();\r\n              }\r\n            }}\r\n            aria-label=\"New tab\"\r\n            className=\"flex-shrink-0 p-2 rounded-lg hover:bg-gray-800/50 border border-transparent hover:border-gray-700/30 text-gray-400 hover:text-gray-200 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n            whileHover={{ scale: 1.05 }}\r\n            whileTap={{ scale: 0.95 }}\r\n            title=\"New Tab (Ctrl+T / ⌘T)\"\r\n          >\r\n            <Plus size={18} />\r\n          </motion.button>\r\n        </div>\r\n\r\n        {/* Context Menu */}\r\n        {contextMenu && (\r\n          <Portal>\r\n            <TabContextMenu\r\n              tabId={contextMenu.tabId}\r\n              url={contextMenu.url}\r\n              containerId={contextMenu.containerId ?? tabs.find(t => t.id === contextMenu.tabId)?.containerId}\r\n              containerName={contextMenu.containerName ?? tabs.find(t => t.id === contextMenu.tabId)?.containerName}\r\n              containerColor={contextMenu.containerColor ?? tabs.find(t => t.id === contextMenu.tabId)?.containerColor}\r\n              mode={contextMenu.mode ?? tabs.find(t => t.id === contextMenu.tabId)?.mode}\r\n              sleeping={contextMenu.sleeping ?? tabs.find(t => t.id === contextMenu.tabId)?.sleeping}\r\n              onClose={() => setContextMenu(null)}\r\n            />\r\n          </Portal>\r\n        )}\r\n      </div>\r\n\r\n      <HolographicPreviewOverlay\r\n        visible={Boolean(holographicPreviewTabId)}\r\n        tabId={holographicPreviewTabId}\r\n        url={previewMetadata?.url}\r\n        title={previewMetadata?.title}\r\n        onClose={() => {\r\n          setHolographicPreviewTabId(null);\r\n          setPreviewMetadata(null);\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"names":["Flame","createLucideIcon","Navigation","TabHoverCardComponent","React","tabId","children","ref","isHovered","setIsHovered","useState","preview","setPreview","tab","useTabsStore","s","t","useEffect","jsxs","e","jsx","AnimatePresence","motion","TabHoverCard","usePeekPreviewStore","create","set","get","current","TabContextMenu","url","containerId","containerName","containerColor","mode","sleeping","onClose","position","setPosition","menuRef","useRef","policy","useProfileStore","state","ghostDisabled","privateDisabled","containers","setContainers","useContainerStore","openPeek","isSleeping","handleClickOutside","storedPos","ipc","list","error","resolveTab","handleOpenAsGhost","handleBurnTab","handleStartTimer","minutes","ms","handleDuplicate","targetContainerId","activate","handleMoveToContainer","targetId","result","handlePeek","handleWake","isGhost","isPrivate","menuItems","Eye","Copy","Ghost","Clock","Sun","item","moveTargets","c","openTargets","MoonStar","idx","Icon","Boxes","container","PredictiveClusterChip","clusters","summary","onApply","index","setIndex","confidence","PlayCircle","prev","PredictivePrefetchHint","entry","onOpen","hostLabel","WEBXR_SUPPORTED","AFRAME_CDN","ensureAFrameRuntime","resolve","existing","script","HolographicPreviewOverlay","visible","title","containerRef","xrSupported","setXrSupported","cancelled","ok","TAB_GRAPH_DRAG_MIME","IS_DEV","isDevEnv","IS_ELECTRON","isElectronRuntime","mapTabsForStore","TabStrip","setAllTabs","setActiveTab","activeId","tabs","setTabs","predictedClusters","setPredictedClusters","prefetchEntries","setPrefetchEntries","predictionSummary","setPredictionSummary","holographicPreviewTabId","setHolographicPreviewTabId","previewMetadata","setPreviewMetadata","hologramSupported","setHologramSupported","handoffStatus","setHandoffStatus","contextMenu","setContextMenu","hasInitialized","setHasInitialized","isRestoringRef","isCreatingTabRef","previousTabIdsRef","currentActiveIdRef","activationInFlightRef","stripRef","tabsRef","predictiveRequestRef","lastPredictionSignatureRef","fetchPredictiveSuggestionsRef","runPredictiveSuggestions","useCallback","options","signature","requestPromise","response","refreshTabsFromMain","tabList","mappedTabs","ids","activeTab","supported","isMounted","applyTabs","mapped","unsubscribe","ipcEvents","ipcReady","waitForIPC","checkIPC","interval","loadTabs","isInitialLoad","tabIds","currentActive","recheckTabs","handleRestoring","restoring","unsubscribeRestoring","handleRestoreTab","tabState","unsubscribeRestoreTab","initTimer","handleTabUpdate","peekState","updatedPeek","activeTabIdFromIPC","newTabIds","currentTabIds","firstTabId","pollInterval","addTab","baseTabs","newTab","updated","closeTab","currentTabs","wasActive","remaining","nextIndex","tabToClose","tabIndex","remainingTabs","snapshotTabs","previousActiveId","nextTabIndex","nextTab","activateTab","updatedTabs","handleApplyCluster","clusterId","cluster","matching","etld","label","useTabGraphStore","handlePrefetchOpen","activeIdRef","handleKeyNavigation","event","currentIndex","handleModifiedShortcuts","currentActiveId","Fragment","prefetchForTab","Sparkles","X","Plus","Portal"],"mappings":"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","x_google_ignoreList":[0,1]}
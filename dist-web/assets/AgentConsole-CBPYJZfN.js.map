{"version":3,"file":"AgentConsole-CBPYJZfN.js","sources":["../../src/routes/AgentConsole.tsx"],"sourcesContent":["// @ts-nocheck\r\n\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { ipc } from '../lib/ipc-typed';\r\nimport { ipcEvents } from '../lib/ipc-events';\r\n\r\nexport default function AgentConsole() {\r\n  const [runId, setRunId] = useState<string | null>(null);\r\n  const [logs, setLogs] = useState<any[]>([]);\r\n  const [streamingText, setStreamingText] = useState<string>('');\r\n  const [streamId, setStreamId] = useState<string | null>(null);\r\n  const dslRef = useRef<string>(JSON.stringify({ goal: \"Open example.com\", steps: [{ skill: 'navigate', args: { url: 'https://example.com' } }], output: { type: 'json', schema: {} } }, null, 2));\r\n\r\n  useEffect(()=>{\r\n    if (!window.agent) return;\r\n    \r\n    const tokenHandler = (t: any) => setLogs((l: any[])=> [...l, t]);\r\n    const stepHandler = (s: any) => setLogs((l: any[])=> [...l, s]);\r\n    \r\n    window.agent.onToken(tokenHandler);\r\n    window.agent.onStep(stepHandler);\r\n    \r\n    // Listen for streaming AI chunks\r\n    const streamChunkHandler = (data: { streamId: string; chunk: { text?: string; finished?: boolean } }) => {\r\n      if (data.streamId === streamId) {\r\n        if (data.chunk.text) {\r\n          setStreamingText(prev => prev + (data.chunk.text || ''));\r\n        }\r\n        if (data.chunk.finished) {\r\n          setStreamId(null);\r\n        }\r\n      }\r\n    };\r\n\r\n    const unsubscribeChunk = ipcEvents.on<{ streamId: string; chunk: { text?: string; finished?: boolean } }>('agent:stream:chunk', streamChunkHandler);\r\n    const unsubscribeDone = ipcEvents.on<{ streamId: string }>('agent:stream:done', (data) => {\r\n      if (data.streamId === streamId) {\r\n        setStreamId(null);\r\n      }\r\n    });\r\n    \r\n    // Cleanup function - properly removes listeners\r\n    return () => {\r\n      unsubscribeChunk();\r\n      unsubscribeDone();\r\n      // Note: In Electron, IPC listeners are automatically cleaned up when the renderer process terminates\r\n      // If window.agent had removeListener methods, we would call them here\r\n      // For now, React's cleanup is sufficient as listeners are scoped to this component\r\n    };\r\n  },[streamId]);\r\n\r\n  return (\r\n    <div className=\"p-3 grid grid-cols-2 gap-3 h-full\">\r\n      <div className=\"flex flex-col gap-2\">\r\n        <h3 className=\"font-medium\">Agent DSL</h3>\r\n        <textarea className=\"flex-1 bg-neutral-800 rounded p-2 text-xs\" defaultValue={dslRef.current} onChange={(e)=> (dslRef.current = e.target.value)} />\r\n        <div className=\"flex gap-2\">\r\n          <button className=\"bg-indigo-600 text-white px-3 py-1 rounded\" onClick={async ()=>{\r\n            const parsed = JSON.parse(dslRef.current);\r\n            const res = await window.agent?.start?.(parsed) as any;\r\n            if (res?.runId) setRunId(res.runId);\r\n          }}>Start</button>\r\n          <button className=\"bg-neutral-700 text-white px-3 py-1 rounded\" onClick={async ()=>{ if (runId) await window.agent?.stop?.(runId); }}>Stop</button>\r\n          <button className=\"bg-neutral-700 text-white px-3 py-1 rounded\" onClick={async ()=>{ await window.recorder?.start?.(); }}>Record</button>\r\n          <button className=\"bg-neutral-700 text-white px-3 py-1 rounded\" onClick={async ()=>{ await window.recorder?.stop?.(); const d = await window.recorder?.getDsl?.(); dslRef.current = JSON.stringify(d, null, 2); (document.activeElement as HTMLElement)?.blur(); }}>Stop & Load</button>\r\n          <button className=\"bg-emerald-600 text-white px-3 py-1 rounded\" onClick={()=>{\r\n            const demo = {\r\n              goal: 'Paginate, extract first table, export CSV',\r\n              steps: [\r\n                { skill: 'paginate_and_extract', args: { url: 'https://example.com', nextSelector: 'a.next', maxPages: 2 } },\r\n                { skill: 'export_csv', args: { from: 'last', filename: 'demo.csv' } }\r\n              ],\r\n              output: { type: 'json', schema: {} }\r\n            };\r\n            dslRef.current = JSON.stringify(demo, null, 2);\r\n          }}>Load Demo: Paginate→Extract→CSV</button>\r\n        </div>\r\n      </div>\r\n      <div className=\"flex flex-col gap-2\">\r\n        <h3 className=\"font-medium\">Live Logs</h3>\r\n        <pre className=\"flex-1 bg-neutral-900 rounded p-2 text-xs overflow-auto\">{JSON.stringify(logs, null, 2)}</pre>\r\n        \r\n        {/* Streaming AI Response */}\r\n        {streamingText && (\r\n          <div className=\"mt-4 p-4 bg-neutral-800 rounded border border-blue-500/30\">\r\n            <h4 className=\"font-medium mb-2 text-blue-400\">Streaming Response:</h4>\r\n            <div className=\"text-sm text-gray-300 whitespace-pre-wrap max-h-60 overflow-y-auto\">\r\n              {streamingText}\r\n            </div>\r\n            <button\r\n              onClick={async () => {\r\n                if (streamId) {\r\n                  await ipc.agent.stream.stop(streamId);\r\n                  setStreamId(null);\r\n                  setStreamingText('');\r\n                }\r\n              }}\r\n              className=\"mt-2 px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-xs\"\r\n            >\r\n              Stop Stream\r\n            </button>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Start Streaming Button */}\r\n        <button\r\n          onClick={async () => {\r\n            try {\r\n              const query = prompt('Enter your query for streaming AI:');\r\n              if (!query) return;\r\n              \r\n              setStreamingText('');\r\n              const result = await ipc.agent.stream.start(query, {\r\n                model: 'llama3.2',\r\n                temperature: 0.7,\r\n              });\r\n              \r\n              if (result?.streamId) {\r\n                setStreamId(result.streamId);\r\n              }\r\n            } catch (error) {\r\n              console.error('Failed to start stream:', error);\r\n              alert('Failed to start streaming. Check console for details.');\r\n            }\r\n          }}\r\n          className=\"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 rounded text-sm font-medium\"\r\n        >\r\n          Start Streaming AI\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":["AgentConsole","runId","setRunId","useState","logs","setLogs","streamingText","setStreamingText","streamId","setStreamId","dslRef","useRef","useEffect","tokenHandler","t","stepHandler","streamChunkHandler","data","prev","unsubscribeChunk","ipcEvents","unsubscribeDone","jsxs","jsx","e","parsed","res","d","demo","ipc","query","result","error"],"mappings":"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"}
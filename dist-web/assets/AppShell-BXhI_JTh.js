const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./trustDashboardStore-CKKody0H.js","./index-BquUM_dP.js","./index-NAWupagS.css","./TopNav-BqNjnIUN.js","./privacyStore-B5f_8hYF.js","./proxy-BIEmBbur.js","./OmniDesk-BdBOPLft.js","./ipc-events-CqodUROu.js","./agentStreamStore-BcjkWHdN.js","./cloud-BWs6gXbb.js","./sparkles-B3IeNLsk.js","./search-RYizLTqL.js","./index-TWPLI6s_.js","./formatDistanceToNow-Ctx6mZEP.js","./clock-gSt0ZU7N.js","./refresh-cw-BV6giV6D.js","./circle-check-DDsejJ4f.js","./brain-B9NCOvP-.js","./gamepad-2-B6N6cwl_.js","./zap-exKG0bW3.js","./use-ipc-event-CcVO0A42.js","./debounce-CnqAXreA.js","./lock-BeOLUjZE.js","./globe-CrjHlxyj.js","./shield-Ce_H0Kiu.js","./plus-Al6gge0g.js","./check-BWr6G6Rr.js","./x-C_5K_ivr.js","./profileStore-B9Mbf7JP.js","./download-B_E2bknD.js","./eye-off-DfQe_-FT.js","./sun-B4KqhO0u.js","./settings-DCl-8xpx.js","./network-RlKt8r1q.js","./circle-check-big-DljQtsCI.js","./circle-x-DE3GrI7J.js","./play-BpEGLF92.js","./arrow-right-0_MbL2nW.js","./activity-BycRfeKU.js","./Portal-BzN9CTBx.js","./triangle-alert-CrRrQux7.js","./TabStrip-Aos3pdO7.js","./eye-BmrkTLPE.js","./copy-BONWjHlW.js","./moon-star-CUMLt3Wn.js","./circle-play-ojLLp3EH.js","./RightPanel-DUOoQZA2.js","./share-2-CRKXNKym.js","./shield-check--KexTCwB.js","./send-l9AJcvKj.js","./shield-alert-BHPhLHIy.js","./trash-2-BmxweSpX.js","./BottomStatus-lP1bYHRF.js","./cpu-BvpYKXOE.js","./CommandPalette-5t_z4PHY.js","./PermissionPrompt-M0aXUVYr.js","./bell-D7jczHYs.js","./ConsentPrompt-CqWgC3Zp.js","./AgentOverlay-DgWEeNIG.js","./ClipperOverlay-aYJp6UZU.js","./ReaderOverlay-LRGHM2GE.js","./book-open-Cip1kOdb.js","./refresh-ccw-UxgP_6HK.js","./TabGraphOverlay-B8ndsI3v.js","./ConsentDashboard-CvJ4xz9R.js","./TrustEthicsDashboard-Jqd3OpHA.js","./OnboardingTour-4L_PA8hG.js"])))=>i.map(i=>d[i]);
import{c as re,i as S,r,a as we,j as e,_ as g,u as Q,R as N,O as ce,b as me}from"./index-BquUM_dP.js";import{i as de}from"./ipc-events-CqodUROu.js";import{u as ue}from"./use-ipc-event-CcVO0A42.js";import{V as je,P as D}from"./Portal-BzN9CTBx.js";import{O as Ee}from"./OmniDesk-BdBOPLft.js";import{c as X,m as T}from"./proxy-BIEmBbur.js";import{A as H}from"./index-TWPLI6s_.js";import{L as pe,S as Se}from"./sparkles-B3IeNLsk.js";import{X as Ne}from"./x-C_5K_ivr.js";import{useTrustDashboardStore as _e}from"./trustDashboardStore-CKKody0H.js";import{T as ke}from"./triangle-alert-CrRrQux7.js";import{f as Te}from"./formatDistanceToNow-Ctx6mZEP.js";const Ce=X("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const Re=X("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Le=X("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const De=X("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Oe=re((t,o)=>({visible:!1,loading:!1,error:null,data:null,focusedTabId:null,async open(){o().visible||t({visible:!0}),await o().refresh()},close(){t({visible:!1,focusedTabId:null})},async toggle(){o().visible?t({visible:!1,focusedTabId:null}):(t({visible:!0}),await o().refresh())},async refresh(){t({loading:!0,error:null});try{const a=await S.graph.tabs();if(!a||typeof a!="object")throw new Error("Graph data unavailable");t({data:a,loading:!1,error:null})}catch(a){t({loading:!1,error:a instanceof Error?a.message:String(a)})}},setFocusedTab(a){t({focusedTabId:a})},async focusTab(a){t({visible:!0,focusedTabId:a}),await o().refresh()}})),Ie=["ob://","about:","chrome://","edge://","app://","omnibrowser://"];function Pe(t){return t?Ie.some(o=>t.startsWith(o)):!0}function Ae({tab:t,overlayActive:o}){const a=r.useRef(null),m=r.useRef(null),c=r.useRef(null),f=we(),[y,h]=r.useState(!1),[k,_]=r.useState(null),[x,i]=r.useState(!1),l=r.useRef(null),v=r.useRef(0),u=r.useMemo(()=>Pe(t?.url)?null:t?.url??"about:blank",[t?.url]);r.useEffect(()=>{if(!f||!m.current||!u)return;const d=m.current,C=3e4,p=()=>{h(!0),_(null),v.current=0,l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{h(!1),_("This page is taking too long to load. Check your connection or try refreshing.")},C)},A=()=>{l.current&&(clearTimeout(l.current),l.current=null),h(!1)},M=()=>{l.current&&(clearTimeout(l.current),l.current=null),h(!1),_(null),v.current=0},z=F=>{l.current&&(clearTimeout(l.current),l.current=null),h(!1);const V=F?.errorCode??-1,R=F?.errorDescription??"Unknown error";let O="Failed to load this page.";V===-105||R.includes("ERR_NAME_NOT_RESOLVED")?O="Could not resolve the website address. Check your internet connection.":V===-106||R.includes("ERR_INTERNET_DISCONNECTED")?O="No internet connection. Please check your network settings.":V===-118||R.includes("ERR_CONNECTION_TIMED_OUT")?O="Connection timed out. The server may be slow or unreachable.":R.includes("ERR_BLOCKED_BY_RESPONSE")?O="This site cannot be embedded for security reasons.":O=`Failed to load: ${R||"Unknown error"}`,_(O)};return d.addEventListener("did-start-loading",p),d.addEventListener("did-stop-loading",A),d.addEventListener("dom-ready",M),d.addEventListener("did-fail-load",z),()=>{l.current&&(clearTimeout(l.current),l.current=null),d.removeEventListener("did-start-loading",p),d.removeEventListener("did-stop-loading",A),d.removeEventListener("dom-ready",M),d.removeEventListener("did-fail-load",z)}},[f,u]),r.useEffect(()=>{if(f||!c.current||!u)return;const d=c.current,C=3e4;let p=null;const A=()=>{if(p&&(clearTimeout(p),p=null),h(!1),_(null),!!c.current)try{c.current.contentDocument?.title,i(!1)}catch{i(!0)}},M=()=>{p&&(clearTimeout(p),p=null),h(!1),_("Failed to load this page. Please check the URL or your connection."),i(!0)};return p=setTimeout(()=>{h(!1),_("This page is taking too long to load. Check your connection or try refreshing."),p=null},C),d.addEventListener("load",A),d.addEventListener("error",M),()=>{p&&(clearTimeout(p),p=null),d.removeEventListener("load",A),d.removeEventListener("error",M)}},[f,u]);const B=r.useCallback(()=>{if(u)try{window.open(u,"_blank","noopener,noreferrer")}catch(d){console.warn("[TabContentSurface] failed to open external window",d)}},[u]);r.useEffect(()=>{if(!u){h(!1),_(null),i(!1);return}if(f){const d=m.current;if(!d)return;try{d.getURL?.()!==u&&(h(!0),d.setAttribute("src",u))}catch(C){console.warn("[TabContentSurface] Failed to update webview src",C)}}else{const d=c.current;if(!d)return;d.src!==u&&(h(!0),d.src=u),i(!1)}},[f,u]);const q=t?.id?`tabpanel-${t.id}`:"tabpanel-empty",P=t?.id?`tab-${t.id}`:void 0,G=!t||!t.active;return u?e.jsxs(T.div,{ref:a,className:`relative h-full w-full bg-slate-950 ${o?"pointer-events-none":""}`,id:q,role:"tabpanel","aria-labelledby":P,"aria-hidden":G,initial:{opacity:.4},animate:{opacity:1},transition:{duration:.35,ease:"easeOut"},children:[f?e.jsx("webview",{ref:m,className:"h-full w-full",allowpopups:"true",autosize:"on",disablewebsecurity:"false","aria-label":t?.title?`Content for ${t.title}`:"Tab content"}):e.jsx("iframe",{ref:c,className:"h-full w-full",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups",allow:"fullscreen",title:t?.title??"Tab content","aria-label":t?.title?`Content for ${t.title}`:"Tab content"}),e.jsx(H,{children:y&&e.jsx(T.div,{className:"pointer-events-none absolute inset-0 z-10 flex items-center justify-center bg-slate-950/55 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},role:"status","aria-live":"polite","aria-label":"Loading page content",children:e.jsxs(T.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.2},className:"flex flex-col items-center gap-4 rounded-2xl border border-slate-700/60 bg-slate-900/90 px-6 py-5 text-sm text-slate-200 shadow-lg shadow-black/40",children:[e.jsx(T.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(pe,{className:"h-6 w-6 text-emerald-300","aria-hidden":"true"})}),e.jsxs("div",{className:"text-center w-full max-w-xs",children:[e.jsxs("div",{className:"font-medium mb-2",children:["Loading ",new URL(u).hostname,"…"]}),e.jsx("div",{className:"mt-1 text-xs text-slate-400 mb-3",children:"This may take a moment"}),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"h-1 w-full overflow-hidden rounded-full bg-slate-800/60",children:e.jsx(T.div,{className:"h-full bg-gradient-to-r from-emerald-500 via-cyan-500 to-emerald-500",initial:{x:"-100%",width:"40%"},animate:{x:["-100%","100%"]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})})})]})]})})}),e.jsx(H,{children:k&&e.jsx(T.div,{className:"pointer-events-auto absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},role:"alert","aria-live":"assertive",children:e.jsxs(T.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.18},className:"max-w-md space-y-3 rounded-2xl border border-amber-400/40 bg-amber-500/15 px-5 py-4 text-center text-sm text-amber-100 shadow-lg shadow-black/50",children:[e.jsx("div",{className:"font-medium",children:k}),e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("button",{type:"button",onClick:()=>{if(u&&f&&m.current){const d=m.current;_(null),h(!0),d.reload()}else u&&!f&&c.current&&(_(null),h(!0),c.current.src=u)},className:"rounded-lg border border-amber-400/60 bg-amber-500/20 px-3 py-1.5 text-xs font-medium text-amber-50 transition-colors hover:bg-amber-500/30",children:"Retry"})})]})})}),e.jsx(H,{children:!f&&x&&e.jsx(T.div,{className:"absolute inset-0 z-20 flex items-center justify-center bg-slate-950/85 px-6",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(T.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.92,opacity:0},transition:{duration:.22},className:"max-w-lg space-y-4 rounded-3xl border border-emerald-500/40 bg-emerald-500/15 p-6 text-center text-sm text-emerald-100 shadow-2xl shadow-black/50",children:[e.jsxs("div",{className:"text-lg font-semibold text-emerald-50",children:[new URL(u).hostname," works best in its own tab"]}),e.jsx("p",{className:"text-emerald-100/70",children:"This site blocks embedded views for security. Open it in a dedicated tab or use the Electron build for a fully integrated webview."}),e.jsxs("button",{type:"button",onClick:B,className:"inline-flex items-center gap-2 rounded-xl border border-emerald-400/60 bg-emerald-500/20 px-4 py-2 text-sm font-medium text-emerald-50 transition hover:border-emerald-300/70 hover:bg-emerald-500/30",children:[e.jsx(Ce,{size:16}),"Open ",new URL(u).hostname]})]})})})]},u):e.jsx(T.div,{id:q,role:"tabpanel","aria-labelledby":P,"aria-hidden":G,className:"h-full w-full overflow-hidden bg-slate-950/60",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(Ee,{variant:"split",forceShow:!0})})}function Me(){const[t,o]=r.useState(!1),[a,m]=r.useState([]),[c,f]=r.useState(null),[y,h]=r.useState(!1);r.useEffect(()=>{const x=()=>{const l=[{message:'Say "new tab" to open a fresh browsing session',priority:"low"},{message:'Try "search for regenerative design" to start research',priority:"medium"},{message:'Voice command: "switch to research mode"',priority:"low"},{message:'Ask "what trackers are blocked?" for privacy status',priority:"medium"},{message:'Say "show consent timeline" to review privacy decisions',priority:"high"}],v=l[Math.floor(Math.random()*l.length)];return v?{...v,id:`tip-${Date.now()}`,timestamp:Date.now()}:null},i=setInterval(()=>{if(!y&&a.length<3){const l=x();l&&m(v=>[...v,l].slice(-3))}},45e3);return()=>clearInterval(i)},[y,a.length]),r.useEffect(()=>{if(a.length>0){f(a[a.length-1]);const x=setTimeout(()=>{f(null),m(i=>i.slice(1))},8e3);return()=>clearTimeout(x)}},[a]);const k=r.useCallback(async x=>{const i=x.toLowerCase().trim();if(i.includes("new tab")||i.includes("open tab"))return await S.tabs.create("about:blank"),{success:!0,message:"Opened new tab"};if(i.includes("research mode")||i.includes("switch to research"))return window.location.hash="#/",{success:!0,message:"Switched to research mode"};if(i.includes("trackers")||i.includes("privacy")){const{useTrustDashboardStore:l}=await g(async()=>{const{useTrustDashboardStore:v}=await import("./trustDashboardStore-CKKody0H.js");return{useTrustDashboardStore:v}},__vite__mapDeps([0,1,2]),import.meta.url);return l.getState().open(),{success:!0,message:"Opened privacy dashboard"}}if(i.includes("consent timeline")){const{useConsentOverlayStore:l}=await g(async()=>{const{useConsentOverlayStore:v}=await Promise.resolve().then(()=>Ve);return{useConsentOverlayStore:v}},void 0,import.meta.url);return l.getState().open(),{success:!0,message:"Opened consent timeline"}}return{success:!1,message:"Command not recognized"}},[]),_=r.useCallback(async()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){console.warn("[VoiceTips] Speech recognition not available");return}o(!0);const x=window.webkitSpeechRecognition||window.SpeechRecognition,i=new x;i.continuous=!1,i.interimResults=!1,i.lang="en-US",i.onresult=l=>{const v=l.results[0][0].transcript;k(v),o(!1)},i.onerror=()=>{o(!1)},i.onend=()=>{o(!1)},i.start()},[k]);return y?null:e.jsxs(e.Fragment,{children:[e.jsx(H,{children:c&&e.jsx(T.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"fixed bottom-24 left-1/2 z-50 -translate-x-1/2",children:e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-blue-500/40 bg-blue-500/15 px-4 py-3 text-sm text-blue-100 shadow-lg backdrop-blur-sm",children:[e.jsx(Se,{size:16,className:"text-blue-300"}),e.jsx("span",{children:c.message}),e.jsx("button",{type:"button",onClick:()=>{f(null),m(x=>x.filter(i=>i.id!==c.id))},className:"ml-2 rounded-lg p-1 hover:bg-blue-500/20","aria-label":"Dismiss tip",children:e.jsx(Ne,{size:14})})]})})}),e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(T.button,{type:"button",onClick:()=>h(!y),className:"flex items-center justify-center rounded-full border border-slate-700/60 bg-slate-900/90 p-2.5 text-slate-200 shadow-lg backdrop-blur-sm hover:bg-slate-800/90",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":y?"Unmute voice tips":"Mute voice tips",children:y?e.jsx(je,{size:18}):e.jsx(Re,{size:18})}),!y&&e.jsx(T.button,{type:"button",onClick:_,disabled:t,className:`flex items-center justify-center rounded-full border p-3 shadow-lg backdrop-blur-sm transition-all ${t?"border-emerald-500/60 bg-emerald-500/20 text-emerald-200":"border-blue-500/60 bg-blue-500/20 text-blue-200 hover:bg-blue-500/30"}`,whileHover:{scale:1.05},whileTap:{scale:.95},animate:t?{scale:[1,1.1,1]}:{},transition:{duration:1.5,repeat:t?1/0:0},"aria-label":"Start voice command",children:e.jsx(Le,{size:20})})]})})]})}const ee="omnibrowser:onboarding:completed",se={isCompleted(){try{return window.localStorage.getItem(ee)==="1"}catch{return!1}},setCompleted(){try{window.localStorage.setItem(ee,"1")}catch{}},clear(){try{window.localStorage.removeItem(ee)}catch{}}},Y=re(t=>({visible:!1,start:()=>{t({visible:!0})},finish:()=>{se.setCompleted(),t({visible:!1})},reset:()=>{se.clear(),t({visible:!0})}}));typeof window<"u"&&(window.__STORE={...window.__STORE,onboarding:Y});async function ze(t){const o={};t.type&&t.type!=="all"&&(o.type=t.type),t.status&&t.status!=="all"&&(t.status==="pending"?o.approved=!1:(t.status==="approved"||t.status==="revoked")&&(o.approved=!0));const a=await S.consent.list(Object.keys(o).length>0?o:void 0);if(!Array.isArray(a))return[];let m=a;return t.status==="pending"?m=m.filter(c=>!c.approved):t.status==="approved"?m=m.filter(c=>c.approved&&!c.revokedAt):t.status==="revoked"&&(m=m.filter(c=>!!c.revokedAt)),m.sort((c,f)=>f.timestamp-c.timestamp)}const fe=re((t,o)=>({visible:!1,loading:!1,error:null,filter:{type:"all",status:"all"},records:[],async open(){o().visible||t({visible:!0}),await o().refresh()},close(){t({visible:!1})},async toggle(){o().visible?t({visible:!1}):(t({visible:!0}),await o().refresh())},async refresh(){t({loading:!0,error:null});try{const a=await ze(o().filter);t({records:a,loading:!1,error:null})}catch(a){t({loading:!1,error:a instanceof Error?a.message:String(a)})}},async setFilter(a){t(m=>({filter:{...m.filter,...a}})),await o().refresh()},async approve(a){await S.consent.approve(a),await o().refresh()},async revoke(a){await S.consent.revoke(a),await o().refresh()}})),Ve=Object.defineProperty({__proto__:null,useConsentOverlayStore:fe},Symbol.toStringTag,{value:"Module"});var Fe=Object.defineProperty,Ke=(t,o,a)=>o in t?Fe(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,te=(t,o,a)=>Ke(t,typeof o!="symbol"?o+"":o,a);class E extends N.Component{constructor(o){super(o),te(this,"handleReload",()=>{window.location.reload()}),te(this,"handleOpenLogs",async()=>{try{const a=await S.diagnostics.openLogs();this.setState({copyStatus:a?.success?"success":"error",copyMessage:a?.success?"Logs folder opened.":"Unable to open logs folder.",copying:!1})}catch(a){console.error("Failed to open logs folder from error boundary:",a),this.setState({copyStatus:"error",copyMessage:"Failed to open logs folder.",copying:!1})}}),te(this,"handleCopyDiagnostics",async()=>{if(!this.state.copying){this.setState({copying:!0,copyStatus:null,copyMessage:void 0});try{const a=await S.diagnostics.copyDiagnostics();a?.diagnostics&&navigator?.clipboard?.writeText?(await navigator.clipboard.writeText(a.diagnostics),this.setState({copyStatus:"success",copyMessage:"Diagnostics copied to clipboard.",copying:!1})):(this.setState({copyStatus:"error",copyMessage:"Clipboard unavailable. Diagnostics logged to console.",copying:!1}),console.info("[Diagnostics] Summary:",a?.diagnostics))}catch(a){console.error("Failed to copy diagnostics from error boundary:",a),this.setState({copyStatus:"error",copyMessage:"Failed to copy diagnostics.",copying:!1})}}}),this.state={hasError:!1,copyStatus:null,copying:!1}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,a){console.error(`ErrorBoundary caught error${this.props.componentName?` in ${this.props.componentName}`:""}:`,o,a),this.setState({error:o,errorInfo:a.componentStack??void 0})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex min-h-screen w-full items-center justify-center bg-slate-950 px-6 py-12 text-gray-100",children:e.jsxs("div",{className:"w-full max-w-xl space-y-5 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-full bg-red-500/20 p-2 text-red-200",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-semibold text-red-200",children:["Something went wrong",this.props.componentName?` inside ${this.props.componentName}`:"","."]}),this.state.error?.message&&e.jsx("p",{className:"mt-2 text-sm text-red-100/80",children:this.state.error.message}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Try reloading the interface. You can also copy diagnostics or inspect the latest logs to share with the team."})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:this.handleReload,className:"rounded-lg border border-blue-500/50 bg-blue-500/10 px-4 py-2 text-sm font-medium text-blue-100 hover:border-blue-500/70 transition-colors",children:"Reload app"}),e.jsx("button",{onClick:this.handleCopyDiagnostics,disabled:this.state.copying,className:`rounded-lg border px-4 py-2 text-sm font-medium transition-colors ${this.state.copying?"border-indigo-500/30 bg-indigo-500/10 text-indigo-200/60 cursor-wait":"border-indigo-500/50 bg-indigo-500/10 text-indigo-100 hover:border-indigo-500/70"}`,children:this.state.copying?"Copying…":"Copy diagnostics"}),e.jsx("button",{onClick:this.handleOpenLogs,className:"rounded-lg border border-emerald-500/50 bg-emerald-500/10 px-4 py-2 text-sm font-medium text-emerald-100 hover:border-emerald-500/70 transition-colors",children:"Open logs folder"})]}),this.state.copyMessage&&e.jsx("div",{className:`text-sm ${this.state.copyStatus==="success"?"text-emerald-300":"text-red-300"}`,children:this.state.copyMessage}),me()&&this.state.errorInfo&&e.jsxs("details",{className:"text-xs text-gray-400",children:[e.jsx("summary",{className:"cursor-pointer text-gray-300",children:"Stack trace"}),e.jsx("pre",{className:"mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded bg-black/40 p-3",children:this.state.errorInfo})]})]})}):this.props.children}}const $e=N.lazy(()=>g(()=>import("./TopNav-BqNjnIUN.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,0,40]),import.meta.url).then(t=>({default:t.TopNav}))),Ue=N.lazy(()=>g(()=>import("./TabStrip-Aos3pdO7.js"),__vite__mapDeps([41,1,2,7,12,5,28,42,43,31,14,44,39,45,10,27,25,20,6,8,9,11,13,15,16,0,40]),import.meta.url).then(t=>({default:t.TabStrip}))),Be=N.lazy(()=>g(()=>import("./RightPanel-DUOoQZA2.js"),__vite__mapDeps([46,1,2,20,7,10,5,16,35,36,47,12,29,6,8,9,11,13,14,15,48,49,38,0,22,50,30,42,25,43,51,17,27,19,24,39,40]),import.meta.url).then(t=>({default:t.RightPanel}))),qe=N.lazy(()=>g(()=>import("./BottomStatus-lP1bYHRF.js"),__vite__mapDeps([52,1,2,20,7,28,22,5,42,33,44,6,8,9,10,11,12,13,14,15,16,4,39,0,53,38,24,17,49,40,27]),import.meta.url).then(t=>({default:t.BottomStatus}))),Ge=N.lazy(()=>g(()=>import("./CommandPalette-5t_z4PHY.js"),__vite__mapDeps([54,1,2,6,7,8,5,9,10,11,12,13,14,15,16,37]),import.meta.url).then(t=>({default:t.CommandPalette}))),We=N.lazy(()=>g(()=>import("./PermissionPrompt-M0aXUVYr.js"),__vite__mapDeps([55,1,2,56,5,26,12,27,14,7,20,39,6,8,9,10,11,13,15,16,0,40]),import.meta.url).then(t=>({default:t.PermissionPrompt}))),He=N.lazy(()=>g(()=>import("./ConsentPrompt-CqWgC3Zp.js"),__vite__mapDeps([57,1,2,12,5,24,27,40,35,34]),import.meta.url).then(t=>({default:t.ConsentPrompt}))),Ye=N.lazy(()=>g(()=>import("./AgentOverlay-DgWEeNIG.js"),__vite__mapDeps([58,1,2,20,7,8,5,19,14,6,9,10,11,12,13,15,16,17,24,50,35]),import.meta.url).then(t=>({default:t.AgentOverlay}))),Xe=N.lazy(()=>g(()=>import("./ClipperOverlay-aYJp6UZU.js"),__vite__mapDeps([59,1,2,12,5]),import.meta.url).then(t=>({default:t.ClipperOverlay}))),Ze=N.lazy(()=>g(()=>import("./ReaderOverlay-LRGHM2GE.js"),__vite__mapDeps([60,1,2,12,5,61,10,29,27,62,40,7,20,39,6,8,9,11,13,14,15,16,0]),import.meta.url).then(t=>({default:t.ReaderOverlay}))),Je=N.lazy(()=>g(()=>import("./TabGraphOverlay-B8ndsI3v.js"),__vite__mapDeps([63,1,2,5,47,15,27,13,7,20,39,6,8,9,10,11,12,14,16,0,40]),import.meta.url).then(t=>({default:t.TabGraphOverlay}))),Qe=N.lazy(()=>g(()=>import("./ConsentDashboard-CvJ4xz9R.js"),__vite__mapDeps([64,1,2,48,5,15,29,50,27,40,13,7,20,39,6,8,9,10,11,12,14,16,0]),import.meta.url).then(t=>({default:t.ConsentDashboard}))),et=N.lazy(()=>g(()=>import("./TrustEthicsDashboard-Jqd3OpHA.js"),__vite__mapDeps([65,1,2,0,5,24,15,16,27,48,50,14,40,38,13,7,20,39,6,8,9,10,11,12]),import.meta.url).then(t=>({default:t.TrustEthicsDashboard}))),tt=N.lazy(()=>g(()=>import("./OnboardingTour-4L_PA8hG.js"),__vite__mapDeps([66,1,2,6,7,8,5,9,10,11,12,13,14,15,16,17,18,19,24,27,20,39,0,40]),import.meta.url).then(t=>({default:t.OnboardingTour})));function st(){const[t,o]=r.useState(!1),[a,m]=r.useState(!1),[c,f]=r.useState(null),[y,h]=r.useState(null),[k,_]=r.useState(!1),[x,i]=r.useState(!1),[l,v]=r.useState(!1),u=Y(n=>n.visible),B=Y(n=>n.start);Y(n=>n.finish),r.useEffect(()=>{},[u]);const[q,P]=r.useState(!1);r.useEffect(()=>{let n=0;const s=j=>{const U=j.dataTransfer?.types;return U?Array.from(U).includes("application/x-omnibrowser-tab-id"):!1},w=j=>{s(j)&&(j.preventDefault(),n+=1,P(!0))},b=j=>{s(j)&&(j.preventDefault(),j.dataTransfer&&(j.dataTransfer.dropEffect="copy"))},L=j=>{s(j)&&(n=Math.max(0,n-1),n===0&&P(!1))},oe=()=>{n=0,P(!1)},ie=j=>{if(!s(j))return;j.preventDefault(),n=0,P(!1);const U=j.dataTransfer?.getData("application/x-omnibrowser-tab-id");if(U)try{Oe.getState().focusTab(U)}catch(ye){me()&&console.warn("[AppShell] Failed to focus tab graph from drop",ye)}},le=()=>{n=0,P(!1)};return document.addEventListener("dragenter",w),document.addEventListener("dragover",b),document.addEventListener("dragleave",L),document.addEventListener("dragend",oe),document.addEventListener("drop",ie),window.addEventListener("tabgraph:dragend",le),()=>{document.removeEventListener("dragenter",w),document.removeEventListener("dragover",b),document.removeEventListener("dragleave",L),document.removeEventListener("dragend",oe),document.removeEventListener("drop",ie),window.removeEventListener("tabgraph:dragend",le)}},[]);const G=fe(n=>n.visible),d=_e(n=>n.visible),C=Q(),p=C.tabs.find(n=>n.id===C.activeId),[A,M]=r.useState(.62),[z,F]=r.useState(!1),V=a||!!c||!!y||x||l,R=p?.url??"",O=!!R&&!R.startsWith("ob://")&&!R.startsWith("about:")&&!R.startsWith("chrome://")&&!R.startsWith("edge://")&&!R.startsWith("app://"),he=r.useCallback(()=>{O&&F(!0)},[O]);r.useEffect(()=>{if(!z)return;const n=w=>{M(b=>{const L=w.clientX/window.innerWidth;return Number.isNaN(L)?b:Math.min(.85,Math.max(.25,L))})},s=()=>{F(!1)};return window.addEventListener("mousemove",n),window.addEventListener("mouseup",s),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",s)}},[z]);const[I,W]=r.useState(null),[Z,ae]=r.useState(!1),[J,ne]=r.useState("idle"),[K,$]=r.useState(null),be=r.useMemo(()=>{if(!I)return null;try{return Te(new Date(I.updatedAt),{addSuffix:!0})}catch{return null}},[I]);r.useEffect(()=>{if(typeof window>"u")return;const n=setTimeout(()=>{!se.isCompleted()&&!u&&B()},800);return()=>clearTimeout(n)},[u,B]),r.useEffect(()=>{if(Z)return;let n=!1;return S.sessionState.summary().then(s=>{if(n)return;const w=s?.summary;w&&w.tabCount>0&&W(w)}).catch(()=>{n||W(null)}),()=>{n=!0}},[Z]),r.useEffect(()=>{if(!K)return;const n=window.setTimeout(()=>{$(null)},6e3);return()=>{window.clearTimeout(n)}},[K]),ue("permissions:request",n=>{f(n)},[]),ue("agent:consent:request",n=>{if(!n||!n.id||!n.action)return;const s={id:n.id,action:{type:n.action.type,description:n.action.description,risk:n.action.risk??"medium"},callback:async w=>{try{w?await S.consent.approve(n.id):await S.consent.revoke(n.id)}catch(b){console.error("Failed to resolve consent:",b)}finally{h(null)}}};h(s)},[]),r.useEffect(()=>{const n=w=>{_(w.fullscreen)};return de.on("app:fullscreen-changed",n)},[]),r.useEffect(()=>{const n=s=>{const b=navigator.platform.toUpperCase().indexOf("MAC")>=0?s.metaKey:s.ctrlKey;if(b&&!s.shiftKey&&!s.altKey&&s.key.toLowerCase()==="k"){s.preventDefault(),m(!0);return}if(!(b&&!s.shiftKey&&!s.altKey&&s.key.toLowerCase()==="l")){if(b&&!s.shiftKey&&!s.altKey&&s.key.toLowerCase()==="t"){s.preventDefault(),S.tabs.create("about:blank").catch(console.error);return}if(b&&!s.shiftKey&&!s.altKey&&s.key.toLowerCase()==="w"){s.preventDefault();const L=Q.getState();L.activeId&&S.tabs.close({id:L.activeId}).catch(console.error);return}if(b&&s.shiftKey&&!s.altKey&&s.key.toLowerCase()==="t"){s.preventDefault();return}if(b&&s.shiftKey&&!s.altKey&&s.key.toLowerCase()==="a"){s.preventDefault(),o(L=>!L);return}if(b&&s.shiftKey&&!s.altKey&&s.key.toLowerCase()==="h"){s.preventDefault(),Q.getState().activeId&&i(!0);return}if(b&&s.altKey&&s.key.toLowerCase()==="p"){s.preventDefault(),document.querySelector("[data-network-button]")?.click();return}if(b&&s.altKey&&s.key.toLowerCase()==="s"){s.preventDefault(),document.querySelector("[data-shields-button]")?.click();return}if(!(b&&!s.shiftKey&&!s.altKey&&s.key.toLowerCase()==="f")&&s.key==="Escape"){x?i(!1):a?m(!1):c?f(null):y?h(null):t&&o(!1);return}}};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[a,c,y,t,x]);const xe=async n=>{if(!p?.url){i(!1);return}try{const s=await S.research.getNotes(p.url),w=s?.notes??"",b=Array.isArray(s?.highlights)?s.highlights:[];await S.research.saveNotes(p.url,w,[...b,n]),de.emit("research:highlight-added",{url:p.url,highlight:n})}catch(s){console.error("Failed to save highlight:",s)}finally{i(!1)}},ve=async()=>{if(!(!I||J==="restoring")){ne("restoring");try{const n=await S.sessionState.restore();if(n?.restored){const s=n.tabCount??I.tabCount??0;$({message:`Restored ${s} tab${s===1?"":"s"} from last session.`,variant:"success"}),W(null),ae(!0)}else n?.error?$({message:`Restore failed: ${n.error}`,variant:"error"}):$({message:"No saved session snapshot available to restore.",variant:"error"})}catch(n){console.error("Failed to restore session snapshot:",n),$({message:"Failed to restore session snapshot.",variant:"error"})}finally{ne("idle")}}},ge=()=>{ae(!0),W(null)};return e.jsxs("div",{className:"relative flex h-screen w-screen flex-col overflow-hidden bg-[#1A1D28] text-gray-100",children:[!k&&e.jsx("div",{className:"flex-none",children:e.jsx(r.Suspense,{fallback:e.jsx("div",{style:{height:"40px",backgroundColor:"#0f172a"}}),children:e.jsx(E,{componentName:"TopNav",fallback:e.jsx("div",{style:{height:"40px",backgroundColor:"#0f172a",padding:"8px",color:"#94a3b8"},children:"Navigation Error"}),children:e.jsx($e,{onAgentToggle:()=>o(!t),onCommandPalette:()=>m(!0),onClipperToggle:()=>{C.activeId&&i(!0)},onReaderToggle:()=>{C.activeId&&v(!0)}})})})}),e.jsxs("div",{className:"flex flex-1 min-h-0 w-full overflow-hidden",children:[e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col overflow-hidden",children:[!k&&I&&!Z&&e.jsx("div",{className:"px-4 pt-3",children:e.jsxs("div",{className:"flex flex-col gap-3 rounded-xl border border-blue-500/40 bg-blue-500/10 px-4 py-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-100",children:"Restore your last browsing session?"}),e.jsxs("p",{className:"text-xs text-blue-200",children:["Last saved ",be??"recently"," • ",I.windowCount," window",I.windowCount===1?"":"s",", ",I.tabCount," tab",I.tabCount===1?"":"s"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:ve,disabled:J==="restoring",className:"inline-flex items-center rounded-lg border border-blue-500/60 bg-blue-600/20 px-3 py-1.5 text-sm font-medium text-blue-100 transition-colors hover:bg-blue-600/30 disabled:cursor-not-allowed disabled:opacity-60",children:[J==="restoring"?e.jsx(pe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(De,{className:"mr-2 h-4 w-4"}),"Restore"]}),e.jsx("button",{type:"button",onClick:ge,className:"rounded-lg border border-slate-700 bg-slate-800/60 px-3 py-1.5 text-sm text-slate-300 transition-colors hover:bg-slate-700/80",children:"Dismiss"})]})]})}),!k&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(E,{componentName:"TabStrip",children:e.jsx(Ue,{})})}),O?e.jsxs("div",{className:"flex flex-1 min-h-0 min-w-0 overflow-hidden",children:[e.jsx("div",{className:"min-h-0 min-w-[320px] flex-shrink-0 flex-grow-0",style:{width:`${Math.round(A*100)}%`},children:e.jsx(Ae,{tab:p,overlayActive:V})}),e.jsx("div",{onMouseDown:he,className:"z-20 flex h-full w-[6px] cursor-col-resize items-center justify-center bg-slate-900/50 transition-colors hover:bg-slate-800",children:e.jsx("div",{className:"h-24 w-[2px] rounded-full bg-slate-700/80"})}),e.jsx("div",{className:"relative min-h-0 min-w-[260px] flex-1 overflow-hidden",style:{width:`${Math.round((1-A)*100)}%`},children:e.jsx("div",{className:"h-full min-h-0 overflow-auto border-l border-slate-800/60 bg-slate-950/40",children:e.jsx(ce,{})})})]}):e.jsx("div",{className:`relative flex-1 min-h-0 min-w-0 overflow-hidden ${k?"absolute inset-0":""}`,children:e.jsx("div",{className:`h-full min-h-0 overflow-auto ${V?"webview--masked":""}`,children:e.jsx(ce,{})})})]}),!k&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(E,{componentName:"RightPanel",children:e.jsx("div",{className:"h-full min-h-0 w-[340px] max-w-[380px] overflow-y-auto border-l border-slate-800/60",children:e.jsx(Be,{open:t,onClose:()=>o(!1)})})})})]}),!k&&e.jsx("div",{className:"flex-none",children:e.jsx(r.Suspense,{fallback:null,children:e.jsx(E,{componentName:"BottomStatus",children:e.jsx(qe,{})})})}),e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"AgentOverlay",children:e.jsx(Ye,{})})})}),e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"ClipperOverlay",children:e.jsx(Xe,{active:x,onCancel:()=>i(!1),onCreateHighlight:xe})})})}),e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"ReaderOverlay",children:e.jsx(Ze,{active:l,onClose:()=>v(!1),tabId:C.activeId,url:p?.url})})})}),q&&e.jsx(D,{children:e.jsx("div",{className:"pointer-events-none fixed inset-0 z-tour flex items-center justify-center",children:e.jsxs("div",{className:"rounded-3xl border border-purple-500/40 bg-purple-900/50 px-8 py-6 text-center shadow-[0_0_60px_rgba(168,85,247,0.35)] backdrop-blur-sm",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-purple-200/70",children:"Tab graph"}),e.jsx("div",{className:"mt-2 text-lg font-semibold text-purple-100",children:"Drop to map this tab's DNA"}),e.jsx("div",{className:"mt-1 text-xs text-purple-200/80",children:"Release anywhere to open the graph overlay."})]})})}),e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"TabGraphOverlay",children:e.jsx(Je,{})})})}),!k&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(E,{componentName:"VoiceTips",children:e.jsx(Me,{})})}),G&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"ConsentDashboard",children:e.jsx(Qe,{})})})}),d&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"TrustEthicsDashboard",children:e.jsx(et,{})})})}),u&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"OnboardingTour",children:e.jsx(tt,{onClose:()=>{}})})})}),a&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"CommandPalette",children:e.jsx(Ge,{onClose:()=>m(!1)})})})}),c&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"PermissionPrompt",children:e.jsx(We,{request:c,onClose:()=>f(null)})})})}),y&&e.jsx(r.Suspense,{fallback:null,children:e.jsx(D,{children:e.jsx(E,{componentName:"ConsentPrompt",children:e.jsx(He,{request:y,onClose:()=>h(null)})})})}),K&&e.jsx(D,{children:e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("div",{className:`rounded-xl border px-4 py-3 text-sm shadow-xl shadow-black/40 ${K.variant==="success"?"border-emerald-400/40 bg-emerald-500/15 text-emerald-100":"border-amber-400/40 bg-amber-500/15 text-amber-100"}`,children:K.message})})})]})}const ht=Object.defineProperty({__proto__:null,AppShell:st},Symbol.toStringTag,{value:"Module"});export{ht as A,Ce as E,Re as M,De as R,Y as a,fe as b,Le as c,Oe as u};
//# sourceMappingURL=AppShell-BXhI_JTh.js.map

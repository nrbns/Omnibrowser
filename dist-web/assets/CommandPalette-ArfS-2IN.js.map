{"version":3,"file":"CommandPalette-ArfS-2IN.js","sources":["../../node_modules/lucide-react/dist/esm/icons/box.js","../../src/lib/commands/registry.ts","../../src/lib/commands/builtin.ts","../../src/components/layout/CommandPalette.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Box = createLucideIcon(\"Box\", [\n  [\n    \"path\",\n    {\n      d: \"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z\",\n      key: \"hh9hay\"\n    }\n  ],\n  [\"path\", { d: \"m3.3 7 8.7 5 8.7-5\", key: \"g66t2b\" }],\n  [\"path\", { d: \"M12 22V12\", key: \"d0xqtd\" }]\n]);\n\nexport { Box as default };\n//# sourceMappingURL=box.js.map\n","import type { CommandDescriptor, CommandSource } from './types';\r\n\r\ntype Listener = () => void;\r\n\r\nconst commandMap = new Map<string, CommandDescriptor>();\r\nconst sources = new Map<string, CommandSource>();\r\nconst listeners = new Set<Listener>();\r\n\r\nlet isHydrated = false;\r\n\r\nfunction emitChange() {\r\n  listeners.forEach((listener) => {\r\n    try {\r\n      listener();\r\n    } catch (error) {\r\n      console.error('[CommandRegistry] Listener error', error);\r\n    }\r\n  });\r\n}\r\n\r\nexport function registerCommand(command: CommandDescriptor): () => void {\r\n  if (commandMap.has(command.id)) {\r\n    console.warn(`[CommandRegistry] Command with id \"${command.id}\" already registered. Overwriting.`);\r\n  }\r\n  commandMap.set(command.id, command);\r\n  emitChange();\r\n  return () => {\r\n    if (commandMap.delete(command.id)) {\r\n      emitChange();\r\n    }\r\n  };\r\n}\r\n\r\nexport function registerCommandSource(source: CommandSource): () => void {\r\n  if (sources.has(source.id)) {\r\n    console.warn(`[CommandRegistry] Command source with id \"${source.id}\" already registered. Overwriting.`);\r\n  }\r\n  sources.set(source.id, source);\r\n  emitChange();\r\n  return () => {\r\n    if (sources.delete(source.id)) {\r\n      emitChange();\r\n    }\r\n  };\r\n}\r\n\r\nexport async function getAllCommands(): Promise<CommandDescriptor[]> {\r\n  const staticCommands = Array.from(commandMap.values());\r\n  const dynamicResults = await Promise.all(\r\n    Array.from(sources.values()).map(async (source) => {\r\n      try {\r\n        const results = await source.getCommands();\r\n        return results;\r\n      } catch (error) {\r\n        console.error(`[CommandRegistry] Failed to load commands from source \"${source.id}\":`, error);\r\n        return [];\r\n      }\r\n    }),\r\n  );\r\n\r\n  return [...staticCommands, ...dynamicResults.flat()];\r\n}\r\n\r\nexport function onCommandsChanged(listener: Listener): () => void {\r\n  listeners.add(listener);\r\n  return () => {\r\n    listeners.delete(listener);\r\n  };\r\n}\r\n\r\nexport function markHydrated() {\r\n  isHydrated = true;\r\n}\r\n\r\nexport function commandsHydrated(): boolean {\r\n  return isHydrated;\r\n}\r\n\r\nexport function notifyCommandsChanged() {\r\n  emitChange();\r\n}\r\n\r\n\r\n","import { registerCommand, registerCommandSource, markHydrated, commandsHydrated, notifyCommandsChanged } from './registry';\r\nimport type { CommandDescriptor } from './types';\r\nimport { ipc } from '../ipc-typed';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\n\r\nlet builtinsRegistered = false;\r\n\r\ntype AppState = ReturnType<typeof useAppStore.getState>;\r\ntype AppMode = AppState['mode'];\r\n\r\nconst staticCommands: CommandDescriptor[] = [\r\n  {\r\n    id: 'core:new-tab',\r\n    title: 'Open New Tab',\r\n    subtitle: 'Create a blank tab in the current container',\r\n    category: 'Navigation',\r\n    keywords: ['tab', 'new', 'create'],\r\n    shortcut: ['Ctrl/Cmd', 'T'],\r\n    run: async () => {\r\n      await ipc.tabs.create('about:blank');\r\n    },\r\n  },\r\n  {\r\n    id: 'core:privacy-dashboard',\r\n    title: 'Open Privacy Dashboard',\r\n    subtitle: 'Review shields, permissions, and session data',\r\n    category: 'Privacy',\r\n    keywords: ['privacy', 'dashboard', 'settings'],\r\n    run: () => {\r\n      window.location.hash = '#/privacy';\r\n    },\r\n  },\r\n  {\r\n    id: 'core:save-workspace',\r\n    title: 'Save Workspace Snapshot',\r\n    subtitle: 'Capture current tabs and layout into a workspace bundle',\r\n    category: 'Workspace',\r\n    keywords: ['workspace', 'session', 'save'],\r\n    run: async () => {\r\n      const name = prompt('Name of the workspace snapshot?');\r\n      if (!name) return;\r\n      await ipc.storage.saveWorkspace({\r\n        id: crypto.randomUUID(),\r\n        name,\r\n        partition: `persist:workspace:${Date.now()}`,\r\n      });\r\n    },\r\n  },\r\n  {\r\n    id: 'core:burn-active-tab',\r\n    title: 'Burn Active Tab',\r\n    subtitle: 'Permanently delete data for the current tab',\r\n    category: 'Privacy',\r\n    keywords: ['burn', 'tab', 'privacy'],\r\n    run: async () => {\r\n      const { activeId } = useTabsStore.getState();\r\n      if (!activeId) return;\r\n      const confirmed = confirm('Burn this tab? All associated storage will be destroyed.');\r\n      if (!confirmed) return;\r\n      await ipc.tabs.burn(activeId);\r\n    },\r\n  },\r\n  {\r\n    id: 'core:ask-agent',\r\n    title: 'Ask Omni Agent',\r\n    subtitle: 'Send a custom question to the AI agent',\r\n    category: 'AI',\r\n    keywords: ['agent', 'ai', 'question'],\r\n    run: async () => {\r\n      const promptText = prompt('What would you like the agent to do?');\r\n      if (!promptText) return;\r\n      await ipc.agent.createTask({\r\n        title: 'Command Palette Request',\r\n        role: 'researcher',\r\n        goal: promptText,\r\n        budget: { tokens: 4096, seconds: 120, requests: 20 },\r\n      });\r\n    },\r\n  },\r\n];\r\n\r\nfunction registerModeCommands() {\r\n  const modes: Array<{ id: string; title: string; mode: AppMode }> = [\r\n    { id: 'core:mode-browse', title: 'Switch to Browse Mode', mode: 'Browse' },\r\n    { id: 'core:mode-research', title: 'Switch to Research Mode', mode: 'Research' },\r\n    { id: 'core:mode-threats', title: 'Switch to Threat Mode', mode: 'Threats' },\r\n    { id: 'core:mode-trade', title: 'Switch to Trade Mode', mode: 'Trade' },\r\n    { id: 'core:mode-docs', title: 'Switch to Docs Mode', mode: 'Docs' },\r\n  ];\r\n\r\n  modes.forEach((entry) => {\r\n    registerCommand({\r\n      id: entry.id,\r\n      title: entry.title,\r\n      category: 'Modes',\r\n      keywords: ['mode', entry.mode.toLowerCase()],\r\n      run: () => {\r\n        useAppStore.getState().setMode(entry.mode);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nfunction registerStaticCommands() {\r\n  staticCommands.forEach((command) => registerCommand(command));\r\n}\r\n\r\nfunction registerActiveTabCommands() {\r\n  registerCommandSource({\r\n    id: 'dynamic:tabs',\r\n    getCommands: async () => {\r\n      const { tabs, activeId } = useTabsStore.getState();\r\n      return tabs.slice(0, 25).map((tab) => ({\r\n        id: `tab:focus:${tab.id}`,\r\n        title: tab.title || 'Untitled Tab',\r\n        subtitle: tab.url,\r\n        category: 'Tabs',\r\n        badge: tab.id === activeId ? 'Active' : undefined,\r\n        keywords: [tab.title, tab.url].filter(Boolean) as string[],\r\n        run: async () => {\r\n          await ipc.tabs.activate({ id: tab.id });\r\n        },\r\n      }));\r\n    },\r\n  });\r\n\r\n  useTabsStore.subscribe(() => {\r\n    notifyCommandsChanged();\r\n  });\r\n}\r\n\r\nexport function initializeBuiltinCommands() {\r\n  if (builtinsRegistered) {\r\n    return;\r\n  }\r\n  builtinsRegistered = true;\r\n\r\n  registerStaticCommands();\r\n  registerModeCommands();\r\n  registerActiveTabCommands();\r\n  markHydrated();\r\n}\r\n\r\nexport function builtinsInitialized(): boolean {\r\n  return builtinsRegistered && commandsHydrated();\r\n}\r\n\r\n\r\n","/**\r\n * CommandPalette - ⌘K command overlay\r\n */\r\n\r\nimport { useEffect, useMemo, useRef, useState } from 'react';\r\nimport type { ReactNode } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Search, ArrowRight, Box, Clock, Sparkles } from 'lucide-react';\r\nimport type { CommandDescriptor } from '../../lib/commands/types';\r\nimport { getAllCommands, onCommandsChanged } from '../../lib/commands/registry';\r\nimport { initializeBuiltinCommands, builtinsInitialized } from '../../lib/commands/builtin';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useContainerStore } from '../../state/containerStore';\r\nimport { ipcEvents } from '../../lib/ipc-events';\r\nimport type { ContainerInfo } from '../../lib/ipc-events';\r\n\r\ninterface CommandPaletteProps {\r\n  onClose: () => void;\r\n}\r\n\r\ntype HistoryEntry = {\r\n  id: string;\r\n  url: string;\r\n  title: string;\r\n  timestamp?: number;\r\n  visitCount?: number;\r\n  lastVisitTime?: number;\r\n};\r\n\r\ntype TabSnapshot = {\r\n  id: string;\r\n  title?: string;\r\n  url?: string;\r\n  active?: boolean;\r\n  containerId?: string;\r\n  containerName?: string;\r\n  containerColor?: string;\r\n  mode?: 'normal' | 'ghost' | 'private';\r\n};\r\n\r\ntype PaletteItem = {\r\n  id: string;\r\n  title: string;\r\n  subtitle?: string;\r\n  category: string;\r\n  type: 'command' | 'history' | 'container' | 'tab' | 'action';\r\n  keywords?: string[];\r\n  shortcut?: string[];\r\n  badge?: string;\r\n  run: () => Promise<void> | void;\r\n  icon?: ReactNode;\r\n  meta?: Record<string, unknown>;\r\n};\r\n\r\nconst DEFAULT_SEARCH_ENGINE = 'https://duckduckgo.com/?q=';\r\n\r\nconst TYPE_PRIORITY: Record<PaletteItem['type'], number> = {\r\n  action: 0,\r\n  command: 1,\r\n  container: 2,\r\n  tab: 3,\r\n  history: 4,\r\n};\r\n\r\nconst PROTOCOL_REGEX = /^(https?:\\/\\/|chrome:\\/\\/|edge:\\/\\/|about:|file:\\/\\/)/i;\r\nconst DOMAIN_REGEX = /^[\\w.-]+\\.[a-z]{2,}(?:[\\/?#].*)?$/i;\r\n\r\nconst withAlpha = (hex?: string, alpha = '33'): string | undefined => {\r\n  if (!hex || !hex.startsWith('#')) return undefined;\r\n  if (hex.length === 4) {\r\n    const r = hex[1];\r\n    const g = hex[2];\r\n    const b = hex[3];\r\n    return `#${r}${r}${g}${g}${b}${b}${alpha}`;\r\n  }\r\n  if (hex.length === 7) {\r\n    return `${hex}${alpha}`;\r\n  }\r\n  return hex;\r\n};\r\n\r\nconst capitalize = (value?: string): string =>\r\n  value ? value.charAt(0).toUpperCase() + value.slice(1) : '';\r\n\r\nconst buildNavigationTarget = (input: string): { url: string; description: string; isDirect: boolean } => {\r\n  const trimmed = input.trim();\r\n  if (!trimmed) {\r\n    return { url: 'about:blank', description: 'Open a blank tab', isDirect: true };\r\n  }\r\n\r\n  if (PROTOCOL_REGEX.test(trimmed)) {\r\n    return { url: trimmed, description: trimmed, isDirect: true };\r\n  }\r\n\r\n  if (!/\\s/.test(trimmed) && DOMAIN_REGEX.test(trimmed)) {\r\n    const url = trimmed.startsWith('www.') ? `https://${trimmed}` : `https://${trimmed}`;\r\n    return { url, description: url, isDirect: true };\r\n  }\r\n\r\n  return {\r\n    url: `${DEFAULT_SEARCH_ENGINE}${encodeURIComponent(trimmed)}`,\r\n    description: `Search the web for “${trimmed}”`,\r\n    isDirect: false,\r\n  };\r\n};\r\n\r\nfunction fuzzyScore(query: string, value?: string): number {\r\n  if (!value) return 0;\r\n  const normalizedQuery = query.toLowerCase();\r\n  const normalizedValue = value.toLowerCase();\r\n\r\n  let score = 0;\r\n  let queryIndex = 0;\r\n  let lastMatchIndex = -1;\r\n\r\n  for (let i = 0; i < normalizedValue.length && queryIndex < normalizedQuery.length; i++) {\r\n    if (normalizedValue[i] === normalizedQuery[queryIndex]) {\r\n      score += 5;\r\n      if (lastMatchIndex === i - 1) {\r\n        score += 3; // consecutive bonus\r\n      }\r\n      if (i === 0) {\r\n        score += 2; // prefix bonus\r\n      }\r\n      lastMatchIndex = i;\r\n      queryIndex++;\r\n    }\r\n  }\r\n\r\n  if (queryIndex === normalizedQuery.length) {\r\n    score += 5; // matched all characters\r\n  }\r\n\r\n  return score;\r\n}\r\n\r\nfunction scorePaletteItem(query: string, item: PaletteItem): number {\r\n  const fields = [\r\n    item.title,\r\n    item.subtitle,\r\n    item.category,\r\n    item.badge,\r\n    ...(item.keywords ?? []),\r\n  ];\r\n  let best = 0;\r\n  for (const field of fields) {\r\n    const current = fuzzyScore(query, field);\r\n    if (current > best) {\r\n      best = current;\r\n    }\r\n  }\r\n  return best;\r\n}\r\n\r\nexport function CommandPalette({ onClose }: CommandPaletteProps) {\r\n  const [query, setQuery] = useState('');\r\n  const [selectedIndex, setSelectedIndex] = useState(0);\r\n  const [commands, setCommands] = useState<CommandDescriptor[]>([]);\r\n  const [loading, setLoading] = useState(!builtinsInitialized());\r\n  const [recentHistory, setRecentHistory] = useState<HistoryEntry[]>([]);\r\n  const [historySearchResults, setHistorySearchResults] = useState<HistoryEntry[]>([]);\r\n  const [historyLoading, setHistoryLoading] = useState(false);\r\n  const [openTabs, setOpenTabs] = useState<TabSnapshot[]>([]);\r\n  const { containers, activeContainerId, setContainers, setActiveContainer } = useContainerStore((state) => ({\r\n    containers: state.containers,\r\n    activeContainerId: state.activeContainerId,\r\n    setContainers: state.setContainers,\r\n    setActiveContainer: state.setActiveContainer,\r\n  }));\r\n  const containersRef = useRef<ContainerInfo[]>(containers);\r\n\r\n  useEffect(() => {\r\n    containersRef.current = containers;\r\n  }, [containers]);\r\n\r\n  useEffect(() => {\r\n    if (!builtinsInitialized()) {\r\n      initializeBuiltinCommands();\r\n    }\r\n    let mounted = true;\r\n\r\n    const loadCommands = async () => {\r\n      const list = await getAllCommands();\r\n      if (!mounted) return;\r\n      setCommands(list);\r\n      setLoading(false);\r\n      setSelectedIndex(0);\r\n    };\r\n\r\n    void loadCommands();\r\n    const unsubscribe = onCommandsChanged(() => {\r\n      void loadCommands();\r\n    });\r\n\r\n    return () => {\r\n      mounted = false;\r\n      unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const loadRecent = async () => {\r\n      try {\r\n        const list = await ipc.history.list();\r\n        if (mounted) {\r\n          setRecentHistory(Array.isArray(list) ? list.slice(0, 20) : []);\r\n        }\r\n      } catch (error) {\r\n        console.warn('[CommandPalette] Failed to load history list:', error);\r\n      }\r\n    };\r\n    void loadRecent();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    if (containers.length === 0) {\r\n      ipc.containers\r\n        .list()\r\n        .then((list) => {\r\n          if (!cancelled && Array.isArray(list)) {\r\n            setContainers(list as ContainerInfo[]);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[CommandPalette] Failed to load containers:', error);\r\n        });\r\n    }\r\n\r\n    const unsubscribeList = ipcEvents.on<ContainerInfo[]>('containers:list', (payload) => {\r\n      if (Array.isArray(payload)) {\r\n        setContainers(payload as ContainerInfo[]);\r\n      }\r\n    });\r\n\r\n    const unsubscribeActive = ipcEvents.on<{ containerId: string; container?: ContainerInfo }>(\r\n      'containers:active',\r\n      (payload) => {\r\n        if (!payload) return;\r\n        const next = payload.container ?? containersRef.current.find((c) => c.id === payload.containerId);\r\n        if (next) {\r\n          setActiveContainer(next);\r\n        }\r\n      },\r\n    );\r\n\r\n    return () => {\r\n      cancelled = true;\r\n      unsubscribeList();\r\n      unsubscribeActive();\r\n    };\r\n  }, [containers.length, setContainers, setActiveContainer]);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    const loadTabs = async () => {\r\n      try {\r\n        const list = await ipc.tabs.list();\r\n        if (!cancelled && Array.isArray(list)) {\r\n          setOpenTabs(list as TabSnapshot[]);\r\n        }\r\n      } catch (error) {\r\n        console.warn('[CommandPalette] Failed to load tabs:', error);\r\n      }\r\n    };\r\n    void loadTabs();\r\n\r\n    const unsubscribeTabs = ipcEvents.on<any[]>('tabs:updated', (payload) => {\r\n      if (Array.isArray(payload)) {\r\n        setOpenTabs(payload as TabSnapshot[]);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      cancelled = true;\r\n      unsubscribeTabs();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const trimmed = query.trim();\r\n    if (trimmed.length < 2) {\r\n      setHistorySearchResults([]);\r\n      setHistoryLoading(false);\r\n      return;\r\n    }\r\n\r\n    let cancelled = false;\r\n    setHistoryLoading(true);\r\n\r\n    const runSearch = async () => {\r\n      try {\r\n        const results = await ipc.history.search(trimmed);\r\n        if (!cancelled) {\r\n          setHistorySearchResults(Array.isArray(results) ? results.slice(0, 20) : []);\r\n        }\r\n      } catch (error) {\r\n        if (!cancelled) {\r\n          console.warn('[CommandPalette] History search failed:', error);\r\n          setHistorySearchResults([]);\r\n        }\r\n      } finally {\r\n        if (!cancelled) {\r\n          setHistoryLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    void runSearch();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [query]);\r\n\r\n  const filteredItems = useMemo(() => {\r\n    const trimmed = query.trim();\r\n    const normalized = trimmed.toLowerCase();\r\n    const historySource = normalized.length >= 2 ? historySearchResults : recentHistory;\r\n\r\n    const commandItems: PaletteItem[] = commands.map((cmd) => ({\r\n      id: cmd.id,\r\n      title: cmd.title,\r\n      subtitle: cmd.subtitle,\r\n      category: cmd.category,\r\n      type: 'command',\r\n      keywords: cmd.keywords,\r\n      shortcut: cmd.shortcut,\r\n      badge: cmd.badge,\r\n      run: cmd.run,\r\n    }));\r\n\r\n    const containerItems: PaletteItem[] = containers.map((container) => ({\r\n      id: `container:${container.id}`,\r\n      title: `Switch to ${container.name}`,\r\n      subtitle: container.description || `${capitalize(container.scope ?? 'session')} container`,\r\n      category: 'Containers',\r\n      type: 'container',\r\n      badge: container.id === activeContainerId ? 'Active' : undefined,\r\n      keywords: [container.name, container.description ?? '', container.id, container.scope ?? ''],\r\n      meta: { color: container.color, container },\r\n      run: async () => {\r\n        try {\r\n          const result = await ipc.containers.setActive(container.id);\r\n          const info = (result || container) as ContainerInfo;\r\n          setActiveContainer(info);\r\n        } catch (error) {\r\n          console.warn('[CommandPalette] Failed to switch container:', error);\r\n        }\r\n      },\r\n    }));\r\n\r\n    const tabItems: PaletteItem[] = openTabs.map((tab) => ({\r\n      id: `tab:${tab.id}`,\r\n      title: tab.title || tab.url || 'Untitled tab',\r\n      subtitle: tab.url,\r\n      category: 'Open Tabs',\r\n      type: 'tab',\r\n      badge: tab.active ? 'Current Tab' : tab.containerName,\r\n      keywords: [tab.title ?? '', tab.url ?? '', tab.containerName ?? '', tab.mode ?? ''],\r\n      meta: { color: tab.containerColor, active: tab.active },\r\n      run: async () => {\r\n        await ipc.tabs.activate({ id: tab.id });\r\n      },\r\n    }));\r\n\r\n    const historyItems: PaletteItem[] = historySource.map((entry) => ({\r\n      id: `history:${entry.id}`,\r\n      title: entry.title || entry.url,\r\n      subtitle: entry.url,\r\n      category: 'History',\r\n      type: 'history',\r\n      badge: entry.visitCount ? `${entry.visitCount}×` : undefined,\r\n      keywords: [entry.url, entry.title],\r\n      run: async () => {\r\n        if (!entry.url) return;\r\n        await ipc.tabs.create({ url: entry.url });\r\n      },\r\n    }));\r\n\r\n    const openInContainerItems: PaletteItem[] =\r\n      trimmed.length > 0\r\n        ? containers.map((container) => {\r\n            const target = buildNavigationTarget(trimmed);\r\n            return {\r\n              id: `open:${container.id}:${trimmed}`,\r\n              title: target.isDirect\r\n                ? `Open ${target.url} in ${container.name}`\r\n                : `Search “${trimmed}” in ${container.name}`,\r\n              subtitle: target.description,\r\n              category: 'Open in Container',\r\n              type: 'action',\r\n              badge: 'New Tab',\r\n              keywords: [trimmed, container.name, container.id],\r\n              meta: { color: container.color },\r\n              run: async () => {\r\n                await ipc.tabs.create({ url: target.url, containerId: container.id });\r\n              },\r\n            } satisfies PaletteItem;\r\n          })\r\n        : [];\r\n\r\n    const combined = [\r\n      ...openInContainerItems,\r\n      ...commandItems,\r\n      ...containerItems,\r\n      ...tabItems,\r\n      ...historyItems,\r\n    ];\r\n\r\n    if (!normalized) {\r\n      return combined.slice(0, 30);\r\n    }\r\n\r\n    const scored = combined\r\n      .map((item) => ({\r\n        item,\r\n        score: scorePaletteItem(normalized, item),\r\n      }))\r\n      .filter(({ score }) => score > 0)\r\n      .sort((a, b) => {\r\n        if (b.score !== a.score) {\r\n          return b.score - a.score;\r\n        }\r\n        const orderA = TYPE_PRIORITY[a.item.type] ?? 99;\r\n        const orderB = TYPE_PRIORITY[b.item.type] ?? 99;\r\n        if (orderA !== orderB) {\r\n          return orderA - orderB;\r\n        }\r\n        return a.item.title.localeCompare(b.item.title);\r\n      })\r\n      .slice(0, 30)\r\n      .map(({ item }) => item);\r\n    return scored;\r\n  }, [query, commands, containers, activeContainerId, openTabs, historySearchResults, recentHistory, setActiveContainer]);\r\n\r\n  const filteredCommands = filteredItems;\r\n\r\n  const groupedItems = useMemo(() => {\r\n    const sections: Array<{ category: string; items: PaletteItem[]; startIndex: number }> = [];\r\n    let currentCategory = '';\r\n\r\n    filteredItems.forEach((item, index) => {\r\n      if (item.category !== currentCategory) {\r\n        currentCategory = item.category;\r\n        sections.push({ category: currentCategory, items: [item], startIndex: index });\r\n      } else {\r\n        sections[sections.length - 1]?.items.push(item);\r\n      }\r\n    });\r\n\r\n    return sections;\r\n  }, [filteredItems]);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onClose();\r\n      } else if (e.key === 'ArrowDown') {\r\n        e.preventDefault();\r\n        setSelectedIndex(prev => Math.min(prev + 1, Math.max(filteredCommands.length - 1, 0)));\r\n      } else if (e.key === 'ArrowUp') {\r\n        e.preventDefault();\r\n        setSelectedIndex(prev => Math.max(prev - 1, 0));\r\n      } else if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        if (filteredCommands[selectedIndex]) {\r\n          void filteredCommands[selectedIndex].run();\r\n          onClose();\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [selectedIndex, filteredCommands, onClose]);\r\n\r\n  useEffect(() => {\r\n    if (selectedIndex >= filteredItems.length) {\r\n      setSelectedIndex(filteredItems.length > 0 ? filteredItems.length - 1 : 0);\r\n    }\r\n  }, [filteredItems, selectedIndex]);\r\n\r\n  const renderIcon = (item: PaletteItem) => {\r\n    const color = typeof item.meta?.color === 'string' ? (item.meta.color as string) : undefined;\r\n    const classNameBase =\r\n      'inline-flex h-6 w-6 items-center justify-center rounded-lg border text-[11px]';\r\n    const className =\r\n      color != null\r\n        ? classNameBase\r\n        : `${classNameBase} border-gray-700 bg-gray-800/60 text-gray-300`;\r\n    const style =\r\n      color != null\r\n        ? {\r\n            borderColor: withAlpha(color, '66') ?? color,\r\n            backgroundColor: withAlpha(color, '22') ?? color,\r\n            color,\r\n          }\r\n        : undefined;\r\n\r\n    if (item.icon) {\r\n      return (\r\n        <span className={className} style={style}>\r\n          {item.icon}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    switch (item.type) {\r\n      case 'history':\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Clock size={14} />\r\n          </span>\r\n        );\r\n      case 'container':\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Box size={14} />\r\n          </span>\r\n        );\r\n      case 'tab':\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Box size={12} />\r\n          </span>\r\n        );\r\n      case 'action':\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Sparkles size={14} />\r\n          </span>\r\n        );\r\n      default:\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Sparkles size={14} />\r\n          </span>\r\n        );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n      className=\"fixed inset-0 z-50 flex items-start justify-center pt-[15vh]\"\r\n      onClick={onClose}\r\n    >\r\n      {/* Backdrop */}\r\n      <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\" />\r\n\r\n      {/* Palette */}\r\n      <motion.div\r\n        initial={{ scale: 0.95, opacity: 0, y: -20 }}\r\n        animate={{ scale: 1, opacity: 1, y: 0 }}\r\n        exit={{ scale: 0.95, opacity: 0, y: -20 }}\r\n        onClick={(e) => e.stopPropagation()}\r\n        className=\"relative w-full max-w-2xl mx-4 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-2xl shadow-2xl overflow-hidden\"\r\n      >\r\n        {/* Search Input */}\r\n        <div className=\"flex items-center gap-3 px-4 py-3 border-b border-gray-800/50\">\r\n          <Search size={20} className=\"text-gray-400\" />\r\n          <input\r\n            type=\"text\"\r\n            value={query}\r\n            onChange={(e) => {\r\n              setQuery(e.target.value);\r\n              setSelectedIndex(0);\r\n            }}\r\n            autoFocus\r\n            placeholder=\"Type a command or search...\"\r\n            className=\"flex-1 bg-transparent text-gray-200 placeholder-gray-500 focus:outline-none\"\r\n          />\r\n          <kbd className=\"px-2 py-1 bg-gray-800 border border-gray-700 rounded text-xs text-gray-400\">\r\n            Esc\r\n          </kbd>\r\n        </div>\r\n\r\n        {/* Results */}\r\n        <div className=\"max-h-96 overflow-y-auto\">\r\n          {filteredItems.length > 0 ? (\r\n            <div className=\"py-2\">\r\n              {groupedItems.map((section) => (\r\n                <div key={`section-${section.category}`}>\r\n                  <div className=\"px-4 pt-3 pb-1 text-[11px] uppercase tracking-wider text-gray-500\">\r\n                    {section.category}\r\n                  </div>\r\n                  <div className=\"flex flex-col\">\r\n                    {section.items.map((cmd, index) => {\r\n                      const globalIndex = section.startIndex + index;\r\n                      const isSelected = selectedIndex === globalIndex;\r\n                      const iconElement = renderIcon(cmd);\r\n                      return (\r\n                        <motion.button\r\n                          key={cmd.id}\r\n                          onClick={() => {\r\n                            void cmd.run();\r\n                            onClose();\r\n                          }}\r\n                          onMouseEnter={() => setSelectedIndex(globalIndex)}\r\n                          className={`w-full flex items-center justify-between px-4 py-3 text-left transition-colors ${\r\n                            isSelected\r\n                              ? 'bg-blue-600/20 border-l-2 border-blue-500'\r\n                              : 'hover:bg-gray-800/40 border-l-2 border-transparent'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-center gap-3 min-w-0\">\r\n                            {iconElement}\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <span className=\"text-sm font-medium text-gray-200 truncate\">{cmd.title}</span>\r\n                                {cmd.badge && (\r\n                                  <span className=\"rounded-full border border-gray-700 bg-gray-800/60 px-2 py-0.5 text-[10px] uppercase tracking-wide text-gray-400\">\r\n                                    {cmd.badge}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                              {cmd.subtitle && (\r\n                                <div className=\"text-xs text-gray-500 truncate\">\r\n                                  {cmd.subtitle}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2 ml-4 shrink-0\">\r\n                            {cmd.shortcut && (\r\n                              <span className=\"flex items-center gap-1 text-[11px] text-gray-500\">\r\n                                {cmd.shortcut.map((part, idx) => (\r\n                                  <kbd\r\n                                    key={`${cmd.id}-sc-${idx}`}\r\n                                    className=\"rounded border border-gray-700 bg-gray-800/60 px-1.5 py-0.5 text-[10px] text-gray-400\"\r\n                                  >\r\n                                    {part}\r\n                                  </kbd>\r\n                                ))}\r\n                              </span>\r\n                            )}\r\n                            <ArrowRight size={16} className=\"text-gray-500\" />\r\n                          </div>\r\n                        </motion.button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"py-8 text-center text-gray-500 text-sm\">\r\n              {loading || historyLoading ? 'Searching…' : 'No commands found'}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"px-4 py-2 border-t border-gray-800/50 flex items-center justify-between text-xs text-gray-500\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <span>↑↓ Navigate</span>\r\n            <span>↵ Select</span>\r\n            <span>Esc Close</span>\r\n          </div>\r\n          <span>{filteredItems.length} results</span>\r\n        </div>\r\n      </motion.div>\r\n    </motion.div>\r\n  );\r\n}\r\n\r\n"],"names":["Box","createLucideIcon","commandMap","sources","listeners","isHydrated","emitChange","listener","error","registerCommand","command","registerCommandSource","source","getAllCommands","staticCommands","dynamicResults","onCommandsChanged","markHydrated","commandsHydrated","notifyCommandsChanged","builtinsRegistered","ipc","name","activeId","useTabsStore","promptText","registerModeCommands","entry","useAppStore","registerStaticCommands","registerActiveTabCommands","tabs","tab","initializeBuiltinCommands","builtinsInitialized","DEFAULT_SEARCH_ENGINE","TYPE_PRIORITY","PROTOCOL_REGEX","DOMAIN_REGEX","withAlpha","hex","alpha","r","g","b","capitalize","value","buildNavigationTarget","input","trimmed","url","fuzzyScore","query","normalizedQuery","normalizedValue","score","queryIndex","lastMatchIndex","i","scorePaletteItem","item","fields","best","field","current","CommandPalette","onClose","setQuery","useState","selectedIndex","setSelectedIndex","commands","setCommands","loading","setLoading","recentHistory","setRecentHistory","historySearchResults","setHistorySearchResults","historyLoading","setHistoryLoading","openTabs","setOpenTabs","containers","activeContainerId","setContainers","setActiveContainer","useContainerStore","state","containersRef","useRef","useEffect","mounted","loadCommands","list","unsubscribe","cancelled","unsubscribeList","ipcEvents","payload","unsubscribeActive","next","c","unsubscribeTabs","results","filteredItems","useMemo","normalized","historySource","commandItems","cmd","containerItems","container","info","tabItems","historyItems","combined","target","a","orderA","orderB","filteredCommands","groupedItems","sections","currentCategory","index","handleKeyDown","e","prev","renderIcon","color","classNameBase","className","style","jsx","Clock","Sparkles","jsxs","motion","Search","section","globalIndex","isSelected","iconElement","part","idx","ArrowRight"],"mappings":"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","x_google_ignoreList":[0]}
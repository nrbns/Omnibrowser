import{r as s,j as e,d as at,u as ye,g as it,a as yt,i as w,b as nt,c as xt}from"./index-BquUM_dP.js";import{R as bt,u as Ge,a as gt,b as vt}from"./AppShell-BXhI_JTh.js";import{u as be,W as Be,E as wt}from"./privacyStore-B5f_8hYF.js";import{u as ot,T as kt,W as We,F as He}from"./OmniDesk-BdBOPLft.js";import{B as jt}from"./brain-B9NCOvP-.js";import{G as Nt}from"./gamepad-2-B6N6cwl_.js";import{Z as Ct}from"./zap-exKG0bW3.js";import{c as ne,b as St,f as At,L as Ke,m as N}from"./proxy-BIEmBbur.js";import{i as lt}from"./ipc-events-CqodUROu.js";import{u as ce}from"./use-ipc-event-CcVO0A42.js";import{d as Ue,H as Pt}from"./debounce-CnqAXreA.js";import{L as It}from"./lock-BeOLUjZE.js";import{G as Et}from"./globe-CrjHlxyj.js";import{S as de}from"./shield-Ce_H0Kiu.js";import{S as ge}from"./search-RYizLTqL.js";import{A as he}from"./index-TWPLI6s_.js";import{S as xe,L as Ce}from"./sparkles-B3IeNLsk.js";import{C as qe}from"./clock-gSt0ZU7N.js";import{P as Me}from"./plus-Al6gge0g.js";import{C as ct,a as dt}from"./check-BWr6G6Rr.js";import{X as Tt}from"./x-C_5K_ivr.js";import{f as Lt}from"./formatDistanceToNow-Ctx6mZEP.js";import{u as _e,e as $t}from"./profileStore-B9Mbf7JP.js";import{D as Re}from"./download-B_E2bknD.js";import{E as Rt}from"./eye-off-DfQe_-FT.js";import{G as zt,B as Mt,S as Dt}from"./sun-B4KqhO0u.js";import{M as Ft,S as Xe}from"./settings-DCl-8xpx.js";import{N as ve}from"./network-RlKt8r1q.js";import{C as Ne}from"./circle-check-big-DljQtsCI.js";import{C as Ee}from"./circle-x-DE3GrI7J.js";import{R as ze}from"./refresh-cw-BV6giV6D.js";import{P as Ot}from"./play-BpEGLF92.js";import{A as Gt}from"./arrow-right-0_MbL2nW.js";import{B as Ve}from"./agentStreamStore-BcjkWHdN.js";import{A as Bt}from"./activity-BycRfeKU.js";import"./Portal-BzN9CTBx.js";import"./trustDashboardStore-CKKody0H.js";import"./triangle-alert-CrRrQux7.js";import"./cloud-BWs6gXbb.js";import"./circle-check-DDsejJ4f.js";const Wt=ne("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Ht=ne("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);const Kt=ne("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);const De=ne("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const Ut=ne("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const ut=ne("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);const qt=ne("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);const Te=ne("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);const _t=ne("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const Le=ne("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const Xt=ne("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);const Vt=ne("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const Zt=ne("PictureInPicture",[["path",{d:"M8 4.5v5H3m-1-6 6 6m13 0v-3c0-1.16-.84-2-2-2h-7m-9 9v2c0 1.05.95 2 2 2h3",key:"bcd8fb"}],["rect",{width:"10",height:"7",x:"12",y:"13.5",ry:"2",key:"136fx3"}]]);const Qt=ne("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);const Yt=ne("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Jt=s.createContext(null);function es(){const r=s.useRef(!1);return St(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function ts(){const r=es(),[a,o]=s.useState(0),p=s.useCallback(()=>{r.current&&o(a+1)},[a]);return[s.useCallback(()=>At.postRender(p),[p]),a]}const ss=r=>!r.isLayoutDirty&&r.willUpdate(!1);function Ze(){const r=new Set,a=new WeakMap,o=()=>r.forEach(ss);return{add:p=>{r.add(p),a.set(p,p.addEventListener("willUpdate",o))},remove:p=>{r.delete(p);const c=a.get(p);c&&(c(),a.delete(p)),o()},dirty:o}}const mt=r=>r===!0,rs=r=>mt(r===!0)||r==="id",as=({children:r,id:a,inherit:o=!0})=>{const p=s.useContext(Ke),c=s.useContext(Jt),[g,h]=ts(),P=s.useRef(null),E=p.id||c;P.current===null&&(rs(o)&&E&&(a=a?E+"-"+a:E),P.current={id:a,group:mt(o)&&p.group||Ze()});const C=s.useMemo(()=>({...P.current,forceRender:g}),[h]);return e.jsx(Ke.Provider,{value:C,children:r})},is=[{id:"Research",icon:jt,label:"Research",color:"text-purple-400",glowColor:"from-purple-500 via-purple-600 to-purple-500"},{id:"Trade",icon:kt,label:"Trade",color:"text-green-400",glowColor:"from-green-500 via-emerald-600 to-green-500"},{id:"Games",icon:Nt,label:"Game",color:"text-yellow-400",glowColor:"from-yellow-500 via-amber-600 to-yellow-500"},{id:"Browse",icon:Ct,label:"Browse",color:"text-cyan-400",glowColor:"from-cyan-500 via-blue-600 to-cyan-500"}];function ns(){const{mode:r,setMode:a}=ot(),o=at(),p=g=>{a(g.id),o("/")},c=r||"Research";return e.jsx("div",{className:"flex items-center gap-1 bg-gray-800/60 rounded-lg p-1 border border-gray-700/50 shadow-sm",children:is.map(g=>{const h=g.icon,P=c===g.id;return e.jsxs(N.button,{onClick:()=>p(g),whileHover:{scale:1.02},whileTap:{scale:.98},className:`
              relative flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium
              transition-all duration-200 cursor-pointer
              ${P?`bg-gradient-to-r ${g.glowColor} text-white shadow-lg`:"text-gray-400 hover:text-gray-200 hover:bg-gray-700/30"}
            `,title:g.label,children:[e.jsx(h,{size:16,className:P?"text-white":g.color}),e.jsx("span",{children:g.label}),P&&e.jsx(N.div,{className:`absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r ${g.glowColor} rounded-full`,initial:{scaleX:0},animate:{scaleX:1},transition:{type:"spring",stiffness:500,damping:30}})]},g.id)})})}const Qe=nt(),os={google:"https://www.google.com/search?q=",duckduckgo:"https://duckduckgo.com/?q=",wiki:"https://en.wikipedia.org/wiki/Special:Search?search=",youtube:"https://www.youtube.com/results?search_query=",twitter:"https://twitter.com/search?q="},we=(r,a)=>`${os[r]}${encodeURIComponent(a)}`,pt=(r,a)=>{if(a===null||Number.isNaN(a)||!Number.isFinite(a))return null;const o=Math.abs(a)>1e6||Math.abs(a)<1e-4?a.toExponential(6):Number.isInteger(a)?a.toString():a.toPrecision(8).replace(/\.?0+$/,"");return`${r} = ${o}`},ft=r=>{const a=r.replace(/,/g,"").trim();if(!a||!/^[0-9+\-*/().%\s^]+$/.test(a))return null;try{const o=Function(`"use strict"; return (${a.replace(/\^/g,"**")})`)();if(typeof o=="number"&&Number.isFinite(o))return o}catch{return null}return null},Ye=r=>{const a=r.trim();if(!a)return null;const o=a.toLowerCase();if(o.startsWith("/calc")){const p=a.slice(5).trim(),c=p?ft(p):null;return{type:"calc",expr:p,result:c??void 0}}return o.startsWith("/ai")?{type:"ai",prompt:a.slice(3).trim()}:o.startsWith("/g ")?{type:"search",engine:"google",query:a.slice(3).trim()}:o.startsWith("/ddg ")?{type:"search",engine:"duckduckgo",query:a.slice(5).trim()}:o.startsWith("/wiki ")?{type:"search",engine:"wiki",query:a.slice(6).trim()}:o.startsWith("/yt ")?{type:"search",engine:"youtube",query:a.slice(4).trim()}:o.startsWith("/t ")?{type:"search",engine:"twitter",query:a.slice(3).trim()}:a.startsWith("?")?{type:"agent",prompt:a.slice(1).trim()}:o.startsWith("ask ")?{type:"agent",prompt:a.slice(4).trim()}:a.startsWith("/")?{type:"command",command:a.slice(1).trim()}:null},ls=(r,a)=>{switch(r.type){case"calc":{if(!r.expr)return{type:"command",title:"Calculate…",subtitle:"Enter an expression to evaluate",action:r};const o=pt(r.expr,r.result??null);return{type:"command",title:`Calculate: ${r.expr}`,subtitle:o??"Press enter to evaluate",action:r}}case"ai":return{type:"command",title:`Ask AI assistant${r.prompt?`: ${r.prompt}`:""}`,subtitle:r.prompt?"OmniBrowser agent":"Provide a prompt to continue",action:r};case"agent":return{type:"command",title:`Ask agent${r.prompt?`: ${r.prompt}`:""}`,subtitle:"Query the current page context",action:r};case"search":return{type:"search",title:`${r.engine==="duckduckgo"?"DuckDuckGo":r.engine==="wiki"?"Wikipedia":r.engine==="youtube"?"YouTube":r.engine==="twitter"?"Twitter/X":"Google"}: ${r.query||a}`,subtitle:we(r.engine,r.query||a),action:r};case"command":return{type:"command",title:`Run command: ${r.command||a}`,subtitle:"Press enter to execute via command palette",action:r};default:return null}},Je="omnibox:recent",et=20;function cs({onCommandPalette:r}){const{tabs:a,activeId:o}=ye(),p=it(t=>t.activeContainerId),c=yt(),g=t=>t.map(n=>({id:n.id,title:n.title||"New Tab",url:n.url||"about:blank",active:!!n.active,mode:n.mode,containerId:n.containerId,containerName:n.containerName,containerColor:n.containerColor,createdAt:n.createdAt,lastActiveAt:n.lastActiveAt,sessionId:n.sessionId,profileId:n.profileId,sleeping:n.sleeping})),[h,P]=s.useState(""),[E,C]=s.useState(!1),[v,A]=s.useState([]),[G,q]=s.useState(-1),[V,le]=s.useState(null),[R,Z]=s.useState(0),[Q,K]=s.useState(!1),[Y,J]=s.useState([]),ee=s.useRef(null),[y,_]=s.useState([]),[S,B]=s.useState(null),D=s.useRef(null),te=s.useRef(null),ue=s.useCallback((t,n)=>{const d=window?.ipc;if(d){if(typeof d.on=="function"){d.on(t,n);return}typeof d.addListener=="function"&&d.addListener(t,n)}},[]),ae=s.useCallback((t,n)=>{const d=window?.ipc;if(d){if(typeof d.removeListener=="function"){d.removeListener(t,n);return}if(typeof d.off=="function"){d.off(t,n);return}typeof d.removeEventListener=="function"&&d.removeEventListener(t,n)}},[]),W=a.find(t=>t.id===o);s.useEffect(()=>{try{const t=localStorage.getItem(Je);if(t){const n=JSON.parse(t);Array.isArray(n)&&J(n.filter(d=>typeof d?.url=="string").slice(0,et))}}catch(t){console.warn("Failed to restore omnibox recents:",t)}},[]);const se=s.useCallback((t,n)=>{!n||n.startsWith("about:")||n.startsWith("ob://")||J(d=>{const f=d.filter(b=>b.url!==n),I=[{title:t||n,url:n,timestamp:Date.now()},...f].slice(0,et);try{localStorage.setItem(Je,JSON.stringify(I))}catch(b){console.warn("Failed to persist omnibox recents:",b)}return I})},[]),U=s.useCallback(()=>{if(te.current){try{te.current()}catch{}te.current=null}D.current=null},[]),me=s.useCallback(t=>{if(!(!t||typeof t!="object")){if(t.type==="status"){B(t.value||null);return}if(t.type==="result"&&t.result){_(n=>{const d=n.findIndex(f=>f.url===t.result.url);if(d>=0){const f=n.slice();return f[d]={...f[d],...t.result},f}return[...n,t.result]});return}if(t.type==="complete"){B(n=>n??"Live results updated");return}if(t.type==="error"){B(t.message||"Live search failed");return}}},[]),m=s.useCallback(async t=>{const n=t.trim();if(n){U(),_([]),B("Searching…");try{const d=await w.liveSearch.start(n,{maxResults:10});D.current=d;const f=(I,b)=>{me(b)};ue(d.channel,f),te.current=()=>ae(d.channel,f)}catch(d){console.error("Live search start failed:",d),B("Live search failed")}}},[ue,ae,me,U]);ce("tabs:updated",t=>{const n=Array.isArray(t)?t.find(d=>d.active):null;if(n&&!E){P(n.url||"");try{const d=new URL(n.url||"about:blank");le({secure:d.protocol==="https:"})}catch{le(null)}}},[o,E]),ce("tabs:progress",t=>{t.tabId===o&&(Z(t.progress),K(t.progress<100&&t.progress>0))},[o]);const L=s.useCallback(Ue(async t=>{const n=t??"",d=n.toLowerCase().trim(),f=[];if(d.startsWith("@live")){A([]);return}const I=typeof navigator<"u"&&navigator.onLine===!1,b=(j,F=!1)=>{if(!j.title)return;f.some(i=>i.title===j.title&&i.subtitle===j.subtitle&&i.url===j.url&&i.type===j.type)||(F?f.unshift(j):f.push(j))},X=Ye(n);if(X){const j=ls(X,n);j&&b(j)}const T=n.trim();if(T.length>0&&!T.startsWith("@")&&!T.startsWith("/")&&!(X&&(X.type==="agent"||X.type==="ai")))b({type:"command",title:`Ask @redix: ${T}`,subtitle:"Stream the Redix agent answer inline",action:{type:"agent",prompt:T},badge:"@redix",icon:"sparkles"},!0);else if(!T){const j=[W?.title?`Summarize "${W.title}"`:"Summarize this tab","Why did regen mode fire?","What related sources am I tracking?"];j.slice().reverse().forEach((F,z)=>b({type:"command",title:`Ask @redix: ${F}`,subtitle:z===j.length-1?"Redix agent":void 0,action:{type:"agent",prompt:F},badge:"@redix",icon:"sparkles"},!0))}d.length>0&&!d.startsWith("http")&&!d.includes(".")&&((!X||X.type!=="search")&&b({type:"search",title:`Search: ${n}`,subtitle:we("google",n),action:{type:"search",engine:"google",query:n}}),b({type:"search",title:`DuckDuckGo: ${n}`,subtitle:we("duckduckgo",n),action:{type:"search",engine:"duckduckgo",query:n}})),a.forEach(j=>{const F=j.title||"Untitled",z=j.url||"";(F.toLowerCase().includes(d)||z.toLowerCase().includes(d))&&b({type:"tab",title:F,subtitle:z||void 0,action:z?{type:"nav",url:z}:void 0})});try{let j=[];if(!I)if(d.trim().length===0||d.length<2)try{j=await w.history.search("")}catch(F){Qe&&console.warn("History search failed:",F),j=[]}else try{j=await w.history.search(n)}catch(F){Qe&&console.warn("History search failed:",F),j=[]}Array.isArray(j)&&j.length>0&&j.slice(0,5).forEach(F=>{b({type:"history",title:F.title||F.url||"Untitled",subtitle:F.url,action:F.url?{type:"nav",url:F.url}:void 0})})}catch(j){console.warn("History search failed:",j)}Y.filter(j=>!d||j.title.toLowerCase().includes(d)||j.url.toLowerCase().includes(d)).slice(0,5).forEach(j=>{b({type:"history",title:j.title,subtitle:j.url,action:{type:"nav",url:j.url}})}),A(f.slice(0,8))},150),[a,Y,W?.id,W?.title]),$=s.useMemo(()=>Ue(t=>{m(t)},250),[m]);s.useEffect(()=>()=>$.cancel(),[$]),s.useEffect(()=>()=>{U()},[U]),s.useEffect(()=>{const t=h.trim();if(t.toLowerCase().startsWith("@live")){const n=t.replace(/^@live\\s*/i,"").trim();if(n.length<2){$.cancel(),_([]),B("Type at least 2 characters to stream results"),U();return}$(n)}else $.cancel(),_([]),B(null),U()},[h,$,U]),s.useEffect(()=>{const t=h.trim();if(!t.toLowerCase().startsWith("@live"))return;const n=t.replace(/^@live\s*/i,"").trim(),d=[{type:"command",title:`Redix Live Search${n?` • ${n}`:""}`,subtitle:S??(n.length<2?"Type at least 2 characters to begin streaming":y.length===0?"Streaming results…":"Live results ready"),interactive:!1,icon:"sparkles"}];y.forEach(f=>{d.push({type:"search",title:f.title||f.url,subtitle:f.snippet||f.url,url:f.url,action:{type:"nav",url:f.url,title:f.title},icon:"search"})}),A(d)},[h,y,S]),s.useEffect(()=>{E?L(h):A([])},[h,E,L]),s.useEffect(()=>{q(-1)},[v.length]),s.useEffect(()=>{const t=n=>{const f=navigator.platform.toUpperCase().indexOf("MAC")>=0?n.metaKey:n.ctrlKey;f&&n.key==="l"&&(n.preventDefault(),ee.current?.focus(),ee.current?.select()),f&&n.key==="k"&&(n.preventDefault(),r())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[r]);const l=async(t,n={})=>{const{background:d=!1,newWindow:f=!1,titleOverride:I}=n;let b=t.trim();if(!b)return;!b.startsWith("http://")&&!b.startsWith("https://")&&!b.startsWith("about:")&&!b.startsWith("file://")&&!b.startsWith("ob://")&&(/^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]*\.[a-zA-Z]{2,}$/.test(b)||b.includes(".")?b=`https://${b}`:b=we("google",b.trim()));const X=d&&!f;if(!c){const T=I||b,re=ye.getState(),pe=(re.tabs??[]).map(z=>({...z}));let j=pe,F=re.activeId??null;if(!re.activeId||pe.length===0){const z=`local-${Date.now()}`;j=pe.map(i=>({...i,active:!1})),j.push({id:z,title:T,url:b,active:!0,mode:"normal"}),F=z}else if(X){const z=`local-${Date.now()}`;j=pe.map(i=>({...i})),j.push({id:z,title:T,url:b,active:!1,mode:"normal"})}else j=pe.map(z=>({...z,title:z.id===re.activeId?T:z.title,url:z.id===re.activeId?b:z.url,active:z.id===re.activeId})),F=re.activeId;ye.setState({tabs:j,activeId:F}),lt.emit("tabs:updated",g(j)),C(!1),A([]),X||P(b),se(T,b);try{f||X?window.open(b,"_blank","noopener,noreferrer"):P(b)}catch(z){console.warn("Failed to handle navigation in browser runtime:",z)}return}if(f){try{await w.private.createWindow({url:b}),C(!1),A([]),se(I||b,b)}catch(T){console.error("Failed to open new window for navigation:",T)}return}try{if((!window.ipc||typeof window.ipc.invoke!="function")&&(console.warn("[Omnibox] IPC not ready for navigation, waiting..."),await new Promise(T=>setTimeout(T,500))),console.log("[Omnibox] Navigating to:",b,{activeId:o,openInBackground:X,activeContainerId:p}),o)if(X){console.log("[Omnibox] Creating background tab");const T=await w.tabs.create({url:b,containerId:p,activate:!1});console.log("[Omnibox] Background tab created:",T)}else console.log("[Omnibox] Navigating active tab:",o),await w.tabs.navigate(o,b),console.log("[Omnibox] Navigation complete");else{console.log("[Omnibox] Creating new tab (no active tab)");const T=await w.tabs.create({url:b,containerId:p,activate:!X});console.log("[Omnibox] Tab created:",T)}C(!1),A([]),X||P(b),se(I||b,b)}catch(T){console.error("Navigation failed:",T);try{(!window.ipc||typeof window.ipc.invoke!="function")&&(console.warn("IPC not ready for tab creation, waiting..."),await new Promise(pe=>setTimeout(pe,500)));const re=await w.tabs.create({url:b,containerId:p,activate:!X});re&&re.id?(C(!1),A([]),X||P(b),se(I||b,b)):console.warn("Tab creation returned invalid result:",re)}catch(re){console.error("Failed to create new tab:",re)}}},x=async(t,n,d={})=>{if(!t){await l(n,d);return}switch(t.type){case"nav":await l(t.url,{...d,titleOverride:t.title??d.titleOverride});return;case"search":{const f=t.query||n.trim();if(!f)return;const I=t.engine==="duckduckgo"?"DuckDuckGo":t.engine==="wiki"?"Wikipedia":t.engine==="youtube"?"YouTube":t.engine==="twitter"?"Twitter/X":"Google";await l(we(t.engine,f),{...d,titleOverride:`${I}: ${f}`});return}case"ai":{const f=t.prompt||n.trim();if(!f){r();return}try{const I=W?.url;await w.agent.ask(f,I?{url:I}:void 0)}catch(I){console.error("AI search error:",I)}await l(`ob://agent?q=${encodeURIComponent(f)}`,{...d,titleOverride:`AI: ${f}`});return}case"agent":{const f=t.prompt||n.trim();if(!f){r();return}try{const I=W?.url;await w.agent.ask(f,I?{url:I}:void 0)}catch(I){console.error("Agent error:",I)}await l(`ob://agent?q=${encodeURIComponent(f)}`,{...d,titleOverride:`Agent: ${f}`});return}case"calc":{const f=t.expr||n.trim();if(!f){C(!0);return}const I=t.result??ft(f),b=f?pt(f,I??null):null;if(b){if(P(b),C(!1),A([]),typeof navigator<"u"&&navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(b)}catch{}}else await l(we("google",f),{...d,titleOverride:`Calculate: ${f}`});return}case"command":C(!1),A([]),r();return;default:await l(n,d)}},k=async(t,n={})=>{if(t.interactive!==!1){if(t.action){await x(t.action,t.subtitle||t.url||h,{...n,titleOverride:t.title});return}if(t.url){await l(t.url,{...n,titleOverride:t.title});return}await l(h,{...n,titleOverride:t.title})}},H=async t=>{if(t.key==="Enter"){console.log("[Omnibox] Enter key pressed, url:",h),t.preventDefault();const n=t.shiftKey&&!t.altKey,d=t.altKey;if(G>=0&&v[G]){console.log("[Omnibox] Activating suggestion:",v[G]);const f=v[G];await k(f,{background:n,newWindow:d})}else{if(h.trim().toLowerCase().startsWith("@live")){const I=y[0];if(I?.url){await l(I.url,{background:n,newWindow:d,titleOverride:I.title});return}}const f=Ye(h);await x(f,h,{background:n,newWindow:d})}}else t.key==="ArrowDown"?(t.preventDefault(),q(n=>Math.min(n+1,v.length-1))):t.key==="ArrowUp"?(t.preventDefault(),q(n=>Math.max(n-1,-1))):t.key==="Escape"&&(C(!1),A([]),ee.current?.blur())};return s.useEffect(()=>{!E&&W&&P(W.url||"")},[W,E]),e.jsxs("div",{className:"relative flex-1 max-w-2xl",children:[e.jsx(N.div,{className:"relative",animate:{scale:E?1.02:1},transition:{duration:.2},children:e.jsxs("div",{className:"relative flex items-center",children:[V&&h&&!E&&e.jsxs("div",{className:"absolute left-3 flex items-center gap-2 z-10 pointer-events-none","aria-hidden":"true",children:[V.secure?e.jsx(It,{size:14,className:"text-green-400","aria-label":"Secure connection"}):h.startsWith("http://")?e.jsx(Ut,{size:14,className:"text-amber-400","aria-label":"Insecure connection"}):e.jsx(Et,{size:14,className:"text-gray-400","aria-label":"Web page"}),V.shieldCount!==void 0&&V.shieldCount>0&&e.jsxs("div",{className:"flex items-center gap-1","aria-label":`${V.shieldCount} shields active`,children:[e.jsx(de,{size:14,className:"text-blue-400"}),e.jsx("span",{className:"text-xs text-gray-400",children:V.shieldCount})]})]}),e.jsx("input",{ref:ee,type:"text",value:h,onChange:t=>P(t.target.value),onFocus:()=>C(!0),onBlur:()=>setTimeout(()=>C(!1),200),onKeyDown:H,"aria-label":"Address bar - Search or enter URL","aria-autocomplete":"list","aria-expanded":E&&v.length>0,placeholder:"Search or enter URL",className:`
              w-full h-9 px-4 ${V&&!E?"pl-20":"pl-4"} pr-10
              bg-gray-800/60 backdrop-blur-sm border border-gray-700/50 rounded-xl
              text-sm text-white placeholder-gray-400
              focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50
              hover:bg-gray-800/80 transition-all
            `}),Q&&R>0&&e.jsx(N.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-500 rounded-b-xl",initial:{scaleX:0},animate:{scaleX:R/100},transition:{duration:.1}}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center",children:e.jsx(ge,{size:14,className:"text-gray-500"})})]})}),e.jsx(he,{children:E&&v.length>0&&e.jsx(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-2 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl overflow-hidden z-50",children:v.map((t,n)=>e.jsxs(N.button,{type:"button",disabled:t.interactive===!1,onMouseDown:async d=>{if(d.preventDefault(),t.interactive===!1)return;const f=d.shiftKey&&!d.altKey,I=d.altKey;await k(t,{background:f,newWindow:I})},onMouseEnter:()=>q(n),onKeyDown:d=>{if(d.key==="Enter"||d.key===" "){if(d.preventDefault(),t.interactive===!1)return;const f=d.shiftKey&&!d.altKey,I=d.altKey;k(t,{background:f,newWindow:I})}},role:"option","aria-selected":G===n,"aria-label":`${t.type} suggestion: ${t.title}`,className:`
                  w-full flex items-center gap-3 px-4 py-2.5 text-left
                  transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset
                  ${G===n?"bg-gray-800/60 text-gray-100":"text-gray-300 hover:bg-gray-800/40"}
                  ${t.interactive===!1?"cursor-default opacity-80":""}
                `,children:[e.jsxs("div",{className:"flex-shrink-0 w-5 h-5 flex items-center justify-center",children:[t.icon==="sparkles"&&e.jsx(xe,{size:14,className:"text-emerald-400"}),t.icon==="search"&&e.jsx(ge,{size:14,className:"text-purple-400"}),t.icon==="history"&&e.jsx(qe,{size:13,className:"text-gray-400"}),!t.icon&&t.action?.type==="calc"&&e.jsx(Kt,{size:14,className:"text-amber-400"}),!t.icon&&t.action?.type==="ai"&&e.jsx(xe,{size:14,className:"text-violet-400"}),!t.icon&&t.action?.type==="agent"&&e.jsx(xe,{size:14,className:"text-blue-400"}),!t.icon&&t.action?.type==="search"&&e.jsx(ge,{size:14,className:"text-purple-400"}),!t.icon&&t.type==="tab"&&e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),!t.icon&&t.type==="history"&&e.jsx(qe,{size:13,className:"text-gray-400"}),!t.icon&&!t.action&&t.type==="command"&&e.jsx(ge,{size:14,className:"text-blue-400"}),!t.icon&&!t.action&&t.type==="search"&&e.jsx(ge,{size:14,className:"text-purple-400"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:t.title}),(t.subtitle||t.url)&&e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.subtitle||t.url})]}),t.badge&&e.jsx("div",{className:"ml-auto flex-shrink-0 rounded-full border border-purple-500/40 bg-purple-500/15 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-purple-200",children:t.badge})]},n))})})]})}function ds(){const[r,a]=s.useState(0),[o,p]=s.useState(!1);return ce("tabs:loading-start",()=>{p(!0),a(0)},[]),ce("tabs:loading-progress",c=>{a(c.progress||0)},[]),ce("tabs:loading-complete",()=>{p(!0),a(100),setTimeout(()=>{p(!1),a(0)},300)},[]),s.useEffect(()=>{if(o&&r<90){const c=setInterval(()=>{a(g=>g>=90?(clearInterval(c),g):g+Math.random()*15)},100);return()=>clearInterval(c)}},[o,r]),e.jsx(he,{children:o&&e.jsx(N.div,{initial:{opacity:0,scaleX:0},animate:{opacity:1,scaleX:1},exit:{opacity:0,scaleX:0},className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-purple-500 via-blue-500 to-cyan-500 origin-left",style:{scaleX:r/100}})})}function us({compact:r=!1}){const a=nt(),[o,p]=s.useState([]),[c,g]=s.useState(null),[h,P]=s.useState(!1),[E,C]=s.useState(!1),[v,A]=s.useState(""),[G,q]=s.useState(null),[V,le]=s.useState(""),[R,Z]=s.useState(null),[Q,K]=s.useState(!1),[Y,J]=s.useState(!1),[ee,y]=s.useState(null),_=s.useRef(""),S=async()=>{try{if(!window.ipc||typeof window.ipc.invoke!="function"){setTimeout(S,300);return}const[m,L]=await Promise.all([w.sessions.list(),w.sessions.getActive()]);let $=Array.isArray(m)?m:[];$.length===0&&($=[{id:"default",name:"Default",profileId:"default",createdAt:Date.now(),tabCount:0,color:"#3b82f6"}]);const l=$.map(t=>t.id).sort().join(",");_.current!==l&&(_.current=l,p($));let x=L&&typeof L=="object"?L:null;x||(x=$.find(t=>t.id==="default")??$[0]??null);const k=x?.id||null,H=c?.id||null;k!==H&&g(x)}catch(m){a&&m instanceof Error&&!m.message.includes("not available")&&console.warn("Failed to load sessions:",m)}};s.useEffect(()=>{const m=setTimeout(()=>{S()},500),L=setInterval(S,5e3);return()=>{clearTimeout(m),clearInterval(L)}},[]),s.useEffect(()=>{if(!h)return;let m=!1;return K(!0),w.sessionState.summary().then(L=>{m||Z(L?.summary??null)}).catch(()=>{m||Z(null)}).finally(()=>{m||K(!1)}),()=>{m=!0}},[h]);const B=async()=>{if(v.trim())try{await w.sessions.create({name:v.trim()}),A(""),C(!1),await S()}catch(m){a&&console.error("Failed to create session:",m)}},D=async m=>{try{await w.sessions.setActive({sessionId:m}),await S(),P(!1)}catch(L){a&&console.error("Failed to switch session:",L)}},te=async(m,L)=>{if(L.stopPropagation(),!!confirm(`Delete session "${o.find($=>$.id===m)?.name}"? This will close all tabs in this session.`))try{await w.sessions.delete({sessionId:m}),await S()}catch($){a&&console.error("Failed to delete session:",$)}},ue=m=>{q(m.id),le(m.name)},ae=async m=>{try{await w.sessions.update({sessionId:m,name:V.trim()}),q(null),await S()}catch(L){console.error("Failed to update session:",L)}},W=async()=>{J(!0),y(null);try{const m=await w.sessionState.restore();if(m?.restored){const L=m.tabCount??0;y(`Restored ${L} tab${L===1?"":"s"} from last session.`),await S()}else m?.error?y(`Restore failed: ${m.error}`):y("No session snapshot available to restore.")}catch(m){console.error("Failed to restore session snapshot:",m),y("Failed to restore session snapshot.")}finally{J(!1)}},se=!c||c.id==="default"||c.name.toLowerCase()==="default",U=!r&&!se,me=U?"gap-2 px-3":"gap-1.5 px-2";return e.jsxs("div",{className:"relative",children:[e.jsxs(N.button,{onClick:()=>P(!h),whileHover:{scale:1.05},whileTap:{scale:.95},className:`relative flex items-center ${me} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`,title:"Multi-Session Manager",children:[e.jsx(Yt,{size:16}),U&&e.jsx("span",{className:"text-sm font-medium",children:c?.name||"Default"}),!se&&c?.color&&e.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-700",style:{backgroundColor:c.color}}),U&&o.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",o.length,")"]})]}),e.jsx(he,{children:h&&e.jsxs(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute right-0 mt-2 w-80 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-lg shadow-xl overflow-hidden z-40",children:[e.jsxs("div",{className:"p-3 border-b border-gray-800/50 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Browser Sessions"}),e.jsx("button",{onClick:()=>{C(!0),A("")},className:"p-1.5 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-blue-400 transition-colors",title:"New Session",children:e.jsx(Me,{size:16})})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[E&&e.jsxs("div",{className:"p-3 border-b border-gray-800/50",children:[e.jsx("input",{type:"text",value:v,onChange:m=>A(m.target.value),onKeyDown:m=>{m.key==="Enter"&&B(),m.key==="Escape"&&(C(!1),A(""))},placeholder:"Session name...",autoFocus:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:B,className:"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white",children:"Create"}),e.jsx("button",{onClick:()=>{C(!1),A("")},className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm text-gray-300",children:"Cancel"})]})]}),o.map(m=>{const L=c?.id===m.id,$=G===m.id;return e.jsx("div",{onClick:()=>!L&&D(m.id),className:`
                      p-3 border-b border-gray-800/50 cursor-pointer transition-colors
                      ${L?"bg-blue-600/20 border-blue-500/30":"hover:bg-gray-800/50"}
                    `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[m.color&&e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-700 flex-shrink-0",style:{backgroundColor:m.color}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[$?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:V,onChange:l=>le(l.target.value),onKeyDown:l=>{l.key==="Enter"&&ae(m.id),l.key==="Escape"&&(q(null),le(""))},onClick:l=>l.stopPropagation(),autoFocus:!0,className:"flex-1 px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:l=>{l.stopPropagation(),ae(m.id)},className:"p-1 text-green-400 hover:text-green-300",children:e.jsx(ct,{size:14})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-200 truncate",children:m.name}),L&&e.jsx("span",{className:"text-xs text-blue-400 font-medium",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[m.tabCount," tab",m.tabCount!==1?"s":""]}),m.id==="default"&&e.jsx("span",{className:"text-xs text-gray-500",children:"• Default"})]})]}),!$&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),ue(m)},className:"p-1.5 rounded-lg hover:bg-gray-700 text-gray-400 hover:text-blue-400 transition-colors",title:"Rename",children:e.jsx(Vt,{size:14})}),m.id!=="default"&&e.jsx("button",{onClick:l=>te(m.id,l),className:"p-1.5 rounded-lg hover:bg-gray-700 text-gray-400 hover:text-red-400 transition-colors",title:"Delete",children:e.jsx(Tt,{size:14})})]})]})},m.id)})]}),e.jsxs("div",{className:"p-3 border-t border-gray-800/50 bg-gray-900/50 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Crash-safe snapshot"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[Q&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-400",children:[e.jsx(Ce,{className:"h-3.5 w-3.5 animate-spin"}),"Checking…"]}),!Q&&R&&e.jsxs("span",{children:[R.tabCount," tab",R.tabCount===1?"":"s"," saved"," ",Lt(R.updatedAt,{addSuffix:!0})]}),!Q&&!R&&e.jsx("span",{children:"No snapshot captured yet."})]})]}),e.jsxs("button",{onClick:W,disabled:Y||Q||!R,className:`inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-xs font-medium transition-colors ${Y||Q||!R?"border-gray-700 text-gray-500 cursor-not-allowed":"border-blue-500/40 bg-blue-500/10 text-blue-200 hover:border-blue-500/60"}`,children:[Y?e.jsx(Ce,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(bt,{className:"h-3.5 w-3.5"}),"Restore"]})]}),ee&&e.jsx("p",{className:"text-xs text-blue-300",children:ee}),e.jsx("p",{className:"text-xs text-gray-500",children:"Each session keeps cookies, storage, and login state isolated. Autosave runs every few seconds."})]})]})})]})}const je=[{key:"allowDownloads",label:"Downloads",icon:Re,description:"File downloads to local storage"},{key:"allowPrivateWindows",label:"Private windows",icon:Rt,description:"Open dedicated private windows"},{key:"allowGhostTabs",label:"Ghost tabs",icon:zt,description:"Create ephemeral ghost tabs"},{key:"allowScreenshots",label:"Screenshots",icon:dt,description:"Capture browser screenshots"},{key:"allowClipping",label:"Clip text",icon:Qt,description:"Use web clipper to capture highlights"}],$e={work:Ht,personal:xe,default:ut};function tt(r){return r.kind&&$e[r.kind]?$e[r.kind]:$e.default}function ms(r){if(!r)return"Unknown policy";const a=je.filter(({key:o})=>!r[o]);return a.length===0?"All capabilities enabled":a.length===je.length?"Strict mode: most features disabled":`Restricted: ${a.map(o=>o.label.toLowerCase()).join(", ")}`}function ps(r){return[...r].sort((a,o)=>{const p=+!!a.system,c=+!!o.system;if(p!==c)return c-p;const g=P=>{switch(P){case"work":return 0;case"personal":return 1;case"default":return 2;default:return 3}},h=g(a.kind)-g(o.kind);return h!==0?h:a.name.localeCompare(o.name)})}function st(r){if(r.color)return r.color;switch(r.kind){case"work":return"#4f46e5";case"personal":return"#f97316";default:return"#3b82f6"}}function fs({compact:r=!1}){const{profiles:a,activeProfileId:o,policies:p,loading:c,setActiveProfile:g,lastPolicyBlock:h,markPolicyMessageRead:P}=_e(y=>({profiles:y.profiles,activeProfileId:y.activeProfileId,policies:y.policies,loading:y.loading,setActiveProfile:y.setActiveProfile,lastPolicyBlock:y.lastPolicyBlock,markPolicyMessageRead:y.markPolicyMessageRead})),[E,C]=s.useState(!1),[v,A]=s.useState(!1),[G,q]=s.useState(""),[V,le]=s.useState(null);s.useEffect(()=>{$t()},[]),s.useEffect(()=>{!E&&v&&(A(!1),q(""))},[E,v]);const R=s.useMemo(()=>a.find(y=>y.id===o)??a[0],[a,o]),Z=s.useMemo(()=>ps(a),[a]),Q=async y=>{if(y===o){C(!1);return}try{le(y),await g(y),C(!1)}catch(_){console.error("Failed to switch profile",_)}finally{le(null)}},K=async()=>{const y=G.trim();if(y)try{await w.profiles.create({name:y}),await _e.getState().loadProfiles(!0),A(!1),q("")}catch(_){console.error("Failed to create profile",_)}},Y=!R||R.id==="default"||R.name.toLowerCase()==="default",J=!r&&!Y,ee=J?"gap-2 px-3":"gap-1.5 px-2";return e.jsxs("div",{className:"relative",children:[e.jsxs(N.button,{onClick:()=>C(y=>!y),whileHover:{scale:1.03},whileTap:{scale:.97},className:`flex items-center ${ee} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`,title:R?`${R.name} profile`:"Profiles",children:[(()=>{const y=R?tt(R):ut;return e.jsx(y,{size:16})})(),J&&e.jsx("span",{className:"text-sm font-medium",children:R?R.name:"Profiles"}),!Y&&R&&e.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full border border-gray-900/40",style:{backgroundColor:st(R)}}),c&&e.jsx(Ce,{size:14,className:"animate-spin text-gray-400"})]}),e.jsx(he,{children:E&&e.jsxs(N.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"absolute right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-800/60 rounded-xl shadow-2xl z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-gray-800/60 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Profiles"}),e.jsx("button",{onClick:()=>A(y=>!y),className:"p-1.5 rounded-md hover:bg-gray-800/60 text-gray-400 hover:text-gray-100 transition-colors",title:"Create new profile",children:e.jsx(Me,{size:14})})]}),v&&e.jsxs("div",{className:"px-3 pb-3 border-b border-gray-800/60 space-y-2",children:[e.jsx("input",{value:G,onChange:y=>q(y.target.value),placeholder:"Profile name",className:"w-full px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onKeyDown:y=>{y.key==="Enter"?K():y.key==="Escape"&&(A(!1),q(""))}}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{A(!1),q("")},className:"text-xs text-gray-400 hover:text-gray-200",children:"Cancel"}),e.jsx("button",{onClick:K,className:"text-xs font-medium px-3 py-1.5 rounded-lg bg-blue-600 hover:bg-blue-500 text-white",children:"Create"})]})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto divide-y divide-gray-800/50",children:[Z.map(y=>{const _=tt(y),S=y.id===o,B=p[y.id],D=B?je.filter(({key:te})=>!B[te]):[];return e.jsxs("button",{onClick:()=>Q(y.id),className:`w-full text-left px-3 py-2 transition-colors ${S?"bg-blue-600/15 border-l-2 border-blue-500/60":"hover:bg-gray-800/60 border-l-2 border-transparent"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-200",children:[e.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full",style:{backgroundColor:st(y)}}),e.jsx(_,{size:16,className:"text-gray-300"}),e.jsx("span",{className:"text-sm font-medium flex-1 truncate",children:y.name}),S&&e.jsx(ct,{size:14,className:"text-blue-400"}),V===y.id&&e.jsx(Ce,{size:14,className:"animate-spin text-gray-400"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500 line-clamp-2",children:y.description||ms(B)}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[je.map(({key:te,label:ue,icon:ae})=>{const W=B?B[te]:!0;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[11px] border ${W?"border-emerald-500/40 text-emerald-200 bg-emerald-500/10":"border-rose-500/40 text-rose-200 bg-rose-500/10 line-through decoration-rose-300/70"}`,title:je.find(se=>se.key===te)?.description,children:[e.jsx(ae,{size:11}),ue]},`${y.id}-${te}`)}),D.length===0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[11px] border border-emerald-400/40 text-emerald-200 bg-emerald-500/10",children:[e.jsx(de,{size:11}),"Compliant"]})]})]},y.id)}),Z.length===0&&e.jsx("div",{className:"px-3 py-4 text-xs text-gray-500 text-center",children:"No profiles yet. Create one to get started."})]}),h&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-800/60 bg-amber-500/10 text-xs text-amber-200 flex items-start gap-2",children:[e.jsx(de,{size:12,className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-amber-100",children:"Action blocked by policy"}),e.jsxs("div",{className:"mt-1 text-amber-200/80",children:[h.action.replace("-"," ")," is disabled for this profile."]}),e.jsx("button",{onClick:P,className:"mt-2 text-[11px] text-amber-200 hover:text-amber-100 underline",children:"Dismiss"})]})]})]})})]})}const hs=[{key:"media",label:"Camera & microphone",description:"Allow access to audio / video input devices."},{key:"display-capture",label:"Screen capture",description:"Enable screen or window sharing requests."},{key:"notifications",label:"Desktop notifications",description:"Permit this container to show system notifications."},{key:"fullscreen",label:"Fullscreen & PIP",description:"Allow fullscreen transitions and picture-in-picture."}];function ys({compact:r=!1}){const{containers:a,activeContainerId:o,setContainers:p,setActiveContainer:c}=it(),{activeId:g,tabs:h}=ye(l=>({activeId:l.activeId,tabs:l.tabs})),[P,E]=s.useState(!1),[C,v]=s.useState(!1),[A,G]=s.useState(""),[q,V]=s.useState("#22c55e"),[le,R]=s.useState({}),[Z,Q]=s.useState({}),K=s.useCallback(async l=>{try{const x=await w.containers.getPermissions(l);return Array.isArray(x?.permissions)?x.permissions:[]}catch(x){return console.error("Failed to fetch container permissions:",x),[]}},[]),Y=s.useCallback(async l=>{const x=await K(l);R(k=>({...k,[l]:x}))},[K]),J=s.useCallback(async l=>{try{const x=await w.containers.getSitePermissions(l);Array.isArray(x)&&Q(k=>({...k,[l]:x}))}catch(x){console.error("Failed to load site permissions:",x)}},[]),ee=s.useCallback(async()=>{try{const[l,x]=await Promise.all([w.containers.list(),w.containers.getActive()]);if(Array.isArray(l)){const k=l;p(k);const H=await Promise.all(k.map(n=>K(n.id))),t={};k.forEach((n,d)=>{t[n.id]=H[d]??[]}),R(t)}x&&(c(x),await Y(x.id),await J(x.id))}catch(l){console.error("Failed to load containers:",l)}},[K,Y,J,c,p]);s.useEffect(()=>{ee()},[ee]),s.useEffect(()=>{const l=lt.on("containers:sitePermissions",x=>{x?.containerId&&Q(k=>({...k,[x.containerId]:[...k[x.containerId]?.filter(H=>H.permission!==x.permission)??[],{permission:x.permission,origins:x.origins}]}))});return()=>{l()}},[]);const y=async l=>{try{const x=await w.containers.setActive(l.id);c(x||l),await Y(l.id),await J(l.id),E(!1)}catch(x){console.error("Failed to set active container:",x)}},_=async()=>{if(A.trim())try{const l=await w.containers.create({name:A.trim(),color:q});l&&(await ee(),await Y(l.id),await J(l.id)),G(""),v(!1),E(!1)}catch(l){console.error("Failed to create container:",l)}},S=a.find(l=>l.id===o),B=s.useMemo(()=>h.find(l=>l.id===g),[h,g]),D=s.useMemo(()=>{if(!B?.url)return null;try{const l=new URL(B.url);return l.protocol.startsWith("http")?`${l.protocol}//${l.host}`:null}catch{return null}},[B?.url]),te=s.useMemo(()=>D?D.replace(/^https?:\/\//,""):null,[D]),ue=S?le[S.id]??[]:[],ae=S?Z[S.id]??[]:[],W=l=>ae.find(x=>x.permission===l)?.origins??[],se=async l=>{if(!S)return;const x=ue.includes(l);try{const k=await w.containers.setPermission(S.id,l,!x);R(H=>({...H,[S.id]:Array.isArray(k?.permissions)?k.permissions:[]})),await J(S.id)}catch(k){console.error("Failed to update container permission:",k)}},U=async(l,x)=>{if(S)try{const k=await w.containers.revokeSitePermission(S.id,l,x);Array.isArray(k)&&Q(H=>({...H,[S.id]:k}))}catch(k){console.error("Failed to revoke site permission:",k)}},me=async l=>{if(!(!S||!D))try{const x=await w.containers.allowSitePermission(S.id,l,D);Array.isArray(x)&&Q(k=>({...k,[S.id]:x}))}catch(x){console.error("Failed to allow site permission:",x)}},m=!S||S.id==="default"||S.name.toLowerCase()==="default",L=!r&&!m,$=L?"gap-2 px-3":"gap-1.5 px-2";return e.jsxs("div",{className:"relative",children:[e.jsxs(N.button,{onClick:()=>E(!P),whileHover:{scale:1.05},whileTap:{scale:.95},className:`relative flex items-center ${$} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`,title:"Container (isolated storage)",children:[e.jsx(Mt,{size:16}),L&&e.jsx("span",{className:"text-sm font-medium",children:S?.name||"Default"}),!m&&S?.color&&e.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-700",style:{backgroundColor:S.color}})]}),e.jsx(he,{children:P&&e.jsxs(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-lg shadow-xl overflow-hidden z-40",children:[e.jsxs("div",{className:"p-3 border-b border-gray-800/50 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Containers"}),e.jsx("button",{onClick:()=>{v(!0),G(""),V("#22c55e")},className:"p-1.5 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-blue-400 transition-colors",children:e.jsx(Me,{size:16})})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[C&&e.jsxs("div",{className:"p-3 border-b border-gray-800/50",children:[e.jsx("input",{type:"text",value:A,onChange:l=>G(l.target.value),placeholder:"Container name",autoFocus:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Color"}),e.jsx("input",{type:"color",value:q,onChange:l=>V(l.target.value),className:"h-7 w-16 bg-transparent border border-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:_,className:"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white",children:"Create"}),e.jsx("button",{onClick:()=>{v(!1),G("")},className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm text-gray-300",children:"Cancel"})]})]}),a.map(l=>{const x=l.id===o;return e.jsxs("button",{onClick:()=>y(l),className:`w-full flex items-center gap-3 px-3 py-2 text-left border-b border-gray-800/50 transition-colors ${x?"bg-blue-600/20 border-blue-500/30":"hover:bg-gray-800/50"}`,children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-700",style:{backgroundColor:l.color}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-200 truncate",children:l.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:l.scope?`${l.scope.charAt(0).toUpperCase()}${l.scope.slice(1)} scope`:"Session scope"})]}),x&&e.jsx("span",{className:"text-xs text-blue-400",children:"Active"})]},l.id)}),a.length===0&&!C&&e.jsx("div",{className:"p-3 text-xs text-gray-500",children:"No containers yet"})]}),S&&e.jsxs("div",{className:"border-t border-gray-800/50 bg-gray-900/60 p-3",children:[e.jsxs("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:["Permissions for ",S.name]}),e.jsx("div",{className:"mt-3 space-y-3",children:hs.map(l=>{const x=ue.includes(l.key),k=W(l.key),H=D?k.includes(D):!1,t=!D||!H&&!x,n=te||D||"this site";return e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-transparent px-2 py-2 hover:border-gray-700/60 hover:bg-gray-800/40 transition-colors cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 rounded border-gray-600 bg-gray-800 text-blue-500 focus:ring-blue-500",checked:x,onChange:()=>se(l.key)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-200",children:l.label}),e.jsx("p",{className:"text-xs text-gray-500 leading-snug",children:l.description}),D&&e.jsx("p",{className:`text-[11px] ${H?"text-emerald-400":"text-gray-500"}`,children:H?`Allowed for ${n}`:`Not allowed for ${n}`}),!x&&e.jsx("p",{className:"text-[11px] text-amber-400",children:"Container-level access disabled"})]}),e.jsx("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopPropagation(),D&&(H?U(l.key,D):me(l.key))},disabled:t,className:`rounded-full border px-2 py-1 text-[11px] font-medium transition-colors ${t?"cursor-not-allowed border-gray-800 bg-gray-900/60 text-gray-500":H?"border-amber-400/60 bg-amber-500/10 text-amber-200 hover:bg-amber-500/20":"border-blue-400/60 bg-blue-500/10 text-blue-100 hover:bg-blue-500/20"}`,children:D?H?"Revoke site":"Allow site":"Open a site"})]}),k.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:"Allowed sites"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(d=>{const f=D&&d===D;return e.jsxs("span",{className:`group inline-flex items-center gap-2 rounded-full border px-2 py-0.5 text-[11px] transition-colors ${f?"border-blue-400 bg-blue-500/20 text-blue-100":"border-gray-700 bg-gray-800/60 text-gray-300"}`,title:d,children:[e.jsx("span",{className:"max-w-[140px] truncate",children:d.replace(/^https?:\/\//,"")}),e.jsx("button",{type:"button",onClick:I=>{I.preventDefault(),I.stopPropagation(),U(l.key,d)},className:`rounded-full bg-transparent p-0.5 transition-colors ${f?"text-blue-200 hover:bg-blue-500/20":"text-gray-500 hover:bg-gray-700 hover:text-gray-200"}`,"aria-label":`Remove ${d} from ${l.label}`,children:"×"})]},`${l.key}-${d}`)})})]})]})]},l.key)})})]}),e.jsx("div",{className:"p-3 border-t border-gray-800/50 bg-gray-900/50",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Containers isolate cookies, storage, and login state per tab."})})]})})]})}const ht="omnibrowser:theme-preference",Ae=typeof window<"u",Pe=()=>!Ae||typeof window.matchMedia!="function"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",Fe=r=>{if(typeof document>"u")return;const a=r==="system"?Pe():r;document.documentElement.dataset.theme=a,document.documentElement.setAttribute("data-theme-resolved",a)},Se=(()=>{if(!Ae)return"system";const r=window.localStorage.getItem(ht);return r==="light"||r==="dark"||r==="system"?r:"system"})(),xs=Se==="system"?Pe():Se;typeof document<"u"&&Fe(Se);const ke=xt((r,a)=>({preference:Se,resolved:xs,setPreference:o=>{Ae&&window.localStorage.setItem(ht,o),Fe(o);const p=o==="system"?Pe():o;r({preference:o,resolved:p})},cyclePreference:()=>{const o=["system","light","dark"],p=a().preference,c=o[(o.indexOf(p)+1)%o.length];a().setPreference(c)}}));if(Ae&&typeof window.matchMedia=="function"){const r=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{const{preference:o}=ke.getState();if(o==="system"){Fe("system");const p=Pe();ke.setState({resolved:p})}};try{r.addEventListener("change",a)}catch{r.addListener(a)}}const bs=[{id:"system",label:"Auto",icon:Ft},{id:"light",label:"Light",icon:Dt},{id:"dark",label:"Dark",icon:Xt}];function rt(){const r=ke(c=>c.preference),a=ke(c=>c.resolved),o=ke(c=>c.setPreference),p=ke(c=>c.cyclePreference);return e.jsx(as,{id:"theme-switcher",children:e.jsx("div",{className:"no-drag button-surface px-2 py-1.5 rounded-lg flex items-center gap-1 text-[11px]",role:"radiogroup","aria-label":"Theme preference",title:`Theme: ${r==="system"?`Auto (${a})`:r}`,onDoubleClick:p,children:bs.map(c=>{const g=c.icon,h=r===c.id||r==="system"&&c.id===a;return e.jsxs(N.button,{type:"button",onClick:()=>o(c.id),whileHover:{scale:1.05},whileTap:{scale:.95},className:`relative flex items-center gap-1 px-2.5 py-1 rounded-md transition-all duration-150 text-xs font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:ring-offset-transparent ${h?"theme-pill-active":"theme-pill"}`,role:"radio","aria-checked":h,children:[e.jsx(g,{size:13}),e.jsx("span",{className:"hidden sm:inline",children:c.label}),h&&e.jsx(N.span,{layoutId:"theme-pill-indicator",className:"absolute inset-0 -z-10 rounded-md bg-blue-500/15 border border-blue-500/40",transition:{type:"spring",stiffness:400,damping:40}})]},c.id)})})})}const gs=15e3;function vs(r){switch(r){case"high":return"bg-red-500/80 text-white";case"moderate":return"bg-amber-500/80 text-white";default:return"bg-emerald-500/80 text-white"}}function ws(r){switch(r){case"high":return"High risk";case"moderate":return"Watch";default:return"Clean"}}function ks(){const r=ye(C=>C.activeId),[a,o]=s.useState(null),[p,c]=s.useState(!1),g=s.useCallback(async()=>{if(!r){o(null);return}c(!0);try{const C=await w.privacy.sentinel.audit(r);o(C??null)}catch(C){console.warn("[PrivacySentinel] audit failed",C)}finally{c(!1)}},[r]);s.useEffect(()=>{g()},[g]),s.useEffect(()=>{if(!r)return;const C=window.setInterval(g,gs);return()=>window.clearInterval(C)},[r,g]);const h=s.useMemo(()=>p?"Scanning…":a?ws(a.grade):"No data",[a,p]),P=s.useMemo(()=>{if(!a)return"Privacy Sentinel has no data for this tab yet.";const C=[a.message];return a.trackers.length>0&&C.push(`Trackers: ${a.trackers.slice(0,3).map(v=>v.host).join(", ")}`),a.thirdPartyHosts.length>0&&C.push(`3rd-party: ${a.thirdPartyHosts.slice(0,3).map(v=>v.host).join(", ")}`),C.push(...a.suggestions),C.join(`
`)},[a]),E=a?vs(a.grade):"bg-slate-500/70 text-white";return e.jsxs("button",{type:"button",className:`no-drag flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium transition-colors ${E}`,title:P,onClick:g,children:[e.jsx("span",{className:"inline-flex h-2 w-2 items-center justify-center",children:e.jsx("span",{className:"h-2 w-2 rounded-full bg-current"})}),e.jsx("span",{children:h})]})}function js(){const{activeId:r}=ye(),[a,o]=s.useState(!1),[p,c]=s.useState(null),[g,h]=s.useState({ads:!0,cookies:"3p",httpsOnly:!1,fingerprinting:!0,scripts:"all",webrtc:!0}),[P,E]=s.useState(0);ce("shields:counters",v=>{(!v.tabId||v.tabId===""||v.tabId===r)&&(c(v),E((v.ads||0)+(v.trackers||0)+(v.cookiesBlocked||0)))},[r]),s.useEffect(()=>{},[r]);const C=async(v,A)=>{const G={...g,[v]:A};h(G)};return e.jsxs("div",{className:"relative",children:[e.jsxs(N.button,{"data-shields-button":!0,onClick:()=>o(!a),whileHover:{scale:1.05},whileTap:{scale:.95},className:`
          relative flex items-center gap-2 px-3 py-1.5 rounded-lg
          bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50
          text-gray-300 hover:text-gray-100 transition-colors
        `,children:[e.jsx(de,{size:16,className:P>0?"text-blue-400":"text-gray-500"}),P>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-500/20 text-blue-400 text-xs font-medium rounded",children:P}),e.jsx(De,{size:14,className:`transition-transform ${a?"rotate-180":""}`})]}),e.jsx(he,{children:a&&e.jsxs(e.Fragment,{children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40",onClick:()=>o(!1)}),e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full right-0 mt-2 w-80 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl z-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Shields"}),p&&e.jsxs("div",{className:"text-xs text-gray-400",children:[p.ads," ads · ",p.trackers," trackers · ",p.httpsUpgrades," upgraded"]})]}),p&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[e.jsxs("div",{className:"bg-gray-800/40 rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:p.ads}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ads Blocked"})]}),e.jsxs("div",{className:"bg-gray-800/40 rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-orange-400",children:p.trackers}),e.jsx("div",{className:"text-xs text-gray-500",children:"Trackers"})]}),e.jsxs("div",{className:"bg-gray-800/40 rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:p.httpsUpgrades}),e.jsx("div",{className:"text-xs text-gray-500",children:"HTTPS"})]})]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[[{key:"ads",label:"Block ads & trackers",icon:de},{key:"fingerprinting",label:"Anti-fingerprinting",icon:de},{key:"webrtc",label:"Block WebRTC leaks",icon:de}].map(({key:v,label:A})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:A}),e.jsx("button",{onClick:()=>C(v,!g[v]),className:`
                        relative w-11 h-6 rounded-full transition-colors
                        ${g[v]?"bg-blue-600":"bg-gray-700"}
                      `,children:e.jsx(N.div,{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm",animate:{x:g[v]?20:0},transition:{type:"spring",stiffness:500,damping:30}})})]},v)),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"3rd-party cookies"}),e.jsxs("select",{value:g.cookies,onChange:v=>C("cookies",v.target.value),className:"bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs text-gray-300",children:[e.jsx("option",{value:"all",children:"Allow"}),e.jsx("option",{value:"3p",children:"Block 3P"}),e.jsx("option",{value:"none",children:"Block All"})]})]})]})]})]})})]})}function Ns(){const[r,a]=s.useState(!1),[o,p]=s.useState({doh:{enabled:!1,provider:"cloudflare"}});ce("net:status",h=>{p(h)},[]),s.useEffect(()=>{const h=async()=>{if(!window.ipc||typeof window.ipc.invoke!="function"){setTimeout(h,500);return}try{const P=await w.dns.status();p(E=>({...E,doh:P}))}catch{}};setTimeout(h,300)},[]);const c=async()=>{try{await w.tor.newIdentity()}catch(h){console.error("Failed to get new Tor identity:",h)}},g=o.tor?.circuitEstablished||o.vpn?.connected||o.proxy?.enabled;return e.jsxs("div",{className:"relative",children:[e.jsxs(N.button,{"data-network-button":!0,onClick:()=>a(!r),whileHover:{scale:1.05},whileTap:{scale:.95},className:`
          relative flex items-center gap-2 px-3 py-1.5 rounded-lg
          bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50
          text-gray-300 hover:text-gray-100 transition-colors
        `,children:[e.jsx(ve,{size:16,className:g?"text-green-400":"text-gray-500"}),g&&e.jsx(N.div,{className:"w-2 h-2 bg-green-400 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0}}),e.jsx(De,{size:14,className:`transition-transform ${r?"rotate-180":""}`})]}),e.jsx(he,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40",onClick:()=>a(!1)}),e.jsx(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl z-50",children:e.jsxs("div",{className:"p-4 space-y-4",children:[o.tor&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:16,className:"text-purple-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Tor"})]}),o.tor.circuitEstablished?e.jsx(Ne,{size:16,className:"text-green-400"}):e.jsx(Ee,{size:16,className:"text-red-400"})]}),o.tor.enabled&&o.tor.circuitEstablished&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:["Identity: ",o.tor.identity.slice(0,8),"..."]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center justify-center gap-2 px-3 py-1.5 bg-purple-600/20 hover:bg-purple-600/30 border border-purple-500/30 rounded text-xs text-purple-300 transition-colors",children:[e.jsx(ze,{size:14}),"New Identity"]})]})]}),o.vpn&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:16,className:"text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"VPN"})]}),o.vpn.connected?e.jsx(Ne,{size:16,className:"text-green-400"}):e.jsx(Ee,{size:16,className:"text-gray-500"})]}),o.vpn.provider&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Provider: ",o.vpn.provider]})]}),o.proxy&&o.proxy.enabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:16,className:"text-cyan-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Proxy"})]}),e.jsx(Ne,{size:16,className:"text-green-400"})]}),o.proxy.host&&e.jsxs("div",{className:"text-xs text-gray-400",children:[o.proxy.type.toUpperCase(),": ",o.proxy.host]})]}),o.doh&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{size:16,className:"text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"DNS-over-HTTPS"})]}),o.doh.enabled?e.jsx(Ne,{size:16,className:"text-green-400"}):e.jsx(Ee,{size:16,className:"text-gray-500"})]}),o.doh.enabled&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Provider: ",o.doh.provider]})]})]})})]})})]})}function ur({onAgentToggle:r,onCommandPalette:a,onClipperToggle:o,onReaderToggle:p}){const{activeId:c}=ye(),g=ot(i=>i.mode),h=at(),P=Ge(i=>i.toggle),E=Ge(i=>i.open),C=gt(i=>i.reset),v=vt(i=>i.open),A=be(i=>i.tor),G=be(i=>i.vpn),q=be(i=>i.startTor),V=be(i=>i.stopTor),le=be(i=>i.newTorIdentity),R=be(i=>i.checkVpn),[Z,Q]=s.useState(!1),[K,Y]=s.useState(!1),[J,ee]=s.useState(!1),[y,_]=s.useState(0),[S,B]=s.useState(!1),[D,te]=s.useState(null),[ue,ae]=s.useState({browse:!1,ai:!1,tools:!1,security:!1}),W=s.useRef({browse:null,ai:null,tools:null,security:null}),[se,U]=s.useState(!1),me=s.useRef(null),m=s.useCallback(i=>{const u=W.current[i];u&&(clearTimeout(u),W.current[i]=null)},[]),L=s.useCallback(i=>{m(i),ae({browse:!1,ai:!1,tools:!1,security:!1}),ae(u=>({...u,[i]:!0})),W.current[i]=setTimeout(()=>{ae(u=>({...u,[i]:!1})),W.current[i]=null},220)},[m]),$=s.useCallback(()=>{te(null),ae({browse:!1,ai:!1,tools:!1,security:!1}),Object.keys(W.current).forEach(i=>m(i))},[m]),l=s.useCallback(i=>{te(u=>u===i?(m(i),ae({browse:!1,ai:!1,tools:!1,security:!1}),null):(L(i),i))},[m,L]),x=s.useRef({activeId:c??null,canGoBack:!1,canGoForward:!1}),k=s.useRef(null);s.useEffect(()=>{x.current={activeId:c??null,canGoBack:Z,canGoForward:K}},[c,Z,K]),s.useEffect(()=>{const i=u=>{(u.metaKey||u.ctrlKey)&&u.shiftKey&&u.key.toLowerCase()==="g"&&(u.preventDefault(),P())};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[P]),s.useEffect(()=>()=>{k.current&&(clearTimeout(k.current),k.current=null),Object.keys(W.current).forEach(i=>m(i))},[m]),s.useEffect(()=>{if(!se)return;const i={capture:!0},u=M=>{me.current&&(me.current.contains(M.target)||U(!1))};return document.addEventListener("mousedown",u,i),()=>document.removeEventListener("mousedown",u,i)},[se]),s.useEffect(()=>{if(!D)return;const i=M=>{M.key==="Escape"&&$()},u={capture:!0};return window.addEventListener("keydown",i,u),()=>window.removeEventListener("keydown",i,u)},[D,$]),ce("downloads:started",()=>{_(i=>i+1)},[]),ce("downloads:done",()=>{_(i=>Math.max(0,i-1))},[]),ce("downloads:progress",()=>{},[]),ce("agent:plan",()=>{B(!0)},[]),s.useEffect(()=>{const i=async()=>{if(!window.ipc||typeof window.ipc.invoke!="function"){setTimeout(i,500);return}try{const u=await w.downloads.list(),M=Array.isArray(u)?u.filter(fe=>["downloading","verifying","paused"].includes(fe.status)).length:0;_(M)}catch{}};setTimeout(i,300)},[]);const H=s.useCallback(async()=>{const{activeId:i}=x.current;if(i)try{await w.tabs.goBack(i)}catch(u){console.error("Failed to go back:",u)}},[]),t=s.useCallback(async()=>{const{activeId:i}=x.current;if(i)try{await w.tabs.goForward(i)}catch(u){console.error("Failed to go forward:",u)}},[]),n=s.useCallback(async()=>{const{activeId:i}=x.current;if(i){k.current&&(clearTimeout(k.current),k.current=null),ee(!0);try{await w.tabs.reload(i),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{ee(!1),k.current=null},1e3)}catch(u){console.error("Failed to refresh:",u),ee(!1)}}},[]);s.useEffect(()=>{const i=u=>{const{activeId:M,canGoBack:fe,canGoForward:oe}=x.current,ie=navigator.platform.toUpperCase().indexOf("MAC")>=0?u.metaKey:u.ctrlKey,Oe=u.altKey,Ie=u.target;if(!(Ie.tagName==="INPUT"||Ie.tagName==="TEXTAREA"||Ie.isContentEditable)){if((ie||Oe)&&u.key==="ArrowLeft"&&!u.shiftKey){fe&&M&&(u.preventDefault(),H());return}if((ie||Oe)&&u.key==="ArrowRight"&&!u.shiftKey){oe&&M&&(u.preventDefault(),t());return}if(ie&&u.key.toLowerCase()==="r"&&!u.shiftKey){M&&(u.preventDefault(),n());return}if(u.key==="F5"&&M&&(u.preventDefault(),n()),ie&&(u.key==="+"||u.key==="=")&&M){u.preventDefault(),w.tabs.zoomIn(M).catch(console.error);return}if(ie&&u.key==="-"&&M){u.preventDefault(),w.tabs.zoomOut(M).catch(console.error);return}if(ie&&u.key==="0"&&M){u.preventDefault(),w.tabs.zoomReset(M).catch(console.error);return}if(u.key==="F12"||ie&&u.shiftKey&&u.key.toLowerCase()==="i"){M&&(u.preventDefault(),w.tabs.devtools(M).catch(console.error));return}}};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[H,t,n]),ce("tabs:navigation-state",i=>{i.tabId===c&&(Q(i.canGoBack),Y(i.canGoForward))},[c]),s.useEffect(()=>{if(!c){Q(!1),Y(!1);return}(async()=>{try{await w.tabs.list()}catch(u){console.error("Failed to update navigation state:",u)}})()},[c]);const d=async()=>{if(c)try{const i=await w.tabs.screenshot(c);i?.success?console.log("Screenshot saved:",i.path):console.error("Screenshot failed:",i?.error)}catch(i){console.error("Failed to capture screenshot:",i)}},f=async()=>{if(c)try{const i=await w.tabs.pip(c,!0);i?.success||console.warn("PIP request failed:",i?.error||"No video element found")}catch(i){console.error("Failed to enter PIP:",i)}},I=s.useCallback(async()=>{if(c)try{await w.tabs.find(c)}catch(i){console.error("Failed to open find:",i)}},[c]),b=s.useCallback(async()=>{if(c)try{await w.tabs.devtools(c)}catch(i){console.error("Failed to toggle DevTools:",i)}},[c]),X=s.useCallback(i=>{if(i.type!=="item"||i.disabled)return;const u=i.onSelect();u&&typeof u.then=="function"?u.catch(M=>{console.error(`Failed to run menu action "${i.key}"`,M)}).finally(()=>$()):$()},[$]),T=typeof navigator<"u"&&navigator.platform?.toUpperCase().includes("MAC"),re=s.useMemo(()=>{const i={"knowledge-graph":{type:"item",key:"knowledge-graph",icon:Le,label:"Research Graph",onSelect:()=>h("/")},"history-graph":{type:"item",key:"history-graph",icon:Te,label:"History Graph",onSelect:()=>h("/history")},workspaces:{type:"item",key:"workspaces",icon:He,label:"Workspace Library",onSelect:()=>h("/workspace")},playbooks:{type:"item",key:"playbooks",icon:We,label:"Auto-Research Playbooks",onSelect:()=>h("/playbooks")},"automation-runs":{type:"item",key:"automation-runs",icon:Ot,label:"Automation Runs",onSelect:()=>h("/runs")},consent:{type:"item",key:"consent-ledger",icon:de,label:"Consent Ledger",onSelect:()=>void v()},"tab-graph":{type:"item",key:"tab-graph",icon:Le,label:"Tab DNA Overlay",onSelect:()=>void E()}},u={Research:{label:"Research Focus",description:"Suggested graph + consent tooling",keys:["knowledge-graph","tab-graph","consent"]},Trade:{label:"Trade Focus",description:"Stay ahead of market changes",keys:["history-graph","playbooks","automation-runs"]},Games:{label:"Gaming Focus",description:"Keep streams and overlays lean",keys:["tab-graph","history-graph"]},Browse:{label:"Everyday Focus",description:"Quick jump to your spaces",keys:["workspaces","history-graph","knowledge-graph"]}},M=u[g]??u.Browse,fe=new Set,oe=[];return oe.push({type:"section",key:"persona-section",label:M.label,description:M.description}),M.keys.forEach(O=>{const ie=i[O];ie&&!fe.has(O)&&(oe.push(ie),fe.add(O))}),oe.push({type:"divider",key:"persona-divider"}),oe.push({type:"section",key:"all-tools",label:"All workspace tools"}),Object.entries(i).forEach(([O,ie])=>{fe.has(O)||(oe.push(ie),fe.add(O))}),oe},[g,h,v,E]),pe=[{type:"item",key:"find",icon:ge,label:"Find in Page",shortcut:T?"⌘ F":"Ctrl F",disabled:!c,onSelect:I},{type:"item",key:"screenshot",icon:dt,label:"Capture Screenshot",disabled:!c,onSelect:d},{type:"item",key:"pip",icon:Zt,label:"Picture-in-Picture",disabled:!c,onSelect:f},{type:"item",key:"devtools",icon:qt,label:"Toggle DevTools",shortcut:T?"⌘ ⇧ I":"Ctrl ⇧ I",disabled:!c,onSelect:b},{type:"divider",key:"tools-divider"},{type:"item",key:"guided-tour",icon:xe,label:"Run Guided Tour",onSelect:()=>{C()}},{type:"item",key:"watchers",icon:Bt,label:"Page Watchers",onSelect:()=>{h("/watchers")}},{type:"item",key:"history",icon:Te,label:"History",onSelect:()=>{h("/history")}},{type:"item",key:"tab-graph",icon:ve,label:"Tab Graph Overlay",shortcut:T?"⌘⇧G":"Ctrl⇧G",onSelect:()=>{E()}},{type:"item",key:"consent-dashboard",icon:de,label:"Consent Playground",onSelect:()=>{v()}}],j=[{type:"item",key:"agent-console",icon:Ve,label:"Open Agent Console",shortcut:T?"⌘⇧A":"Ctrl+Shift+A",onSelect:()=>r()},{type:"item",key:"ask-agent",icon:xe,label:"Ask Agent",shortcut:T?"⌘K":"Ctrl+K",onSelect:()=>a()},{type:"divider",key:"agent-divider"},{type:"item",key:"clip-highlight",icon:Pt,label:"Clip Highlight",shortcut:T?"⌘⇧H":"Ctrl+Shift+H",onSelect:()=>o()},{type:"item",key:"reader-mode",icon:He,label:"Reader Mode",shortcut:T?"⌘⇧R":"Ctrl+Shift+R",onSelect:()=>p()}],F=[{type:"item",key:"privacy-shields",icon:de,label:"Privacy Shields",onSelect:()=>{document.querySelector("[data-shields-button]")?.click()}},{type:"item",key:"network-controls",icon:Be,label:"Network Controls",onSelect:()=>{document.querySelector("[data-network-button]")?.click()}},{type:"item",key:"tor-toggle",icon:de,label:A.running?"Disable Tor":"Enable Tor",onSelect:()=>{A.running?V():q()}},{type:"item",key:"tor-new-identity",icon:ze,label:"Tor: New Identity",disabled:!A.running||!!A.stub,onSelect:()=>{A.running&&!A.stub&&le()}},{type:"item",key:"vpn-status",icon:Be,label:G.connected?`VPN: ${G.type?G.type.toUpperCase():"Active"}`:"Check VPN Status",onSelect:()=>{R()}},{type:"divider",key:"security-divider"},{type:"item",key:"history-graph",icon:Te,label:"History Graph",onSelect:()=>h("/history")}],z=(i,u,M,fe)=>{const oe=D===i;return e.jsxs("div",{className:"relative",children:[e.jsxs(N.button,{type:"button",onClick:()=>l(i),"aria-expanded":oe,"aria-haspopup":"true","data-testid":`nav-menu-${i}`,whileHover:{scale:1.05},whileTap:{scale:.95},className:`button-surface flex items-center gap-1.5 px-2.5 py-2 rounded-lg text-sm transition-all ${oe?"button-surface--active text-primary":"text-muted"}`,title:`${u} menu`,children:[e.jsx(N.div,{animate:oe?{rotate:180}:{rotate:0},transition:{duration:.2},children:e.jsx(M,{size:16,className:"text-muted"})}),e.jsx("span",{className:"hidden xl:inline",children:u}),e.jsx(N.div,{animate:oe?{rotate:180}:{rotate:0},transition:{duration:.2},children:e.jsx(De,{size:14,className:"hidden xl:inline"})})]}),e.jsx(he,{children:oe&&e.jsxs(e.Fragment,{children:[e.jsx(N.button,{type:"button","aria-label":`Close ${u} menu`,className:"fixed inset-0 z-40 bg-transparent pointer-events-auto focus:outline-none",onClick:$,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},`${i}-backdrop`),e.jsx(N.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-60 bg-surface-elevated border border-surface rounded-lg shadow-2xl z-50 py-2",children:ue[i]?e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-2 px-3 py-2",children:Array.from({length:4}).map((O,ie)=>e.jsx(N.div,{initial:{opacity:0,x:-8},animate:{opacity:1,x:0},transition:{delay:ie*.05,duration:.2},className:"h-8 rounded-md bg-slate-800/70",style:{background:"linear-gradient(90deg, rgba(30, 41, 59, 0.7) 25%, rgba(51, 65, 85, 0.7) 50%, rgba(30, 41, 59, 0.7) 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite"}},`skeleton-${i}-${ie}`))}):fe.map(O=>O.type==="divider"?e.jsx("div",{className:"h-px my-1 bg-[var(--surface-border)]/60"},O.key):O.type==="section"?e.jsxs("div",{className:"px-4 pt-1 pb-2 text-[10px] uppercase tracking-[0.24em] text-muted",children:[e.jsx("div",{children:O.label}),O.description&&e.jsx("div",{className:"mt-1 text-[10px] normal-case tracking-normal text-muted/80",children:O.description})]},O.key):e.jsxs(N.button,{type:"button",disabled:O.disabled,onClick:()=>X(O),className:"menu-item w-full",whileHover:{x:2},whileTap:{scale:.98},transition:{duration:.15},children:[e.jsx(O.icon,{size:16,className:"text-muted"}),e.jsx("span",{className:"flex-1 text-left",children:O.label}),O.shortcut&&e.jsx("kbd",{className:"text-xs text-muted border border-surface rounded px-1.5 py-0.5",children:O.shortcut})]},O.key))},`${i}-menu`)]})})]},i)};return e.jsx("div",{className:"drag border-b border-surface bg-surface-panel shadow-lg text-primary transition-colors",children:e.jsxs("div",{className:"no-drag flex flex-wrap items-center gap-2 sm:gap-3 px-2 sm:px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{}),e.jsx(us,{compact:!0}),e.jsxs("div",{className:"hidden 2xl:flex items-center gap-2",children:[e.jsx(fs,{compact:!0}),e.jsx(ys,{compact:!0})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx(N.button,{onClick:()=>h("/"),"aria-label":"Go to home","data-testid":"nav-home-button",whileHover:{scale:1.05},whileTap:{scale:.95},className:"no-drag p-2.5 rounded-lg button-surface hover:text-primary",title:"Home (Go to home screen)",children:e.jsx(_t,{size:18})}),e.jsx(N.button,{onClick:H,disabled:!Z||!c,"aria-label":"Go back","aria-disabled":!Z||!c,"data-testid":"nav-back-button",whileHover:{scale:Z&&c?1.05:1},whileTap:{scale:Z&&c?.95:1},className:`no-drag p-2.5 rounded-lg button-surface ${Z&&c?"hover:text-primary":"opacity-40 cursor-not-allowed"}`,title:"Back (Alt+← / ⌘←)",children:e.jsx(Wt,{size:18})}),e.jsx(N.button,{onClick:t,disabled:!K||!c,"aria-label":"Go forward","aria-disabled":!K||!c,"data-testid":"nav-forward-button",whileHover:{scale:K&&c?1.05:1},whileTap:{scale:K&&c?.95:1},className:`no-drag p-2.5 rounded-lg button-surface ${K&&c?"hover:text-primary":"opacity-40 cursor-not-allowed"}`,title:"Forward (Alt+→ / ⌘→)",children:e.jsx(Gt,{size:18})}),e.jsx(N.button,{onClick:n,disabled:!c,"aria-label":"Refresh page","aria-disabled":!c,"data-testid":"nav-refresh-button",whileHover:{scale:c?1.05:1},whileTap:{scale:c?.95:1},className:`no-drag p-2.5 rounded-lg button-surface ${c?"hover:text-primary":"opacity-40 cursor-not-allowed"}`,title:"Refresh (Ctrl+R / ⌘R)",children:e.jsx(N.div,{animate:{rotate:J?360:0},transition:{duration:1,repeat:J?1/0:0,ease:"linear"},className:"flex items-center justify-center",children:e.jsx(ze,{size:18})})})]}),e.jsx("div",{className:"flex-1 min-w-[220px]","data-onboarding":"omnibox",children:e.jsxs("div",{className:"relative",children:[e.jsx(cs,{onCommandPalette:a}),e.jsx(ds,{})]})}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("div",{className:"flex items-center gap-1.5 border-r border-surface/40 pr-2",children:e.jsxs(N.button,{onClick:r,"aria-label":`Agent console${S?" (active)":""}`,whileHover:{scale:1.05},whileTap:{scale:.95},"data-testid":"nav-agent-button",className:`relative p-2 rounded-lg button-surface ${S?"button-surface--active shadow-[0_0_18px_rgba(59,130,246,0.35)] text-primary":"hover:text-primary"}`,title:"Agent Console (⌘⇧A)",children:[e.jsx(Ve,{size:18}),S&&e.jsx(N.span,{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-green-400 rounded-full border-2 border-gray-900",animate:{scale:[1,1.2,1],opacity:[1,.8,1]},transition:{duration:2,repeat:1/0},"aria-label":"Agent is active"})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[z("ai","AI",xe,j),z("browse","Browse",Le,re),z("tools","Tools",We,pe),z("security","Security",de,F)]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-1 border-l border-surface/40 pl-2",children:[e.jsx(ks,{}),e.jsxs("div",{className:"hidden xl:flex items-center gap-1",children:[e.jsx(js,{}),e.jsx(Ns,{})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-1 border-l border-surface/40 pl-2",children:[e.jsx(rt,{}),e.jsxs(N.button,{onClick:()=>h("/downloads"),"aria-label":`Downloads${y>0?` (${y} active)`:""}`,whileHover:{scale:1.05},whileTap:{scale:.95},"data-testid":"nav-downloads-button",className:"relative p-2 rounded-lg button-surface hover:text-primary",title:`Downloads${y>0?` (${y} active)`:""}`,children:[e.jsx(Re,{size:18}),y>0&&e.jsx(N.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-bold","aria-label":`${y} active download${y>1?"s":""}`,children:y>9?"9+":y})]}),e.jsx(N.button,{onClick:()=>h("/settings"),"aria-label":"Open settings",whileHover:{scale:1.05},whileTap:{scale:.95},"data-testid":"nav-settings-button",className:"p-2 rounded-lg button-surface hover:text-primary",title:"Settings",children:e.jsx(Xe,{size:18})})]}),e.jsxs("div",{className:"md:hidden relative",ref:me,children:[e.jsx("button",{type:"button",onClick:()=>U(i=>!i),className:"p-2 rounded-lg button-surface hover:text-primary","aria-label":"More options","aria-expanded":se,"data-testid":"nav-more-button",title:"More options",children:e.jsx(wt,{size:18})}),e.jsx(he,{children:se&&e.jsxs(e.Fragment,{children:[e.jsx(N.button,{type:"button","aria-label":"Close more menu",className:"fixed inset-0 z-40 bg-transparent pointer-events-auto focus:outline-none",onClick:()=>U(!1),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},"more-backdrop"),e.jsxs(N.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-48 bg-surface-elevated border border-surface rounded-lg shadow-2xl z-50 py-2",children:[e.jsxs("button",{type:"button",onClick:()=>{h("/downloads"),U(!1)},className:"menu-item w-full","data-testid":"nav-more-downloads",children:[e.jsx(Re,{size:16}),e.jsxs("span",{children:["Downloads",y>0?` (${y})`:""]})]}),e.jsxs("button",{type:"button",onClick:()=>{h("/settings"),U(!1)},className:"menu-item w-full","data-testid":"nav-more-settings",children:[e.jsx(Xe,{size:16}),e.jsx("span",{children:"Settings"})]}),e.jsx("div",{className:"h-px my-1 bg-[var(--surface-border)]/60"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx(rt,{})})]},"more-menu")]})})]})]})]})})}export{ur as TopNav};
//# sourceMappingURL=TopNav-BqNjnIUN.js.map

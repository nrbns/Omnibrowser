import{r as i,j as e,i as j}from"./index-DMKJqC5Z.js";import{b as L}from"./AppShell-DKPxPuWD.js";import{S as v}from"./shield-check-x87xpyVa.js";import{R as f}from"./refresh-cw-Ck1GEe8j.js";import{D as y}from"./download-ukpL1WLs.js";import{m as N}from"./proxy-B-PlLRqe.js";import{S as k}from"./shield-alert-BH6vxp5a.js";import{X as E}from"./x-GAlOzW-g.js";import{c as _}from"./createLucideIcon-BHoZ2X8H.js";import{T as z}from"./triangle-alert-BHl0FKa7.js";import{f as I}from"./formatDistanceToNow-CwTn1k5x.js";import"./ipc-events-B-mtt1te.js";import"./use-ipc-event-BWqwbbDc.js";import"./Portal-DMoOea_i.js";import"./globe-B55P551M.js";const D=_("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function O(){const[t,r]=i.useState(null),[d,o]=i.useState(!1),[c,h]=i.useState(null),x=async()=>{try{o(!0);const a=await j.consent.vault.export();r(a),o(!1)}catch(a){h(a instanceof Error?a.message:String(a)),o(!1)}};i.useEffect(()=>{x()},[]);const u=()=>{if(!t)return;const a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=`consent-vault-${t.updatedAt}.json`,n.click(),URL.revokeObjectURL(l)};return e.jsxs("div",{className:"rounded-3xl border border-emerald-500/30 bg-emerald-950/20 p-4 text-emerald-100 shadow-[0_20px_60px_rgba(16,185,129,0.25)]",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-emerald-200",children:[e.jsx(v,{size:16})," Quantum Consent Vault"]}),e.jsx("div",{className:"text-xs text-emerald-100/70",children:"Each consent is sealed with a hash-chain signature. Export receipts for audits."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>void x(),className:"rounded-lg border border-emerald-400/40 bg-emerald-500/10 px-2 py-1 text-[11px] text-emerald-100 hover:bg-emerald-500/20",disabled:d,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{size:12,className:d?"animate-spin":""}),"Refresh"]})}),e.jsx("button",{type:"button",onClick:u,disabled:!t,className:"rounded-lg border border-emerald-400/40 bg-emerald-500/10 px-2 py-1 text-[11px] text-emerald-100 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-60",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{size:12})," Export"]})})]})]}),c&&e.jsx("div",{className:"mt-3 rounded-lg border border-rose-500/40 bg-rose-500/10 px-3 py-2 text-[11px] text-rose-100",children:c}),!c&&e.jsxs("div",{className:"mt-4 max-h-64 overflow-y-auto rounded-2xl border border-emerald-500/15 bg-emerald-900/30",children:[!t&&d&&e.jsx("div",{className:"p-6 text-center text-xs text-emerald-100/70",children:"Loading quantum receipts…"}),t&&!d&&e.jsxs("div",{className:"divide-y divide-emerald-500/10 text-[11px]",children:[t.entries.map(a=>{const l=typeof a.metadata=="object"&&a.metadata!==null?a.metadata:void 0,n=typeof l?.risk=="string"?l.risk:void 0,m=typeof l?.target=="string"?l.target:void 0;return e.jsxs(N.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:"space-y-1 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-emerald-100",children:[e.jsx("span",{className:"font-medium uppercase tracking-wide text-[10px]",children:a.actionType}),e.jsx("span",{className:"text-emerald-200/70",children:new Date(a.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"text-emerald-100/90 break-all",children:["Chain hash: ",a.chainHash]}),e.jsxs("div",{className:"text-emerald-100/70 break-all",children:["Signature: ",a.signature]}),n&&e.jsxs("div",{className:"text-emerald-100/70",children:["Risk: ",n]}),m&&e.jsxs("div",{className:"text-emerald-100/70 break-all",children:["Target: ",m]})]},a.chainHash)}),t.entries.length===0&&e.jsx("div",{className:"p-6 text-center text-xs text-emerald-200/70",children:"Ledger empty. Approve a consent request to generate the first block."})]})]}),t&&e.jsxs("div",{className:"mt-3 text-[10px] text-emerald-200/60",children:["Anchor hash: ",t.anchor]})]})}const U=t=>t.revokedAt?{label:"Revoked",tone:"text-red-400 bg-red-500/10 border-red-500/40"}:t.approved?{label:"Approved",tone:"text-emerald-300 bg-emerald-500/10 border-emerald-500/40"}:{label:"Pending",tone:"text-amber-300 bg-amber-500/10 border-amber-500/40"},F=t=>t==="high"?e.jsx(z,{size:14,className:"text-red-400"}):t==="medium"?e.jsx(k,{size:14,className:"text-amber-400"}):e.jsx(v,{size:14,className:"text-emerald-400"}),T={download:"Download file",form_submit:"Submit form",login:"Login",scrape:"Scrape content",export_data:"Export data",access_clipboard:"Access clipboard",access_camera:"Access camera",access_microphone:"Access microphone",access_filesystem:"Filesystem access",ai_cloud:"Use cloud AI provider"},P=[{value:"all",label:"All actions"},{value:"download",label:"Download file"},{value:"form_submit",label:"Submit form"},{value:"login",label:"Login"},{value:"scrape",label:"Scrape content"},{value:"export_data",label:"Export data"},{value:"access_clipboard",label:"Clipboard"},{value:"access_camera",label:"Camera"},{value:"access_microphone",label:"Microphone"},{value:"access_filesystem",label:"Filesystem"},{value:"ai_cloud",label:"Cloud AI"}],B=[{value:"all",label:"All statuses"},{value:"pending",label:"Pending"},{value:"approved",label:"Approved"},{value:"revoked",label:"Revoked"}];function te(){const{visible:t,records:r,loading:d,error:o,filter:c,close:h,refresh:x,setFilter:u,approve:a,revoke:l}=L(),[n,m]=i.useState(!1);i.useEffect(()=>{if(!t)return;const s=setInterval(()=>{x()},2e4);return()=>clearInterval(s)},[t,x]);const w=i.useMemo(()=>r.filter(s=>!s.approved).length,[r]),C=i.useMemo(()=>r.filter(s=>!!s.revokedAt).length,[r]),A=i.useMemo(()=>r.filter(s=>s.approved&&!s.revokedAt).length,[r]),R=async()=>{try{m(!0);const s=await j.consent.export(),b=new Blob([s],{type:"application/json"}),g=URL.createObjectURL(b),p=document.createElement("a");p.href=g,p.download=`omnibrowser-consent-ledger-${new Date().toISOString()}.json`,document.body.appendChild(p),p.click(),p.remove(),URL.revokeObjectURL(g)}catch(s){console.error("Failed to export consent ledger",s)}finally{m(!1)}},S=s=>{const b=U(s),g=I(new Date(s.timestamp),{addSuffix:!0});return e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/60 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-200",children:[F(s.action.risk),e.jsx("span",{children:T[s.action.type]})]}),e.jsx("span",{className:`rounded-full border px-2 py-0.5 text-[11px] ${b.tone}`,children:b.label})]}),e.jsx("div",{className:"text-xs text-gray-400 leading-relaxed whitespace-pre-wrap",children:s.action.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-[11px] text-gray-500",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Target:"})," ",e.jsx("span",{className:"text-gray-200",children:s.action.target??"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Risk:"})," ",e.jsx("span",{className:"text-gray-200 capitalize",children:s.action.risk})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Requested:"})," ",e.jsx("span",{className:"text-gray-200",children:g})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Ledger ID:"})," ",e.jsxs("span",{className:"text-gray-500 font-mono text-[10px]",children:[s.id.slice(0,8),"…"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-gray-500",children:[e.jsx("span",{children:"Signature:"}),e.jsxs("span",{className:"font-mono truncate text-gray-600",children:[s.signature.slice(0,24),"…"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-[11px] text-gray-500",children:["User: ",e.jsx("span",{className:"text-gray-300",children:s.userId})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!s.approved&&!s.revokedAt&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(s.id),className:"rounded-lg border border-emerald-500/60 bg-emerald-500/10 px-3 py-1 text-xs font-medium text-emerald-200 hover:bg-emerald-500/20",children:"Approve"}),e.jsx("button",{onClick:()=>l(s.id),className:"rounded-lg border border-red-500/60 bg-red-500/10 px-3 py-1 text-xs font-medium text-red-300 hover:bg-red-500/20",children:"Reject"})]}),s.approved&&!s.revokedAt&&e.jsx("button",{onClick:()=>l(s.id),className:"rounded-lg border border-amber-500/50 bg-amber-500/10 px-3 py-1 text-xs font-medium text-amber-200 hover:bg-amber-500/20",children:"Revoke"})]})]})]},s.id)};return t?e.jsxs("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center bg-black/75 backdrop-blur-sm",children:[e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"relative w-[min(900px,92vw)] max-h-[90vh] overflow-hidden rounded-3xl border border-slate-700/70 bg-slate-950/95 text-gray-100 shadow-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-slate-800/60 px-6 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-wide text-emerald-300/80",children:[e.jsx(k,{size:14})," Consent Playground"]}),e.jsx("div",{className:"text-lg font-semibold text-white",children:"Review & control ethical AI memory"}),e.jsxs("div",{className:"text-[11px] text-gray-500",children:["Pending ",w," · Approved ",A," · Revoked ",C]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:R,disabled:n,className:"flex items-center gap-2 rounded-xl border border-slate-700/60 bg-slate-900/70 px-3 py-2 text-xs text-gray-200 hover:bg-slate-900/90 disabled:opacity-50",children:[e.jsx(y,{size:14,className:n?"animate-pulse":""})," Export Ledger"]}),e.jsx("button",{onClick:()=>x(),disabled:d,className:"rounded-xl border border-slate-700/60 bg-slate-900/70 p-2 text-gray-300 hover:bg-slate-900/90 disabled:opacity-50","aria-label":"Refresh consent ledger",children:e.jsx(f,{size:15,className:d?"animate-spin":""})}),e.jsx("button",{onClick:()=>h(),className:"rounded-full border border-slate-700/60 bg-slate-900/70 p-2 text-gray-300 hover:bg-slate-900/90","aria-label":"Close consent dashboard",children:e.jsx(E,{size:16})})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 p-6 overflow-y-auto max-h-[75vh]",children:[e.jsx("div",{className:"grid gap-3 sm:grid-cols-[minmax(0,1fr),auto]",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-400",children:[e.jsx(D,{size:14}),e.jsx("select",{value:c.type??"all",onChange:s=>void u({type:s.target.value}),className:"rounded-lg border border-slate-700/60 bg-slate-900/70 px-2 py-1 text-gray-200",children:P.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{value:c.status??"all",onChange:s=>void u({status:s.target.value}),className:"rounded-lg border border-slate-700/60 bg-slate-900/70 px-2 py-1 text-gray-200",children:B.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})}),o&&e.jsx("div",{className:"rounded-xl border border-red-500/50 bg-red-500/10 px-4 py-2 text-xs text-red-200",children:o}),d?e.jsx("div",{className:"flex items-center justify-center py-12 text-sm text-gray-400",children:"Loading consent ledger…"}):r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-16 text-center text-sm text-gray-500",children:[e.jsx(v,{size:32,className:"text-emerald-400"}),e.jsx("div",{children:"No consent records yet. Run agent actions to populate the ledger."})]}):e.jsx("div",{className:"grid gap-3",children:r.map(S)})]})]}),e.jsx(O,{})]}):null}export{te as ConsentDashboard};
//# sourceMappingURL=ConsentDashboard-CKgA7ZoF.js.map

import{c as m,a as y,i as o}from"./index-dj7m1cGj.js";async function i(t){try{return await t()}catch(a){console.warn("[trust-dashboard] call failed",a);return}}const S=m((t,a)=>({visible:!1,loading:!1,error:null,consentTimeline:[],trustSignals:[],shieldsStatus:null,privacyAudit:null,consentStats:{total:0,pending:0,approved:0,revoked:0},blockedSummary:{trackers:0,ads:0,upgrades:0},lastUpdated:null,async open(){a().visible||t({visible:!0}),await a().refresh()},close(){t({visible:!1})},async refresh(){if(!y()){t({loading:!1,error:null,consentTimeline:[],trustSignals:[],shieldsStatus:null,privacyAudit:null,consentStats:{total:0,pending:0,approved:0,revoked:0},blockedSummary:{trackers:0,ads:0,upgrades:0},lastUpdated:Date.now()});return}t({loading:!0,error:null});try{const[{records:s}={records:[]},l,n,u]=await Promise.all([i(()=>o.trust.list()),i(()=>o.consent.list()),i(()=>o.shields.getStatus()),i(()=>o.privacy.sentinel.audit())]),d=Array.isArray(l)?l:[],p=d.reduce((e,r)=>(e.total+=1,r.approved&&!r.revokedAt?e.approved+=1:r.revokedAt?e.revoked+=1:e.pending+=1,e),{total:0,pending:0,approved:0,revoked:0}),v=[...d].sort((e,r)=>r.timestamp-e.timestamp).slice(0,20),f=Array.isArray(s)?[...s].sort((e,r)=>{if(e.verdict===r.verdict)return r.score-e.score;const c={trusted:2,caution:1,risk:0};return c[r.verdict]-c[e.verdict]}):[],g={trackers:n?.trackersBlocked??0,ads:n?.adsBlocked??0,upgrades:n?.httpsUpgrades??0};t({loading:!1,consentTimeline:v,trustSignals:f,shieldsStatus:n??null,privacyAudit:u??null,consentStats:p,blockedSummary:g,lastUpdated:Date.now()})}catch(s){t({loading:!1,error:s instanceof Error?s.message:String(s)})}}}));export{S as useTrustDashboardStore};
//# sourceMappingURL=trustDashboardStore-CE7KmIta.js.map

import{r as a,j as e,u as Ze,a as lt,i as j,b as ct}from"./index-DMKJqC5Z.js";import{u as ge,L as ke,f as dt,c as ut}from"./formatDistanceToNow-CwTn1k5x.js";import{R as pt,u as ze,a as mt,b as ft}from"./AppShell-DKPxPuWD.js";import{u as me,W as Me}from"./privacyStore-CLrjP8FN.js";import{u as Qe}from"./appStore-YdLSx3oj.js";import{B as ht}from"./brain-qT2viXus.js";import{T as yt}from"./trending-up-BuEY6VB4.js";import{G as xt}from"./gamepad-2-B3k15_2Z.js";import{Z as gt}from"./zap-DnPrAbXN.js";import{u as bt,f as vt,L as Fe,m as P}from"./proxy-B-PlLRqe.js";import{i as Ye}from"./ipc-events-B-mtt1te.js";import{u as ne}from"./use-ipc-event-BWqwbbDc.js";import{u as Je}from"./containerStore-4g5QdXcB.js";import{d as De,W as wt,H as kt}from"./debounce-D_hglKv1.js";import{L as jt}from"./lock-QlIpU5_k.js";import{c as Y}from"./createLucideIcon-BHoZ2X8H.js";import{G as Nt}from"./globe-B55P551M.js";import{S as oe}from"./shield-DNuGHzo8.js";import{S as fe}from"./search-FaAd99m9.js";import{A as ue}from"./index-BE3YK0eV.js";import{S as be}from"./sparkles-C9aT6jfb.js";import{C as Ge}from"./clock-CAio9RVc.js";import{P as Ee}from"./plus-BEevIG6L.js";import{C as et,a as tt}from"./check-CELdvzc1.js";import{X as Ct}from"./x-GAlOzW-g.js";import{u as Oe,e as St}from"./profileStore-r6TNFURV.js";import{D as st}from"./download-ukpL1WLs.js";import{E as At}from"./eye-off-cnqR3OyA.js";import{G as Pt,B as It,S as Tt}from"./sun-DXqxPM3_.js";import{M as Et,S as Lt}from"./settings-BScQ-4A5.js";import{N as he}from"./network-gkI0Eu1G.js";import{C as we}from"./circle-check-big-BrC851lQ.js";import{C as Ae}from"./circle-x-DycYTBkH.js";import{R as Te}from"./refresh-cw-Ck1GEe8j.js";import{P as Rt}from"./play-BHREYUo1.js";import{F as Be}from"./file-text-BKQmjIDI.js";import{A as $t}from"./arrow-right--nONUAkJ.js";import{B as We}from"./bot-Dsx8taB7.js";import{A as zt}from"./activity-BJ2_0ciE.js";import"./Portal-DMoOea_i.js";import"./triangle-alert-BHl0FKa7.js";const Mt=Y("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Ft=Y("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);const Dt=Y("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);const Le=Y("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const Gt=Y("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const rt=Y("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);const Ot=Y("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);const Pe=Y("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);const Bt=Y("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const He=Y("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);const Wt=Y("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);const Ht=Y("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const Kt=Y("PictureInPicture",[["path",{d:"M8 4.5v5H3m-1-6 6 6m13 0v-3c0-1.16-.84-2-2-2h-7m-9 9v2c0 1.05.95 2 2 2h3",key:"bcd8fb"}],["rect",{width:"10",height:"7",x:"12",y:"13.5",ry:"2",key:"136fx3"}]]);const Ut=Y("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);const qt=Y("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),_t=a.createContext(null);function Xt(){const r=a.useRef(!1);return bt(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function Vt(){const r=Xt(),[i,n]=a.useState(0),f=a.useCallback(()=>{r.current&&n(i+1)},[i]);return[a.useCallback(()=>vt.postRender(f),[f]),i]}const Zt=r=>!r.isLayoutDirty&&r.willUpdate(!1);function Ke(){const r=new Set,i=new WeakMap,n=()=>r.forEach(Zt);return{add:f=>{r.add(f),i.set(f,f.addEventListener("willUpdate",n))},remove:f=>{r.delete(f);const l=i.get(f);l&&(l(),i.delete(f)),n()},dirty:n}}const at=r=>r===!0,Qt=r=>at(r===!0)||r==="id",Yt=({children:r,id:i,inherit:n=!0})=>{const f=a.useContext(Fe),l=a.useContext(_t),[g,y]=Vt(),S=a.useRef(null),A=f.id||l;S.current===null&&(Qt(n)&&A&&(i=i?A+"-"+i:A),S.current={id:i,group:at(n)&&f.group||Ke()});const k=a.useMemo(()=>({...S.current,forceRender:g}),[y]);return e.jsx(Fe.Provider,{value:k,children:r})},Jt=[{id:"Research",icon:ht,label:"Research",color:"text-purple-400",glowColor:"from-purple-500 via-purple-600 to-purple-500"},{id:"Trade",icon:yt,label:"Trade",color:"text-green-400",glowColor:"from-green-500 via-emerald-600 to-green-500"},{id:"Games",icon:xt,label:"Game",color:"text-yellow-400",glowColor:"from-yellow-500 via-amber-600 to-yellow-500"},{id:"Browse",icon:gt,label:"Browse",color:"text-cyan-400",glowColor:"from-cyan-500 via-blue-600 to-cyan-500"}];function es(){const{mode:r,setMode:i}=Qe(),n=Ze(),f=g=>{i(g.id),n("/")},l=r||"Research";return e.jsx("div",{className:"flex items-center gap-1 bg-gray-800/60 rounded-lg p-1 border border-gray-700/50 shadow-sm",children:Jt.map(g=>{const y=g.icon,S=l===g.id;return e.jsxs(P.button,{onClick:()=>f(g),whileHover:{scale:1.02},whileTap:{scale:.98},className:`
              relative flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium
              transition-all duration-200 cursor-pointer
              ${S?`bg-gradient-to-r ${g.glowColor} text-white shadow-lg`:"text-gray-400 hover:text-gray-200 hover:bg-gray-700/30"}
            `,title:g.label,children:[e.jsx(y,{size:16,className:S?"text-white":g.color}),e.jsx("span",{children:g.label}),S&&e.jsx(P.div,{className:`absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r ${g.glowColor} rounded-full`,initial:{scaleX:0},animate:{scaleX:1},transition:{type:"spring",stiffness:500,damping:30}})]},g.id)})})}const ts={google:"https://www.google.com/search?q=",duckduckgo:"https://duckduckgo.com/?q=",wiki:"https://en.wikipedia.org/wiki/Special:Search?search=",youtube:"https://www.youtube.com/results?search_query=",twitter:"https://twitter.com/search?q="},ye=(r,i)=>`${ts[r]}${encodeURIComponent(i)}`,it=(r,i)=>{if(i===null||Number.isNaN(i)||!Number.isFinite(i))return null;const n=Math.abs(i)>1e6||Math.abs(i)<1e-4?i.toExponential(6):Number.isInteger(i)?i.toString():i.toPrecision(8).replace(/\.?0+$/,"");return`${r} = ${n}`},nt=r=>{const i=r.replace(/,/g,"").trim();if(!i||!/^[0-9+\-*/().%\s^]+$/.test(i))return null;try{const n=Function(`"use strict"; return (${i.replace(/\^/g,"**")})`)();if(typeof n=="number"&&Number.isFinite(n))return n}catch{return null}return null},Ue=r=>{const i=r.trim();if(!i)return null;const n=i.toLowerCase();if(n.startsWith("/calc")){const f=i.slice(5).trim(),l=f?nt(f):null;return{type:"calc",expr:f,result:l??void 0}}return n.startsWith("/ai")?{type:"ai",prompt:i.slice(3).trim()}:n.startsWith("/g ")?{type:"search",engine:"google",query:i.slice(3).trim()}:n.startsWith("/ddg ")?{type:"search",engine:"duckduckgo",query:i.slice(5).trim()}:n.startsWith("/wiki ")?{type:"search",engine:"wiki",query:i.slice(6).trim()}:n.startsWith("/yt ")?{type:"search",engine:"youtube",query:i.slice(4).trim()}:n.startsWith("/t ")?{type:"search",engine:"twitter",query:i.slice(3).trim()}:i.startsWith("?")?{type:"agent",prompt:i.slice(1).trim()}:n.startsWith("ask ")?{type:"agent",prompt:i.slice(4).trim()}:i.startsWith("/")?{type:"command",command:i.slice(1).trim()}:null},ss=(r,i)=>{switch(r.type){case"calc":{if(!r.expr)return{type:"command",title:"Calculate…",subtitle:"Enter an expression to evaluate",action:r};const n=it(r.expr,r.result??null);return{type:"command",title:`Calculate: ${r.expr}`,subtitle:n??"Press enter to evaluate",action:r}}case"ai":return{type:"command",title:`Ask AI assistant${r.prompt?`: ${r.prompt}`:""}`,subtitle:r.prompt?"OmniBrowser agent":"Provide a prompt to continue",action:r};case"agent":return{type:"command",title:`Ask agent${r.prompt?`: ${r.prompt}`:""}`,subtitle:"Query the current page context",action:r};case"search":return{type:"search",title:`${r.engine==="duckduckgo"?"DuckDuckGo":r.engine==="wiki"?"Wikipedia":r.engine==="youtube"?"YouTube":r.engine==="twitter"?"Twitter/X":"Google"}: ${r.query||i}`,subtitle:ye(r.engine,r.query||i),action:r};case"command":return{type:"command",title:`Run command: ${r.command||i}`,subtitle:"Press enter to execute via command palette",action:r};default:return null}},qe="omnibox:recent",_e=20;function rs({onCommandPalette:r}){const{tabs:i,activeId:n}=ge(),f=Je(s=>s.activeContainerId),l=lt(),g=s=>s.map(o=>({id:o.id,title:o.title||"New Tab",url:o.url||"about:blank",active:!!o.active,mode:o.mode,containerId:o.containerId,containerName:o.containerName,containerColor:o.containerColor,createdAt:o.createdAt,lastActiveAt:o.lastActiveAt,sessionId:o.sessionId,profileId:o.profileId,sleeping:o.sleeping})),[y,S]=a.useState(""),[A,k]=a.useState(!1),[w,T]=a.useState([]),[M,V]=a.useState(-1),[H,E]=a.useState(null),[Z,F]=a.useState(0),[q,O]=a.useState(!1),[te,re]=a.useState([]),m=a.useRef(null),[R,D]=a.useState([]),[K,Q]=a.useState(null),_=a.useRef(null),J=a.useRef(null),ae=a.useCallback((s,o)=>{const u=window?.ipc;if(u){if(typeof u.on=="function"){u.on(s,o);return}typeof u.addListener=="function"&&u.addListener(s,o)}},[]),ee=a.useCallback((s,o)=>{const u=window?.ipc;if(u){if(typeof u.removeListener=="function"){u.removeListener(s,o);return}if(typeof u.off=="function"){u.off(s,o);return}typeof u.removeEventListener=="function"&&u.removeEventListener(s,o)}},[]),d=i.find(s=>s.id===n);a.useEffect(()=>{try{const s=localStorage.getItem(qe);if(s){const o=JSON.parse(s);Array.isArray(o)&&re(o.filter(u=>typeof u?.url=="string").slice(0,_e))}}catch(s){console.warn("Failed to restore omnibox recents:",s)}},[]);const x=a.useCallback((s,o)=>{!o||o.startsWith("about:")||o.startsWith("ob://")||re(u=>{const h=u.filter(b=>b.url!==o),N=[{title:s||o,url:o,timestamp:Date.now()},...h].slice(0,_e);try{localStorage.setItem(qe,JSON.stringify(N))}catch(b){console.warn("Failed to persist omnibox recents:",b)}return N})},[]),C=a.useCallback(()=>{if(J.current){try{J.current()}catch{}J.current=null}_.current=null},[]),p=a.useCallback(s=>{if(!(!s||typeof s!="object")){if(s.type==="status"){Q(s.value||null);return}if(s.type==="result"&&s.result){D(o=>{const u=o.findIndex(h=>h.url===s.result.url);if(u>=0){const h=o.slice();return h[u]={...h[u],...s.result},h}return[...o,s.result]});return}if(s.type==="complete"){Q(o=>o??"Live results updated");return}if(s.type==="error"){Q(s.message||"Live search failed");return}}},[]),L=a.useCallback(async s=>{const o=s.trim();if(o){C(),D([]),Q("Searching…");try{const u=await j.liveSearch.start(o,{maxResults:10});_.current=u;const h=(N,b)=>{p(b)};ae(u.channel,h),J.current=()=>ee(u.channel,h)}catch(u){console.error("Live search start failed:",u),Q("Live search failed")}}},[ae,ee,p,C]);ne("tabs:updated",s=>{const o=Array.isArray(s)?s.find(u=>u.active):null;if(o&&!A){S(o.url||"");try{const u=new URL(o.url||"about:blank");E({secure:u.protocol==="https:"})}catch{E(null)}}},[n,A]),ne("tabs:progress",s=>{s.tabId===n&&(F(s.progress),O(s.progress<100&&s.progress>0))},[n]);const $=a.useCallback(De(async s=>{const o=s??"",u=o.toLowerCase().trim(),h=[];if(u.startsWith("@live")){T([]);return}const N=typeof navigator<"u"&&navigator.onLine===!1,b=(t,c=!1)=>{if(!t.title)return;h.some(G=>G.title===t.title&&G.subtitle===t.subtitle&&G.url===t.url&&G.type===t.type)||(c?h.unshift(t):h.push(t))},U=Ue(o);if(U){const t=ss(U,o);t&&b(t)}const B=o.trim();if(B.length>0&&!B.startsWith("@")&&!B.startsWith("/")&&!(U&&(U.type==="agent"||U.type==="ai")))b({type:"command",title:`Ask @redix: ${B}`,subtitle:"Stream the Redix agent answer inline",action:{type:"agent",prompt:B},badge:"@redix",icon:"sparkles"},!0);else if(!B){const t=[d?.title?`Summarize "${d.title}"`:"Summarize this tab","Why did regen mode fire?","What related sources am I tracking?"];t.slice().reverse().forEach((c,v)=>b({type:"command",title:`Ask @redix: ${c}`,subtitle:v===t.length-1?"Redix agent":void 0,action:{type:"agent",prompt:c},badge:"@redix",icon:"sparkles"},!0))}u.length>0&&!u.startsWith("http")&&!u.includes(".")&&((!U||U.type!=="search")&&b({type:"search",title:`Search: ${o}`,subtitle:ye("google",o),action:{type:"search",engine:"google",query:o}}),b({type:"search",title:`DuckDuckGo: ${o}`,subtitle:ye("duckduckgo",o),action:{type:"search",engine:"duckduckgo",query:o}})),i.forEach(t=>{const c=t.title||"Untitled",v=t.url||"";(c.toLowerCase().includes(u)||v.toLowerCase().includes(u))&&b({type:"tab",title:c,subtitle:v||void 0,action:v?{type:"nav",url:v}:void 0})});try{let t=[];N||(u.trim().length===0||u.length<2?t=await j.history.search(""):t=await j.history.search(o)),Array.isArray(t)&&t.length>0&&t.slice(0,5).forEach(c=>{b({type:"history",title:c.title||c.url||"Untitled",subtitle:c.url,action:c.url?{type:"nav",url:c.url}:void 0})})}catch(t){console.warn("History search failed:",t)}te.filter(t=>!u||t.title.toLowerCase().includes(u)||t.url.toLowerCase().includes(u)).slice(0,5).forEach(t=>{b({type:"history",title:t.title,subtitle:t.url,action:{type:"nav",url:t.url}})}),T(h.slice(0,8))},150),[i,te,d?.id,d?.title]),I=a.useMemo(()=>De(s=>{L(s)},250),[L]);a.useEffect(()=>()=>I.cancel(),[I]),a.useEffect(()=>()=>{C()},[C]),a.useEffect(()=>{const s=y.trim();if(s.toLowerCase().startsWith("@live")){const o=s.replace(/^@live\\s*/i,"").trim();if(o.length<2){I.cancel(),D([]),Q("Type at least 2 characters to stream results"),C();return}I(o)}else I.cancel(),D([]),Q(null),C()},[y,I,C]),a.useEffect(()=>{const s=y.trim();if(!s.toLowerCase().startsWith("@live"))return;const o=s.replace(/^@live\s*/i,"").trim(),u=[{type:"command",title:`Redix Live Search${o?` • ${o}`:""}`,subtitle:K??(o.length<2?"Type at least 2 characters to begin streaming":R.length===0?"Streaming results…":"Live results ready"),interactive:!1,icon:"sparkles"}];R.forEach(h=>{u.push({type:"search",title:h.title||h.url,subtitle:h.snippet||h.url,url:h.url,action:{type:"nav",url:h.url,title:h.title},icon:"search"})}),T(u)},[y,R,K]),a.useEffect(()=>{A?$(y):T([])},[y,A,$]),a.useEffect(()=>{V(-1)},[w.length]),a.useEffect(()=>{const s=o=>{const h=navigator.platform.toUpperCase().indexOf("MAC")>=0?o.metaKey:o.ctrlKey;h&&o.key==="l"&&(o.preventDefault(),m.current?.focus(),m.current?.select()),h&&o.key==="k"&&(o.preventDefault(),r())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[r]);const W=async(s,o={})=>{const{background:u=!1,newWindow:h=!1,titleOverride:N}=o;let b=s.trim();if(!b)return;!b.startsWith("http://")&&!b.startsWith("https://")&&!b.startsWith("about:")&&!b.startsWith("file://")&&!b.startsWith("ob://")&&(/^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]*\.[a-zA-Z]{2,}$/.test(b)||b.includes(".")?b=`https://${b}`:b=ye("google",b));const U=u&&!h;if(!l){const B=N||b,X=ge.getState(),se=(X.tabs??[]).map(v=>({...v}));let t=se,c=X.activeId??null;if(!X.activeId||se.length===0){const v=`local-${Date.now()}`;t=se.map(G=>({...G,active:!1})),t.push({id:v,title:B,url:b,active:!0,mode:"normal"}),c=v}else if(U){const v=`local-${Date.now()}`;t=se.map(G=>({...G})),t.push({id:v,title:B,url:b,active:!1,mode:"normal"})}else t=se.map(v=>({...v,title:v.id===X.activeId?B:v.title,url:v.id===X.activeId?b:v.url,active:v.id===X.activeId})),c=X.activeId;ge.setState({tabs:t,activeId:c}),Ye.emit("tabs:updated",g(t)),k(!1),T([]),U||S(b),x(B,b);try{window.open(b,"_blank","noopener,noreferrer")}catch(v){console.warn("Failed to open URL in browser:",v)}return}if(h){try{await j.private.createWindow({url:b}),k(!1),T([]),x(N||b,b)}catch(B){console.error("Failed to open new window for navigation:",B)}return}try{(!window.ipc||typeof window.ipc.invoke!="function")&&(console.warn("IPC not ready for navigation, waiting..."),await new Promise(B=>setTimeout(B,500))),n?U?await j.tabs.create({url:b,containerId:f,activate:!1}):await j.tabs.navigate(n,b):await j.tabs.create({url:b,containerId:f,activate:!U}),k(!1),T([]),U||S(b),x(N||b,b)}catch(B){console.error("Navigation failed:",B);try{(!window.ipc||typeof window.ipc.invoke!="function")&&(console.warn("IPC not ready for tab creation, waiting..."),await new Promise(se=>setTimeout(se,500)));const X=await j.tabs.create({url:b,containerId:f,activate:!U});X&&X.id?(k(!1),T([]),U||S(b),x(N||b,b)):console.warn("Tab creation returned invalid result:",X)}catch(X){console.error("Failed to create new tab:",X)}}},de=async(s,o,u={})=>{if(!s){await W(o,u);return}switch(s.type){case"nav":await W(s.url,{...u,titleOverride:s.title??u.titleOverride});return;case"search":{const h=s.query||o.trim();if(!h)return;const N=s.engine==="duckduckgo"?"DuckDuckGo":s.engine==="wiki"?"Wikipedia":s.engine==="youtube"?"YouTube":s.engine==="twitter"?"Twitter/X":"Google";await W(ye(s.engine,h),{...u,titleOverride:`${N}: ${h}`});return}case"ai":{const h=s.prompt||o.trim();if(!h){r();return}try{const N=d?.url;await j.agent.ask(h,N?{url:N}:void 0)}catch(N){console.error("AI search error:",N)}await W(`ob://agent?q=${encodeURIComponent(h)}`,{...u,titleOverride:`AI: ${h}`});return}case"agent":{const h=s.prompt||o.trim();if(!h){r();return}try{const N=d?.url;await j.agent.ask(h,N?{url:N}:void 0)}catch(N){console.error("Agent error:",N)}await W(`ob://agent?q=${encodeURIComponent(h)}`,{...u,titleOverride:`Agent: ${h}`});return}case"calc":{const h=s.expr||o.trim();if(!h){k(!0);return}const N=s.result??nt(h),b=h?it(h,N??null):null;if(b){if(S(b),k(!1),T([]),typeof navigator<"u"&&navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(b)}catch{}}else await W(ye("google",h),{...u,titleOverride:`Calculate: ${h}`});return}case"command":k(!1),T([]),r();return;default:await W(o,u)}},le=async(s,o={})=>{if(s.interactive!==!1){if(s.action){await de(s.action,s.subtitle||s.url||y,{...o,titleOverride:s.title});return}if(s.url){await W(s.url,{...o,titleOverride:s.title});return}await W(y,{...o,titleOverride:s.title})}},pe=async s=>{if(s.key==="Enter"){s.preventDefault();const o=s.shiftKey&&!s.altKey,u=s.altKey;if(M>=0&&w[M]){const h=w[M];await le(h,{background:o,newWindow:u})}else{if(y.trim().toLowerCase().startsWith("@live")){const N=R[0];if(N?.url){await W(N.url,{background:o,newWindow:u,titleOverride:N.title});return}}const h=Ue(y);await de(h,y,{background:o,newWindow:u})}}else s.key==="ArrowDown"?(s.preventDefault(),V(o=>Math.min(o+1,w.length-1))):s.key==="ArrowUp"?(s.preventDefault(),V(o=>Math.max(o-1,-1))):s.key==="Escape"&&(k(!1),T([]),m.current?.blur())};return a.useEffect(()=>{!A&&d&&S(d.url||"")},[d,A]),e.jsxs("div",{className:"relative flex-1 max-w-2xl",children:[e.jsx(P.div,{className:"relative",animate:{scale:A?1.02:1},transition:{duration:.2},children:e.jsxs("div",{className:"relative flex items-center",children:[H&&y&&!A&&e.jsxs("div",{className:"absolute left-3 flex items-center gap-2 z-10 pointer-events-none","aria-hidden":"true",children:[H.secure?e.jsx(jt,{size:14,className:"text-green-400","aria-label":"Secure connection"}):y.startsWith("http://")?e.jsx(Gt,{size:14,className:"text-amber-400","aria-label":"Insecure connection"}):e.jsx(Nt,{size:14,className:"text-gray-400","aria-label":"Web page"}),H.shieldCount!==void 0&&H.shieldCount>0&&e.jsxs("div",{className:"flex items-center gap-1","aria-label":`${H.shieldCount} shields active`,children:[e.jsx(oe,{size:14,className:"text-blue-400"}),e.jsx("span",{className:"text-xs text-gray-400",children:H.shieldCount})]})]}),e.jsx("input",{ref:m,type:"text",value:y,onChange:s=>S(s.target.value),onFocus:()=>k(!0),onBlur:()=>setTimeout(()=>k(!1),200),onKeyDown:pe,"aria-label":"Address bar - Search or enter URL","aria-autocomplete":"list","aria-expanded":A&&w.length>0,placeholder:"Search or enter URL",className:`
              w-full h-9 px-4 ${H&&!A?"pl-20":"pl-4"} pr-10
              bg-gray-800/60 backdrop-blur-sm border border-gray-700/50 rounded-xl
              text-sm text-white placeholder-gray-400
              focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50
              hover:bg-gray-800/80 transition-all
            `}),q&&Z>0&&e.jsx(P.div,{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-500 rounded-b-xl",initial:{scaleX:0},animate:{scaleX:Z/100},transition:{duration:.1}}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center",children:e.jsx(fe,{size:14,className:"text-gray-500"})})]})}),e.jsx(ue,{children:A&&w.length>0&&e.jsx(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-2 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl overflow-hidden z-50",children:w.map((s,o)=>e.jsxs(P.button,{type:"button",disabled:s.interactive===!1,onMouseDown:async u=>{if(u.preventDefault(),s.interactive===!1)return;const h=u.shiftKey&&!u.altKey,N=u.altKey;await le(s,{background:h,newWindow:N})},onMouseEnter:()=>V(o),onKeyDown:u=>{if(u.key==="Enter"||u.key===" "){if(u.preventDefault(),s.interactive===!1)return;const h=u.shiftKey&&!u.altKey,N=u.altKey;le(s,{background:h,newWindow:N})}},role:"option","aria-selected":M===o,"aria-label":`${s.type} suggestion: ${s.title}`,className:`
                  w-full flex items-center gap-3 px-4 py-2.5 text-left
                  transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset
                  ${M===o?"bg-gray-800/60 text-gray-100":"text-gray-300 hover:bg-gray-800/40"}
                  ${s.interactive===!1?"cursor-default opacity-80":""}
                `,children:[e.jsxs("div",{className:"flex-shrink-0 w-5 h-5 flex items-center justify-center",children:[s.icon==="sparkles"&&e.jsx(be,{size:14,className:"text-emerald-400"}),s.icon==="search"&&e.jsx(fe,{size:14,className:"text-purple-400"}),s.icon==="history"&&e.jsx(Ge,{size:13,className:"text-gray-400"}),!s.icon&&s.action?.type==="calc"&&e.jsx(Dt,{size:14,className:"text-amber-400"}),!s.icon&&s.action?.type==="ai"&&e.jsx(be,{size:14,className:"text-violet-400"}),!s.icon&&s.action?.type==="agent"&&e.jsx(be,{size:14,className:"text-blue-400"}),!s.icon&&s.action?.type==="search"&&e.jsx(fe,{size:14,className:"text-purple-400"}),!s.icon&&s.type==="tab"&&e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),!s.icon&&s.type==="history"&&e.jsx(Ge,{size:13,className:"text-gray-400"}),!s.icon&&!s.action&&s.type==="command"&&e.jsx(fe,{size:14,className:"text-blue-400"}),!s.icon&&!s.action&&s.type==="search"&&e.jsx(fe,{size:14,className:"text-purple-400"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:s.title}),(s.subtitle||s.url)&&e.jsx("div",{className:"text-xs text-gray-500 truncate",children:s.subtitle||s.url})]}),s.badge&&e.jsx("div",{className:"ml-auto flex-shrink-0 rounded-full border border-purple-500/40 bg-purple-500/15 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-purple-200",children:s.badge})]},o))})})]})}function as(){const[r,i]=a.useState(0),[n,f]=a.useState(!1);return ne("tabs:loading-start",()=>{f(!0),i(0)},[]),ne("tabs:loading-progress",l=>{i(l.progress||0)},[]),ne("tabs:loading-complete",()=>{f(!0),i(100),setTimeout(()=>{f(!1),i(0)},300)},[]),a.useEffect(()=>{if(n&&r<90){const l=setInterval(()=>{i(g=>g>=90?(clearInterval(l),g):g+Math.random()*15)},100);return()=>clearInterval(l)}},[n,r]),e.jsx(ue,{children:n&&e.jsx(P.div,{initial:{opacity:0,scaleX:0},animate:{opacity:1,scaleX:1},exit:{opacity:0,scaleX:0},className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-purple-500 via-blue-500 to-cyan-500 origin-left",style:{scaleX:r/100}})})}function is(){const r=ct(),[i,n]=a.useState([]),[f,l]=a.useState(null),[g,y]=a.useState(!1),[S,A]=a.useState(!1),[k,w]=a.useState(""),[T,M]=a.useState(null),[V,H]=a.useState(""),[E,Z]=a.useState(null),[F,q]=a.useState(!1),[O,te]=a.useState(!1),[re,m]=a.useState(null),R=a.useRef(""),D=async()=>{try{if(!window.ipc||typeof window.ipc.invoke!="function"){setTimeout(D,300);return}const[p,L]=await Promise.all([j.sessions.list(),j.sessions.getActive()]);let $=Array.isArray(p)?p:[];$.length===0&&($=[{id:"default",name:"Default",profileId:"default",createdAt:Date.now(),tabCount:0,color:"#3b82f6"}]);const I=$.map(pe=>pe.id).sort().join(",");R.current!==I&&(R.current=I,n($));let W=L&&typeof L=="object"?L:null;W||(W=$.find(pe=>pe.id==="default")??$[0]??null);const de=W?.id||null,le=f?.id||null;de!==le&&l(W)}catch(p){r&&p instanceof Error&&!p.message.includes("not available")&&console.warn("Failed to load sessions:",p)}};a.useEffect(()=>{const p=setTimeout(()=>{D()},500),L=setInterval(D,5e3);return()=>{clearTimeout(p),clearInterval(L)}},[]),a.useEffect(()=>{if(!g)return;let p=!1;return q(!0),j.sessionState.summary().then(L=>{p||Z(L?.summary??null)}).catch(()=>{p||Z(null)}).finally(()=>{p||q(!1)}),()=>{p=!0}},[g]);const K=async()=>{if(k.trim())try{await j.sessions.create({name:k.trim()}),w(""),A(!1),await D()}catch(p){r&&console.error("Failed to create session:",p)}},Q=async p=>{try{await j.sessions.setActive({sessionId:p}),await D(),y(!1)}catch(L){r&&console.error("Failed to switch session:",L)}},_=async(p,L)=>{if(L.stopPropagation(),!!confirm(`Delete session "${i.find($=>$.id===p)?.name}"? This will close all tabs in this session.`))try{await j.sessions.delete({sessionId:p}),await D()}catch($){r&&console.error("Failed to delete session:",$)}},J=p=>{M(p.id),H(p.name)},ae=async p=>{try{await j.sessions.update({sessionId:p,name:V.trim()}),M(null),await D()}catch(L){console.error("Failed to update session:",L)}},ee=async()=>{te(!0),m(null);try{const p=await j.sessionState.restore();if(p?.restored){const L=p.tabCount??0;m(`Restored ${L} tab${L===1?"":"s"} from last session.`),await D()}else p?.error?m(`Restore failed: ${p.error}`):m("No session snapshot available to restore.")}catch(p){console.error("Failed to restore session snapshot:",p),m("Failed to restore session snapshot.")}finally{te(!1)}},d=!f||f.id==="default"||f.name.toLowerCase()==="default",x=!d,C=x?"gap-2 px-3":"gap-1.5 px-2.5";return e.jsxs("div",{className:"relative",children:[e.jsxs(P.button,{onClick:()=>y(!g),whileHover:{scale:1.05},whileTap:{scale:.95},className:`relative flex items-center ${C} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`,title:"Multi-Session Manager",children:[e.jsx(qt,{size:16}),x&&e.jsx("span",{className:"text-sm font-medium",children:f?.name||"Default"}),!d&&f?.color&&e.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-700",style:{backgroundColor:f.color}}),x&&i.length>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.length,")"]})]}),e.jsx(ue,{children:g&&e.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute right-0 mt-2 w-80 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-lg shadow-xl overflow-hidden z-40",children:[e.jsxs("div",{className:"p-3 border-b border-gray-800/50 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Browser Sessions"}),e.jsx("button",{onClick:()=>{A(!0),w("")},className:"p-1.5 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-blue-400 transition-colors",title:"New Session",children:e.jsx(Ee,{size:16})})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[S&&e.jsxs("div",{className:"p-3 border-b border-gray-800/50",children:[e.jsx("input",{type:"text",value:k,onChange:p=>w(p.target.value),onKeyDown:p=>{p.key==="Enter"&&K(),p.key==="Escape"&&(A(!1),w(""))},placeholder:"Session name...",autoFocus:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:K,className:"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white",children:"Create"}),e.jsx("button",{onClick:()=>{A(!1),w("")},className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm text-gray-300",children:"Cancel"})]})]}),i.map(p=>{const L=f?.id===p.id,$=T===p.id;return e.jsx("div",{onClick:()=>!L&&Q(p.id),className:`
                      p-3 border-b border-gray-800/50 cursor-pointer transition-colors
                      ${L?"bg-blue-600/20 border-blue-500/30":"hover:bg-gray-800/50"}
                    `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[p.color&&e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-700 flex-shrink-0",style:{backgroundColor:p.color}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[$?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:V,onChange:I=>H(I.target.value),onKeyDown:I=>{I.key==="Enter"&&ae(p.id),I.key==="Escape"&&(M(null),H(""))},onClick:I=>I.stopPropagation(),autoFocus:!0,className:"flex-1 px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:I=>{I.stopPropagation(),ae(p.id)},className:"p-1 text-green-400 hover:text-green-300",children:e.jsx(et,{size:14})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-200 truncate",children:p.name}),L&&e.jsx("span",{className:"text-xs text-blue-400 font-medium",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[p.tabCount," tab",p.tabCount!==1?"s":""]}),p.id==="default"&&e.jsx("span",{className:"text-xs text-gray-500",children:"• Default"})]})]}),!$&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:I=>{I.stopPropagation(),J(p)},className:"p-1.5 rounded-lg hover:bg-gray-700 text-gray-400 hover:text-blue-400 transition-colors",title:"Rename",children:e.jsx(Ht,{size:14})}),p.id!=="default"&&e.jsx("button",{onClick:I=>_(p.id,I),className:"p-1.5 rounded-lg hover:bg-gray-700 text-gray-400 hover:text-red-400 transition-colors",title:"Delete",children:e.jsx(Ct,{size:14})})]})]})},p.id)})]}),e.jsxs("div",{className:"p-3 border-t border-gray-800/50 bg-gray-900/50 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Crash-safe snapshot"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[F&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-400",children:[e.jsx(ke,{className:"h-3.5 w-3.5 animate-spin"}),"Checking…"]}),!F&&E&&e.jsxs("span",{children:[E.tabCount," tab",E.tabCount===1?"":"s"," saved"," ",dt(E.updatedAt,{addSuffix:!0})]}),!F&&!E&&e.jsx("span",{children:"No snapshot captured yet."})]})]}),e.jsxs("button",{onClick:ee,disabled:O||F||!E,className:`inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-xs font-medium transition-colors ${O||F||!E?"border-gray-700 text-gray-500 cursor-not-allowed":"border-blue-500/40 bg-blue-500/10 text-blue-200 hover:border-blue-500/60"}`,children:[O?e.jsx(ke,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(pt,{className:"h-3.5 w-3.5"}),"Restore"]})]}),re&&e.jsx("p",{className:"text-xs text-blue-300",children:re}),e.jsx("p",{className:"text-xs text-gray-500",children:"Each session keeps cookies, storage, and login state isolated. Autosave runs every few seconds."})]})]})})]})}const ve=[{key:"allowDownloads",label:"Downloads",icon:st,description:"File downloads to local storage"},{key:"allowPrivateWindows",label:"Private windows",icon:At,description:"Open dedicated private windows"},{key:"allowGhostTabs",label:"Ghost tabs",icon:Pt,description:"Create ephemeral ghost tabs"},{key:"allowScreenshots",label:"Screenshots",icon:tt,description:"Capture browser screenshots"},{key:"allowClipping",label:"Clip text",icon:Ut,description:"Use web clipper to capture highlights"}],Ie={work:Ft,personal:be,default:rt};function Xe(r){return r.kind&&Ie[r.kind]?Ie[r.kind]:Ie.default}function ns(r){if(!r)return"Unknown policy";const i=ve.filter(({key:n})=>!r[n]);return i.length===0?"All capabilities enabled":i.length===ve.length?"Strict mode: most features disabled":`Restricted: ${i.map(n=>n.label.toLowerCase()).join(", ")}`}function os(r){return[...r].sort((i,n)=>{const f=+!!i.system,l=+!!n.system;if(f!==l)return l-f;const g=S=>{switch(S){case"work":return 0;case"personal":return 1;case"default":return 2;default:return 3}},y=g(i.kind)-g(n.kind);return y!==0?y:i.name.localeCompare(n.name)})}function Ve(r){if(r.color)return r.color;switch(r.kind){case"work":return"#4f46e5";case"personal":return"#f97316";default:return"#3b82f6"}}function ls(){const{profiles:r,activeProfileId:i,policies:n,loading:f,setActiveProfile:l,lastPolicyBlock:g,markPolicyMessageRead:y}=Oe(m=>({profiles:m.profiles,activeProfileId:m.activeProfileId,policies:m.policies,loading:m.loading,setActiveProfile:m.setActiveProfile,lastPolicyBlock:m.lastPolicyBlock,markPolicyMessageRead:m.markPolicyMessageRead})),[S,A]=a.useState(!1),[k,w]=a.useState(!1),[T,M]=a.useState(""),[V,H]=a.useState(null);a.useEffect(()=>{St()},[]),a.useEffect(()=>{!S&&k&&(w(!1),M(""))},[S,k]);const E=a.useMemo(()=>r.find(m=>m.id===i)??r[0],[r,i]),Z=a.useMemo(()=>os(r),[r]),F=async m=>{if(m===i){A(!1);return}try{H(m),await l(m),A(!1)}catch(R){console.error("Failed to switch profile",R)}finally{H(null)}},q=async()=>{const m=T.trim();if(m)try{await j.profiles.create({name:m}),await Oe.getState().loadProfiles(!0),w(!1),M("")}catch(R){console.error("Failed to create profile",R)}},O=!E||E.id==="default"||E.name.toLowerCase()==="default",te=!O,re=te?"gap-2 px-3":"gap-1.5 px-2.5";return e.jsxs("div",{className:"relative",children:[e.jsxs(P.button,{onClick:()=>A(m=>!m),whileHover:{scale:1.03},whileTap:{scale:.97},className:`flex items-center ${re} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`,title:E?`${E.name} profile`:"Profiles",children:[(()=>{const m=E?Xe(E):rt;return e.jsx(m,{size:16})})(),te&&e.jsx("span",{className:"text-sm font-medium",children:E?E.name:"Profiles"}),!O&&E&&e.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full border border-gray-900/40",style:{backgroundColor:Ve(E)}}),f&&e.jsx(ke,{size:14,className:"animate-spin text-gray-400"})]}),e.jsx(ue,{children:S&&e.jsxs(P.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:4},className:"absolute right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-800/60 rounded-xl shadow-2xl z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-gray-800/60 flex items-center justify-between",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Profiles"}),e.jsx("button",{onClick:()=>w(m=>!m),className:"p-1.5 rounded-md hover:bg-gray-800/60 text-gray-400 hover:text-gray-100 transition-colors",title:"Create new profile",children:e.jsx(Ee,{size:14})})]}),k&&e.jsxs("div",{className:"px-3 pb-3 border-b border-gray-800/60 space-y-2",children:[e.jsx("input",{value:T,onChange:m=>M(m.target.value),placeholder:"Profile name",className:"w-full px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onKeyDown:m=>{m.key==="Enter"?q():m.key==="Escape"&&(w(!1),M(""))}}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{w(!1),M("")},className:"text-xs text-gray-400 hover:text-gray-200",children:"Cancel"}),e.jsx("button",{onClick:q,className:"text-xs font-medium px-3 py-1.5 rounded-lg bg-blue-600 hover:bg-blue-500 text-white",children:"Create"})]})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto divide-y divide-gray-800/50",children:[Z.map(m=>{const R=Xe(m),D=m.id===i,K=n[m.id],Q=K?ve.filter(({key:_})=>!K[_]):[];return e.jsxs("button",{onClick:()=>F(m.id),className:`w-full text-left px-3 py-2 transition-colors ${D?"bg-blue-600/15 border-l-2 border-blue-500/60":"hover:bg-gray-800/60 border-l-2 border-transparent"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-200",children:[e.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full",style:{backgroundColor:Ve(m)}}),e.jsx(R,{size:16,className:"text-gray-300"}),e.jsx("span",{className:"text-sm font-medium flex-1 truncate",children:m.name}),D&&e.jsx(et,{size:14,className:"text-blue-400"}),V===m.id&&e.jsx(ke,{size:14,className:"animate-spin text-gray-400"})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500 line-clamp-2",children:m.description||ns(K)}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[ve.map(({key:_,label:J,icon:ae})=>{const ee=K?K[_]:!0;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[11px] border ${ee?"border-emerald-500/40 text-emerald-200 bg-emerald-500/10":"border-rose-500/40 text-rose-200 bg-rose-500/10 line-through decoration-rose-300/70"}`,title:ve.find(d=>d.key===_)?.description,children:[e.jsx(ae,{size:11}),J]},`${m.id}-${_}`)}),Q.length===0&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[11px] border border-emerald-400/40 text-emerald-200 bg-emerald-500/10",children:[e.jsx(oe,{size:11}),"Compliant"]})]})]},m.id)}),Z.length===0&&e.jsx("div",{className:"px-3 py-4 text-xs text-gray-500 text-center",children:"No profiles yet. Create one to get started."})]}),g&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-800/60 bg-amber-500/10 text-xs text-amber-200 flex items-start gap-2",children:[e.jsx(oe,{size:12,className:"mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-amber-100",children:"Action blocked by policy"}),e.jsxs("div",{className:"mt-1 text-amber-200/80",children:[g.action.replace("-"," ")," is disabled for this profile."]}),e.jsx("button",{onClick:y,className:"mt-2 text-[11px] text-amber-200 hover:text-amber-100 underline",children:"Dismiss"})]})]})]})})]})}const cs=[{key:"media",label:"Camera & microphone",description:"Allow access to audio / video input devices."},{key:"display-capture",label:"Screen capture",description:"Enable screen or window sharing requests."},{key:"notifications",label:"Desktop notifications",description:"Permit this container to show system notifications."},{key:"fullscreen",label:"Fullscreen & PIP",description:"Allow fullscreen transitions and picture-in-picture."}];function ds(){const{containers:r,activeContainerId:i,setContainers:n,setActiveContainer:f}=Je(),[l,g]=a.useState(!1),[y,S]=a.useState(!1),[A,k]=a.useState(""),[w,T]=a.useState("#22c55e"),[M,V]=a.useState({}),[H,E]=a.useState({}),Z=a.useCallback(async d=>{try{const x=await j.containers.getPermissions(d);return Array.isArray(x?.permissions)?x.permissions:[]}catch(x){return console.error("Failed to fetch container permissions:",x),[]}},[]),F=a.useCallback(async d=>{const x=await Z(d);V(C=>({...C,[d]:x}))},[Z]),q=a.useCallback(async d=>{try{const x=await j.containers.getSitePermissions(d);Array.isArray(x)&&E(C=>({...C,[d]:x}))}catch(x){console.error("Failed to load site permissions:",x)}},[]),O=a.useCallback(async()=>{try{const[d,x]=await Promise.all([j.containers.list(),j.containers.getActive()]);if(Array.isArray(d)){const C=d;n(C);const p=await Promise.all(C.map($=>Z($.id))),L={};C.forEach(($,I)=>{L[$.id]=p[I]??[]}),V(L)}x&&(f(x),await F(x.id),await q(x.id))}catch(d){console.error("Failed to load containers:",d)}},[Z,F,q,f,n]);a.useEffect(()=>{O()},[O]),a.useEffect(()=>{const d=Ye.on("containers:sitePermissions",x=>{x?.containerId&&E(C=>({...C,[x.containerId]:[...C[x.containerId]?.filter(p=>p.permission!==x.permission)??[],{permission:x.permission,origins:x.origins}]}))});return()=>{d()}},[]);const te=async d=>{try{const x=await j.containers.setActive(d.id);f(x||d),await F(d.id),await q(d.id),g(!1)}catch(x){console.error("Failed to set active container:",x)}},re=async()=>{if(A.trim())try{const d=await j.containers.create({name:A.trim(),color:w});d&&(await O(),await F(d.id),await q(d.id)),k(""),S(!1),g(!1)}catch(d){console.error("Failed to create container:",d)}},m=r.find(d=>d.id===i),R=m?M[m.id]??[]:[],D=m?H[m.id]??[]:[],K=d=>D.find(x=>x.permission===d)?.origins??[],Q=async d=>{if(!m)return;const x=R.includes(d);try{const C=await j.containers.setPermission(m.id,d,!x);V(p=>({...p,[m.id]:Array.isArray(C?.permissions)?C.permissions:[]})),await q(m.id)}catch(C){console.error("Failed to update container permission:",C)}},_=async(d,x)=>{if(m)try{const C=await j.containers.revokeSitePermission(m.id,d,x);Array.isArray(C)&&E(p=>({...p,[m.id]:C}))}catch(C){console.error("Failed to revoke site permission:",C)}},J=!m||m.id==="default"||m.name.toLowerCase()==="default",ae=!J,ee=ae?"gap-2 px-3":"gap-1.5 px-2.5";return e.jsxs("div",{className:"relative",children:[e.jsxs(P.button,{onClick:()=>g(!l),whileHover:{scale:1.05},whileTap:{scale:.95},className:`relative flex items-center ${ee} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`,title:"Container (isolated storage)",children:[e.jsx(It,{size:16}),ae&&e.jsx("span",{className:"text-sm font-medium",children:m?.name||"Default"}),!J&&m?.color&&e.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-700",style:{backgroundColor:m.color}})]}),e.jsx(ue,{children:l&&e.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-lg shadow-xl overflow-hidden z-40",children:[e.jsxs("div",{className:"p-3 border-b border-gray-800/50 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Containers"}),e.jsx("button",{onClick:()=>{S(!0),k(""),T("#22c55e")},className:"p-1.5 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-blue-400 transition-colors",children:e.jsx(Ee,{size:16})})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[y&&e.jsxs("div",{className:"p-3 border-b border-gray-800/50",children:[e.jsx("input",{type:"text",value:A,onChange:d=>k(d.target.value),placeholder:"Container name",autoFocus:!0,className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Color"}),e.jsx("input",{type:"color",value:w,onChange:d=>T(d.target.value),className:"h-7 w-16 bg-transparent border border-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:re,className:"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white",children:"Create"}),e.jsx("button",{onClick:()=>{S(!1),k("")},className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm text-gray-300",children:"Cancel"})]})]}),r.map(d=>{const x=d.id===i;return e.jsxs("button",{onClick:()=>te(d),className:`w-full flex items-center gap-3 px-3 py-2 text-left border-b border-gray-800/50 transition-colors ${x?"bg-blue-600/20 border-blue-500/30":"hover:bg-gray-800/50"}`,children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-700",style:{backgroundColor:d.color}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-200 truncate",children:d.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:d.scope?`${d.scope.charAt(0).toUpperCase()}${d.scope.slice(1)} scope`:"Session scope"})]}),x&&e.jsx("span",{className:"text-xs text-blue-400",children:"Active"})]},d.id)}),r.length===0&&!y&&e.jsx("div",{className:"p-3 text-xs text-gray-500",children:"No containers yet"})]}),m&&e.jsxs("div",{className:"border-t border-gray-800/50 bg-gray-900/60 p-3",children:[e.jsxs("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:["Permissions for ",m.name]}),e.jsx("div",{className:"mt-3 space-y-3",children:cs.map(d=>{const x=R.includes(d.key);return e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-transparent px-2 py-2 hover:border-gray-700/60 hover:bg-gray-800/40 transition-colors cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 rounded border-gray-600 bg-gray-800 text-blue-500 focus:ring-blue-500",checked:x,onChange:()=>Q(d.key)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-200",children:d.label}),e.jsx("p",{className:"text-xs text-gray-500 leading-snug",children:d.description}),K(d.key).length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:"Allowed sites"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:K(d.key).map(C=>e.jsxs("span",{className:"group inline-flex items-center gap-2 rounded-full border border-gray-700 bg-gray-800/60 px-2 py-0.5 text-[11px] text-gray-300",title:C,children:[e.jsx("span",{className:"max-w-[140px] truncate",children:C.replace(/^https?:\/\//,"")}),e.jsx("button",{type:"button",onClick:p=>{p.preventDefault(),p.stopPropagation(),_(d.key,C)},className:"rounded-full bg-transparent p-0.5 text-gray-500 hover:bg-gray-700 hover:text-gray-200 transition-colors","aria-label":`Remove ${C} from ${d.label}`,children:"×"})]},`${d.key}-${C}`))})]})]})]},d.key)})})]}),e.jsx("div",{className:"p-3 border-t border-gray-800/50 bg-gray-900/50",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Containers isolate cookies, storage, and login state per tab."})})]})})]})}const ot="omnibrowser:theme-preference",Ne=typeof window<"u",Ce=()=>!Ne||typeof window.matchMedia!="function"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",Re=r=>{if(typeof document>"u")return;const i=r==="system"?Ce():r;document.documentElement.dataset.theme=i,document.documentElement.setAttribute("data-theme-resolved",i)},je=(()=>{if(!Ne)return"system";const r=window.localStorage.getItem(ot);return r==="light"||r==="dark"||r==="system"?r:"system"})(),us=je==="system"?Ce():je;typeof document<"u"&&Re(je);const xe=ut((r,i)=>({preference:je,resolved:us,setPreference:n=>{Ne&&window.localStorage.setItem(ot,n),Re(n);const f=n==="system"?Ce():n;r({preference:n,resolved:f})},cyclePreference:()=>{const n=["system","light","dark"],f=i().preference,l=n[(n.indexOf(f)+1)%n.length];i().setPreference(l)}}));if(Ne&&typeof window.matchMedia=="function"){const r=window.matchMedia("(prefers-color-scheme: dark)"),i=()=>{const{preference:n}=xe.getState();if(n==="system"){Re("system");const f=Ce();xe.setState({resolved:f})}};try{r.addEventListener("change",i)}catch{r.addListener(i)}}const ps=[{id:"system",label:"Auto",icon:Et},{id:"light",label:"Light",icon:Tt},{id:"dark",label:"Dark",icon:Wt}];function ms(){const r=xe(l=>l.preference),i=xe(l=>l.resolved),n=xe(l=>l.setPreference),f=xe(l=>l.cyclePreference);return e.jsx(Yt,{id:"theme-switcher",children:e.jsx("div",{className:"no-drag button-surface px-2 py-1.5 rounded-lg flex items-center gap-1 text-[11px]",role:"radiogroup","aria-label":"Theme preference",title:`Theme: ${r==="system"?`Auto (${i})`:r}`,onDoubleClick:f,children:ps.map(l=>{const g=l.icon,y=r===l.id||r==="system"&&l.id===i;return e.jsxs(P.button,{type:"button",onClick:()=>n(l.id),whileHover:{scale:1.05},whileTap:{scale:.95},className:`relative flex items-center gap-1 px-2.5 py-1 rounded-md transition-all duration-150 text-xs font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:ring-offset-transparent ${y?"theme-pill-active":"theme-pill"}`,role:"radio","aria-checked":y,children:[e.jsx(g,{size:13}),e.jsx("span",{className:"hidden sm:inline",children:l.label}),y&&e.jsx(P.span,{layoutId:"theme-pill-indicator",className:"absolute inset-0 -z-10 rounded-md bg-blue-500/15 border border-blue-500/40",transition:{type:"spring",stiffness:400,damping:40}})]},l.id)})})})}const fs=15e3;function hs(r){switch(r){case"high":return"bg-red-500/80 text-white";case"moderate":return"bg-amber-500/80 text-white";default:return"bg-emerald-500/80 text-white"}}function ys(r){switch(r){case"high":return"High risk";case"moderate":return"Watch";default:return"Clean"}}function xs(){const r=ge(k=>k.activeId),[i,n]=a.useState(null),[f,l]=a.useState(!1),g=a.useCallback(async()=>{if(!r){n(null);return}l(!0);try{const k=await j.privacy.sentinel.audit(r);n(k??null)}catch(k){console.warn("[PrivacySentinel] audit failed",k)}finally{l(!1)}},[r]);a.useEffect(()=>{g()},[g]),a.useEffect(()=>{if(!r)return;const k=window.setInterval(g,fs);return()=>window.clearInterval(k)},[r,g]);const y=a.useMemo(()=>f?"Scanning…":i?ys(i.grade):"No data",[i,f]),S=a.useMemo(()=>{if(!i)return"Privacy Sentinel has no data for this tab yet.";const k=[i.message];return i.trackers.length>0&&k.push(`Trackers: ${i.trackers.slice(0,3).map(w=>w.host).join(", ")}`),i.thirdPartyHosts.length>0&&k.push(`3rd-party: ${i.thirdPartyHosts.slice(0,3).map(w=>w.host).join(", ")}`),k.push(...i.suggestions),k.join(`
`)},[i]),A=i?hs(i.grade):"bg-slate-500/70 text-white";return e.jsxs("button",{type:"button",className:`no-drag flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium transition-colors ${A}`,title:S,onClick:g,children:[e.jsx("span",{className:"inline-flex h-2 w-2 items-center justify-center",children:e.jsx("span",{className:"h-2 w-2 rounded-full bg-current"})}),e.jsx("span",{children:y})]})}function gs(){const{activeId:r}=ge(),[i,n]=a.useState(!1),[f,l]=a.useState(null),[g,y]=a.useState({ads:!0,cookies:"3p",httpsOnly:!1,fingerprinting:!0,scripts:"all",webrtc:!0}),[S,A]=a.useState(0);ne("shields:counters",w=>{(!w.tabId||w.tabId===""||w.tabId===r)&&(l(w),A((w.ads||0)+(w.trackers||0)+(w.cookiesBlocked||0)))},[r]),a.useEffect(()=>{},[r]);const k=async(w,T)=>{const M={...g,[w]:T};y(M)};return e.jsxs("div",{className:"relative",children:[e.jsxs(P.button,{"data-shields-button":!0,onClick:()=>n(!i),whileHover:{scale:1.05},whileTap:{scale:.95},className:`
          relative flex items-center gap-2 px-3 py-1.5 rounded-lg
          bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50
          text-gray-300 hover:text-gray-100 transition-colors
        `,children:[e.jsx(oe,{size:16,className:S>0?"text-blue-400":"text-gray-500"}),S>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-500/20 text-blue-400 text-xs font-medium rounded",children:S}),e.jsx(Le,{size:14,className:`transition-transform ${i?"rotate-180":""}`})]}),e.jsx(ue,{children:i&&e.jsxs(e.Fragment,{children:[e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40",onClick:()=>n(!1)}),e.jsxs(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full right-0 mt-2 w-80 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl z-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Shields"}),f&&e.jsxs("div",{className:"text-xs text-gray-400",children:[f.ads," ads · ",f.trackers," trackers · ",f.httpsUpgrades," upgraded"]})]}),f&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[e.jsxs("div",{className:"bg-gray-800/40 rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-400",children:f.ads}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ads Blocked"})]}),e.jsxs("div",{className:"bg-gray-800/40 rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-orange-400",children:f.trackers}),e.jsx("div",{className:"text-xs text-gray-500",children:"Trackers"})]}),e.jsxs("div",{className:"bg-gray-800/40 rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-400",children:f.httpsUpgrades}),e.jsx("div",{className:"text-xs text-gray-500",children:"HTTPS"})]})]})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[[{key:"ads",label:"Block ads & trackers",icon:oe},{key:"fingerprinting",label:"Anti-fingerprinting",icon:oe},{key:"webrtc",label:"Block WebRTC leaks",icon:oe}].map(({key:w,label:T})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:T}),e.jsx("button",{onClick:()=>k(w,!g[w]),className:`
                        relative w-11 h-6 rounded-full transition-colors
                        ${g[w]?"bg-blue-600":"bg-gray-700"}
                      `,children:e.jsx(P.div,{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm",animate:{x:g[w]?20:0},transition:{type:"spring",stiffness:500,damping:30}})})]},w)),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"3rd-party cookies"}),e.jsxs("select",{value:g.cookies,onChange:w=>k("cookies",w.target.value),className:"bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs text-gray-300",children:[e.jsx("option",{value:"all",children:"Allow"}),e.jsx("option",{value:"3p",children:"Block 3P"}),e.jsx("option",{value:"none",children:"Block All"})]})]})]})]})]})})]})}function bs(){const[r,i]=a.useState(!1),[n,f]=a.useState({doh:{enabled:!1,provider:"cloudflare"}});ne("net:status",y=>{f(y)},[]),a.useEffect(()=>{const y=async()=>{if(!window.ipc||typeof window.ipc.invoke!="function"){setTimeout(y,500);return}try{const S=await j.dns.status();f(A=>({...A,doh:S}))}catch{}};setTimeout(y,300)},[]);const l=async()=>{try{await j.tor.newIdentity()}catch(y){console.error("Failed to get new Tor identity:",y)}},g=n.tor?.circuitEstablished||n.vpn?.connected||n.proxy?.enabled;return e.jsxs("div",{className:"relative",children:[e.jsxs(P.button,{"data-network-button":!0,onClick:()=>i(!r),whileHover:{scale:1.05},whileTap:{scale:.95},className:`
          relative flex items-center gap-2 px-3 py-1.5 rounded-lg
          bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50
          text-gray-300 hover:text-gray-100 transition-colors
        `,children:[e.jsx(he,{size:16,className:g?"text-green-400":"text-gray-500"}),g&&e.jsx(P.div,{className:"w-2 h-2 bg-green-400 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0}}),e.jsx(Le,{size:14,className:`transition-transform ${r?"rotate-180":""}`})]}),e.jsx(ue,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40",onClick:()=>i(!1)}),e.jsx(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl z-50",children:e.jsxs("div",{className:"p-4 space-y-4",children:[n.tor&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:16,className:"text-purple-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Tor"})]}),n.tor.circuitEstablished?e.jsx(we,{size:16,className:"text-green-400"}):e.jsx(Ae,{size:16,className:"text-red-400"})]}),n.tor.enabled&&n.tor.circuitEstablished&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:["Identity: ",n.tor.identity.slice(0,8),"..."]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-3 py-1.5 bg-purple-600/20 hover:bg-purple-600/30 border border-purple-500/30 rounded text-xs text-purple-300 transition-colors",children:[e.jsx(Te,{size:14}),"New Identity"]})]})]}),n.vpn&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:16,className:"text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"VPN"})]}),n.vpn.connected?e.jsx(we,{size:16,className:"text-green-400"}):e.jsx(Ae,{size:16,className:"text-gray-500"})]}),n.vpn.provider&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Provider: ",n.vpn.provider]})]}),n.proxy&&n.proxy.enabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:16,className:"text-cyan-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Proxy"})]}),e.jsx(we,{size:16,className:"text-green-400"})]}),n.proxy.host&&e.jsxs("div",{className:"text-xs text-gray-400",children:[n.proxy.type.toUpperCase(),": ",n.proxy.host]})]}),n.doh&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:16,className:"text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"DNS-over-HTTPS"})]}),n.doh.enabled?e.jsx(we,{size:16,className:"text-green-400"}):e.jsx(Ae,{size:16,className:"text-gray-500"})]}),n.doh.enabled&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Provider: ",n.doh.provider]})]})]})})]})})]})}function or({onAgentToggle:r,onCommandPalette:i,onClipperToggle:n,onReaderToggle:f}){const{activeId:l}=ge(),g=Qe(t=>t.mode),y=Ze(),S=ze(t=>t.toggle),A=ze(t=>t.open),k=mt(t=>t.reset),w=ft(t=>t.open),T=me(t=>t.tor),M=me(t=>t.vpn),V=me(t=>t.startTor),H=me(t=>t.stopTor),E=me(t=>t.newTorIdentity),Z=me(t=>t.checkVpn),[F,q]=a.useState(!1),[O,te]=a.useState(!1),[re,m]=a.useState(!1),[R,D]=a.useState(0),[K,Q]=a.useState(!1),[_,J]=a.useState(null),[ae,ee]=a.useState({browse:!1,ai:!1,tools:!1,security:!1}),d=a.useRef({browse:null,ai:null,tools:null,security:null}),x=a.useCallback(t=>{const c=d.current[t];c&&(clearTimeout(c),d.current[t]=null)},[]),C=a.useCallback(t=>{x(t),ee({browse:!1,ai:!1,tools:!1,security:!1}),ee(c=>({...c,[t]:!0})),d.current[t]=setTimeout(()=>{ee(c=>({...c,[t]:!1})),d.current[t]=null},220)},[x]),p=a.useCallback(()=>{J(null),ee({browse:!1,ai:!1,tools:!1,security:!1}),Object.keys(d.current).forEach(t=>x(t))},[x]),L=a.useCallback(t=>{J(c=>c===t?(x(t),ee({browse:!1,ai:!1,tools:!1,security:!1}),null):(C(t),t))},[x,C]),$=a.useRef({activeId:l??null,canGoBack:!1,canGoForward:!1}),I=a.useRef(null);a.useEffect(()=>{$.current={activeId:l??null,canGoBack:F,canGoForward:O}},[l,F,O]),a.useEffect(()=>{const t=c=>{(c.metaKey||c.ctrlKey)&&c.shiftKey&&c.key.toLowerCase()==="g"&&(c.preventDefault(),S())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[S]),a.useEffect(()=>()=>{I.current&&(clearTimeout(I.current),I.current=null),Object.keys(d.current).forEach(t=>x(t))},[x]),a.useEffect(()=>{if(!_)return;const t=v=>{v.key==="Escape"&&p()},c={capture:!0};return window.addEventListener("keydown",t,c),()=>window.removeEventListener("keydown",t,c)},[_,p]),ne("downloads:started",()=>{D(t=>t+1)},[]),ne("downloads:done",()=>{D(t=>Math.max(0,t-1))},[]),ne("downloads:progress",()=>{},[]),ne("agent:plan",()=>{Q(!0)},[]),a.useEffect(()=>{const t=async()=>{if(!window.ipc||typeof window.ipc.invoke!="function"){setTimeout(t,500);return}try{const c=await j.downloads.list(),v=Array.isArray(c)?c.filter(G=>G.status==="in-progress").length:0;D(v)}catch{}};setTimeout(t,300)},[]);const W=a.useCallback(async()=>{const{activeId:t}=$.current;if(t)try{await j.tabs.goBack(t)}catch(c){console.error("Failed to go back:",c)}},[]),de=a.useCallback(async()=>{const{activeId:t}=$.current;if(t)try{await j.tabs.goForward(t)}catch(c){console.error("Failed to go forward:",c)}},[]),le=a.useCallback(async()=>{const{activeId:t}=$.current;if(t){I.current&&(clearTimeout(I.current),I.current=null),m(!0);try{await j.tabs.reload(t),I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{m(!1),I.current=null},1e3)}catch(c){console.error("Failed to refresh:",c),m(!1)}}},[]);a.useEffect(()=>{const t=c=>{const{activeId:v,canGoBack:G,canGoForward:z}=$.current,ie=navigator.platform.toUpperCase().indexOf("MAC")>=0?c.metaKey:c.ctrlKey,$e=c.altKey,Se=c.target;if(!(Se.tagName==="INPUT"||Se.tagName==="TEXTAREA"||Se.isContentEditable)){if((ie||$e)&&c.key==="ArrowLeft"&&!c.shiftKey){G&&v&&(c.preventDefault(),W());return}if((ie||$e)&&c.key==="ArrowRight"&&!c.shiftKey){z&&v&&(c.preventDefault(),de());return}if(ie&&c.key.toLowerCase()==="r"&&!c.shiftKey){v&&(c.preventDefault(),le());return}if(c.key==="F5"&&v&&(c.preventDefault(),le()),ie&&(c.key==="+"||c.key==="=")&&v){c.preventDefault(),j.tabs.zoomIn(v).catch(console.error);return}if(ie&&c.key==="-"&&v){c.preventDefault(),j.tabs.zoomOut(v).catch(console.error);return}if(ie&&c.key==="0"&&v){c.preventDefault(),j.tabs.zoomReset(v).catch(console.error);return}if(c.key==="F12"||ie&&c.shiftKey&&c.key.toLowerCase()==="i"){v&&(c.preventDefault(),j.tabs.devtools(v).catch(console.error));return}}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[W,de,le]),ne("tabs:navigation-state",t=>{t.tabId===l&&(q(t.canGoBack),te(t.canGoForward))},[l]),a.useEffect(()=>{if(!l){q(!1),te(!1);return}(async()=>{try{await j.tabs.list()}catch(c){console.error("Failed to update navigation state:",c)}})()},[l]);const pe=async()=>{if(l)try{const t=await j.tabs.screenshot(l);t?.success?console.log("Screenshot saved:",t.path):console.error("Screenshot failed:",t?.error)}catch(t){console.error("Failed to capture screenshot:",t)}},s=async()=>{if(l)try{const t=await j.tabs.pip(l,!0);t?.success||console.warn("PIP request failed:",t?.error||"No video element found")}catch(t){console.error("Failed to enter PIP:",t)}},o=a.useCallback(async()=>{if(l)try{await j.tabs.find(l)}catch(t){console.error("Failed to open find:",t)}},[l]),u=a.useCallback(async()=>{if(l)try{await j.tabs.devtools(l)}catch(t){console.error("Failed to toggle DevTools:",t)}},[l]),h=a.useCallback(t=>{if(t.type!=="item"||t.disabled)return;const c=t.onSelect();c&&typeof c.then=="function"?c.catch(v=>{console.error(`Failed to run menu action "${t.key}"`,v)}).finally(()=>p()):p()},[p]),N=typeof navigator<"u"&&navigator.platform?.toUpperCase().includes("MAC"),b=a.useMemo(()=>{const t={"knowledge-graph":{type:"item",key:"knowledge-graph",icon:He,label:"Research Graph",onSelect:()=>y("/")},"history-graph":{type:"item",key:"history-graph",icon:Pe,label:"History Graph",onSelect:()=>y("/history")},workspaces:{type:"item",key:"workspaces",icon:Be,label:"Workspace Library",onSelect:()=>y("/workspace")},playbooks:{type:"item",key:"playbooks",icon:wt,label:"Auto-Research Playbooks",onSelect:()=>y("/playbooks")},"automation-runs":{type:"item",key:"automation-runs",icon:Rt,label:"Automation Runs",onSelect:()=>y("/runs")},consent:{type:"item",key:"consent-ledger",icon:oe,label:"Consent Ledger",onSelect:()=>void w()},"tab-graph":{type:"item",key:"tab-graph",icon:He,label:"Tab DNA Overlay",onSelect:()=>void A()}},c={Research:{label:"Research Focus",description:"Suggested graph + consent tooling",keys:["knowledge-graph","tab-graph","consent"]},Trade:{label:"Trade Focus",description:"Stay ahead of market changes",keys:["history-graph","playbooks","automation-runs"]},Games:{label:"Gaming Focus",description:"Keep streams and overlays lean",keys:["tab-graph","history-graph"]},Browse:{label:"Everyday Focus",description:"Quick jump to your spaces",keys:["workspaces","history-graph","knowledge-graph"]}},v=c[g]??c.Browse,G=new Set,z=[];return z.push({type:"section",key:"persona-section",label:v.label,description:v.description}),v.keys.forEach(ce=>{const ie=t[ce];ie&&!G.has(ce)&&(z.push(ie),G.add(ce))}),z.push({type:"divider",key:"persona-divider"}),z.push({type:"section",key:"all-tools",label:"All workspace tools"}),Object.entries(t).forEach(([ce,ie])=>{G.has(ce)||(z.push(ie),G.add(ce))}),z},[g,y,w,A]),U=[{type:"item",key:"find",icon:fe,label:"Find in Page",shortcut:N?"⌘ F":"Ctrl F",disabled:!l,onSelect:o},{type:"item",key:"screenshot",icon:tt,label:"Capture Screenshot",disabled:!l,onSelect:pe},{type:"item",key:"pip",icon:Kt,label:"Picture-in-Picture",disabled:!l,onSelect:s},{type:"item",key:"devtools",icon:Ot,label:"Toggle DevTools",shortcut:N?"⌘ ⇧ I":"Ctrl ⇧ I",disabled:!l,onSelect:u},{type:"divider",key:"tools-divider"},{type:"item",key:"guided-tour",icon:be,label:"Run Guided Tour",onSelect:()=>{k()}},{type:"item",key:"watchers",icon:zt,label:"Page Watchers",onSelect:()=>{y("/watchers")}},{type:"item",key:"history",icon:Pe,label:"History",onSelect:()=>{y("/history")}},{type:"item",key:"tab-graph",icon:he,label:"Tab Graph Overlay",shortcut:N?"⌘⇧G":"Ctrl⇧G",onSelect:()=>{A()}},{type:"item",key:"consent-dashboard",icon:oe,label:"Consent Playground",onSelect:()=>{w()}}],B=[{type:"item",key:"agent-console",icon:We,label:"Open Agent Console",shortcut:N?"⌘⇧A":"Ctrl+Shift+A",onSelect:()=>r()},{type:"item",key:"ask-agent",icon:be,label:"Ask Agent",shortcut:N?"⌘K":"Ctrl+K",onSelect:()=>i()},{type:"divider",key:"agent-divider"},{type:"item",key:"clip-highlight",icon:kt,label:"Clip Highlight",shortcut:N?"⌘⇧H":"Ctrl+Shift+H",onSelect:()=>n()},{type:"item",key:"reader-mode",icon:Be,label:"Reader Mode",shortcut:N?"⌘⇧R":"Ctrl+Shift+R",onSelect:()=>f()}],X=[{type:"item",key:"privacy-shields",icon:oe,label:"Privacy Shields",onSelect:()=>{document.querySelector("[data-shields-button]")?.click()}},{type:"item",key:"network-controls",icon:Me,label:"Network Controls",onSelect:()=>{document.querySelector("[data-network-button]")?.click()}},{type:"item",key:"tor-toggle",icon:oe,label:T.running?"Disable Tor":"Enable Tor",onSelect:()=>{T.running?H():V()}},{type:"item",key:"tor-new-identity",icon:Te,label:"Tor: New Identity",disabled:!T.running||!!T.stub,onSelect:()=>{T.running&&!T.stub&&E()}},{type:"item",key:"vpn-status",icon:Me,label:M.connected?`VPN: ${M.type?M.type.toUpperCase():"Active"}`:"Check VPN Status",onSelect:()=>{Z()}},{type:"divider",key:"security-divider"},{type:"item",key:"history-graph",icon:Pe,label:"History Graph",onSelect:()=>y("/history")}],se=(t,c,v)=>{const G=_===t;return e.jsxs("div",{className:"relative",children:[e.jsxs(P.button,{type:"button",onClick:()=>L(t),"aria-expanded":G,"aria-haspopup":"true",whileHover:{scale:1.05},whileTap:{scale:.95},className:`button-surface flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm ${G?"button-surface--active text-primary":"text-muted"}`,title:`${c} menu`,children:[e.jsx("span",{children:c}),e.jsx(Le,{size:14,className:`transition-transform ${G?"rotate-180":""}`})]}),e.jsx(ue,{children:G&&e.jsxs(e.Fragment,{children:[e.jsx(P.button,{type:"button","aria-label":`Close ${c} menu`,className:"fixed inset-0 z-40 bg-transparent pointer-events-auto focus:outline-none",onClick:p,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},`${t}-backdrop`),e.jsx(P.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-60 bg-surface-elevated border border-surface rounded-lg shadow-2xl z-50 py-2",children:ae[t]?e.jsx("div",{className:"space-y-2 px-3 py-2",children:Array.from({length:4}).map((z,ce)=>e.jsx("div",{className:"h-8 rounded-md bg-slate-800/70 animate-pulse"},`skeleton-${t}-${ce}`))}):v.map(z=>z.type==="divider"?e.jsx("div",{className:"h-px my-1 bg-[var(--surface-border)]/60"},z.key):z.type==="section"?e.jsxs("div",{className:"px-4 pt-1 pb-2 text-[10px] uppercase tracking-[0.24em] text-muted",children:[e.jsx("div",{children:z.label}),z.description&&e.jsx("div",{className:"mt-1 text-[10px] normal-case tracking-normal text-muted/80",children:z.description})]},z.key):e.jsxs("button",{type:"button",disabled:z.disabled,onClick:()=>h(z),className:"menu-item w-full",children:[e.jsx(z.icon,{size:16,className:"text-muted"}),e.jsx("span",{className:"flex-1 text-left",children:z.label}),z.shortcut&&e.jsx("kbd",{className:"text-xs text-muted border border-surface rounded px-1.5 py-0.5",children:z.shortcut})]},z.key))},`${t}-menu`)]})})]},t)};return e.jsxs("div",{className:"drag h-14 flex items-center px-4 gap-4 bg-surface-panel border-b border-surface shadow-lg text-primary transition-colors",children:[e.jsxs("div",{className:"no-drag flex items-center gap-2",children:[e.jsx(es,{}),e.jsx(is,{}),e.jsxs("div",{className:"hidden xl:flex items-center gap-2",children:[e.jsx(ls,{}),e.jsx(ds,{})]})]}),e.jsxs("div",{className:"no-drag flex items-center gap-1.5 flex-shrink-0",children:[e.jsx(P.button,{onClick:()=>y("/"),"aria-label":"Go to home",whileHover:{scale:1.05},whileTap:{scale:.95},className:"no-drag p-2.5 rounded-lg button-surface hover:text-primary",title:"Home (Go to home screen)",children:e.jsx(Bt,{size:18})}),e.jsx(P.button,{onClick:W,disabled:!F||!l,"aria-label":"Go back","aria-disabled":!F||!l,whileHover:{scale:F&&l?1.05:1},whileTap:{scale:F&&l?.95:1},className:`no-drag p-2.5 rounded-lg button-surface ${F&&l?"hover:text-primary":"opacity-40 cursor-not-allowed"}`,title:"Back (Alt+← / ⌘←)",children:e.jsx(Mt,{size:18})}),e.jsx(P.button,{onClick:de,disabled:!O||!l,"aria-label":"Go forward","aria-disabled":!O||!l,whileHover:{scale:O&&l?1.05:1},whileTap:{scale:O&&l?.95:1},className:`no-drag p-2.5 rounded-lg button-surface ${O&&l?"hover:text-primary":"opacity-40 cursor-not-allowed"}`,title:"Forward (Alt+→ / ⌘→)",children:e.jsx($t,{size:18})}),e.jsx(P.button,{onClick:le,disabled:!l,"aria-label":"Refresh page","aria-disabled":!l,whileHover:{scale:l?1.05:1},whileTap:{scale:l?.95:1},className:`no-drag p-2.5 rounded-lg button-surface ${l?"hover:text-primary":"opacity-40 cursor-not-allowed"}`,title:"Refresh (Ctrl+R / ⌘R)",children:e.jsx(P.div,{animate:{rotate:re?360:0},transition:{duration:1,repeat:re?1/0:0,ease:"linear"},className:"flex items-center justify-center",children:e.jsx(Te,{size:18})})})]}),e.jsxs("div",{className:"no-drag flex-1 relative mx-4","data-onboarding":"omnibox",children:[e.jsx(rs,{onCommandPalette:i}),e.jsx(as,{})]}),e.jsxs("div",{className:"no-drag flex items-center gap-1.5",children:[se("ai","AI",B),se("browse","Browse",b),se("tools","Tools",U),se("security","Security",X),e.jsx(xs,{}),e.jsx(ms,{}),e.jsxs("div",{className:"hidden 2xl:flex items-center gap-1.5",children:[e.jsx(gs,{}),e.jsx(bs,{})]}),e.jsxs(P.button,{onClick:()=>{y("/downloads")},"aria-label":`Downloads${R>0?` (${R} active)`:""}`,whileHover:{scale:1.05},whileTap:{scale:.95},className:"no-drag relative p-2 rounded-lg button-surface hover:text-primary",title:`Downloads${R>0?` (${R} active)`:""}`,children:[e.jsx(st,{size:18}),R>0&&e.jsx(P.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-bold","aria-label":`${R} active download${R>1?"s":""}`,children:R>9?"9+":R})]}),e.jsx(P.button,{onClick:()=>y("/settings"),"aria-label":"Open settings",whileHover:{scale:1.05},whileTap:{scale:.95},className:"no-drag p-2 rounded-lg button-surface hover:text-primary",title:"Settings",children:e.jsx(Lt,{size:18})}),e.jsxs(P.button,{onClick:r,"aria-label":`Agent console${K?" (active)":""}`,whileHover:{scale:1.05},whileTap:{scale:.95},className:`no-drag p-2 rounded-lg button-surface ${K?"button-surface--active shadow-[0_0_18px_rgba(59,130,246,0.35)] text-primary":"hover:text-primary"}`,title:"Agent Console (⌘⇧A)",children:[e.jsx(We,{size:18}),K&&e.jsx(P.span,{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-green-400 rounded-full border-2 border-gray-900",animate:{scale:[1,1.2,1],opacity:[1,.8,1]},transition:{duration:2,repeat:1/0},"aria-label":"Agent is active"})]})]})]})}export{or as TopNav};
//# sourceMappingURL=TopNav-D0Oba9Rq.js.map

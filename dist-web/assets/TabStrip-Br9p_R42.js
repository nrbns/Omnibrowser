import{R as Ne,r as u,j as t,i as A,a as Ie,b as Ce}from"./index-DMKJqC5Z.js";import{u as me,c as Se}from"./formatDistanceToNow-CwTn1k5x.js";import{i as J}from"./ipc-events-B-mtt1te.js";import{A as fe}from"./index-BE3YK0eV.js";import{m as H}from"./proxy-B-PlLRqe.js";import{u as Pe}from"./profileStore-r6TNFURV.js";import{u as Ee}from"./containerStore-4g5QdXcB.js";import{E as ve}from"./eye-CLZIWIZg.js";import{C as Re}from"./copy-DdRvNS-U.js";import{G as De,S as Me,B as ge}from"./sun-DXqxPM3_.js";import{c as ye}from"./createLucideIcon-BHoZ2X8H.js";import{C as Fe}from"./clock-CAio9RVc.js";import{M as He}from"./moon-star-BJaCkZ8v.js";import{P as $e}from"./Portal-DMoOea_i.js";import{u as ze}from"./AppShell-DKPxPuWD.js";import{C as Le}from"./circle-play-DjXo3Y2F.js";import{S as _e}from"./sparkles-C9aT6jfb.js";import{X as Ge}from"./x-GAlOzW-g.js";import{P as Be}from"./plus-BEevIG6L.js";import"./use-ipc-event-BWqwbbDc.js";import"./globe-B55P551M.js";import"./triangle-alert-BHl0FKa7.js";const Oe=ye("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);const Ke=ye("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),we=Ne.forwardRef(({tabId:i,children:a},c)=>{const[s,g]=u.useState(!1),[w,$]=u.useState(null),z=me(R=>R.tabs).find(R=>R.id===i);return u.useEffect(()=>{s&&z&&$({title:z.title||"New Tab",url:z.url||"about:blank"})},[s,z]),t.jsxs("div",{ref:c,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),className:"relative",style:{pointerEvents:"auto"},onClick:R=>{R.target===R.currentTarget&&R.stopPropagation()},children:[a,t.jsx(fe,{children:s&&w&&t.jsxs(H.div,{initial:{opacity:0,scale:.95,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:10},className:"absolute bottom-full left-0 mb-2 bg-gray-800 border border-gray-700 rounded-lg shadow-2xl z-[40] w-80 p-4",onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),onClick:R=>R.stopPropagation(),onMouseDown:R=>R.stopPropagation(),style:{pointerEvents:"auto"},children:[w.thumbnail&&t.jsx("img",{src:w.thumbnail,alt:w.title,className:"w-full h-32 object-cover rounded mb-2"}),t.jsx("div",{className:"text-sm font-medium text-gray-200 mb-1 truncate",children:w.title}),t.jsx("div",{className:"text-xs text-gray-400 truncate",children:w.url})]})})]})});we.displayName="TabHoverCard";const We=we,ue=Se((i,a)=>({visible:!1,tab:null,open:c=>i({visible:!0,tab:c}),close:()=>i({visible:!1,tab:null}),sync:c=>{const s=a().tab;s?.id===c.id&&i({tab:{...s,...c}})}}));function Ue({tabId:i,url:a,containerId:c,containerName:s,containerColor:g,mode:w,sleeping:$,onClose:P}){const[z,R]=u.useState({x:0,y:0}),K=u.useRef(null),B=Pe(n=>n.policies[n.activeProfileId]),Q=B?!B.allowGhostTabs:!1,ae=B?!B.allowPrivateWindows:!1,{containers:W,setContainers:ie}=Ee(n=>({containers:n.containers,setContainers:n.setContainers})),D=me(n=>n.tabs.find(j=>j.id===i)),oe=ue(n=>n.open),Z=$??D?.sleeping??!1;u.useEffect(()=>{const n=j=>{K.current&&!K.current.contains(j.target)&&P()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[P]),u.useEffect(()=>{const n=window.__lastContextMenuPos||{x:0,y:0};R({x:n.x,y:n.y})},[]),u.useEffect(()=>{W.length===0&&A.containers.list().then(n=>{Array.isArray(n)&&ie(n)}).catch(n=>{console.error("Failed to load containers for context menu:",n)})},[W.length,ie]);const L=()=>({id:D?.id??i,title:D?.title??D?.url??a??"New Tab",url:D?.url??a??"about:blank",containerId:D?.containerId??c,containerName:D?.containerName??s,containerColor:D?.containerColor??g,mode:D?.mode??w,createdAt:D?.createdAt,lastActiveAt:D?.lastActiveAt,sessionId:D?.sessionId,profileId:D?.profileId,sleeping:D?.sleeping??$??!1}),se=async()=>{if(!Q)try{await A.private.createGhostTab({url:a}),P()}catch(n){console.error("Failed to open as ghost:",n)}},O=async()=>{try{confirm("Burn this tab? All data will be permanently deleted.")&&(await A.tabs.burn(i),P())}catch(n){console.error("Failed to burn tab:",n)}},U=async()=>{if(ae)return;const n=prompt("Auto-close after (minutes):","10");if(n)try{const j=parseInt(n)*60*1e3;await A.private.createWindow({url:a,autoCloseAfter:j}),P()}catch(j){console.error("Failed to start timer:",j)}},ee=async(n,j=!0)=>{try{await A.tabs.create({url:a||"about:blank",containerId:n??c,activate:j}),P()}catch(te){console.error("Failed to duplicate tab:",te)}},_=async n=>{if(!n||n===c){P();return}try{const j=await A.tabs.setContainer(i,n);j?.success||console.warn("Failed to switch container:",j?.error)}catch(j){console.error("Failed to switch tab container:",j)}finally{P()}},M=()=>{oe(L()),P()},h=async()=>{try{await A.tabs.wake(i),P()}catch(n){console.error("Failed to wake tab:",n)}},V=w==="ghost",X=w==="private",x=[{icon:ve,label:"Peek preview",action:M},{icon:Re,label:"Duplicate Tab",action:()=>ee(c,!0),disabled:V||X},{icon:De,label:"Open as Ghost",action:se,hide:V,disabled:Q,disabledReason:"Disabled by profile policy"},{icon:Oe,label:"Burn Tab",action:O,danger:!0},{icon:Fe,label:"Start 10-min Timer",action:U,disabled:ae,disabledReason:"Disabled by profile policy"},{icon:Me,label:"Wake tab",action:h,hide:!Z}].filter(n=>!n.hide),ce=!V&&!X?W.filter(n=>n.id!==c):[],q=W.filter(n=>n.id!==c);return t.jsx(fe,{children:t.jsxs(H.div,{ref:K,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},className:"fixed z-50 bg-surface-elevated text-foreground border border-subtle rounded-lg shadow-elevated py-1 min-w-[200px]",style:{left:`${z.x}px`,top:`${z.y}px`},children:[Z&&t.jsxs("div",{className:"px-3 py-2 text-xs text-amber-500 bg-amber-500/10 border-b border-subtle flex items-center gap-2",children:[t.jsx(He,{size:14}),t.jsx("span",{children:"Tab is hibernating"})]}),(c||s)&&t.jsxs("div",{className:"px-3 py-2 text-xs text-muted border-b border-subtle flex items-center gap-2",children:[t.jsx("div",{className:"w-2.5 h-2.5 rounded-full border border-gray-500/30",style:{backgroundColor:g||"#6366f1"}}),t.jsx("span",{children:s||(c==="default"?"Default container":c)})]}),x.map((n,j)=>{const te=n.icon;return t.jsxs(H.button,{whileHover:n.disabled?void 0:{scale:1.01},onClick:n.action,className:`w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors ${n.danger?"text-red-500 hover:bg-red-500/10":n.disabled?"text-muted cursor-not-allowed":"text-foreground hover:bg-[color:var(--surface-muted)]/45"}`,disabled:n.disabled,title:n.disabled?n.disabledReason||"Disabled by profile policy":void 0,children:[t.jsx(te,{size:16}),t.jsx("span",{children:n.label})]},j)}),q.length>0&&t.jsxs("div",{className:"mt-1 border-t border-subtle pt-1.5",children:[t.jsxs("div",{className:"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2",children:[t.jsx(ge,{size:12}),"Open copy in container"]}),t.jsx("div",{className:"flex flex-col",children:q.map(n=>t.jsxs(H.button,{whileHover:{scale:1.01},onClick:()=>ee(n.id,!0),className:"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-full border border-gray-500/30",style:{backgroundColor:n.color||"#6366f1"}}),t.jsx("span",{className:"truncate",children:n.name})]},`open-${n.id}`))})]}),ce.length>0&&t.jsxs("div",{className:"mt-1 border-t border-subtle pt-1.5",children:[t.jsxs("div",{className:"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2",children:[t.jsx(ge,{size:12}),"Move to container"]}),t.jsx("div",{className:"flex flex-col",children:ce.map(n=>t.jsxs(H.button,{whileHover:{scale:1.01},onClick:()=>_(n.id),className:"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors",children:[t.jsx("span",{className:"w-2.5 h-2.5 rounded-full border border-gray-500/30",style:{backgroundColor:n.color||"#6366f1"}}),t.jsx("span",{className:"truncate",children:n.name})]},n.id))})]})]})})}function Xe({clusters:i,summary:a,onApply:c}){const[s,g]=u.useState(0);if(u.useEffect(()=>{i.length?s>=i.length&&g(0):g(0)},[i,s]),!i.length)return null;const w=i[s],$=typeof w.confidence=="number"?Math.round(w.confidence*100):null;return t.jsxs(H.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"no-drag flex items-center gap-2 mr-3",children:[t.jsxs("button",{type:"button",onClick:()=>c(w.id),className:"flex items-center gap-1.5 rounded-full border border-blue-500/40 bg-blue-500/15 px-3 py-1.5 text-xs text-blue-100 transition-colors hover:bg-blue-500/25",title:a??"Redix suggests regrouping these tabs into a focused workspace.",children:[t.jsx(Le,{size:12}),t.jsxs("span",{className:"font-semibold",children:["Regroup ",w.label]}),$!==null&&t.jsxs("span",{className:"text-[11px] text-blue-200/80",children:[$,"%"]})]}),i.length>1&&t.jsx("button",{type:"button",onClick:()=>g(P=>(P+1)%i.length),className:"rounded-full border border-slate-700/60 p-1.5 text-[10px] text-slate-300 transition-colors hover:text-slate-100","aria-label":"Next suggested cluster",children:"â—"})]})}function qe({entry:i,onOpen:a}){if(!i)return null;let c=i.url;try{c=new URL(i.url).hostname.replace(/^www\./,"")}catch{}const s=typeof i.confidence=="number"?Math.round(i.confidence*100):null;return t.jsx(H.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"no-drag flex items-center gap-2 mr-3",children:t.jsxs("button",{type:"button",onClick:()=>a(i),className:"flex items-center gap-1.5 rounded-full border border-emerald-500/40 bg-emerald-500/15 px-3 py-1.5 text-xs text-emerald-100 transition-colors hover:bg-emerald-500/25",title:i.reason,children:[t.jsx(Ke,{size:12}),t.jsxs("span",{className:"font-semibold",children:["Scout ",c]}),s!==null&&t.jsxs("span",{className:"text-[11px] text-emerald-200/80",children:[s,"%"]})]})})}const he=typeof navigator<"u"&&"xr"in navigator,Ve="https://unpkg.com/aframe@1.5.0/dist/aframe.min.js";async function Ye(){return typeof window>"u"?!1:window.AFRAME?!0:new Promise(i=>{const a=document.querySelector('script[data-hologram="aframe"]');if(a){a.addEventListener("load",()=>i(!0),{once:!0}),a.addEventListener("error",()=>i(!1),{once:!0});return}const c=document.createElement("script");c.src=Ve,c.async=!0,c.crossOrigin="anonymous",c.dataset.hologram="aframe",c.addEventListener("load",()=>i(!0),{once:!0}),c.addEventListener("error",()=>i(!1),{once:!0}),document.head.appendChild(c)})}function Je({visible:i,tabId:a,url:c,title:s,onClose:g}){const w=u.useRef(null),[$,P]=u.useState(he);return u.useEffect(()=>{let z=!1;if(!(!i||!w.current)){if(!he){P(!1);return}return(async()=>{const R=await Ye();z||(R?P(!0):(console.warn("[Hologram] Failed to load A-Frame runtime from CDN"),P(!1)))})(),()=>{z=!0}}},[i]),!i||!a?null:t.jsx(fe,{children:t.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-md",children:t.jsxs(H.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"relative w-[720px] max-w-[92vw] rounded-3xl border border-cyan-500/40 bg-cyan-950/90 p-6 shadow-[0_20px_80px_rgba(8,145,178,0.25)]",children:[t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-cyan-200/80",children:"Holographic Preview"}),t.jsx("div",{className:"text-lg font-semibold text-cyan-100",children:s||"Live Tab"}),t.jsx("div",{className:"text-xs text-cyan-100/70 break-all",children:c})]}),t.jsx("button",{type:"button",onClick:g,className:"rounded-full border border-cyan-400/30 bg-cyan-500/10 px-3 py-1 text-xs text-cyan-100 hover:bg-cyan-500/20",children:"Close"})]}),t.jsxs("div",{className:"mt-4 overflow-hidden rounded-2xl border border-cyan-500/30 bg-cyan-900/60 p-4",children:[!$&&t.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-16 text-center text-sm text-cyan-100/80",children:[t.jsx("p",{children:"WebXR holograms require a compatible browser/device."}),t.jsx("p",{className:"text-xs text-cyan-200/60",children:"Fallback: switch tabs to view this content directly."})]}),$&&t.jsx("div",{ref:w,className:"relative h-[360px] w-full",children:t.jsx("iframe",{src:`/hologram.html?tabId=${encodeURIComponent(a)}`,className:"h-full w-full rounded-xl border-none",allow:"xr-spatial-tracking; vr; webxr",title:`Holographic preview for tab ${a}`})})]})]})})})}const Qe="application/x-omnibrowser-tab-id",C=Ce(),ne=Ie(),F=i=>i.map(a=>({id:a.id,title:a.title,active:a.active,url:a.url,mode:a.mode,containerId:a.containerId,containerColor:a.containerColor,containerName:a.containerName,createdAt:a.createdAt,lastActiveAt:a.lastActiveAt,sessionId:a.sessionId,profileId:a.profileId,sleeping:a.sleeping}));function wt(){const{setAll:i,setActive:a,activeId:c}=me(),[s,g]=u.useState([]),[w,$]=u.useState([]),[P,z]=u.useState([]),[R,K]=u.useState(null),[B,Q]=u.useState(null),[ae,W]=u.useState(null),[ie,D]=u.useState(null),[oe,Z]=u.useState({platform:"desktop",lastSentAt:null}),[L,se]=u.useState(null),[O,U]=u.useState(!1),ee=u.useRef(!1),_=u.useRef(!1),M=u.useRef(""),h=u.useRef(null),V=u.useRef(null),X=u.useRef(null),x=u.useRef(s),ce=ue(e=>e.open),q=u.useRef(null),n=u.useRef(""),j=u.useRef();u.useEffect(()=>{h.current=c},[c]);const te=u.useCallback(async e=>{if(!ne){e?.force&&($([]),z([]),K(null));return}if(q.current&&!e?.force)return q.current;const o=x.current.map(l=>`${l.id}:${l.lastActiveAt??0}`).sort().join("|");if(!e?.force&&o&&o===n.current&&w.length>0)return;const r=(async()=>{try{const l=await A.tabs.predictiveGroups(e?.force?{force:!0}:{});if(n.current=o,!l){$([]),z([]),K(null);return}$(Array.isArray(l.groups)?l.groups:[]),z(Array.isArray(l.prefetch)?l.prefetch:[]),K(l.summary?.explanation??null)}catch(l){C&&console.warn("[TabStrip] Predictive suggestions failed",l),e?.force&&($([]),z([]),K(null))}finally{q.current===r&&(q.current=null)}})();return q.current=r,r},[w.length]);u.useEffect(()=>{j.current=te},[te]),u.useEffect(()=>{O&&j.current?.({force:!0})},[O]);const le=u.useCallback(async()=>{if(ne)try{const e=await A.tabs.list();if(!Array.isArray(e))return;const o=e.map(d=>({id:d.id,title:d.title||"New Tab",url:d.url||"about:blank",active:d.active||!1,mode:d.mode||"normal",containerId:d.containerId,containerName:d.containerName,containerColor:d.containerColor,createdAt:d.createdAt,lastActiveAt:d.lastActiveAt,sessionId:d.sessionId,profileId:d.profileId})),r=o.map(d=>d.id).sort().join(",");M.current=r,g(o),x.current=o,i(F(o));const l=o.find(d=>d.active);l?(a(l.id),h.current=l.id):o.length===0&&(a(null),h.current=null),j.current?.()}catch(e){C&&console.error("[TabStrip] Failed to refresh tabs from main process:",e)}},[a,i]);u.useEffect(()=>{(()=>{const o=typeof navigator<"u"&&"xr"in navigator;D(o),o&&Z(r=>({...r,platform:"xr-ready"}))})()},[]),u.useEffect(()=>{oe.lastSentAt&&A.crossReality.sendHandoffStatus(oe)},[oe]),u.useEffect(()=>{if(!ne){let p=!0;const v=G=>{if(!p)return;const S=G.length?G:[{id:"local-initial",title:"Welcome",url:"https://omnibrowser.dev/",active:!0,mode:"normal"}];g(S),x.current=S,M.current=S.map(I=>I.id).sort().join(","),i(F(S));const k=S.find(I=>I.active)??S[0];a(k?k.id:null),h.current=k?k.id:null,U(!0)};v(x.current.length>0?x.current:s);const m=J.on("tabs:updated",G=>{if(!p)return;if(!Array.isArray(G)||G.length===0){v([]);return}const S=G.map(k=>({id:k.id,title:k.title||"New Tab",url:k.url||"about:blank",active:!!k.active,mode:k.mode||"normal",containerId:k.containerId,containerName:k.containerName,containerColor:k.containerColor,createdAt:k.createdAt,lastActiveAt:k.lastActiveAt,sessionId:k.sessionId,profileId:k.profileId,sleeping:k.sleeping}));v(S)});return()=>{p=!1,m()}}let e=!0,o=!1;const r=()=>new Promise(p=>{if(window.ipc&&typeof window.ipc.invoke=="function"){o=!0,p();return}const v=()=>{window.ipc&&typeof window.ipc.invoke=="function"&&(o=!0,p())};window.addEventListener("ipc:ready",v,{once:!0});const m=setInterval(()=>{window.ipc&&typeof window.ipc.invoke=="function"&&(clearInterval(m),o=!0,p())},100);setTimeout(()=>{clearInterval(m),o||(console.warn("IPC not ready after 5 seconds, proceeding anyway"),p())},5e3)}),l=async(p=!1)=>{if(e&&!(_.current&&!p)&&(o||await r(),!!e))try{const v=await A.tabs.list();if(!e)return;if(Array.isArray(v)&&v.length>0){const m=v.map(I=>({id:I.id,title:I.title||"New Tab",url:I.url||"about:blank",active:I.active||!1,mode:I.mode||"normal",containerId:I.containerId,containerName:I.containerName,containerColor:I.containerColor,createdAt:I.createdAt,lastActiveAt:I.lastActiveAt,sessionId:I.sessionId,profileId:I.profileId})),G=m.map(I=>I.id).sort().join(",");M.current!==G&&(M.current=G,g(m),i(F(m)));const S=m.find(I=>I.active),k=h.current;S&&S.id!==k?a(S.id):m.length>0&&!S&&m[0]&&m[0].id!==k&&(await A.tabs.activate({id:m[0].id}),a(m[0].id)),p&&U(!0)}else p&&!O&&!ee.current&&!_.current?setTimeout(async()=>{if(!(!e||O||ee.current||_.current)){try{const m=await A.tabs.list();if(Array.isArray(m)&&m.length>0){U(!0);return}}catch{}_.current=!0,U(!0);try{(!window.ipc||typeof window.ipc.invoke!="function")&&await new Promise(G=>setTimeout(G,200));const m=await A.tabs.create("about:blank");m&&m.id&&C&&console.log("[TabStrip] Initial tab created after wait:",m.id)}catch(m){C&&console.error("[TabStrip] Failed to create initial tab:",m)}finally{setTimeout(()=>{_.current=!1},1e3)}}},300):e&&(g([]),i([]),a(null),O||U(!0))}catch{p&&e&&!O&&U(!0)}},d=p=>{e&&(ee.current=p)},N=J.on("session:restoring",d),f=async p=>{if(!(!e||_.current)){_.current=!0;try{await A.tabs.create({url:p.url||"about:blank",containerId:p.containerId,mode:p.mode,profileId:p.profileId,tabId:p.id,activate:!!p.activate,createdAt:p.createdAt,lastActiveAt:p.lastActiveAt,sessionId:p.sessionId,fromSessionRestore:!0})}catch(v){C&&console.error("Failed to restore tab from session:",v)}finally{setTimeout(()=>{_.current=!1},500)}}},E=J.on("session:restore-tab",f),b=setTimeout(()=>{l(!0)},100),T=p=>{if(!e||!Array.isArray(p)){C&&console.warn("[TabStrip] handleTabUpdate: Invalid data or unmounted",{isMounted:e,tabList:p});return}const v=p.map(y=>({id:y.id,title:y.title||"New Tab",url:y.url||"about:blank",active:y.active||!1,containerId:y.containerId,containerName:y.containerName,containerColor:y.containerColor,mode:y.mode,createdAt:y.createdAt,lastActiveAt:y.lastActiveAt,sessionId:y.sessionId,profileId:y.profileId,sleeping:!!y.sleeping})),m=ue.getState();if(m.visible&&m.tab){const y=v.find(je=>je.id===m.tab?.id);y&&ue.getState().sync(y)}const S=v.find(y=>y.active)?.id||null,k=v.map(y=>y.id).sort().join(","),I=M.current;if(g(v),x.current=v,i(F(v)),I!==k&&(M.current=k),S)(h.current!==S||c!==S)&&(a(S),h.current=S);else if(v.length>0){const y=v[0].id;h.current!==y&&c!==y&&(a(y),h.current=y)}else(h.current!==null||c!==null)&&(a(null),h.current=null)},pe=J.on("tabs:updated",T),re=setInterval(()=>{e&&o&&O&&(_.current||l(!1).catch(()=>{}))},1e4);return()=>{e=!1,pe(),N(),E(),clearInterval(re),clearTimeout(b)}},[]);const be=async()=>{if(!ne){const e=(x.current.length>0?x.current:s).map(l=>({...l,active:!1})),o={id:`local-${Date.now()}`,title:"New Tab",url:"about:blank",active:!0,mode:"normal"},r=[...e,o];g(r),x.current=r,M.current=r.map(l=>l.id).sort().join(","),i(F(r)),a(o.id),h.current=o.id,J.emit("tabs:updated",F(r));return}if(_.current){C&&console.log("[TabStrip] Tab creation already in progress, skipping");return}_.current=!0;try{(!window.ipc||typeof window.ipc.invoke!="function")&&await new Promise(o=>setTimeout(o,500));const e=await A.tabs.create("about:blank");e&&e.id?C&&console.log("[TabStrip] Tab created via addTab:",e.id):C&&console.warn("[TabStrip] Tab creation returned no ID:",e)}catch(e){C&&console.error("Failed to create tab:",e)}finally{setTimeout(()=>{_.current=!1},100)}},de=async e=>{if(!ne){const b=x.current.length>0?x.current:s,T=b.findIndex(m=>m.id===e);if(T===-1)return;const pe=b[T]?.active,re=b.filter(m=>m.id!==e);let p=re;if(re.length===0)p=[{id:`local-${Date.now()}`,title:"New Tab",url:"about:blank",active:!0,mode:"normal"}];else if(pe){const m=Math.min(T,re.length-1);p=re.map((G,S)=>({...G,active:S===m}))}const v=p.find(m=>m.active)??p[0];g(p),x.current=p,M.current=p.map(m=>m.id).sort().join(","),i(F(p)),a(v?v.id:null),h.current=v?v.id:null,J.emit("tabs:updated",F(p));return}if(_.current)return;const o=x.current.length>0?x.current:s,r=o.find(b=>b.id===e);if(!r)return;const l=r.active,d=o.findIndex(b=>b.id===e),N=o.filter(b=>b.id!==e),f=o.map(b=>({...b})),E=h.current;if(g(N),x.current=N,M.current=N.map(b=>b.id).sort().join(","),i(F(N)),l&&N.length>0){const b=Math.min(d,N.length-1),T=N[b];T&&(a(T.id),h.current=T.id)}else N.length===0&&(a(null),h.current=null);C&&console.log("[TabStrip] Closing tab (optimistic):",e,"previous active:",E);try{const b=await Promise.race([A.tabs.close({id:e}),new Promise(T=>setTimeout(()=>T({success:!1,error:"Timeout"}),2e3))]);C&&console.log("[TabStrip] tabs.close result:",b),(!b||!b.success)&&(C&&console.warn("[TabStrip] Tab close failed or timed out, reverting:",e,b?.error),g(f),x.current=f,M.current=f.map(T=>T.id).sort().join(","),i(F(f)),E&&(a(E),h.current=E),await le())}catch(b){C&&console.error("[TabStrip] Exception during tab close, reverting:",b),g(f),x.current=f,M.current=f.map(T=>T.id).sort().join(","),i(F(f)),E&&(a(E),h.current=E),await le()}},Y=async e=>{if(!ne){const f=x.current.length>0?x.current:s;if(!f.find(T=>T.id===e))return;const b=f.map(T=>({...T,active:T.id===e}));g(b),x.current=b,M.current=b.map(T=>T.id).sort().join(","),i(F(b)),a(e),h.current=e,J.emit("tabs:updated",F(b));return}if(c===e||V.current===e)return;const o=x.current.length>0?x.current:s;if(!o.find(f=>f.id===e)){C&&console.warn("[TabStrip] Tab not found for activation:",e,"Available tabs:",o.map(f=>f.id));return}V.current=e;const l=h.current,d=o.map(f=>({...f}));a(e),h.current=e;const N=o.map(f=>({...f,active:f.id===e}));g(N),x.current=N,i(F(N)),C&&console.log("[TabStrip] Activating tab (optimistic):",e,"previous:",l);try{const f=await Promise.race([A.tabs.activate({id:e}),new Promise(E=>setTimeout(()=>E({success:!1,error:"Timeout"}),2e3))]);C&&console.log("[TabStrip] tabs.activate result:",f),!f||!f.success?(C&&console.warn("[TabStrip] Tab activation failed or timed out, reverting:",e,f?.error),g(d),x.current=d,M.current=d.map(E=>E.id).sort().join(","),i(F(d)),l&&(a(l),h.current=l),await le()):C&&console.log("[TabStrip] Tab activation acknowledged by IPC:",e)}catch(f){C&&console.error("[TabStrip] Exception during tab activation, reverting:",f),g(d),x.current=d,M.current=d.map(E=>E.id).sort().join(","),i(F(d)),l&&(a(l),h.current=l),await le()}finally{V.current=null}},Te=u.useCallback(e=>{const o=w.find(f=>f.id===e);if(!o||!o.tabIds.length)return;const l=x.current.filter(f=>o.tabIds.includes(f.id));if(l.length<=1)return;let d="workspace";try{l[0]?.url&&(d=new URL(l[0].url).hostname.replace(/^www\./,"")||"workspace")}catch{d="workspace"}const N=l.length>=3?`${d} cluster`:o.label;A.tabs.create({url:"about:blank",containerId:d,activate:!0}).then(async f=>{if(f?.id){for(const E of l)try{await A.tabs.moveToWorkspace({tabId:E.id,workspaceId:f.id,label:N})}catch(b){C&&console.warn("[TabStrip] Failed to regroup tab",b)}setTimeout(()=>{ze.getState().refresh()},300),j.current?.({force:!0})}})},[w]),ke=u.useCallback(e=>{e?.url&&A.tabs.create({url:e.url,activate:!0}).then(()=>{j.current?.({force:!0})})},[]);u.useEffect(()=>{if(!(!c||!X.current))try{X.current.querySelector(`[data-tab="${CSS.escape(c)}"]`)?.scrollIntoView?.({block:"nearest",inline:"center",behavior:"smooth"})}catch{}},[c]);const xe=u.useRef(c);u.useEffect(()=>{x.current=s,xe.current=c},[s,c]),u.useEffect(()=>{if(!X.current||!c)return;X.current.querySelector(`[data-tab="${CSS.escape(c)}"]`)?.scrollIntoView({block:"nearest",inline:"nearest"})},[c,s.length]);const Ae=u.useCallback(e=>{if(!["ArrowLeft","ArrowRight","Home","End"].includes(e.key))return;const o=s.findIndex(d=>d.id===c);if(o===-1)return;e.preventDefault();let r=o;switch(e.key){case"Home":r=0;break;case"End":r=s.length-1;break;case"ArrowLeft":r=(o-1+s.length)%s.length;break;case"ArrowRight":r=(o+1)%s.length;break}const l=s[r];l&&Y(l.id)},[s,c,Y]);return u.useEffect(()=>{const e=o=>{if(!(navigator.platform.toUpperCase().includes("MAC")?o.metaKey:o.ctrlKey)||o.key!=="Tab")return;const d=x.current,N=xe.current;if(!d.length||!N)return;o.preventDefault();const f=d.findIndex(T=>T.id===N);if(f===-1)return;const E=o.shiftKey?(f-1+d.length)%d.length:(f+1)%d.length,b=d[E];b&&Y(b.id)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Y]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{ref:X,role:"tablist","aria-label":"Browser tabs",className:"no-drag flex items-center gap-1 px-3 py-2 bg-[#1A1D28] border-b border-gray-700/30 overflow-x-auto scrollbar-hide",style:{pointerEvents:"auto"},onKeyDown:Ae,"data-onboarding":"tabstrip",children:[t.jsx(qe,{entry:P[0]??null,onOpen:ke}),t.jsx(Xe,{clusters:w,onApply:Te,summary:R}),t.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",style:{pointerEvents:"auto"},children:[t.jsx(fe,{mode:"popLayout",children:s.length>0?s.map(e=>{const o=P.find(r=>r.tabId===e.id);return t.jsx(We,{tabId:e.id,children:t.jsxs(H.div,{"data-tab":e.id,role:"tab","aria-selected":e.active,"aria-label":`Tab: ${e.title}${e.mode==="ghost"?" (Ghost tab)":e.mode==="private"?" (Private tab)":""}${e.sleeping?" (Hibernating)":""}`,tabIndex:e.active?0:-1,layout:!0,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:`
                      relative flex items-center gap-2 px-4 py-2 rounded-lg
                      min-w-[100px] max-w-[220px] cursor-pointer group
                      transition-all duration-200
                      focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
                      ${e.active?"bg-purple-600/20 border border-purple-500/40 shadow-lg shadow-purple-500/20":"bg-gray-800/30 hover:bg-gray-800/50 border border-transparent"}
                      ${e.mode==="ghost"?"ring-1 ring-purple-500/40":""}
                      ${e.mode==="private"?"ring-1 ring-emerald-500/40":""}
                      ${e.sleeping?"ring-1 ring-amber-400/40":""}
                    `,style:{pointerEvents:"auto",zIndex:1,userSelect:"none"},draggable:!0,onDragStart:r=>{try{r.dataTransfer?.setData(Qe,e.id),e.title&&r.dataTransfer?.setData("text/plain",e.title),r.dataTransfer&&(r.dataTransfer.effectAllowed="copy")}catch(l){C&&console.warn("[TabStrip] Drag start failed",l)}},onDragEnd:()=>{window.dispatchEvent(new CustomEvent("tabgraph:dragend"))},onClick:r=>{r.preventDefault(),r.stopPropagation(),Y(e.id)},onKeyDown:r=>{if(r.key==="Enter"||r.key===" "){r.preventDefault(),r.stopPropagation(),Y(e.id);return}if(["ArrowLeft","ArrowRight","Home","End"].includes(r.key)){r.preventDefault(),r.stopPropagation();const l=s.findIndex(f=>f.id===e.id);if(l===-1)return;let d=l;switch(r.key){case"Home":d=0;break;case"End":d=s.length-1;break;case"ArrowLeft":d=(l-1+s.length)%s.length;break;case"ArrowRight":d=(l+1)%s.length;break}const N=s[d];N&&Y(N.id)}},onAuxClick:r=>{r.preventDefault(),r.stopPropagation(),r.button===1&&de(e.id)},onContextMenu:r=>{r.preventDefault(),window.__lastContextMenuPos={x:r.clientX,y:r.clientY},se({tabId:e.id,url:e.url,containerId:e.containerId,containerName:e.containerName,containerColor:e.containerColor,mode:e.mode,sleeping:e.sleeping,x:r.clientX,y:r.clientY})},onMouseEnter:()=>{e===s[s.length-1]&&(Q(e.id),W({url:e.url,title:e.title}))},onMouseLeave:()=>{B===e.id&&(Q(null),W(null))},children:[o&&t.jsx("span",{className:"absolute top-1 right-2 text-emerald-300 text-[11px] font-semibold",title:`Suggested follow-up: ${o.reason}`,children:"âš¡"}),ie!==!1&&B===e.id&&t.jsxs(H.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},className:"absolute -bottom-9 left-1/2 flex -translate-x-1/2 items-center gap-2",children:[t.jsxs(H.button,{type:"button",className:"flex items-center gap-1 rounded-full border border-cyan-400/40 bg-cyan-500/15 px-3 py-1 text-[10px] text-cyan-100 shadow-lg backdrop-blur transition-colors hover:bg-cyan-500/25",onClick:r=>{r.preventDefault(),r.stopPropagation(),Z({platform:"xr",lastSentAt:Date.now()}),window.dispatchEvent(new CustomEvent("tab:holographic-preview",{detail:{tabId:e.id}})),A.crossReality.handoff(e.id,"xr")},children:[t.jsx(_e,{size:12})," XR Hologram"]}),t.jsxs(H.button,{type:"button",className:"flex items-center gap-1 rounded-full border border-amber-400/40 bg-amber-500/15 px-2.5 py-1 text-[10px] text-amber-100 shadow-lg backdrop-blur transition-colors hover:bg-amber-500/25",onClick:r=>{r.preventDefault(),r.stopPropagation(),Z({platform:"mobile",lastSentAt:Date.now()}),A.crossReality.handoff(e.id,"mobile")},children:[t.jsx("span",{role:"img","aria-label":"mobile",children:"ðŸ“±"})," Send"]})]}),t.jsx("div",{className:"flex-shrink-0 w-4 h-4 bg-gray-600 rounded-full flex items-center justify-center",children:e.favicon?t.jsx("img",{src:e.favicon,alt:"",className:"w-full h-full rounded-full"}):t.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})}),e.mode&&e.mode!=="normal"&&t.jsx("span",{className:`px-1.5 py-0.5 rounded-md text-[10px] font-medium border ${e.mode==="ghost"?"bg-purple-500/20 text-purple-200 border-purple-400/40":"bg-emerald-500/20 text-emerald-200 border-emerald-400/40"}`,children:e.mode==="ghost"?"Ghost":"Private"}),e.containerId&&e.containerId!=="default"&&t.jsx("div",{className:"w-2.5 h-2.5 rounded-full border border-gray-700/60",style:{backgroundColor:e.containerColor||"#6366f1"},title:`${e.containerName||"Custom"} container`}),e.sleeping&&t.jsx("span",{className:"flex items-center",title:"Tab is hibernating",children:t.jsx(H.span,{className:"w-2 h-2 rounded-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.55)]",animate:{scale:[1,1.25,1],opacity:[.7,1,.7]},transition:{repeat:1/0,duration:1.8,ease:"easeInOut"}})}),t.jsx("span",{className:`flex-1 text-sm truncate ${e.active?"text-gray-100":"text-gray-400"}`,children:e.title}),t.jsx(H.button,{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),ce(e)},"aria-label":`Peek preview: ${e.title}`,className:"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-gray-700/50 transition-opacity text-gray-400 hover:text-gray-100 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag ml-1",style:{pointerEvents:"auto",zIndex:2},whileHover:{scale:1.05},whileTap:{scale:.96},title:"Peek preview",children:t.jsx(ve,{size:14})}),t.jsx(H.button,{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),de(e.id)},onAuxClick:r=>{r.button===1&&(r.preventDefault(),r.stopPropagation(),de(e.id))},onMouseDown:r=>{r.stopPropagation()},onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),r.stopPropagation(),de(e.id))},"aria-label":`Close tab: ${e.title}`,className:"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-gray-700/50 transition-opacity ml-1 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag",style:{pointerEvents:"auto",zIndex:2},whileHover:{scale:1.1},whileTap:{scale:.9},title:"Close tab (Middle click)",children:t.jsx(Ge,{size:14,className:"text-gray-400"})})]})},e.id)}):null}),t.jsx(H.button,{onClick:be,onKeyDown:e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),be())},"aria-label":"New tab",className:"flex-shrink-0 p-2 rounded-lg hover:bg-gray-800/50 border border-transparent hover:border-gray-700/30 text-gray-400 hover:text-gray-200 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",whileHover:{scale:1.05},whileTap:{scale:.95},title:"New Tab (Ctrl+T / âŒ˜T)",children:t.jsx(Be,{size:18})})]}),L&&t.jsx($e,{children:t.jsx(Ue,{tabId:L.tabId,url:L.url,containerId:L.containerId??s.find(e=>e.id===L.tabId)?.containerId,containerName:L.containerName??s.find(e=>e.id===L.tabId)?.containerName,containerColor:L.containerColor??s.find(e=>e.id===L.tabId)?.containerColor,mode:L.mode??s.find(e=>e.id===L.tabId)?.mode,sleeping:L.sleeping??s.find(e=>e.id===L.tabId)?.sleeping,onClose:()=>se(null)})})]}),t.jsx(Je,{visible:!!B,tabId:B,url:ae?.url,title:ae?.title,onClose:()=>{Q(null),W(null)}})]})}export{wt as TabStrip};
//# sourceMappingURL=TabStrip-Br9p_R42.js.map

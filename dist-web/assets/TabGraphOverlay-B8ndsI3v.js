import{c as D,i as I,r as b,j as e}from"./index-BquUM_dP.js";import{u as T}from"./AppShell-BXhI_JTh.js";import{c as C,m as N}from"./proxy-BIEmBbur.js";import{S as L}from"./share-2-CRKXNKym.js";import{R as O}from"./refresh-cw-BV6giV6D.js";import{X as W}from"./x-C_5K_ivr.js";import{f as S}from"./formatDistanceToNow-Ctx6mZEP.js";import"./ipc-events-CqodUROu.js";import"./use-ipc-event-CcVO0A42.js";import"./Portal-BzN9CTBx.js";import"./OmniDesk-BdBOPLft.js";import"./agentStreamStore-BcjkWHdN.js";import"./cloud-BWs6gXbb.js";import"./sparkles-B3IeNLsk.js";import"./search-RYizLTqL.js";import"./index-TWPLI6s_.js";import"./clock-gSt0ZU7N.js";import"./circle-check-DDsejJ4f.js";import"./trustDashboardStore-CKKody0H.js";import"./triangle-alert-CrRrQux7.js";const z=C("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),R=D((i,r)=>({plan:null,loading:!1,error:null,lastFetchedAt:null,async fetch(n){const{loading:x,lastFetchedAt:p}=r();if(!x&&!(!n?.force&&p&&Date.now()-p<1e4)){i({loading:!0,error:null});try{const a=await I.graph.workflow({maxSteps:n?.maxSteps??5});if(!a||typeof a!="object")throw new Error("Workflow weaver unavailable.");i({plan:a,loading:!1,lastFetchedAt:Date.now()})}catch(a){i({error:a instanceof Error?a.message:String(a),loading:!1})}}},setPlan(n){i({plan:n})}})),A={domain:"#60a5fa",container:"#34d399",mode:"#a855f7",timeline:"#f97316"},c={width:680,height:520},w=28,F=(i,r)=>{if(r===0)return{x:c.width/2,y:c.height/2};const n=2*Math.PI*i/r,x=Math.min(c.width,c.height)/2-70,p=c.width/2+x*Math.cos(n),a=c.height/2+x*Math.sin(n);return{x:p,y:a}};function le(){const{visible:i,data:r,loading:n,error:x,close:p,refresh:a,focusedTabId:g,setFocusedTab:M}=T(t=>({visible:t.visible,data:t.data,loading:t.loading,error:t.error,close:t.close,refresh:t.refresh,focusedTabId:t.focusedTabId,setFocusedTab:t.setFocusedTab})),{plan:h,loading:v,error:k,fetch:u}=R(t=>({plan:t.plan,loading:t.loading,error:t.error,fetch:t.fetch})),[o,y]=b.useState(null);b.useEffect(()=>{if(!i)return;!r&&!n&&a();const t=setInterval(()=>{a()},15e3);return()=>clearInterval(t)},[i,r,n,a]),b.useEffect(()=>{if(!i)return;u({maxSteps:5,force:!0});const t=setInterval(()=>{u({maxSteps:5})},2e4);return()=>clearInterval(t)},[i,u]);const f=b.useMemo(()=>{if(!r)return null;const t=r.nodes.map((s,m)=>({node:s,...F(m,r.nodes.length)})),l=new Map(t.map(s=>[s.node.id,s])),d=r.edges.map(s=>{const m=l.get(s.source),j=l.get(s.target);return!m||!j?null:{edge:s,source:m,target:j}}).filter(s=>!!s);return{positions:t,edges:d}},[r]);b.useEffect(()=>{if(!f||!g)return;const t=f.positions.find(l=>l.node.id===g);t&&y(t.node)},[f,g]);const E=()=>{y(null),M(null),p()};return i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},className:"relative w-[820px] max-w-[92vw] rounded-3xl border border-slate-700/70 bg-slate-950/95 shadow-2xl shadow-black/50",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 border-b border-slate-800/60 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-emerald-300",children:[e.jsx(L,{size:16}),"Dynamic Tab Graph"]}),e.jsx("div",{className:"text-lg font-semibold text-gray-100",children:"Browse DNA Overlay"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[r?.summary.totalTabs??0," tabs Â· ",r?.summary.domains??0," domains Â· ",r?.summary.containers??0," ","containers",r?.updatedAt&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["Updated"," ",S(new Date(r.updatedAt),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{a(),u({maxSteps:5,force:!0})},disabled:n,className:"rounded-xl border border-slate-700/60 bg-slate-900/70 px-3 py-2 text-xs font-medium text-gray-200 hover:bg-slate-900/90 transition-colors disabled:cursor-wait disabled:opacity-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:14,className:n?"animate-spin":""}),"Refresh"]})}),e.jsx("button",{type:"button",onClick:E,className:"rounded-full border border-slate-700/60 bg-slate-900/70 p-2 text-gray-300 hover:bg-slate-900/90 transition-colors","aria-label":"Close tab graph overlay",children:e.jsx(W,{size:16})})]})]}),e.jsxs("div",{className:"px-6 pb-6",children:[x&&e.jsx("div",{className:"mb-3 rounded-lg border border-rose-500/40 bg-rose-500/10 px-4 py-2 text-xs text-rose-100",children:x}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-[auto_220px]",children:[e.jsx("div",{className:"relative flex items-center justify-center rounded-2xl border border-slate-800/60 bg-slate-900/60 p-4",children:e.jsxs("svg",{width:c.width,height:c.height,className:"text-gray-500",children:[f?.edges.map(({edge:t,source:l,target:d})=>{const s=t.reasons[0]??"domain",m=A[s]??"#94a3b8",j=1+Math.min(t.weight,4);return e.jsx("line",{x1:l.x,y1:l.y,x2:d.x,y2:d.y,stroke:m,strokeOpacity:.4,strokeWidth:j},t.id)}),f?.positions.map(({node:t,x:l,y:d})=>{const s=g===t.id;return e.jsxs("g",{transform:`translate(${l}, ${d})`,children:[s&&e.jsx(N.circle,{r:w+14,className:"fill-transparent stroke-purple-400/70",strokeWidth:1.5,animate:{scale:[1,1.08,1]},transition:{duration:1.5,repeat:1/0}}),e.jsx(N.circle,{r:w,className:`stroke-2 ${s?"stroke-purple-400":t.active?"stroke-emerald-400":"stroke-slate-700/70"}`,fill:s?"#a855f73d":t.active?"#10b98133":"#1f293733",whileHover:{scale:1.05},onMouseEnter:()=>y(t),onMouseLeave:()=>y(null)}),e.jsx("text",{textAnchor:"middle",dominantBaseline:"middle",className:"pointer-events-none select-none text-[10px] font-medium fill-gray-200",children:t.mode==="ghost"?"ðŸ‘»":t.mode==="private"?"ðŸ›¡ï¸":"ðŸ—‚ï¸"}),e.jsx("text",{y:w+14,textAnchor:"middle",className:"pointer-events-none select-none text-[10px] fill-gray-300",children:t.title.slice(0,24)})]},t.id)})]})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"rounded-xl border border-slate-800/60 bg-slate-900/60 p-3 text-xs text-gray-300",children:[e.jsx("div",{className:"mb-2 font-semibold text-sm text-gray-100",children:"Legend"}),e.jsx("div",{className:"flex flex-col gap-2",children:Object.entries(A).map(([t,l])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex h-2.5 w-8 rounded-full",style:{background:l,opacity:.5}}),e.jsxs("span",{className:"capitalize text-gray-300",children:[t," affinity"]})]},t))})]}),e.jsxs("div",{className:"flex-1 overflow-hidden rounded-xl border border-slate-800/60 bg-slate-900/60 p-3 text-xs text-gray-300",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-100",children:"Tab Details"}),o&&e.jsx("a",{href:o.url,className:"text-[11px] text-blue-300 hover:text-blue-200",target:"_blank",rel:"noreferrer",children:"Open"})]}),o?e.jsxs("div",{className:"space-y-1 text-[11px] leading-snug text-gray-300",children:[e.jsx("div",{className:"font-medium text-gray-100",children:o.title}),e.jsx("div",{className:"text-gray-400 break-all",children:o.url}),e.jsxs("div",{children:["Domain: ",e.jsx("span",{className:"text-gray-200",children:o.domain})]}),o.containerName&&e.jsxs("div",{children:["Container: ",e.jsx("span",{className:"text-gray-200",children:o.containerName})]}),o.mode&&e.jsxs("div",{children:["Mode: ",e.jsx("span",{className:"text-gray-200",children:o.mode})]}),typeof o.lastActiveAt=="number"&&e.jsxs("div",{children:["Last active"," ",S(new Date(o.lastActiveAt),{addSuffix:!0})]})]}):e.jsx("div",{className:"text-[11px] text-gray-500",children:"Hover a node to inspect metadata."})]}),e.jsxs("div",{className:"overflow-hidden rounded-xl border border-purple-500/30 bg-purple-500/5 p-3 text-xs text-gray-200",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-purple-200",children:[e.jsx(z,{size:14})," Neural Workflow Weaver"]}),e.jsx("button",{type:"button",onClick:()=>void u({maxSteps:5,force:!0}),className:"rounded-lg border border-purple-400/40 bg-purple-500/10 px-2 py-1 text-[11px] text-purple-100 hover:bg-purple-500/20 transition-colors",disabled:v,children:v?"Generatingâ€¦":"Regenerate"})]}),k&&e.jsx("div",{className:"mb-2 rounded border border-rose-500/40 bg-rose-500/10 px-2 py-1 text-[11px] text-rose-100",children:k}),v&&!h&&e.jsx("div",{className:"text-[11px] text-purple-200/70",children:"Analyzing your open tabsâ€¦"}),!v&&h&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[11px] text-purple-100/80",children:h.summary}),e.jsx("div",{className:"space-y-2",children:h.steps.length===0?e.jsx("div",{className:"text-[11px] text-purple-200/70",children:"Open a few research tabs to generate a workflow."}):h.steps.map((t,l)=>e.jsxs("div",{className:"rounded-lg border border-purple-400/30 bg-purple-500/10 p-2 text-[11px] text-purple-100/90",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px] uppercase tracking-wide text-purple-200/80",children:[e.jsxs("span",{children:["Step ",l+1]}),typeof t.confidence=="number"&&e.jsxs("span",{children:[Math.round(t.confidence*100),"% confidence"]})]}),e.jsx("div",{className:"mt-1 text-[12px] font-semibold text-purple-50",children:t.title}),e.jsx("div",{className:"mt-1 text-[11px] text-purple-100/80",children:t.description}),t.recommendedActions?.length>0&&e.jsx("ul",{className:"mt-2 list-disc space-y-0.5 pl-4 text-[11px] text-purple-100/70",children:t.recommendedActions.map((d,s)=>e.jsx("li",{children:d},`${t.id}-action-${s}`))})]},t.id))})]})]})]})]})]})]})}):null}export{le as TabGraphOverlay};
//# sourceMappingURL=TabGraphOverlay-B8ndsI3v.js.map

import{c as R,m as N}from"./proxy-C7NQ8sMs.js";import{c as ne,r as u,j as e,u as se,b as ve,f as Ae,i as I}from"./index-dj7m1cGj.js";import{A as re}from"./index-D3V9pHtR.js";import{S as K}from"./sparkles-BXvEuSDZ.js";import{C as Oe}from"./copy-r_Uv8dWa.js";import{X as _e}from"./x-kCWGjBIF.js";import{L as we}from"./loader-circle-B2cekLv2.js";import{u as V,B as ze}from"./agentStreamStore-DATaLJlE.js";import{C as $e}from"./cloud-RM87ovcD.js";import{S as me}from"./search-DY2JFyPs.js";import{f as G}from"./formatDistanceToNow-Ctx6mZEP.js";import{C as We}from"./clock-C2CbMN6U.js";import{R as Fe}from"./refresh-cw-81QnrOuz.js";import{C as Ue}from"./circle-check-J1xVWsPI.js";const He=R("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);const Be=R("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const qe=R("CircleGauge",[["path",{d:"M15.6 2.7a10 10 0 1 0 5.7 5.7",key:"1e0p6d"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M13.4 10.6 19 5",key:"1kr7tw"}]]);const Ve=R("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]);const Ge=R("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const Qe=R("FileSearch",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]);const Ke=R("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Je=R("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);const Ye=R("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);const Lt=R("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);const Ze=R("Sparkle",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}]]);const xe=R("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);const he=R("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);const Xe=R("Workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]),et=ne((n,s)=>({mode:"Browse",setMode:a=>n({mode:a}),graphDockOpen:!1,toggleGraphDock:()=>{const a=!s().graphDockOpen;n({graphDockOpen:a}),window.ui?.setRightDock?.(a?360:0)},ledgerDockOpen:!1,toggleLedgerDock:()=>{const a=!s().ledgerDockOpen;n({ledgerDockOpen:a}),window.ui?.setRightDock?.(a?360:0)},researchPaneOpen:!1,toggleResearchPane:()=>{const a=!s().researchPaneOpen;n({researchPaneOpen:a}),window.ui?.setRightDock?.(a?420:0)}}));var tt=Object.defineProperty,at=(n,s,a)=>s in n?tt(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a,Q=(n,s,a)=>at(n,typeof s!="symbol"?s+"":s,a);const st="ws://localhost:4000/ws",rt="http://localhost:4000/api/query",nt="http://localhost:4000/api/ask";class ot{constructor(s=st){Q(this,"url"),Q(this,"ws",null),Q(this,"listeners",new Map),Q(this,"backoff",1e3),this.url=s,this.connect()}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.backoff=1e3},this.ws.onmessage=s=>{try{const a=JSON.parse(s.data);a?.id&&this.listeners.has(a.id)&&this.listeners.get(a.id)?.(a),window.dispatchEvent(new CustomEvent("redix:message",{detail:a}))}catch(a){console.warn("[RedixWS] failed to parse message",a)}},this.ws.onclose=()=>{window.setTimeout(()=>this.connect(),this.backoff),this.backoff=Math.min(this.backoff*1.5,3e4)},this.ws.onerror=()=>{this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close()}}send(s){if(this.ws&&this.ws.readyState===WebSocket.OPEN)this.ws.send(JSON.stringify(s));else{const a=s.payload??{};fetch(rt,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a.query,sessionId:a.sessionId,options:a.options})}).then(async o=>{if(!o.ok)throw new Error(`HTTP ${o.status}`);const l=await o.json();s.id&&this.listeners.has(s.id)&&(this.listeners.get(s.id)?.({id:s.id,type:"final_result",payload:l}),this.listeners.delete(s.id))}).catch(o=>{s.id&&this.listeners.has(s.id)&&(this.listeners.get(s.id)?.({id:s.id,type:"error",payload:{message:o.message}}),this.listeners.delete(s.id))})}}startHttpStream(s,a,o,l,i){const C=new URL(nt,window.location.origin);C.searchParams.set("q",a),C.searchParams.set("sessionId",o);const k=d=>{if(!d)return{};try{return JSON.parse(d)}catch{return{}}},b=new EventSource(C.toString()),E=d=>{i({id:s,type:"ack",payload:k(d.data)})},f=d=>{i({id:s,type:"partial_result",payload:k(d.data)})},v=d=>{const g=k(d.data).item;i({id:s,type:"partial_result",payload:{items:g?[g]:[]}})},S=d=>{i({id:s,type:"final_result",payload:k(d.data)}),h()},w=d=>{i({id:s,type:"error",payload:k(d.data)}),h()},L=()=>{h()},h=()=>{b.removeEventListener("ack",E),b.removeEventListener("update",f),b.removeEventListener("token",v),b.removeEventListener("result",S),b.removeEventListener("error",w),b.removeEventListener("done",L),b.close()};return b.addEventListener("ack",E),b.addEventListener("update",f),b.addEventListener("token",v),b.addEventListener("result",S),b.addEventListener("error",w),b.addEventListener("done",L),b.onerror=()=>{i({id:s,type:"error",payload:{message:"sse-disconnected"}}),h()},{id:s,cancel:()=>{h()}}}request(s,a,o={},l){const i=crypto.randomUUID();return!this.ws||this.ws.readyState!==WebSocket.OPEN?this.startHttpStream(i,s,a,o,l):(this.listeners.set(i,l),this.send({id:i,type:"start_query",payload:{query:s,sessionId:a,options:{stream:!0,...o}}}),{id:i,cancel:()=>{this.listeners.delete(i),this.send({id:i,type:"cancel",payload:{taskId:o.taskId}})}})}}const it=new ot;function lt(n,s){const a=it.request(n,s.sessionId,{},o=>{const l=o;switch(o.type){case"partial_result":s.onPartial?.(l);break;case"final_result":s.onFinal?.(l);break;case"error":s.onError?.(l),a.cancel();break}});return a}function ct({query:n,isOpen:s,onClose:a}){const[o,l]=u.useState(""),[i,C]=u.useState(!1),[k,b]=u.useState(null),[E,f]=u.useState(!1),v=u.useRef(null),S=u.useRef(`redix-ai-${crypto.randomUUID()}`),w=u.useRef(null);u.useEffect(()=>{w.current&&i&&w.current.scrollIntoView({behavior:"smooth"})},[o,i]),u.useEffect(()=>{if(!(!s||!n.trim()))return v.current?.cancel(),l(""),b(null),C(!0),v.current=lt(n,{sessionId:S.current,onPartial:h=>{const d=h.payload;if(d.text)l(j=>j+d.text);else if(d.content)l(j=>j+d.content);else if(d.items&&Array.isArray(d.items)){const j=d.items.map(g=>g.text||g.content||g.snippet||"").join(`

`);j&&l(g=>g.includes(j)?g:g+(g?`

`:"")+j)}},onFinal:h=>{C(!1);const d=h.payload;if(d.text)l(j=>j+d.text);else if(d.content)l(j=>j+d.content);else if(d.items&&Array.isArray(d.items)){const j=d.items.map(g=>g.text||g.content||g.snippet||"").join(`

`);j&&!o.includes(j)&&l(g=>g+(g?`

`:"")+j)}},onError:h=>{C(!1);const d=h.payload?.message||"Failed to get AI response";b(d),console.error("[AIResponsePane] Redix error:",h)}}),()=>{v.current?.cancel(),v.current=null}},[n,s]);const L=u.useCallback(async()=>{if(o)try{await navigator.clipboard.writeText(o),f(!0),setTimeout(()=>f(!1),2e3)}catch(h){console.error("[AIResponsePane] Failed to copy:",h)}},[o]);return s?e.jsx(re,{children:e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},className:"fixed bottom-20 left-1/2 -translate-x-1/2 z-50 w-full max-w-4xl mx-4 rounded-2xl border border-slate-700/70 bg-slate-950/95 backdrop-blur-xl shadow-2xl",style:{maxHeight:"60vh"},children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-800/60",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-emerald-500/20",children:e.jsx(K,{size:16,className:"text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-100",children:"AI Response"}),e.jsx("p",{className:"text-xs text-gray-400 truncate max-w-md",children:n})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsx("button",{type:"button",onClick:L,className:"p-2 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-slate-800/60 transition-colors",title:"Copy response",children:E?e.jsx(Be,{size:16}):e.jsx(Oe,{size:16})}),e.jsx("button",{type:"button",onClick:a,className:"p-2 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-slate-800/60 transition-colors",title:"Close",children:e.jsx(_e,{size:16})})]})]}),e.jsxs("div",{className:"px-6 py-4 overflow-y-auto",style:{maxHeight:"calc(60vh - 80px)"},children:[i&&!o&&e.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[e.jsx(we,{size:16,className:"animate-spin text-emerald-400"}),e.jsx("span",{className:"text-sm",children:"Streaming response from Redix..."})]}),k&&e.jsxs("div",{className:"rounded-lg border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:[e.jsx("p",{className:"font-medium",children:"Error"}),e.jsx("p",{className:"mt-1 text-xs text-red-300/80",children:k})]}),o&&e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},className:"prose prose-invert prose-sm max-w-none text-gray-200",children:[e.jsxs("div",{className:"whitespace-pre-wrap break-words",children:[o,i&&e.jsx("span",{className:"inline-block w-2 h-4 ml-1 bg-emerald-400 animate-pulse"})]}),e.jsx("div",{ref:w})]}),!o&&!i&&!k&&e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(K,{size:32,className:"mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Waiting for AI response..."})]})]})]})}):null}const be={normal:"Performance Mode","battery-saver":"Battery Saver Mode",extreme:"Regen Mode"},ye={normal:null,"battery-saver":"+0.8hr battery",extreme:"+1.8hr battery"},fe={normal:"text-gray-400","battery-saver":"text-emerald-300",extreme:"text-amber-300"},dt={batteryPct:null,charging:null,ramMb:0,cpuLoad1:0,activeTabs:0,carbonIntensity:null,carbonRegion:null},ke="ob:ecoHistory:v1";function pt(){if(typeof window>"u")return[];try{const n=window.localStorage.getItem(ke);if(!n)return[];const s=JSON.parse(n);return Array.isArray(s)?s.map(a=>({timestamp:typeof a.timestamp=="number"?a.timestamp:Date.now(),mode:a.mode??"normal",batteryPct:typeof a.batteryPct=="number"?a.batteryPct:null,carbonIntensity:typeof a.carbonIntensity=="number"||a.carbonIntensity===null?a.carbonIntensity:void 0,cpuLoad:typeof a.cpuLoad=="number"?a.cpuLoad:0,activeTabs:typeof a.activeTabs=="number"?a.activeTabs:0})).slice(-120):[]}catch(n){return console.warn("[efficiencyStore] Failed to load history",n),[]}}function ut(n){if(!(typeof window>"u"))try{window.localStorage.setItem(ke,JSON.stringify(n))}catch(s){console.warn("[efficiencyStore] Failed to persist history",s)}}const mt=pt(),q=ne((n,s)=>({mode:"normal",label:be.normal,badge:ye.normal,colorClass:fe.normal,lastUpdated:null,snapshot:dt,history:mt,setEvent:a=>{const o={timestamp:a.timestamp,mode:a.mode,batteryPct:a.snapshot.batteryPct,carbonIntensity:a.snapshot.carbonIntensity,cpuLoad:a.snapshot.cpuLoad1,activeTabs:a.snapshot.activeTabs};let l=s().history;l=[...l,o].slice(-120),ut(l);const i=a.mode;n({mode:i,label:a.label??be[i],badge:a.badge??ye[i],colorClass:fe[i],lastUpdated:a.timestamp,snapshot:a.snapshot,history:l})}})),je=ne(n=>({events:[],pushEvent:s=>n(a=>{const o=s.timestamp??Date.now(),l=s.id??`ws-${o}-${Math.random().toString(36).slice(2,8)}`;return{events:[...a.events,{id:l,timestamp:o,workspaceId:s.workspaceId??null,type:s.type,message:s.message,payload:s.payload}].slice(-100)}}),clear:s=>n(a=>s?{events:a.events.filter(o=>o.workspaceId!==s)}:{events:[]})}));function ge(n={}){const s=typeof se?.getState=="function"?se.getState():null;if(!s)return null;const{url:a="about:blank",title:o,activate:l=!0,mode:i="normal"}=n,C=Array.isArray(s.tabs)?s.tabs:[],k=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`local-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,b=C.map(f=>({...f,active:l?!1:!!f.active})),E={id:k,title:o||a,url:a,active:l,mode:i};b.push(E),s.setAll(b);try{ve.emit("tabs:updated",b)}catch{}return E}const xt="https://duckduckgo.com/?q=",ht=["@live explain quantum computing basics","graph the AI ethics landscape","summarize today's markets","compare battery life of M-series laptops","find regenerative design principles"];function bt(n){return`${xt}${encodeURIComponent(n)}`}function yt(){const[n,s]=u.useState([]),[a,o]=u.useState([]),[l,i]=u.useState(!0),[C,k]=u.useState(!0),b=je(f=>f.pushEvent),E=u.useCallback(async()=>{if(!window.ipc||typeof window.ipc.invoke!="function")return!1;i(!0),k(!0);try{const v=(await I.workspaceV2.list())?.workspaces||[];s(v.slice(0,4)),i(!1)}catch{s([]),i(!1)}try{const f=await I.sessions.list(),S=(Array.isArray(f)?f:[]).slice(0,3).map(w=>({id:w.id,type:w.name?.includes("Research")?"Research":w.name?.includes("Trade")?"Trade":"Browse",title:w.name||"Untitled Session",url:w.lastUrl||"about:blank",timestamp:w.updatedAt||w.createdAt||Date.now()-36e5,sessionId:w.id}));S.length>0?o(S):o([{type:"Research",title:"Quantum Computing Research",url:"about:blank",timestamp:Date.now()-36e5},{type:"Trade",title:"Market Analysis",url:"about:blank",timestamp:Date.now()-72e5}]),k(!1)}catch{o([{type:"Research",title:"Quantum Computing Research",url:"about:blank",timestamp:Date.now()-36e5},{type:"Trade",title:"Market Analysis",url:"about:blank",timestamp:Date.now()-72e5}]),k(!1)}return!0},[]);return u.useEffect(()=>{let f=!1;const v=()=>{f||E().then(L=>{!L&&!f&&setTimeout(v,500)})},S=setTimeout(v,350),w=ve.on("workspace:updated",()=>{b({type:"workspace:updated",message:"Workspace metadata refreshed"}),f||E()});return()=>{f=!0,clearTimeout(S),w()}},[E]),{recentWorkspaces:n,continueSessions:a,reload:E,loadingWorkspaces:l,loadingSessions:C}}function Mt({variant:n="overlay",forceShow:s=!1}){const{tabs:a,activeId:o}=se(),{setMode:l}=et(),i=Ae(),{recentWorkspaces:C,continueSessions:k,reload:b,loadingWorkspaces:E,loadingSessions:f}=yt(),[v,S]=u.useState(""),[w,L]=u.useState(!1),[h,d]=u.useState(!1),[j,g]=u.useState(!1),[oe,ie]=u.useState(""),Ne=q(t=>t.label),le=q(t=>t.badge),P=q(t=>t.snapshot),ce=q(t=>t.lastUpdated),J=q(t=>t.history),F=je(t=>t.pushEvent),Y=V(t=>t.status),de=V(t=>t.lastGoal),pe=V(t=>t.events),W=V(t=>t.transcript),_=u.useMemo(()=>{const t=pe.slice(-3).reverse(),r=t.length>0?t[0].timestamp:null,m=W.split(`
`).map(p=>p.trim()).filter(Boolean),x={idle:{label:"Idle",tone:"border-slate-700/60 bg-slate-800/60 text-slate-300"},connecting:{label:"Connecting",tone:"border-blue-500/40 bg-blue-500/15 text-blue-100"},live:{label:"Streaming",tone:"border-emerald-500/40 bg-emerald-500/15 text-emerald-100"},complete:{label:"Complete",tone:"border-purple-500/40 bg-purple-500/15 text-purple-100"},error:{label:"Error",tone:"border-rose-500/40 bg-rose-500/15 text-rose-100"}},T=x[Y]??x.idle,c=t.map(p=>{switch(p.type){case"start":return{...p,label:"Run started",detail:p.content??"Agent boot sequence initiated.",variant:"border-blue-400/40 bg-blue-500/10 text-blue-100"};case"step":return{...p,label:`Step ${p.step??""}`.trim(),detail:p.content??p.status??"Executing tool call…",variant:"border-purple-400/40 bg-purple-500/10 text-purple-100"};case"log":return{...p,label:"Log update",detail:p.content??"Log appended.",variant:"border-slate-400/40 bg-slate-500/10 text-slate-100"};case"consent":return{...p,label:p.approved?"Consent granted":"Consent requested",detail:p.content??`Risk ${p.risk??"medium"} · ${p.approved?"approved":"pending"}`,variant:p.approved?"border-emerald-400/40 bg-emerald-500/10 text-emerald-100":"border-amber-400/40 bg-amber-500/10 text-amber-100"};case"done":return{...p,label:"Run complete",detail:p.content??"Outputs finalised.",variant:"border-emerald-400/40 bg-emerald-500/10 text-emerald-100"};case"error":return{...p,label:"Run error",detail:p.content??"Check diagnostics for details.",variant:"border-rose-400/40 bg-rose-500/10 text-rose-100"};default:return{...p,label:p.type,detail:p.content??"Event received.",variant:"border-slate-400/40 bg-slate-500/10 text-slate-100"}}}),y=c.map(p=>p.detail).filter(Boolean).slice(0,2),z=y.length>0?y:m.slice(-2);return{latestEvents:t,timeline:c,snippet:z,lastUpdated:r,statusTone:T}},[pe,W,Y]),Z=u.useMemo(()=>W.trim().length>0,[W]),[U,H]=u.useState("idle"),Se=u.useCallback(async()=>{if(!Z||typeof navigator>"u"||!navigator.clipboard){H("error");return}try{H("copying"),await navigator.clipboard.writeText(W.trim()),H("copied")}catch(t){console.warn("[OmniDesk] Failed to copy transcript",t),H("error")}},[W,Z]);u.useEffect(()=>{if(U!=="copied")return;const t=window.setTimeout(()=>H("idle"),2e3);return()=>window.clearTimeout(t)},[U]);const M=u.useMemo(()=>{const t=typeof P.batteryPct=="number"?Math.max(0,Math.min(100,Math.round(P.batteryPct))):null,r=typeof P.carbonIntensity=="number"?Math.max(0,Math.round(P.carbonIntensity)):null,m=Number.isFinite(P.cpuLoad1)?Math.max(0,Math.min(100,Math.round(P.cpuLoad1))):0,x=P.activeTabs??0,T=(()=>{const y=t!==null?t*.4:35,z=100-m,p=r!==null?Math.max(0,220-r)/220*100:50,$=Math.max(0,12-x)/12*100,ae=.35*y+.25*z+.25*p+.15*$;return Math.round(Math.max(5,Math.min(98,ae)))})(),c=[{id:"battery",label:t!==null?`${t}% battery reserve`:"Gathering battery telemetry",description:t!==null&&t>=60?"Great reserve for deep work.":"Stay plugged in to build reserve.",achieved:t!==null&&t>=60,icon:He},{id:"carbon",label:r!==null?`${r} gCO₂/kWh grid intensity`:"Estimating regional carbon mix",description:r!==null&&r<=180?"Low-carbon window — ideal for heavy tasks.":"Carbon intensity elevated. Schedule net-heavy work later.",achieved:r!==null&&r<=180,icon:$e},{id:"tabs",label:`${x} active tabs`,description:x<=6?"Lean session profile — memory savings unlocked.":"Consider Hibernate to free resources.",achieved:x<=6,icon:K}];return{batteryPctValue:t,carbonIntensityValue:r,cpuLoad:m,activeTabs:x,ecoScore:T,achievements:c}},[P]),D=u.useMemo(()=>{const t=J.slice(-24),r=t.map(c=>typeof c.batteryPct=="number"?c.batteryPct:null).filter(c=>c!==null),m=t.map(c=>typeof c.carbonIntensity=="number"?c.carbonIntensity:null).filter(c=>c!==null),x=c=>{if(c.length<2)return{delta:0,direction:"flat"};const y=c[c.length-1],z=Math.max(0,c.length-6),p=c[z],$=y-p;return{delta:$,direction:$>1?"up":$<-1?"down":"flat"}},T=c=>{if(c.length<2)return"";const y=Math.min(...c),p=Math.max(...c)-y||1;return c.map(($,ae)=>{const Me=ae/Math.max(c.length-1,1)*100,Pe=100-($-y)/p*80-10;return`${Me.toFixed(2)},${Pe.toFixed(2)}`}).join(" ")};return{battery:{series:r,path:T(r),trend:x(r)},carbon:{series:m,path:T(m),trend:x(m)}}},[J]),Ce={idle:"Agent idle",connecting:"Connecting to Redix…",live:"Streaming answer in real time",complete:"Last run completed",error:"Run encountered an issue"},A=u.useMemo(()=>{const r=2*Math.PI*46,m=Math.max(0,Math.min(100,M.ecoScore)),x=r-m/100*r;return{radius:46,circumference:r,offset:x,clampedScore:m}},[M.ecoScore]),Ee=[{icon:K,label:"Ask Agent",action:async()=>{i("/agent")},color:"from-blue-500 to-cyan-500",description:"Open the agent console to start a guided workflow."},{icon:me,label:"Search Topic",action:async()=>{l("Research"),await I.tabs.create("about:blank")},color:"from-purple-500 to-pink-500",description:"Launch AI-powered research with citations-first results."},{icon:Ke,label:"Research Notes",action:async()=>{l("Research"),await I.tabs.create("about:blank")},color:"from-green-500 to-emerald-500",description:"Capture structured notes that sync with your highlights."},{icon:Xe,label:"Run Playbook",action:()=>{i("/playbooks")},color:"from-orange-500 to-red-500",description:"Automate multi-step workflows with reusable recipes."}],X=u.useMemo(()=>{const t=M.batteryPctValue!==null?`${M.batteryPctValue}%`:"—",r=M.carbonIntensityValue!==null?`${M.carbonIntensityValue} gCO₂/kWh`:"Syncing…",m=`${M.activeTabs}`;return{batteryPct:t,carbonIntensity:r,activeTabs:m}},[M]),ue=async t=>{try{let r=t.url||"about:blank";if(t.sessionId)try{await I.sessions.setActive({sessionId:t.sessionId}),await new Promise(T=>setTimeout(T,200));const x=await I.tabs.list();if(x.length>0){!x.find(c=>c.active)&&x[0]&&await I.tabs.activate({id:x[0].id});return}(!r||r==="about:blank")&&(r="about:blank")}catch(x){console.warn("Failed to set active session:",x)}if(t.type==="Research"?l("Research"):t.type==="Trade"&&l("Trade"),!await I.tabs.create(r))throw new Error("Failed to create tab");await new Promise(x=>setTimeout(x,100))}catch(r){console.error("Failed to continue session:",r);try{await I.tabs.create("about:blank"),F({type:"workspace:resume-session",workspaceId:t.sessionId??null,message:`Started fallback tab for session "${t.title}"`})}catch(m){console.error("Failed to create fallback tab:",m)}}},B=u.useCallback(async t=>{const r=t.trim();if(!r){console.warn("[OmniDesk] Empty search query, ignoring");return}if(h){console.warn("[OmniDesk] Search already in progress, ignoring");return}if(d(!0),console.log("[OmniDesk] Launching search:",r),r.trim().startsWith("@live")||r.trim().startsWith("@ask")){ie(r),g(!0),d(!1);return}const x=a.find(y=>y.id===o),T=x?.url==="about:blank"||!x?.url||x?.url?.startsWith("about:"),c=bt(r);l("Research");try{if(T&&x)try{console.log("[OmniDesk] Navigating existing tab:",x.id,"to:",c),await I.tabs.navigate(x.id,c),S(""),console.log("[OmniDesk] Navigation successful");return}catch(p){console.warn("[OmniDesk] Failed to navigate existing tab, creating new one:",p)}console.log("[OmniDesk] Creating new tab with URL:",c);const y=await I.tabs.create(c);(y&&typeof y=="object"&&"success"in y?y.success!==!1:!!y)?console.log("[OmniDesk] Tab created successfully:",y):(console.warn("[OmniDesk] Tab creation failed, using fallback"),ge({url:c,title:`Search: ${r}`}),F({type:"workspace:launch-fallback",message:"IPC unavailable, opened search in fallback tab."}),typeof window<"u"&&window.open(c,"_blank","noopener,noreferrer")),S("")}catch(y){console.error("[OmniDesk] Search launch error:",y),ge({url:c,title:`Search: ${r}`}),F({type:"workspace:launch-error",message:"Encountered an error launching the flow. Using fallback tab.",payload:{error:y instanceof Error?y.message:String(y)}}),typeof window<"u"&&window.open(c,"_blank","noopener,noreferrer")}finally{d(!1)}},[F,l,a,o,h]),O=a.find(t=>t.id===o),ee=O?.url==="about:blank"||!O?.url||O?.url?.startsWith("about:")||O?.url?.startsWith("ob://newtab")||O?.url?.startsWith("ob://home"),te=s||a.length===0||!O||ee;if(!te)return null;const De=n==="overlay"?"absolute inset-0 z-20 flex h-full w-full overflow-auto bg-gradient-to-br from-[#131722] via-[#171B2A] to-[#10131C] px-6 py-8":n==="split"?"flex h-full w-full overflow-auto bg-gradient-to-br from-[#131722] via-[#171B2A] to-[#10131C] px-6 py-8":"flex h-full w-full overflow-auto bg-gradient-to-br from-[#0F121C] via-[#131827] to-[#0F121C] px-6 py-8",Re={minHeight:"100%",width:"100%",position:n==="overlay"?"absolute":"relative",zIndex:n==="overlay"?20:1,pointerEvents:"auto"},Te=async()=>{L(!0);try{await b(),F({type:"workspace:manual-refresh",message:"Dashboard refreshed"})}finally{L(!1)}},Ie=u.useMemo(()=>Array.from({length:2}),[]),Le=u.useMemo(()=>Array.from({length:3}),[]);return u.useEffect(()=>{typeof window<"u"&&window.IS_DEV!==void 0&&console.log("[OmniDesk] Rendering dashboard:",{shouldShowDashboard:te,forceShow:s,tabsLength:a.length,activeTab:O,isAboutBlank:ee,variant:n})},[te,s,a.length,O,ee,n]),e.jsxs("div",{className:De,"data-onboarding":"dashboard",style:Re,children:[e.jsxs("div",{className:"mx-auto flex h-full w-full max-w-6xl flex-col gap-6 xl:flex-row",style:{minHeight:"100%"},children:[e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},className:"rounded-3xl border border-slate-800/70 bg-slate-900/70 px-6 py-7 shadow-2xl shadow-black/30",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.32em] text-slate-400",children:"Regenerative Command Center"}),e.jsx("h1",{className:"mt-3 text-3xl font-semibold text-slate-100 sm:text-4xl",children:"Guide your next deep work session with OmniBrowser & Redix"}),e.jsx("p",{className:"mt-3 max-w-2xl text-sm text-slate-400",children:"Spin up an agent, resume an exploration, or launch a new search. Your flow state starts here."}),e.jsxs("form",{className:"mt-6 space-y-3",onSubmit:t=>{t.preventDefault(),B(v)},children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row",children:[e.jsxs("div",{className:"flex min-h-[52px] flex-1 items-center gap-3 rounded-2xl border border-slate-700/60 bg-slate-800/70 px-4 py-3 text-slate-200 focus-within:border-blue-500/60",children:[e.jsx(me,{size:18,className:"text-blue-400"}),e.jsx("input",{value:v,onChange:t=>S(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),B(v))},onClick:t=>{t.stopPropagation()},placeholder:"Search the open web, knowledge base, or ask Redix…",className:"flex-1 bg-transparent text-sm outline-none placeholder:text-slate-500",style:{pointerEvents:"auto",zIndex:10},autoFocus:!1,tabIndex:0})]}),e.jsx("button",{type:"submit",onClick:t=>{t.preventDefault(),t.stopPropagation(),B(v)},disabled:h||!v.trim(),className:"inline-flex items-center justify-center gap-2 rounded-2xl border border-blue-500/60 bg-blue-500/20 px-5 py-3 text-sm font-semibold text-blue-100 shadow-[0_10px_40px_-20px_rgba(59,130,246,0.8)] transition hover:border-blue-400 hover:bg-blue-500/30 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-60 disabled:cursor-not-allowed",style:{pointerEvents:"auto",zIndex:10},children:h?e.jsxs(e.Fragment,{children:[e.jsx(we,{size:16,className:"animate-spin"}),e.jsx("span",{children:"Launching..."})]}):"Launch Flow"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-slate-400",children:ht.map(t=>e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),!h&&(S(t),B(t))},disabled:h,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),r.stopPropagation(),S(t),B(t))},className:"rounded-full border border-slate-700/60 bg-slate-800/60 px-3 py-1.5 transition hover:border-blue-500/50 hover:bg-slate-800/80 hover:text-blue-200 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-50 disabled:cursor-not-allowed",style:{pointerEvents:"auto",zIndex:10},children:t},t))})]})]}),e.jsx(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1,duration:.4},className:"grid gap-3 sm:grid-cols-2 xl:grid-cols-3",children:Ee.map(t=>{const r=t.icon;return e.jsxs(N.button,{onClick:m=>{m.preventDefault(),m.stopPropagation(),!h&&t.action()},onKeyDown:m=>{if(m.key==="Enter"||m.key===" "){if(m.preventDefault(),m.stopPropagation(),h)return;t.action()}},disabled:h,whileHover:h?{}:{y:-4,scale:1.02},whileTap:h?{}:{scale:.96},transition:{type:"spring",stiffness:400,damping:17},className:`group flex h-full flex-col justify-between gap-4 rounded-2xl border border-slate-800/70 bg-slate-900/60 px-5 py-6 text-left shadow-[0_12px_40px_-24px_rgba(15,23,42,0.9)] transition hover:border-slate-700/70 hover:bg-slate-900/80 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500/50 ${h?"opacity-60 cursor-not-allowed":""}`,style:{pointerEvents:"auto",zIndex:10},children:[e.jsx("span",{className:`inline-flex h-11 w-11 items-center justify-center rounded-xl bg-gradient-to-br ${t.color} text-white shadow-[0_15px_30px_-20px_currentColor]`,children:e.jsx(r,{className:"h-5 w-5"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100 group-hover:text-white",children:t.label}),t.description?e.jsx("p",{className:"text-xs leading-snug text-slate-400 group-hover:text-slate-300",children:t.description}):null]})]},t.label)})}),e.jsxs(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.16,duration:.4},className:"rounded-3xl border border-violet-500/30 bg-violet-500/10 px-6 py-5 text-violet-100 shadow-[0_45px_120px_-60px_rgba(139,92,246,0.6)]",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-xl border border-violet-400/40 bg-violet-500/20",children:e.jsx(ze,{size:16})}),"Live Redix Pulse"]}),e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-[11px] ${_.statusTone.tone}`,children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-current"}),Ce[Y]]})]}),e.jsxs("div",{className:"mt-4 space-y-3 text-sm text-purple-100/90",children:[de?e.jsxs("div",{className:"rounded-2xl border border-violet-400/30 bg-violet-500/10 px-4 py-3 text-xs text-purple-100/80",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-[0.28em] text-purple-200/70",children:"Last goal"}),e.jsx("p",{className:"mt-2 text-sm text-purple-100",children:de})]}):null,e.jsxs("div",{className:"rounded-2xl border border-violet-400/20 bg-violet-500/10 px-4 py-4",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-[0.3em] text-purple-200/70",children:"Preview"}),e.jsx("div",{className:"mt-2 text-xs text-purple-100/80",children:e.jsx(re,{mode:"popLayout",children:_.snippet.length>0?_.snippet.map((t,r)=>e.jsx(N.p,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.25},className:"leading-relaxed",children:t},`${t}-${r}`)):e.jsx(N.p,{initial:{opacity:.6},animate:{opacity:1},className:"text-purple-200/70",children:"No live transcript yet. Kick off a prompt to watch the agent stream."})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[e.jsxs("button",{type:"button",onClick:Se,disabled:!Z||U==="copying",className:"inline-flex items-center gap-1 rounded-full border border-violet-400/40 bg-violet-500/15 px-3 py-1 font-medium text-purple-100 transition hover:border-violet-300/60 hover:bg-violet-500/25 disabled:cursor-not-allowed disabled:opacity-60",children:[e.jsx(Ve,{size:12}),U==="copied"?"Copied!":U==="copying"?"Copying…":"Copy transcript"]}),e.jsxs("button",{type:"button",onClick:()=>i("/agent"),className:"inline-flex items-center gap-1 rounded-full border border-violet-400/40 bg-violet-500/15 px-3 py-1 font-medium text-purple-100 transition hover:border-violet-300/60 hover:bg-violet-500/25",children:[e.jsx(Qe,{size:12}),"View run log"]}),e.jsxs("button",{type:"button",onClick:()=>i("/agent"),className:"inline-flex items-center gap-1 rounded-full border border-violet-400/40 bg-violet-500/15 px-3 py-1 font-medium text-purple-100 transition hover:border-violet-300/60 hover:bg-violet-500/25",children:[e.jsx(Ze,{size:12}),"Launch prompt"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[11px] uppercase tracking-[0.28em] text-purple-200/70",children:"Timeline"}),e.jsx("div",{className:"mt-2 space-y-2",children:e.jsx(re,{initial:!1,children:_.timeline.length>0?_.timeline.map(t=>e.jsxs(N.div,{initial:{opacity:0,x:8},animate:{opacity:1,x:0},exit:{opacity:0,x:-8},transition:{duration:.2},className:`flex items-center justify-between rounded-xl px-3 py-2 text-[11px] ${t.variant}`,children:[e.jsx("span",{className:"capitalize",children:t.label}),e.jsx("span",{className:"text-purple-300/70",children:G(t.timestamp,{addSuffix:!0})})]},t.id)):e.jsx(N.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},className:"rounded-xl border border-dashed border-violet-400/30 px-4 py-3 text-[11px] text-purple-200/70",children:"No agent events yet — run a plan or quick prompt to populate this stream."})})})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-between gap-2 text-xs",children:[e.jsx("div",{className:"text-purple-200/60",children:_.lastUpdated?`Updated ${G(_.lastUpdated,{addSuffix:!0})}`:"Awaiting first signal"}),e.jsx("button",{type:"button",onClick:()=>i("/agent"),className:"inline-flex items-center gap-2 rounded-full border border-violet-400/40 bg-violet-500/20 px-3 py-1.5 text-xs font-medium text-purple-100 hover:border-violet-300/60 hover:bg-violet-500/30",children:"Open agent console"})]})]}),e.jsx(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.4},className:"rounded-3xl border border-slate-800/60 bg-slate-900/60 px-6 py-5 shadow-lg",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-slate-400",children:[e.jsx(Ge,{size:16,className:"text-slate-300"}),e.jsx("span",{children:"Pro tip:"}),e.jsx("span",{className:"text-slate-300",children:"Drag any research tab into Redix MindMap to instantly connect ideas."})]})})]}),e.jsxs("aside",{className:"w-full flex-shrink-0 space-y-4 xl:w-[360px]",children:[e.jsxs(N.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},transition:{duration:.4},className:"rounded-2xl border border-slate-800/70 bg-slate-900/70 p-5 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between text-sm font-semibold text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{size:16}),"Continue Session"]}),e.jsx("button",{onClick:Te,className:"rounded-full border border-slate-700/60 p-1.5 text-slate-400 transition hover:border-slate-500/60 hover:text-slate-200",title:"Refresh",children:e.jsx(Fe,{size:14,className:w?"animate-spin":""})})]}),e.jsx("div",{className:"space-y-3",children:f?Ie.map((t,r)=>e.jsxs(N.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:r*.1,duration:.3},className:"h-[86px] w-full rounded-xl border border-slate-800/60 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-5 w-16 rounded-full bg-slate-800/60 animate-pulse"}),e.jsx("div",{className:"h-4 w-20 rounded-full bg-slate-800/60 animate-pulse"})]}),e.jsx("div",{className:"h-5 w-3/4 rounded bg-slate-800/60 animate-pulse"})]},`session-skeleton-${r}`)):k.length>0?k.map((t,r)=>e.jsxs("button",{onClick:m=>{m.preventDefault(),m.stopPropagation(),ue(t)},onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),m.stopPropagation(),ue(t))},className:"group w-full rounded-xl border border-slate-800/60 bg-slate-900/60 px-4 py-3 text-left transition hover:border-slate-600/60 hover:bg-slate-900 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500/50",style:{pointerEvents:"auto",zIndex:10},children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[e.jsx("span",{className:`rounded-full px-2 py-0.5 text-[11px] ${t.type==="Research"?"bg-purple-500/20 text-purple-300":t.type==="Trade"?"bg-emerald-500/20 text-emerald-300":"bg-blue-500/20 text-blue-200"}`,children:t.type}),e.jsx("span",{children:G(t.timestamp,{addSuffix:!0})})]}),e.jsx("div",{className:"mt-2 text-sm font-medium text-slate-100 group-hover:text-white",children:t.title})]},r)):e.jsx("div",{className:"rounded-xl border border-dashed border-slate-700/60 px-4 py-6 text-center text-xs text-slate-500",children:"We’ll keep your auto-snapshots here for quick handoffs."})})]}),e.jsxs(N.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},transition:{delay:.1,duration:.4},className:"rounded-2xl border border-slate-800/70 bg-slate-900/70 p-5 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-semibold text-slate-300",children:[e.jsx(Ye,{size:16}),"Recent Workspaces"]}),e.jsx("div",{className:"space-y-2",children:E?Le.map((t,r)=>e.jsx(N.div,{initial:{opacity:0,x:-8},animate:{opacity:1,x:0},transition:{delay:r*.08,duration:.3},className:"h-14 w-full rounded-xl border border-slate-800/60 bg-slate-900/40 p-3 flex items-center",children:e.jsx("div",{className:"h-4 w-2/3 rounded bg-slate-800/60 animate-pulse"})},`workspace-skeleton-${r}`)):C.length>0?C.map(t=>e.jsxs("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),i(`/w/${t.id}`)},onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),r.stopPropagation(),i(`/w/${t.id}`))},className:"flex w-full items-center justify-between rounded-xl border border-slate-800/60 bg-slate-900/60 px-4 py-3 text-left text-sm text-slate-200 transition hover:border-slate-600/70 hover:text-white cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500/50",style:{pointerEvents:"auto",zIndex:10},children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx("span",{className:"text-xs text-slate-500",children:"Open"})]},t.id)):e.jsx("div",{className:"rounded-xl border border-dashed border-slate-700/60 px-4 py-6 text-center text-xs text-slate-500",children:"Create a workspace to keep your Redix graph evolving."})})]}),e.jsxs(N.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},transition:{delay:.2,duration:.4},className:"overflow-hidden rounded-2xl border border-emerald-500/30 bg-gradient-to-br from-emerald-950/80 via-emerald-900/70 to-emerald-950/90 p-5 text-emerald-100 shadow-lg shadow-emerald-900/50",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-xl border border-emerald-400/40 bg-emerald-500/10",children:e.jsx(Je,{size:16})}),"Eco Scoreboard"]}),e.jsxs("div",{className:"text-right text-xs text-emerald-200/70",children:[e.jsx("div",{className:"uppercase tracking-[0.3em] text-emerald-300/60",children:"Eco score"}),e.jsx("div",{className:"text-xl font-semibold text-emerald-100",children:A.clampedScore})]})]}),e.jsxs("div",{className:"mt-5 grid gap-5 md:grid-cols-[150px,1fr]",children:[e.jsxs("div",{className:"relative mx-auto flex h-36 w-36 items-center justify-center",children:[e.jsxs("svg",{width:"150",height:"150",viewBox:"0 0 150 150",className:"absolute inset-0 text-emerald-500/40",children:[e.jsx("circle",{cx:"75",cy:"75",r:A.radius,stroke:"currentColor",strokeWidth:"10",fill:"none",className:"opacity-30"}),e.jsx(N.circle,{cx:"75",cy:"75",r:A.radius,stroke:"url(#ecoGradient)",strokeWidth:"10",strokeLinecap:"round",fill:"none",strokeDasharray:A.circumference,strokeDashoffset:A.offset,initial:{strokeDashoffset:A.circumference},animate:{strokeDashoffset:A.offset},transition:{duration:.8,ease:"easeOut"},transform:"rotate(-90 75 75)"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"ecoGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#34d399"}),e.jsx("stop",{offset:"100%",stopColor:"#22d3ee"})]})})]}),e.jsxs("div",{className:"relative z-10 text-center",children:[e.jsx(qe,{size:28,className:"mx-auto text-emerald-300"}),e.jsx("div",{className:"mt-2 text-3xl font-semibold text-emerald-50",children:A.clampedScore}),e.jsx("div",{className:"text-[11px] uppercase tracking-[0.28em] text-emerald-200/70",children:"Regenerative"})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 rounded-2xl border border-emerald-400/20 bg-emerald-500/5 p-4 text-xs text-emerald-100/80",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.28em] text-emerald-200/70",children:"Battery"}),e.jsx("p",{className:"mt-2 text-lg font-semibold text-emerald-50",children:X.batteryPct})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.28em] text-emerald-200/70",children:"Carbon"}),e.jsx("p",{className:"mt-2 text-sm font-semibold text-emerald-50 leading-tight",children:X.carbonIntensity})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.28em] text-emerald-200/70",children:"Active Tabs"}),e.jsx("p",{className:"mt-2 text-lg font-semibold text-emerald-50",children:X.activeTabs})]})]}),e.jsx("div",{className:"space-y-2",children:M.achievements.map(t=>{const r=t.icon;return e.jsxs("div",{className:"flex items-start gap-3 rounded-2xl border border-emerald-400/20 bg-emerald-500/10 px-4 py-3 text-xs text-emerald-100/80",children:[e.jsx("span",{className:`mt-0.5 inline-flex h-7 w-7 items-center justify-center rounded-xl border ${t.achieved?"border-emerald-400/60 bg-emerald-500/20 text-emerald-200":"border-emerald-400/20 bg-emerald-500/5 text-emerald-200/60"}`,children:t.achieved?e.jsx(Ue,{size:14}):e.jsx(r,{size:14})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-emerald-100",children:t.label}),e.jsx("div",{className:"mt-1 text-[11px] text-emerald-200/70",children:t.description})]})]},t.id)})}),e.jsxs("div",{className:"rounded-2xl border border-emerald-400/20 bg-emerald-500/10 px-4 py-4 text-xs text-emerald-100/80",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-emerald-100",children:"Trends"}),e.jsxs("span",{className:"text-[11px] uppercase tracking-[0.28em] text-emerald-200/70",children:["Last ",Math.min(J.length,24)," samples"]})]}),e.jsxs("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-100",children:["Battery",D.battery.trend.direction==="up"?e.jsx(he,{size:12,className:"text-emerald-300"}):D.battery.trend.direction==="down"?e.jsx(xe,{size:12,className:"text-amber-300"}):null,e.jsxs("span",{className:"text-[11px] text-emerald-200/70",children:[D.battery.trend.delta>0?`+${D.battery.trend.delta.toFixed(1)}`:D.battery.trend.delta.toFixed(1),"%"]})]}),e.jsx("div",{className:"relative h-16 overflow-hidden rounded-xl border border-emerald-400/20 bg-emerald-500/10",children:D.battery.path?e.jsx("svg",{viewBox:"0 0 100 100",className:"absolute inset-0 h-full w-full text-emerald-300",children:e.jsx("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"3",points:D.battery.path})}):e.jsx("div",{className:"flex h-full items-center justify-center text-[11px] text-emerald-200/60",children:"Not enough data"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-100",children:["Carbon",D.carbon.trend.direction==="down"?e.jsx(xe,{size:12,className:"text-emerald-300"}):D.carbon.trend.direction==="up"?e.jsx(he,{size:12,className:"text-amber-300"}):null,e.jsxs("span",{className:"text-[11px] text-emerald-200/70",children:[D.carbon.trend.delta>0?`+${D.carbon.trend.delta.toFixed(0)}`:D.carbon.trend.delta.toFixed(0)," ","g"]})]}),e.jsx("div",{className:"relative h-16 overflow-hidden rounded-xl border border-emerald-400/20 bg-emerald-500/10",children:D.carbon.path?e.jsx("svg",{viewBox:"0 0 100 100",className:"absolute inset-0 h-full w-full text-emerald-200",children:e.jsx("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"3",points:D.carbon.path})}):e.jsx("div",{className:"flex h-full items-center justify-center text-[11px] text-emerald-200/60",children:"Awaiting carbon samples"})})]})]})]})]})]}),ce&&e.jsxs("p",{className:"mt-5 text-[11px] text-emerald-100/60",children:["Updated ",G(ce,{addSuffix:!0})]}),e.jsxs("p",{className:"mt-1 text-[11px] text-emerald-100/70",children:[Ne,le?` • ${le}`:""]})]})]})]}),e.jsx(ct,{query:oe,isOpen:j,onClose:()=>{g(!1),ie("")}})]})}export{He as B,Be as C,Ke as F,Je as L,Mt as O,Lt as R,he as T,Xe as W,xe as a,q as b,ge as c,et as u};
//# sourceMappingURL=OmniDesk-XqA-NCuc.js.map

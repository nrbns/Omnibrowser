{"version":3,"file":"TopNav-D0Oba9Rq.js","sources":["../../node_modules/lucide-react/dist/esm/icons/arrow-left.js","../../node_modules/lucide-react/dist/esm/icons/briefcase.js","../../node_modules/lucide-react/dist/esm/icons/calculator.js","../../node_modules/lucide-react/dist/esm/icons/chevron-down.js","../../node_modules/lucide-react/dist/esm/icons/circle-alert.js","../../node_modules/lucide-react/dist/esm/icons/circle-user.js","../../node_modules/lucide-react/dist/esm/icons/code.js","../../node_modules/lucide-react/dist/esm/icons/history.js","../../node_modules/lucide-react/dist/esm/icons/house.js","../../node_modules/lucide-react/dist/esm/icons/layers.js","../../node_modules/lucide-react/dist/esm/icons/moon.js","../../node_modules/lucide-react/dist/esm/icons/pen.js","../../node_modules/lucide-react/dist/esm/icons/picture-in-picture.js","../../node_modules/lucide-react/dist/esm/icons/scissors.js","../../node_modules/lucide-react/dist/esm/icons/user.js","../../node_modules/framer-motion/dist/es/context/DeprecatedLayoutGroupContext.mjs","../../node_modules/framer-motion/dist/es/utils/use-is-mounted.mjs","../../node_modules/framer-motion/dist/es/utils/use-force-update.mjs","../../node_modules/framer-motion/dist/es/projection/node/group.mjs","../../node_modules/framer-motion/dist/es/components/LayoutGroup/index.mjs","../../src/components/TopNav/ModeSwitch.tsx","../../src/components/TopNav/Omnibox.tsx","../../src/components/TopNav/ProgressBar.tsx","../../src/components/sessions/SessionSwitcher.tsx","../../src/components/sessions/ProfileQuickSwitcher.tsx","../../src/components/sessions/ContainerSwitcher.tsx","../../src/state/themeStore.ts","../../src/components/TopNav/ThemeSwitcher.tsx","../../src/components/TopNav/PrivacySentinelBadge.tsx","../../src/components/TopNav/ShieldsButton.tsx","../../src/components/TopNav/NetworkButton.tsx","../../src/components/layout/TopNav.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ArrowLeft = createLucideIcon(\"ArrowLeft\", [\n  [\"path\", { d: \"m12 19-7-7 7-7\", key: \"1l729n\" }],\n  [\"path\", { d: \"M19 12H5\", key: \"x3x0zl\" }]\n]);\n\nexport { ArrowLeft as default };\n//# sourceMappingURL=arrow-left.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Briefcase = createLucideIcon(\"Briefcase\", [\n  [\"path\", { d: \"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16\", key: \"jecpp\" }],\n  [\"rect\", { width: \"20\", height: \"14\", x: \"2\", y: \"6\", rx: \"2\", key: \"i6l2r4\" }]\n]);\n\nexport { Briefcase as default };\n//# sourceMappingURL=briefcase.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Calculator = createLucideIcon(\"Calculator\", [\n  [\"rect\", { width: \"16\", height: \"20\", x: \"4\", y: \"2\", rx: \"2\", key: \"1nb95v\" }],\n  [\"line\", { x1: \"8\", x2: \"16\", y1: \"6\", y2: \"6\", key: \"x4nwl0\" }],\n  [\"line\", { x1: \"16\", x2: \"16\", y1: \"14\", y2: \"18\", key: \"wjye3r\" }],\n  [\"path\", { d: \"M16 10h.01\", key: \"1m94wz\" }],\n  [\"path\", { d: \"M12 10h.01\", key: \"1nrarc\" }],\n  [\"path\", { d: \"M8 10h.01\", key: \"19clt8\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }],\n  [\"path\", { d: \"M12 18h.01\", key: \"mhygvu\" }],\n  [\"path\", { d: \"M8 18h.01\", key: \"lrp35t\" }]\n]);\n\nexport { Calculator as default };\n//# sourceMappingURL=calculator.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ChevronDown = createLucideIcon(\"ChevronDown\", [\n  [\"path\", { d: \"m6 9 6 6 6-6\", key: \"qrunsl\" }]\n]);\n\nexport { ChevronDown as default };\n//# sourceMappingURL=chevron-down.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CircleAlert = createLucideIcon(\"CircleAlert\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"8\", y2: \"12\", key: \"1pkeuh\" }],\n  [\"line\", { x1: \"12\", x2: \"12.01\", y1: \"16\", y2: \"16\", key: \"4dfq90\" }]\n]);\n\nexport { CircleAlert as default };\n//# sourceMappingURL=circle-alert.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CircleUser = createLucideIcon(\"CircleUser\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"circle\", { cx: \"12\", cy: \"10\", r: \"3\", key: \"ilqhr7\" }],\n  [\"path\", { d: \"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662\", key: \"154egf\" }]\n]);\n\nexport { CircleUser as default };\n//# sourceMappingURL=circle-user.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Code = createLucideIcon(\"Code\", [\n  [\"polyline\", { points: \"16 18 22 12 16 6\", key: \"z7tu5w\" }],\n  [\"polyline\", { points: \"8 6 2 12 8 18\", key: \"1eg1df\" }]\n]);\n\nexport { Code as default };\n//# sourceMappingURL=code.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst History = createLucideIcon(\"History\", [\n  [\"path\", { d: \"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\", key: \"1357e3\" }],\n  [\"path\", { d: \"M3 3v5h5\", key: \"1xhq8a\" }],\n  [\"path\", { d: \"M12 7v5l4 2\", key: \"1fdv2h\" }]\n]);\n\nexport { History as default };\n//# sourceMappingURL=history.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst House = createLucideIcon(\"House\", [\n  [\"path\", { d: \"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8\", key: \"5wwlr5\" }],\n  [\n    \"path\",\n    {\n      d: \"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\",\n      key: \"1d0kgt\"\n    }\n  ]\n]);\n\nexport { House as default };\n//# sourceMappingURL=house.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Layers = createLucideIcon(\"Layers\", [\n  [\n    \"path\",\n    {\n      d: \"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z\",\n      key: \"8b97xw\"\n    }\n  ],\n  [\"path\", { d: \"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65\", key: \"dd6zsq\" }],\n  [\"path\", { d: \"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65\", key: \"ep9fru\" }]\n]);\n\nexport { Layers as default };\n//# sourceMappingURL=layers.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Moon = createLucideIcon(\"Moon\", [\n  [\"path\", { d: \"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z\", key: \"a7tn18\" }]\n]);\n\nexport { Moon as default };\n//# sourceMappingURL=moon.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Pen = createLucideIcon(\"Pen\", [\n  [\n    \"path\",\n    {\n      d: \"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z\",\n      key: \"1a8usu\"\n    }\n  ]\n]);\n\nexport { Pen as default };\n//# sourceMappingURL=pen.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst PictureInPicture = createLucideIcon(\"PictureInPicture\", [\n  [\n    \"path\",\n    {\n      d: \"M8 4.5v5H3m-1-6 6 6m13 0v-3c0-1.16-.84-2-2-2h-7m-9 9v2c0 1.05.95 2 2 2h3\",\n      key: \"bcd8fb\"\n    }\n  ],\n  [\"rect\", { width: \"10\", height: \"7\", x: \"12\", y: \"13.5\", ry: \"2\", key: \"136fx3\" }]\n]);\n\nexport { PictureInPicture as default };\n//# sourceMappingURL=picture-in-picture.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Scissors = createLucideIcon(\"Scissors\", [\n  [\"circle\", { cx: \"6\", cy: \"6\", r: \"3\", key: \"1lh9wr\" }],\n  [\"path\", { d: \"M8.12 8.12 12 12\", key: \"1alkpv\" }],\n  [\"path\", { d: \"M20 4 8.12 15.88\", key: \"xgtan2\" }],\n  [\"circle\", { cx: \"6\", cy: \"18\", r: \"3\", key: \"fqmcym\" }],\n  [\"path\", { d: \"M14.8 14.8 20 20\", key: \"ptml3r\" }]\n]);\n\nexport { Scissors as default };\n//# sourceMappingURL=scissors.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst User = createLucideIcon(\"User\", [\n  [\"path\", { d: \"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\", key: \"975kel\" }],\n  [\"circle\", { cx: \"12\", cy: \"7\", r: \"4\", key: \"17ys0d\" }]\n]);\n\nexport { User as default };\n//# sourceMappingURL=user.js.map\n","import { createContext } from 'react';\n\n/**\n * Note: Still used by components generated by old versions of Framer\n *\n * @deprecated\n */\nconst DeprecatedLayoutGroupContext = createContext(null);\n\nexport { DeprecatedLayoutGroupContext };\n","import { useRef } from 'react';\nimport { useIsomorphicLayoutEffect } from './use-isomorphic-effect.mjs';\n\nfunction useIsMounted() {\n    const isMounted = useRef(false);\n    useIsomorphicLayoutEffect(() => {\n        isMounted.current = true;\n        return () => {\n            isMounted.current = false;\n        };\n    }, []);\n    return isMounted;\n}\n\nexport { useIsMounted };\n","import { useState, useCallback } from 'react';\nimport { useIsMounted } from './use-is-mounted.mjs';\nimport { frame } from '../frameloop/frame.mjs';\n\nfunction useForceUpdate() {\n    const isMounted = useIsMounted();\n    const [forcedRenderCount, setForcedRenderCount] = useState(0);\n    const forceRender = useCallback(() => {\n        isMounted.current && setForcedRenderCount(forcedRenderCount + 1);\n    }, [forcedRenderCount]);\n    /**\n     * Defer this to the end of the next animation frame in case there are multiple\n     * synchronous calls.\n     */\n    const deferredForceRender = useCallback(() => frame.postRender(forceRender), [forceRender]);\n    return [deferredForceRender, forcedRenderCount];\n}\n\nexport { useForceUpdate };\n","const notify = (node) => !node.isLayoutDirty && node.willUpdate(false);\nfunction nodeGroup() {\n    const nodes = new Set();\n    const subscriptions = new WeakMap();\n    const dirtyAll = () => nodes.forEach(notify);\n    return {\n        add: (node) => {\n            nodes.add(node);\n            subscriptions.set(node, node.addEventListener(\"willUpdate\", dirtyAll));\n        },\n        remove: (node) => {\n            nodes.delete(node);\n            const unsubscribe = subscriptions.get(node);\n            if (unsubscribe) {\n                unsubscribe();\n                subscriptions.delete(node);\n            }\n            dirtyAll();\n        },\n        dirty: dirtyAll,\n    };\n}\n\nexport { nodeGroup };\n","\"use client\";\nimport { jsx } from 'react/jsx-runtime';\nimport { useContext, useRef, useMemo } from 'react';\nimport { LayoutGroupContext } from '../../context/LayoutGroupContext.mjs';\nimport { DeprecatedLayoutGroupContext } from '../../context/DeprecatedLayoutGroupContext.mjs';\nimport { useForceUpdate } from '../../utils/use-force-update.mjs';\nimport { nodeGroup } from '../../projection/node/group.mjs';\n\nconst shouldInheritGroup = (inherit) => inherit === true;\nconst shouldInheritId = (inherit) => shouldInheritGroup(inherit === true) || inherit === \"id\";\nconst LayoutGroup = ({ children, id, inherit = true }) => {\n    const layoutGroupContext = useContext(LayoutGroupContext);\n    const deprecatedLayoutGroupContext = useContext(DeprecatedLayoutGroupContext);\n    const [forceRender, key] = useForceUpdate();\n    const context = useRef(null);\n    const upstreamId = layoutGroupContext.id || deprecatedLayoutGroupContext;\n    if (context.current === null) {\n        if (shouldInheritId(inherit) && upstreamId) {\n            id = id ? upstreamId + \"-\" + id : upstreamId;\n        }\n        context.current = {\n            id,\n            group: shouldInheritGroup(inherit)\n                ? layoutGroupContext.group || nodeGroup()\n                : nodeGroup(),\n        };\n    }\n    const memoizedContext = useMemo(() => ({ ...context.current, forceRender }), [key]);\n    return (jsx(LayoutGroupContext.Provider, { value: memoizedContext, children: children }));\n};\n\nexport { LayoutGroup };\n","/**\r\n * ModeSwitch - Browser mode selector\r\n */\r\n\r\nimport { Brain, TrendingUp, Gamepad2, Zap } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst modes = [\r\n  { id: 'Research', icon: Brain, label: 'Research', color: 'text-purple-400', glowColor: 'from-purple-500 via-purple-600 to-purple-500' },\r\n  { id: 'Trade', icon: TrendingUp, label: 'Trade', color: 'text-green-400', glowColor: 'from-green-500 via-emerald-600 to-green-500' },\r\n  { id: 'Games', icon: Gamepad2, label: 'Game', color: 'text-yellow-400', glowColor: 'from-yellow-500 via-amber-600 to-yellow-500' },\r\n  { id: 'Browse', icon: Zap, label: 'Browse', color: 'text-cyan-400', glowColor: 'from-cyan-500 via-blue-600 to-cyan-500' },\r\n];\r\n\r\nexport function ModeSwitch() {\r\n  const { mode, setMode } = useAppStore();\r\n  const navigate = useNavigate();\r\n\r\n  const handleModeChange = (newMode: typeof modes[number]) => {\r\n    setMode(newMode.id as any);\r\n    // All modes stay on home page, agent is accessed separately\r\n    navigate('/');\r\n  };\r\n\r\n  // Map current mode - use mode as-is, default to Research\r\n  const currentMode = mode || 'Research';\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-1 bg-gray-800/60 rounded-lg p-1 border border-gray-700/50 shadow-sm\">\r\n      {modes.map((m) => {\r\n        const Icon = m.icon;\r\n        const isActive = currentMode === m.id;\r\n        \r\n        return (\r\n          <motion.button\r\n            key={m.id}\r\n            onClick={() => handleModeChange(m)}\r\n            whileHover={{ scale: 1.02 }}\r\n            whileTap={{ scale: 0.98 }}\r\n            className={`\r\n              relative flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium\r\n              transition-all duration-200 cursor-pointer\r\n              ${isActive\r\n                ? `bg-gradient-to-r ${m.glowColor} text-white shadow-lg`\r\n                : 'text-gray-400 hover:text-gray-200 hover:bg-gray-700/30'\r\n              }\r\n            `}\r\n            title={m.label}\r\n          >\r\n            <Icon size={16} className={isActive ? 'text-white' : m.color} />\r\n            <span>{m.label}</span>\r\n            {isActive && (\r\n              <motion.div\r\n                className={`absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r ${m.glowColor} rounded-full`}\r\n                initial={{ scaleX: 0 }}\r\n                animate={{ scaleX: 1 }}\r\n                transition={{ type: 'spring', stiffness: 500, damping: 30 }}\r\n              />\r\n            )}\r\n          </motion.button>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n\r\n","/**\r\n * Omnibox - URL bar with autocomplete suggestions and search\r\n * Fully functional search and navigation\r\n */\r\n\r\n// @ts-nocheck\r\n\r\nimport { useState, useEffect, useRef, useCallback, useMemo } from 'react';\r\nimport { Search, Lock, Shield, AlertCircle, Globe, Calculator, Sparkles, Clock } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { TabUpdate, ipcEvents } from '../../lib/ipc-events';\r\nimport { useIPCEvent } from '../../lib/use-ipc-event';\r\nimport { debounce } from 'lodash-es';\r\nimport { useContainerStore } from '../../state/containerStore';\r\nimport { isElectronRuntime } from '../../lib/env';\r\n\r\ninterface Suggestion {\r\n  type: 'history' | 'tab' | 'command' | 'search';\r\n  title: string;\r\n  subtitle?: string;\r\n  url?: string;\r\n  icon?: string;\r\n  action?: SuggestionAction;\r\n  interactive?: boolean;\r\n  badge?: string;\r\n  metadata?: string;\r\n}\r\n\r\ntype SearchEngine = 'google' | 'duckduckgo' | 'wiki' | 'youtube' | 'twitter';\r\n\r\ntype SuggestionAction =\r\n  | { type: 'nav'; url: string; title?: string }\r\n  | { type: 'search'; engine: SearchEngine; query: string }\r\n  | { type: 'ai'; prompt: string }\r\n  | { type: 'agent'; prompt: string }\r\n  | { type: 'calc'; expr: string; result?: string }\r\n  | { type: 'command'; command: string };\r\n\r\ntype LiveResult = {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  snippet?: string;\r\n  source?: string;\r\n  score?: number;\r\n  publishedAt?: string;\r\n};\r\n\r\nconst SEARCH_ENDPOINTS: Record<SearchEngine, string> = {\r\n  google: 'https://www.google.com/search?q=',\r\n  duckduckgo: 'https://duckduckgo.com/?q=',\r\n  wiki: 'https://en.wikipedia.org/wiki/Special:Search?search=',\r\n  youtube: 'https://www.youtube.com/results?search_query=',\r\n  twitter: 'https://twitter.com/search?q=',\r\n};\r\n\r\nconst buildSearchUrl = (engine: SearchEngine, query: string) =>\r\n  `${SEARCH_ENDPOINTS[engine]}${encodeURIComponent(query)}`;\r\n\r\nconst formatCalcResult = (expr: string, result: number | null) => {\r\n  if (result === null || Number.isNaN(result) || !Number.isFinite(result)) {\r\n    return null;\r\n  }\r\n  const formatted =\r\n    Math.abs(result) > 1_000_000 || Math.abs(result) < 0.0001\r\n      ? result.toExponential(6)\r\n      : Number.isInteger(result)\r\n      ? result.toString()\r\n      : result.toPrecision(8).replace(/\\.?0+$/, '');\r\n  return `${expr} = ${formatted}`;\r\n};\r\n\r\nconst evaluateExpression = (raw: string) => {\r\n  const expr = raw.replace(/,/g, '').trim();\r\n  if (!expr) {\r\n    return null;\r\n  }\r\n\r\n  // Only allow safe characters\r\n  if (!/^[0-9+\\-*/().%\\s^]+$/.test(expr)) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    const value = Function(`\"use strict\"; return (${expr.replace(/\\^/g, '**')})`)();\r\n    if (typeof value === 'number' && Number.isFinite(value)) {\r\n      return value;\r\n    }\r\n  } catch {\r\n    return null;\r\n  }\r\n  return null;\r\n};\r\n\r\nconst resolveQuickAction = (input: string): SuggestionAction | null => {\r\n  const trimmed = input.trim();\r\n  if (!trimmed) {\r\n    return null;\r\n  }\r\n\r\n  const lower = trimmed.toLowerCase();\r\n\r\n  if (lower.startsWith('/calc')) {\r\n    const expr = trimmed.slice(5).trim();\r\n    const result = expr ? evaluateExpression(expr) : null;\r\n    return { type: 'calc', expr, result: result ?? undefined };\r\n  }\r\n\r\n  if (lower.startsWith('/ai')) {\r\n    const prompt = trimmed.slice(3).trim();\r\n    return { type: 'ai', prompt };\r\n  }\r\n\r\n  if (lower.startsWith('/g ')) {\r\n    return { type: 'search', engine: 'google', query: trimmed.slice(3).trim() };\r\n  }\r\n\r\n  if (lower.startsWith('/ddg ')) {\r\n    return { type: 'search', engine: 'duckduckgo', query: trimmed.slice(5).trim() };\r\n  }\r\n\r\n  if (lower.startsWith('/wiki ')) {\r\n    return { type: 'search', engine: 'wiki', query: trimmed.slice(6).trim() };\r\n  }\r\n\r\n  if (lower.startsWith('/yt ')) {\r\n    return { type: 'search', engine: 'youtube', query: trimmed.slice(4).trim() };\r\n  }\r\n\r\n  if (lower.startsWith('/t ')) {\r\n    return { type: 'search', engine: 'twitter', query: trimmed.slice(3).trim() };\r\n  }\r\n\r\n  if (trimmed.startsWith('?')) {\r\n    return { type: 'agent', prompt: trimmed.slice(1).trim() };\r\n  }\r\n\r\n  if (lower.startsWith('ask ')) {\r\n    return { type: 'agent', prompt: trimmed.slice(4).trim() };\r\n  }\r\n\r\n  if (trimmed.startsWith('/')) {\r\n    return { type: 'command', command: trimmed.slice(1).trim() };\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst buildSuggestionFromAction = (action: SuggestionAction, rawInput: string): Suggestion | null => {\r\n  switch (action.type) {\r\n    case 'calc': {\r\n      if (!action.expr) {\r\n        return {\r\n          type: 'command',\r\n          title: 'Calculate…',\r\n          subtitle: 'Enter an expression to evaluate',\r\n          action,\r\n        };\r\n      }\r\n      const formatted = formatCalcResult(action.expr, action.result ?? null);\r\n      return {\r\n        type: 'command',\r\n        title: `Calculate: ${action.expr}`,\r\n        subtitle: formatted ?? 'Press enter to evaluate',\r\n        action,\r\n      };\r\n    }\r\n    case 'ai':\r\n      return {\r\n        type: 'command',\r\n        title: `Ask AI assistant${action.prompt ? `: ${action.prompt}` : ''}`,\r\n        subtitle: action.prompt ? 'OmniBrowser agent' : 'Provide a prompt to continue',\r\n        action,\r\n      };\r\n    case 'agent':\r\n      return {\r\n        type: 'command',\r\n        title: `Ask agent${action.prompt ? `: ${action.prompt}` : ''}`,\r\n        subtitle: 'Query the current page context',\r\n        action,\r\n      };\r\n    case 'search': {\r\n      const engineLabel =\r\n        action.engine === 'duckduckgo'\r\n          ? 'DuckDuckGo'\r\n          : action.engine === 'wiki'\r\n          ? 'Wikipedia'\r\n          : action.engine === 'youtube'\r\n          ? 'YouTube'\r\n          : action.engine === 'twitter'\r\n          ? 'Twitter/X'\r\n          : 'Google';\r\n      return {\r\n        type: 'search',\r\n        title: `${engineLabel}: ${action.query || rawInput}`,\r\n        subtitle: buildSearchUrl(action.engine, action.query || rawInput),\r\n        action,\r\n      };\r\n    }\r\n    case 'command':\r\n      return {\r\n        type: 'command',\r\n        title: `Run command: ${action.command || rawInput}`,\r\n        subtitle: 'Press enter to execute via command palette',\r\n        action,\r\n      };\r\n    default:\r\n      return null;\r\n  }\r\n};\r\n\r\nconst RECENTS_STORAGE_KEY = 'omnibox:recent';\r\nconst MAX_RECENTS = 20;\r\n\r\nexport function Omnibox({ onCommandPalette }: { onCommandPalette: () => void }) {\r\n  const { tabs, activeId } = useTabsStore();\r\n  const activeContainerId = useContainerStore((state) => state.activeContainerId);\r\n  const isElectron = isElectronRuntime();\r\n  const formatTabsForEvent = (list: Array<{ id: string; title?: string; url?: string; active?: boolean; mode?: string; containerId?: string; containerName?: string; containerColor?: string; createdAt?: number; lastActiveAt?: number; sessionId?: string; profileId?: string; sleeping?: boolean }>) =>\r\n    list.map((t) => ({\r\n      id: t.id,\r\n      title: t.title || 'New Tab',\r\n      url: t.url || 'about:blank',\r\n      active: Boolean(t.active),\r\n      mode: t.mode,\r\n      containerId: t.containerId,\r\n      containerName: t.containerName,\r\n      containerColor: t.containerColor,\r\n      createdAt: t.createdAt,\r\n      lastActiveAt: t.lastActiveAt,\r\n      sessionId: t.sessionId,\r\n      profileId: t.profileId,\r\n      sleeping: t.sleeping,\r\n    }));\r\n  const [url, setUrl] = useState('');\r\n  const [focused, setFocused] = useState(false);\r\n  const [suggestions, setSuggestions] = useState<Suggestion[]>([]);\r\n  const [selectedIndex, setSelectedIndex] = useState(-1);\r\n  const [siteInfo, setSiteInfo] = useState<{ secure: boolean; shieldCount?: number } | null>(null);\r\n  const [progress, setProgress] = useState(0);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [recentItems, setRecentItems] = useState<Array<{ title: string; url: string; timestamp: number }>>([]);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const [liveResults, setLiveResults] = useState<LiveResult[]>([]);\r\n  const [liveStatus, setLiveStatus] = useState<string | null>(null);\r\n  const liveSessionRef = useRef<{ jobId: string; channel: string } | null>(null);\r\n  const liveUnsubscribeRef = useRef<(() => void) | null>(null);\r\n  const attachIpcListener = useCallback((channel: string, handler: (...args: any[]) => void) => {\r\n    const bridge = (window as any)?.ipc;\r\n    if (!bridge) return;\r\n    if (typeof bridge.on === 'function') {\r\n      bridge.on(channel, handler);\r\n      return;\r\n    }\r\n    if (typeof bridge.addListener === 'function') {\r\n      bridge.addListener(channel, handler);\r\n    }\r\n  }, []);\r\n\r\n  const detachIpcListener = useCallback((channel: string, handler: (...args: any[]) => void) => {\r\n    const bridge = (window as any)?.ipc;\r\n    if (!bridge) return;\r\n    if (typeof bridge.removeListener === 'function') {\r\n      bridge.removeListener(channel, handler);\r\n      return;\r\n    }\r\n    if (typeof bridge.off === 'function') {\r\n      bridge.off(channel, handler);\r\n      return;\r\n    }\r\n    if (typeof bridge.removeEventListener === 'function') {\r\n      bridge.removeEventListener(channel, handler);\r\n    }\r\n  }, []);\r\n\r\n  const activeTab = tabs.find(t => t.id === activeId);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const raw = localStorage.getItem(RECENTS_STORAGE_KEY);\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (Array.isArray(parsed)) {\r\n          setRecentItems(\r\n            parsed\r\n              .filter((item: any) => typeof item?.url === 'string')\r\n              .slice(0, MAX_RECENTS)\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to restore omnibox recents:', error);\r\n    }\r\n  }, []);\r\n\r\n  const rememberRecent = useCallback((title: string, finalUrl: string) => {\r\n    if (!finalUrl || finalUrl.startsWith('about:') || finalUrl.startsWith('ob://')) {\r\n      return;\r\n    }\r\n    setRecentItems((prev) => {\r\n      const filtered = prev.filter((item) => item.url !== finalUrl);\r\n      const next = [{ title: title || finalUrl, url: finalUrl, timestamp: Date.now() }, ...filtered].slice(0, MAX_RECENTS);\r\n      try {\r\n        localStorage.setItem(RECENTS_STORAGE_KEY, JSON.stringify(next));\r\n      } catch (error) {\r\n        console.warn('Failed to persist omnibox recents:', error);\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const stopLiveSession = useCallback(() => {\r\n    if (liveUnsubscribeRef.current) {\r\n      try {\r\n        liveUnsubscribeRef.current();\r\n      } catch {\r\n        // noop\r\n      }\r\n      liveUnsubscribeRef.current = null;\r\n    }\r\n    liveSessionRef.current = null;\r\n  }, []);\r\n\r\n  const handleLiveStep = useCallback((step: any) => {\r\n    if (!step || typeof step !== 'object') {\r\n      return;\r\n    }\r\n\r\n    if (step.type === 'status') {\r\n      setLiveStatus(step.value || null);\r\n      return;\r\n    }\r\n\r\n    if (step.type === 'result' && step.result) {\r\n      setLiveResults((prev) => {\r\n        const existingIndex = prev.findIndex((item) => item.url === step.result.url);\r\n        if (existingIndex >= 0) {\r\n          const updated = prev.slice();\r\n          updated[existingIndex] = { ...updated[existingIndex], ...step.result };\r\n          return updated;\r\n        }\r\n        return [...prev, step.result];\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (step.type === 'complete') {\r\n      setLiveStatus((current) => current ?? 'Live results updated');\r\n      return;\r\n    }\r\n\r\n    if (step.type === 'error') {\r\n      setLiveStatus(step.message || 'Live search failed');\r\n      return;\r\n    }\r\n  }, []);\r\n\r\n  const startLiveSearch = useCallback(\r\n    async (query: string) => {\r\n      const trimmed = query.trim();\r\n      if (!trimmed) {\r\n        return;\r\n      }\r\n\r\n      stopLiveSession();\r\n      setLiveResults([]);\r\n      setLiveStatus('Searching…');\r\n\r\n      try {\r\n        const session = await ipc.liveSearch.start(trimmed, { maxResults: 10 });\r\n        liveSessionRef.current = session;\r\n\r\n        const handler = (_event: any, step: any) => {\r\n          handleLiveStep(step);\r\n        };\r\n\r\n        attachIpcListener(session.channel, handler);\r\n        liveUnsubscribeRef.current = () => detachIpcListener(session.channel, handler);\r\n      } catch (error) {\r\n        console.error('Live search start failed:', error);\r\n        setLiveStatus('Live search failed');\r\n      }\r\n    },\r\n    [attachIpcListener, detachIpcListener, handleLiveStep, stopLiveSession],\r\n  );\r\n\r\n  // Listen for tab updates\r\n  useIPCEvent<TabUpdate[]>('tabs:updated', (tabList) => {\r\n    const tab = Array.isArray(tabList) ? tabList.find((t: any) => t.active) : null;\r\n    if (tab && !focused) {\r\n      setUrl(tab.url || '');\r\n      try {\r\n        const urlObj = new URL(tab.url || 'about:blank');\r\n        setSiteInfo({\r\n          secure: urlObj.protocol === 'https:',\r\n        });\r\n      } catch {\r\n        setSiteInfo(null);\r\n      }\r\n    }\r\n  }, [activeId, focused]);\r\n\r\n  // Listen for progress updates\r\n  useIPCEvent<{ tabId: string; progress: number }>('tabs:progress', (data) => {\r\n    if (data.tabId === activeId) {\r\n      setProgress(data.progress);\r\n      setIsLoading(data.progress < 100 && data.progress > 0);\r\n    }\r\n  }, [activeId]);\r\n\r\n  // Search suggestions with history and tabs\r\n  const searchSuggestions = useCallback(\r\n    debounce(async (query: string) => {\r\n      const normalized = query ?? '';\r\n      const queryLower = normalized.toLowerCase().trim();\r\n      const results: Suggestion[] = [];\r\n      if (queryLower.startsWith('@live')) {\r\n        setSuggestions([]);\r\n        return;\r\n      }\r\n      const offline = typeof navigator !== 'undefined' && navigator.onLine === false;\r\n\r\n      const pushSuggestion = (suggestion: Suggestion, front = false) => {\r\n        if (!suggestion.title) return;\r\n        const exists = results.some(\r\n          (item) =>\r\n            item.title === suggestion.title &&\r\n            item.subtitle === suggestion.subtitle &&\r\n            item.url === suggestion.url &&\r\n            item.type === suggestion.type,\r\n        );\r\n        if (!exists) {\r\n          if (front) {\r\n            results.unshift(suggestion);\r\n          } else {\r\n            results.push(suggestion);\r\n          }\r\n        }\r\n      };\r\n\r\n      const quickAction = resolveQuickAction(normalized);\r\n      if (quickAction) {\r\n        const quickSuggestion = buildSuggestionFromAction(quickAction, normalized);\r\n        if (quickSuggestion) {\r\n          pushSuggestion(quickSuggestion);\r\n        }\r\n      }\r\n\r\n      const trimmed = normalized.trim();\r\n      const shouldSuggestRedix =\r\n        trimmed.length > 0 && !trimmed.startsWith('@') && !trimmed.startsWith('/');\r\n      if (\r\n        shouldSuggestRedix &&\r\n        !(quickAction && (quickAction.type === 'agent' || quickAction.type === 'ai'))\r\n      ) {\r\n        pushSuggestion(\r\n          {\r\n            type: 'command',\r\n            title: `Ask @redix: ${trimmed}`,\r\n            subtitle: 'Stream the Redix agent answer inline',\r\n            action: { type: 'agent', prompt: trimmed },\r\n            badge: '@redix',\r\n            icon: 'sparkles',\r\n          },\r\n          true,\r\n        );\r\n      } else if (!trimmed) {\r\n        const defaultPrompts = [\r\n          activeTab?.title ? `Summarize \"${activeTab.title}\"` : 'Summarize this tab',\r\n          'Why did regen mode fire?',\r\n          'What related sources am I tracking?',\r\n        ];\r\n        defaultPrompts\r\n          .slice()\r\n          .reverse()\r\n          .forEach((prompt, index) =>\r\n            pushSuggestion(\r\n              {\r\n                type: 'command',\r\n                title: `Ask @redix: ${prompt}`,\r\n                subtitle: index === defaultPrompts.length - 1 ? 'Redix agent' : undefined,\r\n                action: { type: 'agent', prompt },\r\n                badge: '@redix',\r\n                icon: 'sparkles',\r\n              },\r\n              true,\r\n            ),\r\n          );\r\n      }\r\n\r\n      if (queryLower.length > 0 && !queryLower.startsWith('http') && !queryLower.includes('.')) {\r\n        if (!quickAction || quickAction.type !== 'search') {\r\n          pushSuggestion({\r\n            type: 'search',\r\n            title: `Search: ${normalized}`,\r\n            subtitle: buildSearchUrl('google', normalized),\r\n            action: { type: 'search', engine: 'google', query: normalized },\r\n          });\r\n        }\r\n        pushSuggestion({\r\n          type: 'search',\r\n          title: `DuckDuckGo: ${normalized}`,\r\n          subtitle: buildSearchUrl('duckduckgo', normalized),\r\n          action: { type: 'search', engine: 'duckduckgo', query: normalized },\r\n        });\r\n      }\r\n\r\n      // Tab matches\r\n      tabs.forEach(tab => {\r\n        const title = tab.title || 'Untitled';\r\n        const tabUrl = tab.url || '';\r\n        if (title.toLowerCase().includes(queryLower) ||\r\n            tabUrl.toLowerCase().includes(queryLower)) {\r\n          pushSuggestion({\r\n            type: 'tab',\r\n            title,\r\n            subtitle: tabUrl || undefined,\r\n            action: tabUrl ? { type: 'nav', url: tabUrl } : undefined,\r\n          });\r\n        }\r\n      });\r\n\r\n      // History search (recent searches when query is empty or short)\r\n      try {\r\n        let history: any[] = [];\r\n        if (!offline) {\r\n          if (queryLower.trim().length === 0 || queryLower.length < 2) {\r\n            history = await ipc.history.search('');\r\n          } else {\r\n            history = await ipc.history.search(normalized);\r\n          }\r\n        }\r\n\r\n        if (Array.isArray(history) && history.length > 0) {\r\n          history.slice(0, 5).forEach((item: any) => {\r\n            pushSuggestion({\r\n              type: 'history',\r\n              title: item.title || item.url || 'Untitled',\r\n              subtitle: item.url,\r\n              action: item.url ? { type: 'nav', url: item.url } : undefined,\r\n            });\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.warn('History search failed:', error);\r\n      }\r\n\r\n      const localRecentMatches = recentItems\r\n        .filter((item) => !queryLower || item.title.toLowerCase().includes(queryLower) || item.url.toLowerCase().includes(queryLower))\r\n        .slice(0, 5);\r\n\r\n      localRecentMatches.forEach((item) => {\r\n        pushSuggestion({\r\n          type: 'history',\r\n          title: item.title,\r\n          subtitle: item.url,\r\n          action: { type: 'nav', url: item.url },\r\n        });\r\n      });\r\n\r\n      setSuggestions(results.slice(0, 8));\r\n    }, 150),\r\n    [tabs, recentItems, activeTab?.id, activeTab?.title]\r\n  );\r\n\r\n  const debouncedLiveSearch = useMemo(\r\n    () =>\r\n      debounce((searchTerm: string) => {\r\n        startLiveSearch(searchTerm);\r\n      }, 250),\r\n    [startLiveSearch],\r\n  );\r\n\r\n  useEffect(() => () => debouncedLiveSearch.cancel(), [debouncedLiveSearch]);\r\n\r\n  useEffect(() => () => {\r\n    stopLiveSession();\r\n  }, [stopLiveSession]);\r\n\r\n  useEffect(() => {\r\n    const trimmed = url.trim();\r\n    if (trimmed.toLowerCase().startsWith('@live')) {\r\n      const searchTerm = trimmed.replace(/^@live\\\\s*/i, '').trim();\r\n      if (searchTerm.length < 2) {\r\n        debouncedLiveSearch.cancel();\r\n        setLiveResults([]);\r\n        setLiveStatus('Type at least 2 characters to stream results');\r\n        stopLiveSession();\r\n        return;\r\n      }\r\n      debouncedLiveSearch(searchTerm);\r\n    } else {\r\n      debouncedLiveSearch.cancel();\r\n      setLiveResults([]);\r\n      setLiveStatus(null);\r\n      stopLiveSession();\r\n    }\r\n  }, [url, debouncedLiveSearch, stopLiveSession]);\r\n\r\n  useEffect(() => {\r\n    const trimmed = url.trim();\r\n    if (!trimmed.toLowerCase().startsWith('@live')) {\r\n      return;\r\n    }\r\n    const searchTerm = trimmed.replace(/^@live\\s*/i, '').trim();\r\n    const base: Suggestion[] = [\r\n      {\r\n        type: 'command',\r\n        title: `Redix Live Search${searchTerm ? ` • ${searchTerm}` : ''}`,\r\n        subtitle:\r\n          liveStatus ??\r\n          (searchTerm.length < 2\r\n            ? 'Type at least 2 characters to begin streaming'\r\n            : liveResults.length === 0\r\n            ? 'Streaming results…'\r\n            : 'Live results ready'),\r\n        interactive: false,\r\n        icon: 'sparkles',\r\n      },\r\n    ];\r\n\r\n    liveResults.forEach((result) => {\r\n      base.push({\r\n        type: 'search',\r\n        title: result.title || result.url,\r\n        subtitle: result.snippet || result.url,\r\n        url: result.url,\r\n        action: { type: 'nav', url: result.url, title: result.title },\r\n        icon: 'search',\r\n      });\r\n    });\r\n\r\n    setSuggestions(base);\r\n  }, [url, liveResults, liveStatus]);\r\n\r\n  useEffect(() => {\r\n    if (focused) {\r\n      searchSuggestions(url);\r\n    } else {\r\n      setSuggestions([]);\r\n    }\r\n  }, [url, focused, searchSuggestions]);\r\n\r\n  useEffect(() => {\r\n    setSelectedIndex(-1);\r\n  }, [suggestions.length]);\r\n\r\n  // Keyboard shortcuts\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\r\n      const modifier = isMac ? e.metaKey : e.ctrlKey;\r\n      \r\n      if (modifier && e.key === 'l') {\r\n        e.preventDefault();\r\n        inputRef.current?.focus();\r\n        inputRef.current?.select();\r\n      }\r\n      if (modifier && e.key === 'k') {\r\n        e.preventDefault();\r\n        onCommandPalette();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [onCommandPalette]);\r\n\r\n  const navigateToUrl = async (\r\n    targetUrl: string,\r\n    options: { background?: boolean; newWindow?: boolean; titleOverride?: string } = {},\r\n  ) => {\r\n    const { background = false, newWindow = false, titleOverride } = options;\r\n    // Normalize URL\r\n    let finalUrl = targetUrl.trim();\r\n\r\n    if (!finalUrl) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      !finalUrl.startsWith('http://') &&\r\n      !finalUrl.startsWith('https://') &&\r\n      !finalUrl.startsWith('about:') &&\r\n      !finalUrl.startsWith('file://') &&\r\n      !finalUrl.startsWith('ob://')\r\n    ) {\r\n      const domainPattern = /^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]*\\.[a-zA-Z]{2,}$/;\r\n      if (domainPattern.test(finalUrl) || finalUrl.includes('.')) {\r\n        finalUrl = `https://${finalUrl}`;\r\n      } else {\r\n        finalUrl = buildSearchUrl('google', finalUrl);\r\n      }\r\n    }\r\n\r\n    const openInBackground = background && !newWindow;\r\n\r\n    if (!isElectron) {\r\n      const normalizedTitle = titleOverride || finalUrl;\r\n      const state = useTabsStore.getState();\r\n      const baseTabs = (state.tabs ?? []).map((tab) => ({ ...tab }));\r\n      let nextTabs = baseTabs;\r\n      let nextActiveId = state.activeId ?? null;\r\n\r\n      if (!state.activeId || baseTabs.length === 0) {\r\n        const newId = `local-${Date.now()}`;\r\n        nextTabs = baseTabs.map((tab) => ({ ...tab, active: false }));\r\n        nextTabs.push({\r\n          id: newId,\r\n          title: normalizedTitle,\r\n          url: finalUrl,\r\n          active: true,\r\n          mode: 'normal',\r\n        });\r\n        nextActiveId = newId;\r\n      } else if (openInBackground) {\r\n        const newId = `local-${Date.now()}`;\r\n        nextTabs = baseTabs.map((tab) => ({ ...tab }));\r\n        nextTabs.push({\r\n          id: newId,\r\n          title: normalizedTitle,\r\n          url: finalUrl,\r\n          active: false,\r\n          mode: 'normal',\r\n        });\r\n      } else {\r\n        nextTabs = baseTabs.map((tab) => ({\r\n          ...tab,\r\n          title: tab.id === state.activeId ? normalizedTitle : tab.title,\r\n          url: tab.id === state.activeId ? finalUrl : tab.url,\r\n          active: tab.id === state.activeId,\r\n        }));\r\n        nextActiveId = state.activeId;\r\n      }\r\n\r\n      useTabsStore.setState({ tabs: nextTabs, activeId: nextActiveId });\r\n      ipcEvents.emit('tabs:updated', formatTabsForEvent(nextTabs));\r\n\r\n      setFocused(false);\r\n      setSuggestions([]);\r\n      if (!openInBackground) {\r\n        setUrl(finalUrl);\r\n      }\r\n      rememberRecent(normalizedTitle, finalUrl);\r\n\r\n      try {\r\n        const target = newWindow || openInBackground ? '_blank' : '_blank';\r\n        window.open(finalUrl, target, 'noopener,noreferrer');\r\n      } catch (error) {\r\n        console.warn('Failed to open URL in browser:', error);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (newWindow) {\r\n      try {\r\n        await ipc.private.createWindow({ url: finalUrl });\r\n        setFocused(false);\r\n        setSuggestions([]);\r\n        rememberRecent(titleOverride || finalUrl, finalUrl);\r\n      } catch (error) {\r\n        console.error('Failed to open new window for navigation:', error);\r\n      }\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if (!window.ipc || typeof (window.ipc as any).invoke !== 'function') {\r\n        console.warn('IPC not ready for navigation, waiting...');\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n      }\r\n\r\n      if (!activeId) {\r\n        await ipc.tabs.create({ url: finalUrl, containerId: activeContainerId, activate: !openInBackground });\r\n      } else if (openInBackground) {\r\n        await ipc.tabs.create({ url: finalUrl, containerId: activeContainerId, activate: false });\r\n      } else {\r\n        await ipc.tabs.navigate(activeId, finalUrl);\r\n      }\r\n\r\n      setFocused(false);\r\n      setSuggestions([]);\r\n      if (!openInBackground) {\r\n        setUrl(finalUrl);\r\n      }\r\n      rememberRecent(titleOverride || finalUrl, finalUrl);\r\n    } catch (error) {\r\n      console.error('Navigation failed:', error);\r\n      try {\r\n        if (!window.ipc || typeof (window.ipc as any).invoke !== 'function') {\r\n          console.warn('IPC not ready for tab creation, waiting...');\r\n          await new Promise(resolve => setTimeout(resolve, 500));\r\n        }\r\n\r\n        const newTab = await ipc.tabs.create({ url: finalUrl, containerId: activeContainerId, activate: !openInBackground });\r\n        if (newTab && newTab.id) {\r\n          setFocused(false);\r\n          setSuggestions([]);\r\n          if (!openInBackground) {\r\n            setUrl(finalUrl);\r\n          }\r\n          rememberRecent(titleOverride || finalUrl, finalUrl);\r\n        } else {\r\n          console.warn('Tab creation returned invalid result:', newTab);\r\n        }\r\n      } catch (createError) {\r\n        console.error('Failed to create new tab:', createError);\r\n      }\r\n    }\r\n  };\r\n\r\n  const executeAction = async (\r\n    action: SuggestionAction | null | undefined,\r\n    fallbackInput: string,\r\n    options: { background?: boolean; newWindow?: boolean; titleOverride?: string } = {},\r\n  ) => {\r\n    if (!action) {\r\n      await navigateToUrl(fallbackInput, options);\r\n      return;\r\n    }\r\n\r\n    switch (action.type) {\r\n      case 'nav':\r\n        await navigateToUrl(action.url, { ...options, titleOverride: action.title ?? options.titleOverride });\r\n        return;\r\n      case 'search': {\r\n        const query = action.query || fallbackInput.trim();\r\n        if (!query) return;\r\n        const engineLabel =\r\n          action.engine === 'duckduckgo'\r\n            ? 'DuckDuckGo'\r\n            : action.engine === 'wiki'\r\n            ? 'Wikipedia'\r\n            : action.engine === 'youtube'\r\n            ? 'YouTube'\r\n            : action.engine === 'twitter'\r\n            ? 'Twitter/X'\r\n            : 'Google';\r\n        await navigateToUrl(buildSearchUrl(action.engine, query), {\r\n          ...options,\r\n          titleOverride: `${engineLabel}: ${query}`,\r\n        });\r\n        return;\r\n      }\r\n      case 'ai': {\r\n        const prompt = action.prompt || fallbackInput.trim();\r\n        if (!prompt) {\r\n          onCommandPalette();\r\n          return;\r\n        }\r\n        try {\r\n          const tabUrl = activeTab?.url;\r\n          await ipc.agent.ask(prompt, tabUrl ? { url: tabUrl } : undefined);\r\n        } catch (error) {\r\n          console.error('AI search error:', error);\r\n        }\r\n        await navigateToUrl(`ob://agent?q=${encodeURIComponent(prompt)}`, {\r\n          ...options,\r\n          titleOverride: `AI: ${prompt}`,\r\n        });\r\n        return;\r\n      }\r\n      case 'agent': {\r\n        const prompt = action.prompt || fallbackInput.trim();\r\n        if (!prompt) {\r\n          onCommandPalette();\r\n          return;\r\n        }\r\n        try {\r\n          const tabUrl = activeTab?.url;\r\n          await ipc.agent.ask(prompt, tabUrl ? { url: tabUrl } : undefined);\r\n        } catch (error) {\r\n          console.error('Agent error:', error);\r\n        }\r\n        await navigateToUrl(`ob://agent?q=${encodeURIComponent(prompt)}`, {\r\n          ...options,\r\n          titleOverride: `Agent: ${prompt}`,\r\n        });\r\n        return;\r\n      }\r\n      case 'calc': {\r\n        const expr = action.expr || fallbackInput.trim();\r\n        if (!expr) {\r\n          setFocused(true);\r\n          return;\r\n        }\r\n        const resultValue = action.result ?? evaluateExpression(expr);\r\n        const formatted = expr ? formatCalcResult(expr, resultValue ?? null) : null;\r\n        if (formatted) {\r\n          setUrl(formatted);\r\n          setFocused(false);\r\n          setSuggestions([]);\r\n          if (typeof navigator !== 'undefined' && navigator.clipboard?.writeText) {\r\n            try {\r\n              await navigator.clipboard.writeText(formatted);\r\n            } catch {\r\n              // Clipboard might be unavailable; ignore.\r\n            }\r\n          }\r\n        } else {\r\n          await navigateToUrl(buildSearchUrl('google', expr), {\r\n            ...options,\r\n            titleOverride: `Calculate: ${expr}`,\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      case 'command':\r\n        setFocused(false);\r\n        setSuggestions([]);\r\n        onCommandPalette();\r\n        return;\r\n      default:\r\n        await navigateToUrl(fallbackInput, options);\r\n    }\r\n  };\r\n\r\n  const handleSuggestionActivate = async (\r\n    suggestion: Suggestion,\r\n    options: { background?: boolean; newWindow?: boolean } = {},\r\n  ) => {\r\n    if (suggestion.interactive === false) {\r\n      return;\r\n    }\r\n    if (suggestion.action) {\r\n      await executeAction(suggestion.action, suggestion.subtitle || suggestion.url || url, {\r\n        ...options,\r\n        titleOverride: suggestion.title,\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (suggestion.url) {\r\n      await navigateToUrl(suggestion.url, { ...options, titleOverride: suggestion.title });\r\n      return;\r\n    }\r\n\r\n    await navigateToUrl(url, { ...options, titleOverride: suggestion.title });\r\n  };\r\n\r\n  const handleKeyDown = async (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const background = e.shiftKey && !e.altKey;\r\n      const newWindow = e.altKey;\r\n      if (selectedIndex >= 0 && suggestions[selectedIndex]) {\r\n        const suggestion = suggestions[selectedIndex];\r\n        await handleSuggestionActivate(suggestion, { background, newWindow });\r\n      } else {\r\n        if (url.trim().toLowerCase().startsWith('@live')) {\r\n          const topResult = liveResults[0];\r\n          if (topResult?.url) {\r\n            await navigateToUrl(topResult.url, {\r\n              background,\r\n              newWindow,\r\n              titleOverride: topResult.title,\r\n            });\r\n            return;\r\n          }\r\n        }\r\n        const action = resolveQuickAction(url);\r\n        await executeAction(action, url, { background, newWindow });\r\n      }\r\n    } else if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setSelectedIndex(prev => Math.min(prev + 1, suggestions.length - 1));\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setSelectedIndex(prev => Math.max(prev - 1, -1));\r\n    } else if (e.key === 'Escape') {\r\n      setFocused(false);\r\n      setSuggestions([]);\r\n      inputRef.current?.blur();\r\n    }\r\n  };\r\n\r\n  // Sync URL with active tab when not focused\r\n  useEffect(() => {\r\n    if (!focused && activeTab) {\r\n      setUrl(activeTab.url || '');\r\n    }\r\n  }, [activeTab, focused]);\r\n\r\n  return (\r\n    <div className=\"relative flex-1 max-w-2xl\">\r\n      <motion.div\r\n        className=\"relative\"\r\n        animate={{ scale: focused ? 1.02 : 1 }}\r\n        transition={{ duration: 0.2 }}\r\n      >\r\n        <div className=\"relative flex items-center\">\r\n          {/* Site Info Icons */}\r\n          {siteInfo && url && !focused && (\r\n            <div className=\"absolute left-3 flex items-center gap-2 z-10 pointer-events-none\" aria-hidden=\"true\">\r\n              {siteInfo.secure ? (\r\n                <Lock size={14} className=\"text-green-400\" aria-label=\"Secure connection\" />\r\n              ) : url.startsWith('http://') ? (\r\n                <AlertCircle size={14} className=\"text-amber-400\" aria-label=\"Insecure connection\" />\r\n              ) : (\r\n                <Globe size={14} className=\"text-gray-400\" aria-label=\"Web page\" />\r\n              )}\r\n              {siteInfo.shieldCount !== undefined && siteInfo.shieldCount > 0 && (\r\n                <div className=\"flex items-center gap-1\" aria-label={`${siteInfo.shieldCount} shields active`}>\r\n                  <Shield size={14} className=\"text-blue-400\" />\r\n                  <span className=\"text-xs text-gray-400\">{siteInfo.shieldCount}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          <input\r\n            ref={inputRef}\r\n            type=\"text\"\r\n            value={url}\r\n            onChange={(e) => setUrl(e.target.value)}\r\n            onFocus={() => setFocused(true)}\r\n            onBlur={() => setTimeout(() => setFocused(false), 200)} // Delay for suggestion clicks\r\n            onKeyDown={handleKeyDown}\r\n            aria-label=\"Address bar - Search or enter URL\"\r\n            aria-autocomplete=\"list\"\r\n            aria-expanded={focused && suggestions.length > 0}\r\n            placeholder=\"Search or enter URL\"\r\n            className={`\r\n              w-full h-9 px-4 ${siteInfo && !focused ? 'pl-20' : 'pl-4'} pr-10\r\n              bg-gray-800/60 backdrop-blur-sm border border-gray-700/50 rounded-xl\r\n              text-sm text-white placeholder-gray-400\r\n              focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50\r\n              hover:bg-gray-800/80 transition-all\r\n            `}\r\n          />\r\n\r\n          {/* Progress Bar */}\r\n          {isLoading && progress > 0 && (\r\n            <motion.div\r\n              className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-500 rounded-b-xl\"\r\n              initial={{ scaleX: 0 }}\r\n              animate={{ scaleX: progress / 100 }}\r\n              transition={{ duration: 0.1 }}\r\n            />\r\n          )}\r\n\r\n          {/* Search Icon */}\r\n          <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center\">\r\n            <Search size={14} className=\"text-gray-500\" />\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Suggestions Dropdown */}\r\n      <AnimatePresence>\r\n        {focused && suggestions.length > 0 && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: -10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: -10 }}\r\n            className=\"absolute top-full left-0 right-0 mt-2 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl overflow-hidden z-50\"\r\n          >\r\n            {suggestions.map((suggestion, index) => (\r\n              <motion.button\r\n                key={index}\r\n                type=\"button\"\r\n                disabled={suggestion.interactive === false}\r\n                onMouseDown={async (event) => {\r\n                  event.preventDefault();\r\n                  if (suggestion.interactive === false) return;\r\n                  const background = event.shiftKey && !event.altKey;\r\n                  const newWindow = event.altKey;\r\n                  await handleSuggestionActivate(suggestion, { background, newWindow });\r\n                }}\r\n                onMouseEnter={() => setSelectedIndex(index)}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter' || e.key === ' ') {\r\n                    e.preventDefault();\r\n                    if (suggestion.interactive === false) return;\r\n                    const background = e.shiftKey && !e.altKey;\r\n                    const newWindow = e.altKey;\r\n                    handleSuggestionActivate(suggestion, { background, newWindow });\r\n                  }\r\n                }}\r\n                role=\"option\"\r\n                aria-selected={selectedIndex === index}\r\n                aria-label={`${suggestion.type} suggestion: ${suggestion.title}`}\r\n                className={`\r\n                  w-full flex items-center gap-3 px-4 py-2.5 text-left\r\n                  transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset\r\n                  ${selectedIndex === index\r\n                    ? 'bg-gray-800/60 text-gray-100'\r\n                    : 'text-gray-300 hover:bg-gray-800/40'\r\n                  }\r\n                  ${suggestion.interactive === false ? 'cursor-default opacity-80' : ''}\r\n                `}\r\n              >\r\n                <div className=\"flex-shrink-0 w-5 h-5 flex items-center justify-center\">\r\n                  {suggestion.icon === 'sparkles' && <Sparkles size={14} className=\"text-emerald-400\" />}\r\n                  {suggestion.icon === 'search' && <Search size={14} className=\"text-purple-400\" />}\r\n                  {suggestion.icon === 'history' && <Clock size={13} className=\"text-gray-400\" />}\r\n                  {!suggestion.icon && suggestion.action?.type === 'calc' && <Calculator size={14} className=\"text-amber-400\" />}\r\n                  {!suggestion.icon && suggestion.action?.type === 'ai' && <Sparkles size={14} className=\"text-violet-400\" />}\r\n                  {!suggestion.icon && suggestion.action?.type === 'agent' && <Sparkles size={14} className=\"text-blue-400\" />}\r\n                  {!suggestion.icon && suggestion.action?.type === 'search' && <Search size={14} className=\"text-purple-400\" />}\r\n                  {!suggestion.icon && suggestion.type === 'tab' && <div className=\"w-3 h-3 bg-blue-500 rounded-full\" />}\r\n                  {!suggestion.icon && suggestion.type === 'history' && <Clock size={13} className=\"text-gray-400\" />}\r\n                  {!suggestion.icon && !suggestion.action && suggestion.type === 'command' && <Search size={14} className=\"text-blue-400\" />}\r\n                  {!suggestion.icon && !suggestion.action && suggestion.type === 'search' && <Search size={14} className=\"text-purple-400\" />}\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"text-sm font-medium truncate\">{suggestion.title}</div>\r\n                  {(suggestion.subtitle || suggestion.url) && (\r\n                    <div className=\"text-xs text-gray-500 truncate\">\r\n                      {suggestion.subtitle || suggestion.url}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                {suggestion.badge && (\r\n                  <div className=\"ml-auto flex-shrink-0 rounded-full border border-purple-500/40 bg-purple-500/15 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-purple-200\">\r\n                    {suggestion.badge}\r\n                  </div>\r\n                )}\r\n              </motion.button>\r\n            ))}\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * ProgressBar - Animated loading indicator under omnibox\r\n */\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useIPCEvent } from '../../lib/use-ipc-event';\r\n\r\nexport function ProgressBar() {\r\n  const [progress, setProgress] = useState(0);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Listen for tab loading state\r\n  useIPCEvent('tabs:loading-start', () => {\r\n    setIsLoading(true);\r\n    setProgress(0);\r\n  }, []);\r\n\r\n  useIPCEvent('tabs:loading-progress', (data: { progress: number }) => {\r\n    setProgress(data.progress || 0);\r\n  }, []);\r\n\r\n  useIPCEvent('tabs:loading-complete', () => {\r\n    setIsLoading(true);\r\n    setProgress(100);\r\n    setTimeout(() => {\r\n      setIsLoading(false);\r\n      setProgress(0);\r\n    }, 300);\r\n  }, []);\r\n\r\n  // Simulate progress when loading\r\n  useEffect(() => {\r\n    if (isLoading && progress < 90) {\r\n      const interval = setInterval(() => {\r\n        setProgress(prev => {\r\n          if (prev >= 90) {\r\n            clearInterval(interval);\r\n            return prev;\r\n          }\r\n          return prev + Math.random() * 15;\r\n        });\r\n      }, 100);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [isLoading, progress]);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isLoading && (\r\n        <motion.div\r\n          initial={{ opacity: 0, scaleX: 0 }}\r\n          animate={{ opacity: 1, scaleX: 1 }}\r\n          exit={{ opacity: 0, scaleX: 0 }}\r\n          className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-purple-500 via-blue-500 to-cyan-500 origin-left\"\r\n          style={{ scaleX: progress / 100 }}\r\n        />\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\n","/**\r\n * Session Switcher Component\r\n * UI for managing and switching between multiple browser sessions\r\n */\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { formatDistanceToNow } from 'date-fns';\r\nimport { User, Plus, X, Edit2, Check, RotateCcw, Loader2 } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport type { BrowserSession } from '../../types/session';\r\nimport { isDevEnv } from '../../lib/env';\r\n\r\nexport function SessionSwitcher() {\r\n  const IS_DEV = isDevEnv();\r\n  const [sessions, setSessions] = useState<BrowserSession[]>([]);\r\n  const [activeSession, setActiveSession] = useState<BrowserSession | null>(null);\r\n  const [open, setOpen] = useState(false);\r\n  const [creating, setCreating] = useState(false);\r\n  const [newSessionName, setNewSessionName] = useState('');\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const [editName, setEditName] = useState('');\r\n  const [snapshotSummary, setSnapshotSummary] = useState<{ updatedAt: number; windowCount: number; tabCount: number } | null>(null);\r\n  const [summaryLoading, setSummaryLoading] = useState(false);\r\n  const [restoring, setRestoring] = useState(false);\r\n  const [restoreFeedback, setRestoreFeedback] = useState<string | null>(null);\r\n\r\n  // Track previous sessions to prevent unnecessary updates\r\n  const previousSessionsRef = useRef<string>('');\r\n  \r\n  // Load sessions\r\n  const loadSessions = async () => {\r\n    try {\r\n      // Wait for IPC to be ready\r\n      if (!window.ipc || typeof window.ipc.invoke !== 'function') {\r\n        setTimeout(loadSessions, 300);\r\n        return; // Will retry shortly\r\n      }\r\n      \r\n      const [allSessions, active] = await Promise.all([\r\n        ipc.sessions.list(),\r\n        ipc.sessions.getActive(),\r\n      ]);\r\n      \r\n      // Only update if sessions actually changed\r\n      let sessionsArray = Array.isArray(allSessions) ? allSessions as BrowserSession[] : [];\r\n\r\n      // Ensure at least the default session exists\r\n      if (sessionsArray.length === 0) {\r\n        sessionsArray = [{\r\n          id: 'default',\r\n          name: 'Default',\r\n          profileId: 'default',\r\n          createdAt: Date.now(),\r\n          tabCount: 0,\r\n          color: '#3b82f6',\r\n        }];\r\n      }\r\n      const sessionsKey = sessionsArray.map(s => s.id).sort().join(',');\r\n      \r\n      if (previousSessionsRef.current !== sessionsKey) {\r\n        previousSessionsRef.current = sessionsKey;\r\n        setSessions(sessionsArray);\r\n      }\r\n      \r\n      // Update active session only if changed\r\n      let activeSessionObj = active && typeof active === 'object' ? active as BrowserSession : null;\r\n      if (!activeSessionObj) {\r\n        activeSessionObj = sessionsArray.find(s => s.id === 'default') ?? sessionsArray[0] ?? null;\r\n      }\r\n      const currentActiveId = activeSessionObj?.id || null;\r\n      const previousActiveId = activeSession?.id || null;\r\n      \r\n      if (currentActiveId !== previousActiveId) {\r\n        setActiveSession(activeSessionObj);\r\n      }\r\n    } catch (error) {\r\n      // Silently handle - will retry on next interval\r\n      // Only log if it's a real error, not just IPC not ready\r\n      if (IS_DEV && error instanceof Error && !error.message.includes('not available')) {\r\n        console.warn('Failed to load sessions:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Delay initial load to allow IPC to initialize\r\n    const timeoutId = setTimeout(() => {\r\n      loadSessions();\r\n    }, 500);\r\n    \r\n    // Refresh periodically (less frequent to reduce spam)\r\n    const interval = setInterval(loadSessions, 5000);\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      clearInterval(interval);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    let cancelled = false;\r\n    setSummaryLoading(true);\r\n    ipc.sessionState.summary()\r\n      .then((res) => {\r\n        if (cancelled) return;\r\n        setSnapshotSummary(res?.summary ?? null);\r\n      })\r\n      .catch(() => {\r\n        if (!cancelled) {\r\n          setSnapshotSummary(null);\r\n        }\r\n      })\r\n      .finally(() => {\r\n        if (!cancelled) {\r\n          setSummaryLoading(false);\r\n        }\r\n      });\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [open]);\r\n\r\n  const handleCreateSession = async () => {\r\n    if (!newSessionName.trim()) return;\r\n    \r\n    try {\r\n      await ipc.sessions.create({ name: newSessionName.trim() });\r\n      setNewSessionName('');\r\n      setCreating(false);\r\n      await loadSessions();\r\n    } catch (error) {\r\n      if (IS_DEV) console.error('Failed to create session:', error);\r\n    }\r\n  };\r\n\r\n  const handleSwitchSession = async (sessionId: string) => {\r\n    try {\r\n      await ipc.sessions.setActive({ sessionId });\r\n      await loadSessions();\r\n      setOpen(false);\r\n    } catch (error) {\r\n      if (IS_DEV) console.error('Failed to switch session:', error);\r\n    }\r\n  };\r\n\r\n  const handleDeleteSession = async (sessionId: string, e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (!confirm(`Delete session \"${sessions.find(s => s.id === sessionId)?.name}\"? This will close all tabs in this session.`)) {\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      await ipc.sessions.delete({ sessionId });\r\n      await loadSessions();\r\n    } catch (error) {\r\n      if (IS_DEV) console.error('Failed to delete session:', error);\r\n    }\r\n  };\r\n\r\n  const handleStartEdit = (session: BrowserSession) => {\r\n    setEditingId(session.id);\r\n    setEditName(session.name);\r\n  };\r\n\r\n  const handleSaveEdit = async (sessionId: string) => {\r\n    try {\r\n      await ipc.sessions.update({ sessionId, name: editName.trim() });\r\n      setEditingId(null);\r\n      await loadSessions();\r\n    } catch (error) {\r\n      console.error('Failed to update session:', error);\r\n    }\r\n  };\r\n\r\n  const handleRestoreLastSession = async () => {\r\n    setRestoring(true);\r\n    setRestoreFeedback(null);\r\n    try {\r\n      const result = await ipc.sessionState.restore();\r\n      if (result?.restored) {\r\n        const restoredCount = result.tabCount ?? 0;\r\n        setRestoreFeedback(\r\n          `Restored ${restoredCount} tab${restoredCount === 1 ? '' : 's'} from last session.`,\r\n        );\r\n        await loadSessions();\r\n      } else if (result?.error) {\r\n        setRestoreFeedback(`Restore failed: ${result.error}`);\r\n      } else {\r\n        setRestoreFeedback('No session snapshot available to restore.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to restore session snapshot:', error);\r\n      setRestoreFeedback('Failed to restore session snapshot.');\r\n    } finally {\r\n      setRestoring(false);\r\n    }\r\n  };\r\n\r\n  const isDefaultSession =\r\n    !activeSession ||\r\n    activeSession.id === 'default' ||\r\n    activeSession.name.toLowerCase() === 'default';\r\n\r\n  const showLabel = !isDefaultSession;\r\n\r\n  const buttonSpacing = showLabel ? 'gap-2 px-3' : 'gap-1.5 px-2.5';\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      {/* Session Button */}\r\n      <motion.button\r\n        onClick={() => setOpen(!open)}\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n        className={`relative flex items-center ${buttonSpacing} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`}\r\n        title=\"Multi-Session Manager\"\r\n      >\r\n        <User size={16} />\r\n        {showLabel && (\r\n          <span className=\"text-sm font-medium\">\r\n            {activeSession?.name || 'Default'}\r\n          </span>\r\n        )}\r\n        {!isDefaultSession && activeSession?.color && (\r\n          <div\r\n            className=\"w-3 h-3 rounded-full border border-gray-700\"\r\n            style={{ backgroundColor: activeSession.color }}\r\n          />\r\n        )}\r\n        {showLabel && sessions.length > 1 && (\r\n          <span className=\"text-xs text-gray-500\">({sessions.length})</span>\r\n        )}\r\n      </motion.button>\r\n\r\n      {/* Session Panel */}\r\n      <AnimatePresence>\r\n        {open && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: 10 }}\r\n            className=\"absolute right-0 mt-2 w-80 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-lg shadow-xl overflow-hidden z-40\"\r\n          >\r\n            {/* Header */}\r\n            <div className=\"p-3 border-b border-gray-800/50 flex items-center justify-between\">\r\n              <h3 className=\"text-sm font-semibold text-gray-200\">Browser Sessions</h3>\r\n              <button\r\n                onClick={() => {\r\n                  setCreating(true);\r\n                  setNewSessionName('');\r\n                }}\r\n                className=\"p-1.5 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-blue-400 transition-colors\"\r\n                title=\"New Session\"\r\n              >\r\n                <Plus size={16} />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Sessions List */}\r\n            <div className=\"max-h-96 overflow-y-auto\">\r\n              {creating && (\r\n                <div className=\"p-3 border-b border-gray-800/50\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={newSessionName}\r\n                    onChange={(e) => setNewSessionName(e.target.value)}\r\n                    onKeyDown={(e) => {\r\n                      if (e.key === 'Enter') handleCreateSession();\r\n                      if (e.key === 'Escape') {\r\n                        setCreating(false);\r\n                        setNewSessionName('');\r\n                      }\r\n                    }}\r\n                    placeholder=\"Session name...\"\r\n                    autoFocus\r\n                    className=\"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  />\r\n                  <div className=\"flex gap-2 mt-2\">\r\n                    <button\r\n                      onClick={handleCreateSession}\r\n                      className=\"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white\"\r\n                    >\r\n                      Create\r\n                    </button>\r\n                    <button\r\n                      onClick={() => {\r\n                        setCreating(false);\r\n                        setNewSessionName('');\r\n                      }}\r\n                      className=\"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm text-gray-300\"\r\n                    >\r\n                      Cancel\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {sessions.map((session) => {\r\n                const isActive = activeSession?.id === session.id;\r\n                const isEditing = editingId === session.id;\r\n\r\n                return (\r\n                  <div\r\n                    key={session.id}\r\n                    onClick={() => !isActive && handleSwitchSession(session.id)}\r\n                    className={`\r\n                      p-3 border-b border-gray-800/50 cursor-pointer transition-colors\r\n                      ${isActive \r\n                        ? 'bg-blue-600/20 border-blue-500/30' \r\n                        : 'hover:bg-gray-800/50'\r\n                      }\r\n                    `}\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      {/* Color Indicator */}\r\n                      {session.color && (\r\n                        <div\r\n                          className=\"w-4 h-4 rounded-full border border-gray-700 flex-shrink-0\"\r\n                          style={{ backgroundColor: session.color }}\r\n                        />\r\n                      )}\r\n\r\n                      {/* Session Info */}\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        {isEditing ? (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <input\r\n                              type=\"text\"\r\n                              value={editName}\r\n                              onChange={(e) => setEditName(e.target.value)}\r\n                              onKeyDown={(e) => {\r\n                                if (e.key === 'Enter') handleSaveEdit(session.id);\r\n                                if (e.key === 'Escape') {\r\n                                  setEditingId(null);\r\n                                  setEditName('');\r\n                                }\r\n                              }}\r\n                              onClick={(e) => e.stopPropagation()}\r\n                              autoFocus\r\n                              className=\"flex-1 px-2 py-1 bg-gray-800 border border-gray-700 rounded text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                            />\r\n                            <button\r\n                              onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                handleSaveEdit(session.id);\r\n                              }}\r\n                              className=\"p-1 text-green-400 hover:text-green-300\"\r\n                            >\r\n                              <Check size={14} />\r\n                            </button>\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className=\"font-medium text-gray-200 truncate\">\r\n                              {session.name}\r\n                            </span>\r\n                            {isActive && (\r\n                              <span className=\"text-xs text-blue-400 font-medium\">Active</span>\r\n                            )}\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex items-center gap-2 mt-1\">\r\n                          <span className=\"text-xs text-gray-400\">\r\n                            {session.tabCount} tab{session.tabCount !== 1 ? 's' : ''}\r\n                          </span>\r\n                          {session.id === 'default' && (\r\n                            <span className=\"text-xs text-gray-500\">• Default</span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Actions */}\r\n                      {!isEditing && (\r\n                        <div className=\"flex items-center gap-1\">\r\n                          <button\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              handleStartEdit(session);\r\n                            }}\r\n                            className=\"p-1.5 rounded-lg hover:bg-gray-700 text-gray-400 hover:text-blue-400 transition-colors\"\r\n                            title=\"Rename\"\r\n                          >\r\n                            <Edit2 size={14} />\r\n                          </button>\r\n                          {session.id !== 'default' && (\r\n                            <button\r\n                              onClick={(e) => handleDeleteSession(session.id, e)}\r\n                              className=\"p-1.5 rounded-lg hover:bg-gray-700 text-gray-400 hover:text-red-400 transition-colors\"\r\n                              title=\"Delete\"\r\n                            >\r\n                              <X size={14} />\r\n                            </button>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"p-3 border-t border-gray-800/50 bg-gray-900/50 space-y-2\">\r\n              <div className=\"flex items-start justify-between gap-3\">\r\n                <div className=\"space-y-0.5\">\r\n                  <p className=\"text-xs font-semibold uppercase tracking-wide text-gray-500\">Crash-safe snapshot</p>\r\n                  <p className=\"text-sm text-gray-300\">\r\n                    {summaryLoading && (\r\n                      <span className=\"inline-flex items-center gap-1 text-gray-400\">\r\n                        <Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\r\n                        Checking…\r\n                      </span>\r\n                    )}\r\n                    {!summaryLoading && snapshotSummary && (\r\n                      <span>\r\n                        {snapshotSummary.tabCount} tab{snapshotSummary.tabCount === 1 ? '' : 's'} saved{' '}\r\n                        {formatDistanceToNow(snapshotSummary.updatedAt, { addSuffix: true })}\r\n                      </span>\r\n                    )}\r\n                    {!summaryLoading && !snapshotSummary && (\r\n                      <span>No snapshot captured yet.</span>\r\n                    )}\r\n                  </p>\r\n                </div>\r\n                <button\r\n                  onClick={handleRestoreLastSession}\r\n                  disabled={restoring || summaryLoading || !snapshotSummary}\r\n                  className={`inline-flex items-center gap-2 rounded-lg border px-3 py-1.5 text-xs font-medium transition-colors ${\r\n                    restoring || summaryLoading || !snapshotSummary\r\n                      ? 'border-gray-700 text-gray-500 cursor-not-allowed'\r\n                      : 'border-blue-500/40 bg-blue-500/10 text-blue-200 hover:border-blue-500/60'\r\n                  }`}\r\n                >\r\n                  {restoring ? <Loader2 className=\"h-3.5 w-3.5 animate-spin\" /> : <RotateCcw className=\"h-3.5 w-3.5\" />}\r\n                  Restore\r\n                </button>\r\n              </div>\r\n              {restoreFeedback && (\r\n                <p className=\"text-xs text-blue-300\">{restoreFeedback}</p>\r\n              )}\r\n              <p className=\"text-xs text-gray-500\">\r\n                Each session keeps cookies, storage, and login state isolated. Autosave runs every few seconds.\r\n              </p>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\n","import { useEffect, useMemo, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  UserCircle,\r\n  Briefcase,\r\n  Sparkles,\r\n  Check,\r\n  Download,\r\n  EyeOff,\r\n  Ghost,\r\n  Camera,\r\n  Scissors,\r\n  Shield,\r\n  Loader2,\r\n  Plus,\r\n} from 'lucide-react';\r\nimport { ensureProfilesLoaded, useProfileStore } from '../../state/profileStore';\r\nimport { ProfileInfo, ProfilePolicy } from '../../lib/ipc-events';\r\nimport { ipc } from '../../lib/ipc-typed';\r\n\r\ntype PolicyKey = keyof ProfilePolicy;\r\n\r\nconst POLICY_CONFIG: Array<{\r\n  key: PolicyKey;\r\n  label: string;\r\n  icon: typeof Download;\r\n  description: string;\r\n}> = [\r\n  {\r\n    key: 'allowDownloads',\r\n    label: 'Downloads',\r\n    icon: Download,\r\n    description: 'File downloads to local storage',\r\n  },\r\n  {\r\n    key: 'allowPrivateWindows',\r\n    label: 'Private windows',\r\n    icon: EyeOff,\r\n    description: 'Open dedicated private windows',\r\n  },\r\n  {\r\n    key: 'allowGhostTabs',\r\n    label: 'Ghost tabs',\r\n    icon: Ghost,\r\n    description: 'Create ephemeral ghost tabs',\r\n  },\r\n  {\r\n    key: 'allowScreenshots',\r\n    label: 'Screenshots',\r\n    icon: Camera,\r\n    description: 'Capture browser screenshots',\r\n  },\r\n  {\r\n    key: 'allowClipping',\r\n    label: 'Clip text',\r\n    icon: Scissors,\r\n    description: 'Use web clipper to capture highlights',\r\n  },\r\n];\r\n\r\nconst PROFILE_ICON: Record<string, typeof UserCircle> = {\r\n  work: Briefcase,\r\n  personal: Sparkles,\r\n  default: UserCircle,\r\n};\r\n\r\nfunction getProfileIcon(profile: ProfileInfo) {\r\n  if (profile.kind && PROFILE_ICON[profile.kind]) {\r\n    return PROFILE_ICON[profile.kind];\r\n  }\r\n  return PROFILE_ICON.default;\r\n}\r\n\r\nfunction summarizePolicy(policy?: ProfilePolicy) {\r\n  if (!policy) return 'Unknown policy';\r\n  const restricted = POLICY_CONFIG.filter(({ key }) => !policy[key]);\r\n  if (restricted.length === 0) {\r\n    return 'All capabilities enabled';\r\n  }\r\n  if (restricted.length === POLICY_CONFIG.length) {\r\n    return 'Strict mode: most features disabled';\r\n  }\r\n  return `Restricted: ${restricted.map((r) => r.label.toLowerCase()).join(', ')}`;\r\n}\r\n\r\nfunction sortProfiles(profiles: ProfileInfo[]) {\r\n  return [...profiles].sort((a, b) => {\r\n    const systemA = Number(!!a.system);\r\n    const systemB = Number(!!b.system);\r\n    if (systemA !== systemB) return systemB - systemA;\r\n    const kindRank = (kind?: string) => {\r\n      switch (kind) {\r\n        case 'work':\r\n          return 0;\r\n        case 'personal':\r\n          return 1;\r\n        case 'default':\r\n          return 2;\r\n        default:\r\n          return 3;\r\n      }\r\n    };\r\n    const rankDelta = kindRank(a.kind) - kindRank(b.kind);\r\n    if (rankDelta !== 0) return rankDelta;\r\n    return a.name.localeCompare(b.name);\r\n  });\r\n}\r\n\r\nfunction profileAccent(profile: ProfileInfo) {\r\n  if (profile.color) {\r\n    return profile.color;\r\n  }\r\n  switch (profile.kind) {\r\n    case 'work':\r\n      return '#4f46e5';\r\n    case 'personal':\r\n      return '#f97316';\r\n    default:\r\n      return '#3b82f6';\r\n  }\r\n}\r\n\r\nexport function ProfileQuickSwitcher() {\r\n  const {\r\n    profiles,\r\n    activeProfileId,\r\n    policies,\r\n    loading,\r\n    setActiveProfile,\r\n    lastPolicyBlock,\r\n    markPolicyMessageRead,\r\n  } = useProfileStore((state) => ({\r\n    profiles: state.profiles,\r\n    activeProfileId: state.activeProfileId,\r\n    policies: state.policies,\r\n    loading: state.loading,\r\n    setActiveProfile: state.setActiveProfile,\r\n    lastPolicyBlock: state.lastPolicyBlock,\r\n    markPolicyMessageRead: state.markPolicyMessageRead,\r\n  }));\r\n  const [open, setOpen] = useState(false);\r\n  const [creating, setCreating] = useState(false);\r\n  const [newName, setNewName] = useState('');\r\n  const [pendingProfileId, setPendingProfileId] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    ensureProfilesLoaded();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!open && creating) {\r\n      setCreating(false);\r\n      setNewName('');\r\n    }\r\n  }, [open, creating]);\r\n\r\n  const activeProfile = useMemo(() => {\r\n    return profiles.find((profile) => profile.id === activeProfileId) ?? profiles[0];\r\n  }, [profiles, activeProfileId]);\r\n\r\n  const sortedProfiles = useMemo(() => sortProfiles(profiles), [profiles]);\r\n\r\n  const handleSelect = async (profileId: string) => {\r\n    if (profileId === activeProfileId) {\r\n      setOpen(false);\r\n      return;\r\n    }\r\n    try {\r\n      setPendingProfileId(profileId);\r\n      await setActiveProfile(profileId);\r\n      setOpen(false);\r\n    } catch (error) {\r\n      console.error('Failed to switch profile', error);\r\n    } finally {\r\n      setPendingProfileId(null);\r\n    }\r\n  };\r\n\r\n  const handleCreate = async () => {\r\n    const name = newName.trim();\r\n    if (!name) return;\r\n    try {\r\n      await ipc.profiles.create({ name });\r\n      await useProfileStore.getState().loadProfiles(true);\r\n      setCreating(false);\r\n      setNewName('');\r\n    } catch (error) {\r\n      console.error('Failed to create profile', error);\r\n    }\r\n  };\r\n\r\n  const isDefaultProfile =\r\n    !activeProfile ||\r\n    activeProfile.id === 'default' ||\r\n    activeProfile.name.toLowerCase() === 'default';\r\n\r\n  const showLabel = !isDefaultProfile;\r\n\r\n  const buttonSpacing = showLabel ? 'gap-2 px-3' : 'gap-1.5 px-2.5';\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <motion.button\r\n        onClick={() => setOpen((v) => !v)}\r\n        whileHover={{ scale: 1.03 }}\r\n        whileTap={{ scale: 0.97 }}\r\n        className={`flex items-center ${buttonSpacing} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`}\r\n        title={activeProfile ? `${activeProfile.name} profile` : 'Profiles'}\r\n      >\r\n        {(() => {\r\n          const Icon = activeProfile ? getProfileIcon(activeProfile) : UserCircle;\r\n          return <Icon size={16} />;\r\n        })()}\r\n        {showLabel && (\r\n          <span className=\"text-sm font-medium\">\r\n            {activeProfile ? activeProfile.name : 'Profiles'}\r\n          </span>\r\n        )}\r\n        {!isDefaultProfile && activeProfile && (\r\n          <span\r\n            className=\"inline-flex h-2.5 w-2.5 rounded-full border border-gray-900/40\"\r\n            style={{ backgroundColor: profileAccent(activeProfile) }}\r\n          />\r\n        )}\r\n        {loading && <Loader2 size={14} className=\"animate-spin text-gray-400\" />}\r\n      </motion.button>\r\n\r\n      <AnimatePresence>\r\n        {open && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 4 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: 4 }}\r\n            className=\"absolute right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-800/60 rounded-xl shadow-2xl z-50 overflow-hidden\"\r\n          >\r\n            <div className=\"p-3 border-b border-gray-800/60 flex items-center justify-between\">\r\n              <span className=\"text-xs uppercase tracking-wide text-gray-500\">Profiles</span>\r\n              <button\r\n                onClick={() => setCreating((v) => !v)}\r\n                className=\"p-1.5 rounded-md hover:bg-gray-800/60 text-gray-400 hover:text-gray-100 transition-colors\"\r\n                title=\"Create new profile\"\r\n              >\r\n                <Plus size={14} />\r\n              </button>\r\n            </div>\r\n\r\n            {creating && (\r\n              <div className=\"px-3 pb-3 border-b border-gray-800/60 space-y-2\">\r\n                <input\r\n                  value={newName}\r\n                  onChange={(e) => setNewName(e.target.value)}\r\n                  placeholder=\"Profile name\"\r\n                  className=\"w-full px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  autoFocus\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === 'Enter') {\r\n                      handleCreate();\r\n                    } else if (e.key === 'Escape') {\r\n                      setCreating(false);\r\n                      setNewName('');\r\n                    }\r\n                  }}\r\n                />\r\n                <div className=\"flex items-center gap-2 justify-end\">\r\n                  <button\r\n                    onClick={() => {\r\n                      setCreating(false);\r\n                      setNewName('');\r\n                    }}\r\n                    className=\"text-xs text-gray-400 hover:text-gray-200\"\r\n                  >\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    onClick={handleCreate}\r\n                    className=\"text-xs font-medium px-3 py-1.5 rounded-lg bg-blue-600 hover:bg-blue-500 text-white\"\r\n                  >\r\n                    Create\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"max-h-80 overflow-y-auto divide-y divide-gray-800/50\">\r\n              {sortedProfiles.map((profile) => {\r\n                const Icon = getProfileIcon(profile);\r\n                const isActive = profile.id === activeProfileId;\r\n                const policy = policies[profile.id];\r\n                const restricted = policy\r\n                  ? POLICY_CONFIG.filter(({ key }) => !policy[key])\r\n                  : [];\r\n\r\n                return (\r\n                  <button\r\n                    key={profile.id}\r\n                    onClick={() => handleSelect(profile.id)}\r\n                    className={`w-full text-left px-3 py-2 transition-colors ${\r\n                      isActive\r\n                        ? 'bg-blue-600/15 border-l-2 border-blue-500/60'\r\n                        : 'hover:bg-gray-800/60 border-l-2 border-transparent'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex items-center gap-2 text-gray-200\">\r\n                      <span\r\n                        className=\"inline-flex h-2.5 w-2.5 rounded-full\"\r\n                        style={{ backgroundColor: profileAccent(profile) }}\r\n                      />\r\n                      <Icon size={16} className=\"text-gray-300\" />\r\n                      <span className=\"text-sm font-medium flex-1 truncate\">{profile.name}</span>\r\n                      {isActive && <Check size={14} className=\"text-blue-400\" />}\r\n                      {pendingProfileId === profile.id && (\r\n                        <Loader2 size={14} className=\"animate-spin text-gray-400\" />\r\n                      )}\r\n                    </div>\r\n                    <div className=\"mt-1 text-xs text-gray-500 line-clamp-2\">\r\n                      {profile.description || summarizePolicy(policy)}\r\n                    </div>\r\n                    <div className=\"mt-2 flex flex-wrap gap-1\">\r\n                      {POLICY_CONFIG.map(({ key, label, icon: PolicyIcon }) => {\r\n                        const allowed = policy ? policy[key] : true;\r\n                        return (\r\n                          <span\r\n                            key={`${profile.id}-${key}`}\r\n                            className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[11px] border ${\r\n                              allowed\r\n                                ? 'border-emerald-500/40 text-emerald-200 bg-emerald-500/10'\r\n                                : 'border-rose-500/40 text-rose-200 bg-rose-500/10 line-through decoration-rose-300/70'\r\n                            }`}\r\n                            title={POLICY_CONFIG.find((p) => p.key === key)?.description}\r\n                          >\r\n                            <PolicyIcon size={11} />\r\n                            {label}\r\n                          </span>\r\n                        );\r\n                      })}\r\n                      {restricted.length === 0 && (\r\n                        <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[11px] border border-emerald-400/40 text-emerald-200 bg-emerald-500/10\">\r\n                          <Shield size={11} />\r\n                          Compliant\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })}\r\n\r\n              {sortedProfiles.length === 0 && (\r\n                <div className=\"px-3 py-4 text-xs text-gray-500 text-center\">\r\n                  No profiles yet. Create one to get started.\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {lastPolicyBlock && (\r\n              <div className=\"px-3 py-2 border-t border-gray-800/60 bg-amber-500/10 text-xs text-amber-200 flex items-start gap-2\">\r\n                <Shield size={12} className=\"mt-0.5\" />\r\n                <div>\r\n                  <div className=\"font-medium text-amber-100\">Action blocked by policy</div>\r\n                  <div className=\"mt-1 text-amber-200/80\">\r\n                    {lastPolicyBlock.action.replace('-', ' ')} is disabled for this profile.\r\n                  </div>\r\n                  <button\r\n                    onClick={markPolicyMessageRead}\r\n                    className=\"mt-2 text-[11px] text-amber-200 hover:text-amber-100 underline\"\r\n                  >\r\n                    Dismiss\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Boxes, Plus } from 'lucide-react';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useContainerStore } from '../../state/containerStore';\r\nimport { ContainerInfo } from '../../lib/ipc-events';\r\nimport { ipcEvents } from '../../lib/ipc-events';\r\n\r\ntype PermissionKey = 'media' | 'display-capture' | 'notifications' | 'fullscreen';\r\n\r\nconst PERMISSION_OPTIONS: Array<{ key: PermissionKey; label: string; description: string }> = [\r\n  {\r\n    key: 'media',\r\n    label: 'Camera & microphone',\r\n    description: 'Allow access to audio / video input devices.',\r\n  },\r\n  {\r\n    key: 'display-capture',\r\n    label: 'Screen capture',\r\n    description: 'Enable screen or window sharing requests.',\r\n  },\r\n  {\r\n    key: 'notifications',\r\n    label: 'Desktop notifications',\r\n    description: 'Permit this container to show system notifications.',\r\n  },\r\n  {\r\n    key: 'fullscreen',\r\n    label: 'Fullscreen & PIP',\r\n    description: 'Allow fullscreen transitions and picture-in-picture.',\r\n  },\r\n];\r\n\r\nexport function ContainerSwitcher() {\r\n  const { containers, activeContainerId, setContainers, setActiveContainer } = useContainerStore();\r\n  const [open, setOpen] = useState(false);\r\n  const [creating, setCreating] = useState(false);\r\n  const [name, setName] = useState('');\r\n  const [color, setColor] = useState('#22c55e');\r\n  const [permissionState, setPermissionState] = useState<Record<string, string[]>>({});\r\n  const [sitePermissionState, setSitePermissionState] = useState<\r\n    Record<string, Array<{ permission: PermissionKey; origins: string[] }>>\r\n  >({});\r\n\r\n  const fetchPermissions = useCallback(async (containerId: string): Promise<string[]> => {\r\n    try {\r\n      const response = await ipc.containers.getPermissions(containerId);\r\n      return Array.isArray(response?.permissions) ? response.permissions : [];\r\n    } catch (error) {\r\n      console.error('Failed to fetch container permissions:', error);\r\n      return [];\r\n    }\r\n  }, []);\r\n\r\n  const refreshPermissionState = useCallback(async (containerId: string) => {\r\n    const permissions = await fetchPermissions(containerId);\r\n    setPermissionState((prev) => ({\r\n      ...prev,\r\n      [containerId]: permissions,\r\n    }));\r\n  }, [fetchPermissions]);\r\n\r\n  const refreshSitePermissions = useCallback(async (containerId: string) => {\r\n    try {\r\n      const entries = await ipc.containers.getSitePermissions(containerId);\r\n      if (Array.isArray(entries)) {\r\n        setSitePermissionState((prev) => ({\r\n          ...prev,\r\n          [containerId]: entries as Array<{ permission: PermissionKey; origins: string[] }>,\r\n        }));\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load site permissions:', error);\r\n    }\r\n  }, []);\r\n\r\n  const loadContainers = useCallback(async () => {\r\n    try {\r\n      const [list, active] = await Promise.all([\r\n        ipc.containers.list(),\r\n        ipc.containers.getActive(),\r\n      ]);\r\n\r\n      if (Array.isArray(list)) {\r\n        const typedList = list as ContainerInfo[];\r\n        setContainers(typedList);\r\n        const permissionEntries = await Promise.all(\r\n          typedList.map((container) => fetchPermissions(container.id))\r\n        );\r\n        const map: Record<string, string[]> = {};\r\n        typedList.forEach((container, index) => {\r\n          map[container.id] = permissionEntries[index] ?? [];\r\n        });\r\n        setPermissionState(map);\r\n      }\r\n\r\n      if (active) {\r\n        setActiveContainer(active as ContainerInfo);\r\n        await refreshPermissionState(active.id);\r\n        await refreshSitePermissions(active.id);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load containers:', error);\r\n    }\r\n  }, [fetchPermissions, refreshPermissionState, refreshSitePermissions, setActiveContainer, setContainers]);\r\n\r\n  useEffect(() => {\r\n    void loadContainers();\r\n  }, [loadContainers]);\r\n\r\n  useEffect(() => {\r\n    const unsubscribeSite = ipcEvents.on<{ containerId: string; permission: PermissionKey; origins: string[] }>(\r\n      'containers:sitePermissions',\r\n      (payload) => {\r\n        if (!payload?.containerId) return;\r\n        setSitePermissionState((prev) => ({\r\n          ...prev,\r\n          [payload.containerId]: [\r\n            ...(prev[payload.containerId]?.filter((entry) => entry.permission !== payload.permission) ?? []),\r\n            { permission: payload.permission, origins: payload.origins },\r\n          ],\r\n        }));\r\n      },\r\n    );\r\n    return () => {\r\n      unsubscribeSite();\r\n    };\r\n  }, []);\r\n\r\n  const handleSelect = async (container: ContainerInfo) => {\r\n    try {\r\n      const active = await ipc.containers.setActive(container.id);\r\n      if (active) {\r\n        setActiveContainer(active as ContainerInfo);\r\n      } else {\r\n        setActiveContainer(container);\r\n      }\r\n      await refreshPermissionState(container.id);\r\n      await refreshSitePermissions(container.id);\r\n      setOpen(false);\r\n    } catch (error) {\r\n      console.error('Failed to set active container:', error);\r\n    }\r\n  };\r\n\r\n  const handleCreate = async () => {\r\n    if (!name.trim()) return;\r\n    try {\r\n      const container = await ipc.containers.create({ name: name.trim(), color });\r\n      if (container) {\r\n        await loadContainers();\r\n        await refreshPermissionState(container.id);\r\n        await refreshSitePermissions(container.id);\r\n      }\r\n      setName('');\r\n      setCreating(false);\r\n      setOpen(false);\r\n    } catch (error) {\r\n      console.error('Failed to create container:', error);\r\n    }\r\n  };\r\n\r\n  const activeContainer = containers.find((c) => c.id === activeContainerId);\r\n  const activePermissions = activeContainer ? permissionState[activeContainer.id] ?? [] : [];\r\n  const sitePermissionEntries = activeContainer ? sitePermissionState[activeContainer.id] ?? [] : [];\r\n  const originsForPermission = (permission: PermissionKey) =>\r\n    sitePermissionEntries.find((entry) => entry.permission === permission)?.origins ?? [];\r\n\r\n  const handleTogglePermission = async (permissionKey: PermissionKey) => {\r\n    if (!activeContainer) return;\r\n    const enabled = activePermissions.includes(permissionKey);\r\n    try {\r\n      const response = await ipc.containers.setPermission(activeContainer.id, permissionKey, !enabled);\r\n      setPermissionState((prev) => ({\r\n        ...prev,\r\n        [activeContainer.id]: Array.isArray(response?.permissions) ? response.permissions : [],\r\n      }));\r\n      await refreshSitePermissions(activeContainer.id);\r\n    } catch (error) {\r\n      console.error('Failed to update container permission:', error);\r\n    }\r\n  };\r\n\r\n  const handleRemoveOrigin = async (permissionKey: PermissionKey, origin: string) => {\r\n    if (!activeContainer) return;\r\n    try {\r\n      const entries = await ipc.containers.revokeSitePermission(activeContainer.id, permissionKey, origin);\r\n      if (Array.isArray(entries)) {\r\n        setSitePermissionState((prev) => ({\r\n          ...prev,\r\n          [activeContainer.id]: entries as Array<{ permission: PermissionKey; origins: string[] }>,\r\n        }));\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to revoke site permission:', error);\r\n    }\r\n  };\r\n\r\n  const isDefaultContainer =\r\n    !activeContainer ||\r\n    activeContainer.id === 'default' ||\r\n    activeContainer.name.toLowerCase() === 'default';\r\n\r\n  const showLabel = !isDefaultContainer;\r\n\r\n  const buttonSpacing = showLabel ? 'gap-2 px-3' : 'gap-1.5 px-2.5';\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <motion.button\r\n        onClick={() => setOpen(!open)}\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n        className={`relative flex items-center ${buttonSpacing} py-1.5 rounded-lg bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-all`}\r\n        title=\"Container (isolated storage)\"\r\n      >\r\n        <Boxes size={16} />\r\n        {showLabel && (\r\n          <span className=\"text-sm font-medium\">{activeContainer?.name || 'Default'}</span>\r\n        )}\r\n        {!isDefaultContainer && activeContainer?.color && (\r\n          <div\r\n            className=\"w-3 h-3 rounded-full border border-gray-700\"\r\n            style={{ backgroundColor: activeContainer.color }}\r\n          />\r\n        )}\r\n      </motion.button>\r\n\r\n      <AnimatePresence>\r\n        {open && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: 10 }}\r\n            className=\"absolute right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-lg shadow-xl overflow-hidden z-40\"\r\n          >\r\n            <div className=\"p-3 border-b border-gray-800/50 flex items-center justify-between\">\r\n              <h3 className=\"text-sm font-semibold text-gray-200\">Containers</h3>\r\n              <button\r\n                onClick={() => {\r\n                  setCreating(true);\r\n                  setName('');\r\n                  setColor('#22c55e');\r\n                }}\r\n                className=\"p-1.5 rounded-lg hover:bg-gray-800 text-gray-400 hover:text-blue-400 transition-colors\"\r\n              >\r\n                <Plus size={16} />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"max-h-80 overflow-y-auto\">\r\n              {creating && (\r\n                <div className=\"p-3 border-b border-gray-800/50\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={name}\r\n                    onChange={(e) => setName(e.target.value)}\r\n                    placeholder=\"Container name\"\r\n                    autoFocus\r\n                    className=\"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  />\r\n                  <div className=\"flex items-center gap-2 mt-2\">\r\n                    <label className=\"text-xs text-gray-400\">Color</label>\r\n                    <input\r\n                      type=\"color\"\r\n                      value={color}\r\n                      onChange={(e) => setColor(e.target.value)}\r\n                      className=\"h-7 w-16 bg-transparent border border-gray-700 rounded\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex gap-2 mt-3\">\r\n                    <button\r\n                      onClick={handleCreate}\r\n                      className=\"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white\"\r\n                    >\r\n                      Create\r\n                    </button>\r\n                    <button\r\n                      onClick={() => {\r\n                        setCreating(false);\r\n                        setName('');\r\n                      }}\r\n                      className=\"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm text-gray-300\"\r\n                    >\r\n                      Cancel\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {containers.map((container) => {\r\n                const isActive = container.id === activeContainerId;\r\n                return (\r\n                  <button\r\n                    key={container.id}\r\n                    onClick={() => handleSelect(container)}\r\n                    className={`w-full flex items-center gap-3 px-3 py-2 text-left border-b border-gray-800/50 transition-colors ${\r\n                      isActive ? 'bg-blue-600/20 border-blue-500/30' : 'hover:bg-gray-800/50'\r\n                    }`}\r\n                  >\r\n                    <div\r\n                      className=\"w-4 h-4 rounded-full border border-gray-700\"\r\n                      style={{ backgroundColor: container.color }}\r\n                    />\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"text-sm font-medium text-gray-200 truncate\">{container.name}</div>\r\n                      <div className=\"text-xs text-gray-500 truncate\">\r\n                        {container.scope ? `${container.scope.charAt(0).toUpperCase()}${container.scope.slice(1)} scope` : 'Session scope'}\r\n                      </div>\r\n                    </div>\r\n                    {isActive && <span className=\"text-xs text-blue-400\">Active</span>}\r\n                  </button>\r\n                );\r\n              })}\r\n\r\n              {containers.length === 0 && !creating && (\r\n                <div className=\"p-3 text-xs text-gray-500\">No containers yet</div>\r\n              )}\r\n            </div>\r\n\r\n            {activeContainer && (\r\n              <div className=\"border-t border-gray-800/50 bg-gray-900/60 p-3\">\r\n                <span className=\"text-xs uppercase tracking-wide text-gray-500\">\r\n                  Permissions for {activeContainer.name}\r\n                </span>\r\n                <div className=\"mt-3 space-y-3\">\r\n                  {PERMISSION_OPTIONS.map((option) => {\r\n                    const enabled = activePermissions.includes(option.key);\r\n                    return (\r\n                      <label\r\n                        key={option.key}\r\n                        className=\"flex items-start gap-3 rounded-lg border border-transparent px-2 py-2 hover:border-gray-700/60 hover:bg-gray-800/40 transition-colors cursor-pointer\"\r\n                      >\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          className=\"mt-1 h-4 w-4 rounded border-gray-600 bg-gray-800 text-blue-500 focus:ring-blue-500\"\r\n                          checked={enabled}\r\n                          onChange={() => handleTogglePermission(option.key)}\r\n                        />\r\n                        <div className=\"flex-1 space-y-1\">\r\n                          <div className=\"text-sm font-medium text-gray-200\">\r\n                            {option.label}\r\n                          </div>\r\n                          <p className=\"text-xs text-gray-500 leading-snug\">\r\n                            {option.description}\r\n                          </p>\r\n                      {originsForPermission(option.key).length > 0 && (\r\n                        <div className=\"mt-2 space-y-1\">\r\n                          <span className=\"text-[11px] uppercase tracking-wide text-gray-500\">\r\n                            Allowed sites\r\n                          </span>\r\n                          <div className=\"flex flex-wrap gap-2\">\r\n                            {originsForPermission(option.key).map((origin) => (\r\n                              <span\r\n                                key={`${option.key}-${origin}`}\r\n                                className=\"group inline-flex items-center gap-2 rounded-full border border-gray-700 bg-gray-800/60 px-2 py-0.5 text-[11px] text-gray-300\"\r\n                                title={origin}\r\n                              >\r\n                                <span className=\"max-w-[140px] truncate\">{origin.replace(/^https?:\\/\\//, '')}</span>\r\n                                <button\r\n                                  type=\"button\"\r\n                                  onClick={(e) => {\r\n                                    e.preventDefault();\r\n                                    e.stopPropagation();\r\n                                    void handleRemoveOrigin(option.key, origin);\r\n                                  }}\r\n                                  className=\"rounded-full bg-transparent p-0.5 text-gray-500 hover:bg-gray-700 hover:text-gray-200 transition-colors\"\r\n                                  aria-label={`Remove ${origin} from ${option.label}`}\r\n                                >\r\n                                  ×\r\n                                </button>\r\n                              </span>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                        </div>\r\n                      </label>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"p-3 border-t border-gray-800/50 bg-gray-900/50\">\r\n              <p className=\"text-xs text-gray-500\">\r\n                Containers isolate cookies, storage, and login state per tab.\r\n              </p>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","import { create } from 'zustand';\r\n\r\ntype ThemePreference = 'system' | 'light' | 'dark';\r\ntype ResolvedTheme = 'light' | 'dark';\r\n\r\ninterface ThemeState {\r\n  preference: ThemePreference;\r\n  resolved: ResolvedTheme;\r\n  setPreference: (preference: ThemePreference) => void;\r\n  cyclePreference: () => void;\r\n}\r\n\r\nconst STORAGE_KEY = 'omnibrowser:theme-preference';\r\nconst isBrowser = typeof window !== 'undefined';\r\n\r\nconst getSystemTheme = (): ResolvedTheme => {\r\n  if (!isBrowser || typeof window.matchMedia !== 'function') {\r\n    return 'dark';\r\n  }\r\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n};\r\n\r\nconst applyTheme = (preference: ThemePreference) => {\r\n  if (typeof document === 'undefined') return;\r\n  const resolved = preference === 'system' ? getSystemTheme() : preference;\r\n  document.documentElement.dataset.theme = resolved;\r\n  document.documentElement.setAttribute('data-theme-resolved', resolved);\r\n};\r\n\r\nconst initialPreference: ThemePreference = (() => {\r\n  if (!isBrowser) return 'system';\r\n  const stored = window.localStorage.getItem(STORAGE_KEY);\r\n  if (stored === 'light' || stored === 'dark' || stored === 'system') {\r\n    return stored;\r\n  }\r\n  return 'system';\r\n})();\r\n\r\nconst initialResolved: ResolvedTheme = initialPreference === 'system' ? getSystemTheme() : initialPreference;\r\nif (typeof document !== 'undefined') {\r\n  applyTheme(initialPreference);\r\n}\r\n\r\nexport const useThemeStore = create<ThemeState>((set, get) => ({\r\n  preference: initialPreference,\r\n  resolved: initialResolved,\r\n  setPreference: (preference) => {\r\n    if (isBrowser) {\r\n      window.localStorage.setItem(STORAGE_KEY, preference);\r\n    }\r\n    applyTheme(preference);\r\n    const resolved = preference === 'system' ? getSystemTheme() : preference;\r\n    set({ preference, resolved });\r\n  },\r\n  cyclePreference: () => {\r\n    const order: ThemePreference[] = ['system', 'light', 'dark'];\r\n    const current = get().preference;\r\n    const next = order[(order.indexOf(current) + 1) % order.length];\r\n    get().setPreference(next);\r\n  },\r\n}));\r\n\r\nif (isBrowser && typeof window.matchMedia === 'function') {\r\n  const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n  const handleChange = () => {\r\n    const { preference } = useThemeStore.getState();\r\n    if (preference === 'system') {\r\n      applyTheme('system');\r\n      const resolved = getSystemTheme();\r\n      useThemeStore.setState({ resolved });\r\n    }\r\n  };\r\n  try {\r\n    mediaQuery.addEventListener('change', handleChange);\r\n  } catch {\r\n    // Safari < 14 fallback\r\n    mediaQuery.addListener(handleChange);\r\n  }\r\n}\r\n","import { LayoutGroup, motion } from 'framer-motion';\r\nimport { Monitor, Moon, Sun } from 'lucide-react';\r\nimport { useThemeStore } from '../../state/themeStore';\r\n\r\nconst OPTIONS: Array<{\r\n  id: 'system' | 'light' | 'dark';\r\n  label: string;\r\n  icon: typeof Monitor;\r\n}> = [\r\n  { id: 'system', label: 'Auto', icon: Monitor },\r\n  { id: 'light', label: 'Light', icon: Sun },\r\n  { id: 'dark', label: 'Dark', icon: Moon },\r\n];\r\n\r\nexport function ThemeSwitcher() {\r\n  const preference = useThemeStore((state) => state.preference);\r\n  const resolved = useThemeStore((state) => state.resolved);\r\n  const setPreference = useThemeStore((state) => state.setPreference);\r\n  const cyclePreference = useThemeStore((state) => state.cyclePreference);\r\n\r\n  return (\r\n    <LayoutGroup id=\"theme-switcher\">\r\n      <div\r\n        className=\"no-drag button-surface px-2 py-1.5 rounded-lg flex items-center gap-1 text-[11px]\"\r\n        role=\"radiogroup\"\r\n        aria-label=\"Theme preference\"\r\n        title={`Theme: ${preference === 'system' ? `Auto (${resolved})` : preference}`}\r\n        onDoubleClick={cyclePreference}\r\n      >\r\n        {OPTIONS.map((option) => {\r\n          const Icon = option.icon;\r\n          const isActive = preference === option.id || (preference === 'system' && option.id === resolved);\r\n          return (\r\n            <motion.button\r\n              key={option.id}\r\n              type=\"button\"\r\n              onClick={() => setPreference(option.id)}\r\n              whileHover={{ scale: 1.05 }}\r\n              whileTap={{ scale: 0.95 }}\r\n              className={`relative flex items-center gap-1 px-2.5 py-1 rounded-md transition-all duration-150 text-xs font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:ring-offset-transparent ${\r\n                isActive ? 'theme-pill-active' : 'theme-pill'\r\n              }`}\r\n              role=\"radio\"\r\n              aria-checked={isActive}\r\n            >\r\n              <Icon size={13} />\r\n              <span className=\"hidden sm:inline\">{option.label}</span>\r\n              {isActive && (\r\n                <motion.span\r\n                  layoutId=\"theme-pill-indicator\"\r\n                  className=\"absolute inset-0 -z-10 rounded-md bg-blue-500/15 border border-blue-500/40\"\r\n                  transition={{ type: 'spring', stiffness: 400, damping: 40 }}\r\n                />\r\n              )}\r\n            </motion.button>\r\n          );\r\n        })}\r\n      </div>\r\n    </LayoutGroup>\r\n  );\r\n}\r\n","import { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport type { PrivacyAuditSummary } from '../../lib/ipc-events';\r\n\r\nconst POLL_INTERVAL = 15000;\r\n\r\nfunction gradeToColor(grade: PrivacyAuditSummary['grade']): string {\r\n  switch (grade) {\r\n    case 'high':\r\n      return 'bg-red-500/80 text-white';\r\n    case 'moderate':\r\n      return 'bg-amber-500/80 text-white';\r\n    default:\r\n      return 'bg-emerald-500/80 text-white';\r\n  }\r\n}\r\n\r\nfunction gradeToLabel(grade: PrivacyAuditSummary['grade']): string {\r\n  switch (grade) {\r\n    case 'high':\r\n      return 'High risk';\r\n    case 'moderate':\r\n      return 'Watch';\r\n    default:\r\n      return 'Clean';\r\n  }\r\n}\r\n\r\nexport function PrivacySentinelBadge() {\r\n  const activeTabId = useTabsStore((state) => state.activeId);\r\n  const [audit, setAudit] = useState<PrivacyAuditSummary | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const runAudit = useCallback(async () => {\r\n    if (!activeTabId) {\r\n      setAudit(null);\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      const result = await ipc.privacy.sentinel.audit(activeTabId);\r\n      setAudit(result ?? null);\r\n    } catch (error) {\r\n      console.warn('[PrivacySentinel] audit failed', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [activeTabId]);\r\n\r\n  useEffect(() => {\r\n    runAudit();\r\n  }, [runAudit]);\r\n\r\n  useEffect(() => {\r\n    if (!activeTabId) return;\r\n    const timer = window.setInterval(runAudit, POLL_INTERVAL);\r\n    return () => window.clearInterval(timer);\r\n  }, [activeTabId, runAudit]);\r\n\r\n  const label = useMemo(() => {\r\n    if (loading) return 'Scanning…';\r\n    if (!audit) return 'No data';\r\n    return gradeToLabel(audit.grade);\r\n  }, [audit, loading]);\r\n\r\n  const tooltip = useMemo(() => {\r\n    if (!audit) return 'Privacy Sentinel has no data for this tab yet.';\r\n    const lines = [audit.message];\r\n    if (audit.trackers.length > 0) {\r\n      lines.push(`Trackers: ${audit.trackers.slice(0, 3).map(t => t.host).join(', ')}`);\r\n    }\r\n    if (audit.thirdPartyHosts.length > 0) {\r\n      lines.push(`3rd-party: ${audit.thirdPartyHosts.slice(0, 3).map(t => t.host).join(', ')}`);\r\n    }\r\n    lines.push(...audit.suggestions);\r\n    return lines.join('\\n');\r\n  }, [audit]);\r\n\r\n  const gradeClass = audit ? gradeToColor(audit.grade) : 'bg-slate-500/70 text-white';\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      className={`no-drag flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium transition-colors ${gradeClass}`}\r\n      title={tooltip}\r\n      onClick={runAudit}\r\n    >\r\n      <span className=\"inline-flex h-2 w-2 items-center justify-center\">\r\n        <span className=\"h-2 w-2 rounded-full bg-current\" />\r\n      </span>\r\n      <span>{label}</span>\r\n    </button>\r\n  );\r\n}\r\n","/**\r\n * ShieldsButton - Per-site shields toggle with live counters\r\n */\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Shield, ChevronDown } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { ShieldsCounters } from '../../lib/ipc-events';\r\nimport { useIPCEvent } from '../../lib/use-ipc-event';\r\n\r\ninterface ShieldsConfig {\r\n  ads: boolean;\r\n  cookies: 'all' | '3p' | 'none';\r\n  httpsOnly: boolean;\r\n  fingerprinting: boolean;\r\n  scripts: 'all' | '3p' | 'none';\r\n  webrtc: boolean;\r\n}\r\n\r\nexport function ShieldsButton() {\r\n  const { activeId } = useTabsStore();\r\n  const [open, setOpen] = useState(false);\r\n  const [counters, setCounters] = useState<ShieldsCounters | null>(null);\r\n  const [config, setConfig] = useState<ShieldsConfig>({\r\n    ads: true,\r\n    cookies: '3p',\r\n    httpsOnly: false,\r\n    fingerprinting: true,\r\n    scripts: 'all',\r\n    webrtc: true,\r\n  });\r\n  const [totalBlocked, setTotalBlocked] = useState(0);\r\n\r\n  // Listen for shields counters\r\n  useIPCEvent<ShieldsCounters>('shields:counters', (data) => {\r\n    // If tabId is empty or matches activeId, update counters\r\n    if (!data.tabId || data.tabId === '' || data.tabId === activeId) {\r\n      setCounters(data);\r\n      setTotalBlocked((data.ads || 0) + (data.trackers || 0) + (data.cookiesBlocked || 0));\r\n    }\r\n  }, [activeId]);\r\n\r\n  // Load shields config for current site\r\n  useEffect(() => {\r\n    if (activeId) {\r\n      // Would fetch from IPC\r\n      // ipc.shields.getConfig(activeId).then(setConfig).catch(() => {});\r\n    }\r\n  }, [activeId]);\r\n\r\n  const updateConfig = async (key: keyof ShieldsConfig, value: any) => {\r\n    const newConfig = { ...config, [key]: value };\r\n    setConfig(newConfig);\r\n    // Would update via IPC\r\n    // await ipc.shields.setConfig(activeId, newConfig);\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <motion.button\r\n        data-shields-button\r\n        onClick={() => setOpen(!open)}\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n        className={`\r\n          relative flex items-center gap-2 px-3 py-1.5 rounded-lg\r\n          bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50\r\n          text-gray-300 hover:text-gray-100 transition-colors\r\n        `}\r\n      >\r\n        <Shield size={16} className={totalBlocked > 0 ? 'text-blue-400' : 'text-gray-500'} />\r\n        {totalBlocked > 0 && (\r\n          <span className=\"px-1.5 py-0.5 bg-blue-500/20 text-blue-400 text-xs font-medium rounded\">\r\n            {totalBlocked}\r\n          </span>\r\n        )}\r\n        <ChevronDown size={14} className={`transition-transform ${open ? 'rotate-180' : ''}`} />\r\n      </motion.button>\r\n\r\n      <AnimatePresence>\r\n        {open && (\r\n          <>\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              className=\"fixed inset-0 z-40\"\r\n              onClick={() => setOpen(false)}\r\n            />\r\n            <motion.div\r\n              initial={{ opacity: 0, y: -10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -10 }}\r\n              className=\"absolute top-full right-0 mt-2 w-80 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl z-50\"\r\n            >\r\n              <div className=\"p-4 border-b border-gray-800/50\">\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                  <h3 className=\"text-sm font-semibold text-gray-200\">Shields</h3>\r\n                  {counters && (\r\n                    <div className=\"text-xs text-gray-400\">\r\n                      {counters.ads} ads · {counters.trackers} trackers · {counters.httpsUpgrades} upgraded\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Live Counters */}\r\n                {counters && (\r\n                  <div className=\"grid grid-cols-3 gap-2 mb-4\">\r\n                    <div className=\"bg-gray-800/40 rounded p-2 text-center\">\r\n                      <div className=\"text-lg font-bold text-red-400\">{counters.ads}</div>\r\n                      <div className=\"text-xs text-gray-500\">Ads Blocked</div>\r\n                    </div>\r\n                    <div className=\"bg-gray-800/40 rounded p-2 text-center\">\r\n                      <div className=\"text-lg font-bold text-orange-400\">{counters.trackers}</div>\r\n                      <div className=\"text-xs text-gray-500\">Trackers</div>\r\n                    </div>\r\n                    <div className=\"bg-gray-800/40 rounded p-2 text-center\">\r\n                      <div className=\"text-lg font-bold text-green-400\">{counters.httpsUpgrades}</div>\r\n                      <div className=\"text-xs text-gray-500\">HTTPS</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Toggles */}\r\n              <div className=\"p-4 space-y-3\">\r\n                {[\r\n                  { key: 'ads' as const, label: 'Block ads & trackers', icon: Shield },\r\n                  { key: 'fingerprinting' as const, label: 'Anti-fingerprinting', icon: Shield },\r\n                  { key: 'webrtc' as const, label: 'Block WebRTC leaks', icon: Shield },\r\n                ].map(({ key, label }) => (\r\n                  <div key={key} className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm text-gray-300\">{label}</span>\r\n                    <button\r\n                      onClick={() => updateConfig(key, !config[key])}\r\n                      className={`\r\n                        relative w-11 h-6 rounded-full transition-colors\r\n                        ${config[key] ? 'bg-blue-600' : 'bg-gray-700'}\r\n                      `}\r\n                    >\r\n                      <motion.div\r\n                        className=\"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm\"\r\n                        animate={{ x: config[key] ? 20 : 0 }}\r\n                        transition={{ type: 'spring', stiffness: 500, damping: 30 }}\r\n                      />\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n\r\n                {/* Cookie blocking */}\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-sm text-gray-300\">3rd-party cookies</span>\r\n                  <select\r\n                    value={config.cookies}\r\n                    onChange={(e) => updateConfig('cookies', e.target.value)}\r\n                    className=\"bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs text-gray-300\"\r\n                  >\r\n                    <option value=\"all\">Allow</option>\r\n                    <option value=\"3p\">Block 3P</option>\r\n                    <option value=\"none\">Block All</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\n","/**\r\n * NetworkButton - Proxy/Tor/VPN/DoH status with controls\r\n */\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Network, ChevronDown, CheckCircle, XCircle, RefreshCw } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { NetworkStatus } from '../../lib/ipc-events';\r\nimport { useIPCEvent } from '../../lib/use-ipc-event';\r\nimport { ipc } from '../../lib/ipc-typed';\r\n\r\nexport function NetworkButton() {\r\n  const [open, setOpen] = useState(false);\r\n  const [status, setStatus] = useState<NetworkStatus>({\r\n    doh: { enabled: false, provider: 'cloudflare' },\r\n  });\r\n\r\n  // Listen for network status updates\r\n  useIPCEvent<NetworkStatus>('net:status', (data) => {\r\n    setStatus(data);\r\n  }, []);\r\n\r\n  // Load initial status (wait for IPC)\r\n  useEffect(() => {\r\n    const loadStatus = async () => {\r\n      // Wait for IPC to be ready\r\n      if (!window.ipc || typeof window.ipc.invoke !== 'function') {\r\n        // Retry after a delay\r\n        setTimeout(loadStatus, 500);\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        const s = await ipc.dns.status();\r\n        setStatus(prev => ({ ...prev, doh: s as any }));\r\n      } catch {\r\n        // Silently handle - will retry if needed\r\n      }\r\n    };\r\n    \r\n    // Delay initial load to allow IPC to initialize\r\n    setTimeout(loadStatus, 300);\r\n  }, []);\r\n\r\n  const handleNewTorIdentity = async () => {\r\n    try {\r\n      await ipc.tor.newIdentity();\r\n    } catch (error) {\r\n      console.error('Failed to get new Tor identity:', error);\r\n    }\r\n  };\r\n\r\n  const hasActiveConnection = status.tor?.circuitEstablished || status.vpn?.connected || status.proxy?.enabled;\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <motion.button\r\n        data-network-button\r\n        onClick={() => setOpen(!open)}\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n        className={`\r\n          relative flex items-center gap-2 px-3 py-1.5 rounded-lg\r\n          bg-gray-800/60 hover:bg-gray-800/80 border border-gray-700/50\r\n          text-gray-300 hover:text-gray-100 transition-colors\r\n        `}\r\n      >\r\n        <Network size={16} className={hasActiveConnection ? 'text-green-400' : 'text-gray-500'} />\r\n        {hasActiveConnection && (\r\n          <motion.div\r\n            className=\"w-2 h-2 bg-green-400 rounded-full\"\r\n            animate={{ scale: [1, 1.2, 1] }}\r\n            transition={{ duration: 2, repeat: Infinity }}\r\n          />\r\n        )}\r\n        <ChevronDown size={14} className={`transition-transform ${open ? 'rotate-180' : ''}`} />\r\n      </motion.button>\r\n\r\n      <AnimatePresence>\r\n        {open && (\r\n          <>\r\n            <motion.div\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0 }}\r\n              className=\"fixed inset-0 z-40\"\r\n              onClick={() => setOpen(false)}\r\n            />\r\n            <motion.div\r\n              initial={{ opacity: 0, y: -10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -10 }}\r\n              className=\"absolute top-full right-0 mt-2 w-72 bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl z-50\"\r\n            >\r\n              <div className=\"p-4 space-y-4\">\r\n                {/* Tor */}\r\n                {status.tor && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Network size={16} className=\"text-purple-400\" />\r\n                        <span className=\"text-sm font-medium text-gray-200\">Tor</span>\r\n                      </div>\r\n                      {status.tor.circuitEstablished ? (\r\n                        <CheckCircle size={16} className=\"text-green-400\" />\r\n                      ) : (\r\n                        <XCircle size={16} className=\"text-red-400\" />\r\n                      )}\r\n                    </div>\r\n                    {status.tor.enabled && status.tor.circuitEstablished && (\r\n                      <div className=\"space-y-1\">\r\n                        <div className=\"text-xs text-gray-400\">Identity: {status.tor.identity.slice(0, 8)}...</div>\r\n                        <button\r\n                          onClick={handleNewTorIdentity}\r\n                          className=\"w-full flex items-center justify-center gap-2 px-3 py-1.5 bg-purple-600/20 hover:bg-purple-600/30 border border-purple-500/30 rounded text-xs text-purple-300 transition-colors\"\r\n                        >\r\n                          <RefreshCw size={14} />\r\n                          New Identity\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* VPN */}\r\n                {status.vpn && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Network size={16} className=\"text-blue-400\" />\r\n                        <span className=\"text-sm font-medium text-gray-200\">VPN</span>\r\n                      </div>\r\n                      {status.vpn.connected ? (\r\n                        <CheckCircle size={16} className=\"text-green-400\" />\r\n                      ) : (\r\n                        <XCircle size={16} className=\"text-gray-500\" />\r\n                      )}\r\n                    </div>\r\n                    {status.vpn.provider && (\r\n                      <div className=\"text-xs text-gray-400\">Provider: {status.vpn.provider}</div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Proxy */}\r\n                {status.proxy && status.proxy.enabled && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Network size={16} className=\"text-cyan-400\" />\r\n                        <span className=\"text-sm font-medium text-gray-200\">Proxy</span>\r\n                      </div>\r\n                      <CheckCircle size={16} className=\"text-green-400\" />\r\n                    </div>\r\n                    {status.proxy.host && (\r\n                      <div className=\"text-xs text-gray-400\">{status.proxy.type.toUpperCase()}: {status.proxy.host}</div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* DNS-over-HTTPS */}\r\n                {status.doh && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Network size={16} className=\"text-green-400\" />\r\n                        <span className=\"text-sm font-medium text-gray-200\">DNS-over-HTTPS</span>\r\n                      </div>\r\n                      {status.doh.enabled ? (\r\n                        <CheckCircle size={16} className=\"text-green-400\" />\r\n                      ) : (\r\n                        <XCircle size={16} className=\"text-gray-500\" />\r\n                      )}\r\n                    </div>\r\n                    {status.doh.enabled && (\r\n                      <div className=\"text-xs text-gray-400\">Provider: {status.doh.provider}</div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </motion.div>\r\n          </>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\n","/**\r\n * TopNav - Complete navigation bar with all components\r\n */\r\n\r\nimport { useState, useEffect, useRef, useCallback, useMemo } from 'react';\r\nimport {\r\n  ArrowLeft,\r\n  ArrowRight,\r\n  RefreshCw,\r\n  Download,\r\n  Settings,\r\n  Bot,\r\n  ChevronDown,\r\n  Workflow,\r\n  Camera,\r\n  PictureInPicture,\r\n  Code,\r\n  FileText,\r\n  Network,\r\n  Layers,\r\n  Sparkles,\r\n  Highlighter,\r\n  Shield,\r\n  Wifi,\r\n  Play,\r\n  History,\r\n  Search,\r\n  Activity,\r\n  Home,\r\n} from 'lucide-react';\r\nimport type { LucideIcon } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { useOnboardingStore } from '../../state/onboardingStore';\r\nimport { useTabGraphStore } from '../../state/tabGraphStore';\r\nimport { useConsentOverlayStore } from '../../state/consentOverlayStore';\r\nimport { usePrivacyStore } from '../../state/privacyStore';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { ModeSwitch } from '../TopNav/ModeSwitch';\r\nimport { Omnibox } from '../TopNav/Omnibox';\r\nimport { ProgressBar } from '../TopNav/ProgressBar';\r\nimport { SessionSwitcher } from '../sessions/SessionSwitcher';\r\nimport { ProfileQuickSwitcher } from '../sessions/ProfileQuickSwitcher';\r\nimport { ContainerSwitcher } from '../sessions/ContainerSwitcher';\r\nimport { useIPCEvent } from '../../lib/use-ipc-event';\r\nimport { DownloadUpdate } from '../../lib/ipc-events';\r\nimport { ThemeSwitcher } from '../TopNav/ThemeSwitcher';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { PrivacySentinelBadge } from '../TopNav/PrivacySentinelBadge';\r\nimport { ShieldsButton } from '../TopNav/ShieldsButton';\r\nimport { NetworkButton } from '../TopNav/NetworkButton';\r\n\r\ntype MenuId = 'browse' | 'ai' | 'tools' | 'security';\r\n\r\ntype MenuEntry =\r\n  | {\r\n      type: 'item';\r\n      key: string;\r\n      icon: LucideIcon;\r\n      label: string;\r\n      shortcut?: string;\r\n      disabled?: boolean;\r\n      onSelect: () => void | Promise<void>;\r\n    }\r\n  | {\r\n      type: 'divider';\r\n      key: string;\r\n    }\r\n  | {\r\n      type: 'section';\r\n      key: string;\r\n      label: string;\r\n      description?: string;\r\n    };\r\n\r\ninterface TopNavProps {\r\n  onAgentToggle: () => void;\r\n  onCommandPalette: () => void;\r\n  onClipperToggle: () => void;\r\n  onReaderToggle: () => void;\r\n}\r\n\r\nexport function TopNav({ onAgentToggle, onCommandPalette, onClipperToggle, onReaderToggle }: TopNavProps) {\r\n  const { activeId } = useTabsStore();\r\n  const mode = useAppStore((state) => state.mode);\r\n  const navigate = useNavigate();\r\n  const toggleTabGraph = useTabGraphStore((state) => state.toggle);\r\n  const openTabGraph = useTabGraphStore((state) => state.open);\r\n  const resetOnboarding = useOnboardingStore((state) => state.reset);\r\n  const openConsentDashboard = useConsentOverlayStore((state) => state.open);\r\n  const torStatus = usePrivacyStore((state) => state.tor);\r\n  const vpnStatus = usePrivacyStore((state) => state.vpn);\r\n  const startTor = usePrivacyStore((state) => state.startTor);\r\n  const stopTor = usePrivacyStore((state) => state.stopTor);\r\n  const newTorIdentity = usePrivacyStore((state) => state.newTorIdentity);\r\n  const checkVpn = usePrivacyStore((state) => state.checkVpn);\r\n  const [canGoBack, setCanGoBack] = useState(false);\r\n  const [canGoForward, setCanGoForward] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [downloadCount, setDownloadCount] = useState(0);\r\n  const [agentActive, setAgentActive] = useState(false);\r\n  const [activeMenu, setActiveMenu] = useState<MenuId | null>(null);\r\n  const [menuLoading, setMenuLoading] = useState<Record<MenuId, boolean>>({ browse: false, ai: false, tools: false, security: false });\r\n  const menuTimersRef = useRef<Record<MenuId, ReturnType<typeof setTimeout> | null>>({ browse: null, ai: null, tools: null, security: null });\r\n\r\n  const clearMenuTimer = useCallback((menu: MenuId) => {\r\n    const timer = menuTimersRef.current[menu];\r\n    if (timer) {\r\n      clearTimeout(timer);\r\n      menuTimersRef.current[menu] = null;\r\n    }\r\n  }, []);\r\n\r\n  const startMenuLoad = useCallback((menu: MenuId) => {\r\n    clearMenuTimer(menu);\r\n    setMenuLoading({ browse: false, ai: false, tools: false, security: false });\r\n    setMenuLoading((prev) => ({ ...prev, [menu]: true }));\r\n    menuTimersRef.current[menu] = setTimeout(() => {\r\n      setMenuLoading((prev) => ({ ...prev, [menu]: false }));\r\n      menuTimersRef.current[menu] = null;\r\n    }, 220);\r\n  }, [clearMenuTimer]);\r\n\r\n  const closeMenus = useCallback(() => {\r\n    setActiveMenu(null);\r\n    setMenuLoading({ browse: false, ai: false, tools: false, security: false });\r\n    (Object.keys(menuTimersRef.current) as MenuId[]).forEach((menu) => clearMenuTimer(menu));\r\n  }, [clearMenuTimer]);\r\n\r\n  const toggleMenu = useCallback(\r\n    (menu: MenuId) => {\r\n      setActiveMenu((current) => {\r\n        if (current === menu) {\r\n          clearMenuTimer(menu);\r\n          setMenuLoading({ browse: false, ai: false, tools: false, security: false });\r\n          return null;\r\n        }\r\n        startMenuLoad(menu);\r\n        return menu;\r\n      });\r\n    },\r\n    [clearMenuTimer, startMenuLoad]\r\n  );\r\n  const navigationStateRef = useRef({\r\n    activeId: activeId ?? null,\r\n    canGoBack: false,\r\n    canGoForward: false,\r\n  });\r\n  const refreshTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n\r\n  useEffect(() => {\r\n    navigationStateRef.current = {\r\n      activeId: activeId ?? null,\r\n      canGoBack,\r\n      canGoForward,\r\n    };\r\n  }, [activeId, canGoBack, canGoForward]);\r\n\r\n  useEffect(() => {\r\n    const handleGraphShortcut = (event: KeyboardEvent) => {\r\n      const isGraphShortcut =\r\n        (event.metaKey || event.ctrlKey) && event.shiftKey && event.key.toLowerCase() === 'g';\r\n      if (isGraphShortcut) {\r\n        event.preventDefault();\r\n        void toggleTabGraph();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleGraphShortcut);\r\n    return () => window.removeEventListener('keydown', handleGraphShortcut);\r\n  }, [toggleTabGraph]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (refreshTimerRef.current) {\r\n        clearTimeout(refreshTimerRef.current);\r\n        refreshTimerRef.current = null;\r\n      }\r\n      (Object.keys(menuTimersRef.current) as MenuId[]).forEach((menu) => clearMenuTimer(menu));\r\n    };\r\n  }, [clearMenuTimer]);\r\n\r\n  useEffect(() => {\r\n    if (!activeMenu) return;\r\n    const handleEscape = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        closeMenus();\r\n      }\r\n    };\r\n    const options: AddEventListenerOptions = { capture: true };\r\n    window.addEventListener('keydown', handleEscape, options);\r\n    return () => window.removeEventListener('keydown', handleEscape, options);\r\n  }, [activeMenu, closeMenus]);\r\n\r\n  // Listen for download updates\r\n  useIPCEvent<DownloadUpdate>('downloads:started', () => {\r\n    setDownloadCount(prev => prev + 1);\r\n  }, []);\r\n\r\n  useIPCEvent<DownloadUpdate>('downloads:done', () => {\r\n    setDownloadCount(prev => Math.max(0, prev - 1));\r\n  }, []);\r\n\r\n  useIPCEvent<DownloadUpdate>('downloads:progress', () => {\r\n    // Keep track of active downloads\r\n  }, []);\r\n\r\n  // Listen for agent activity\r\n  useIPCEvent('agent:plan', () => {\r\n    setAgentActive(true);\r\n  }, []);\r\n\r\n  // Load initial download count (wait for IPC)\r\n  useEffect(() => {\r\n    const loadDownloads = async () => {\r\n      // Wait for IPC to be ready\r\n      if (!window.ipc || typeof window.ipc.invoke !== 'function') {\r\n        // Retry after a delay\r\n        setTimeout(loadDownloads, 500);\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        const list = await ipc.downloads.list();\r\n        const active = Array.isArray(list) ? list.filter((d: any) => d.status === 'in-progress').length : 0;\r\n        setDownloadCount(active);\r\n      } catch {\r\n        // Silently handle - will retry if needed\r\n      }\r\n    };\r\n    \r\n    // Delay initial load to allow IPC to initialize\r\n    setTimeout(loadDownloads, 300);\r\n  }, []);\r\n\r\n  const handleBack = useCallback(async () => {\r\n    const { activeId: currentActiveId } = navigationStateRef.current;\r\n    if (!currentActiveId) return;\r\n    try {\r\n      await ipc.tabs.goBack(currentActiveId);\r\n      // Navigation state will be updated via IPC event\r\n    } catch (error) {\r\n      console.error('Failed to go back:', error);\r\n    }\r\n  }, []);\r\n\r\n  const handleForward = useCallback(async () => {\r\n    const { activeId: currentActiveId } = navigationStateRef.current;\r\n    if (!currentActiveId) return;\r\n    try {\r\n      await ipc.tabs.goForward(currentActiveId);\r\n      // Navigation state will be updated via IPC event\r\n    } catch (error) {\r\n      console.error('Failed to go forward:', error);\r\n    }\r\n  }, []);\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    const { activeId: currentActiveId } = navigationStateRef.current;\r\n    if (!currentActiveId) return;\r\n    if (refreshTimerRef.current) {\r\n      clearTimeout(refreshTimerRef.current);\r\n      refreshTimerRef.current = null;\r\n    }\r\n    setIsLoading(true);\r\n    try {\r\n      await ipc.tabs.reload(currentActiveId);\r\n      // Reset loading state after a delay\r\n      if (refreshTimerRef.current) {\r\n        clearTimeout(refreshTimerRef.current);\r\n      }\r\n      refreshTimerRef.current = setTimeout(() => {\r\n        setIsLoading(false);\r\n        refreshTimerRef.current = null;\r\n      }, 1000);\r\n    } catch (error) {\r\n      console.error('Failed to refresh:', error);\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Keyboard shortcuts for navigation and zoom\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const { activeId: currentActiveId, canGoBack: currentCanGoBack, canGoForward: currentCanGoForward } = navigationStateRef.current;\r\n      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\r\n      const modifier = isMac ? e.metaKey : e.ctrlKey;\r\n      const altModifier = e.altKey;\r\n\r\n      // Don't intercept if user is typing in an input field\r\n      const target = e.target as HTMLElement;\r\n      if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\r\n        return;\r\n      }\r\n\r\n      if ((modifier || altModifier) && e.key === 'ArrowLeft' && !e.shiftKey) {\r\n        if (currentCanGoBack && currentActiveId) {\r\n          e.preventDefault();\r\n          void handleBack();\r\n        }\r\n        return;\r\n      }\r\n\r\n      if ((modifier || altModifier) && e.key === 'ArrowRight' && !e.shiftKey) {\r\n        if (currentCanGoForward && currentActiveId) {\r\n          e.preventDefault();\r\n          void handleForward();\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (modifier && e.key.toLowerCase() === 'r' && !e.shiftKey) {\r\n        if (currentActiveId) {\r\n          e.preventDefault();\r\n          void handleRefresh();\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F5' && currentActiveId) {\r\n        e.preventDefault();\r\n        void handleRefresh();\r\n      }\r\n\r\n      // Zoom shortcuts\r\n      if (modifier && (e.key === '+' || e.key === '=') && currentActiveId) {\r\n        e.preventDefault();\r\n        ipc.tabs.zoomIn(currentActiveId).catch(console.error);\r\n        return;\r\n      }\r\n\r\n      if (modifier && e.key === '-' && currentActiveId) {\r\n        e.preventDefault();\r\n        ipc.tabs.zoomOut(currentActiveId).catch(console.error);\r\n        return;\r\n      }\r\n\r\n      if (modifier && e.key === '0' && currentActiveId) {\r\n        e.preventDefault();\r\n        ipc.tabs.zoomReset(currentActiveId).catch(console.error);\r\n        return;\r\n      }\r\n\r\n      // DevTools shortcuts: F12 or Cmd+Shift+I / Ctrl+Shift+I\r\n      if (e.key === 'F12' || (modifier && e.shiftKey && e.key.toLowerCase() === 'i')) {\r\n        if (currentActiveId) {\r\n          e.preventDefault();\r\n          ipc.tabs.devtools(currentActiveId).catch(console.error);\r\n        }\r\n        return;\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [handleBack, handleForward, handleRefresh]);\r\n\r\n  // Listen for navigation state updates from backend\r\n  useIPCEvent<{ tabId: string; canGoBack: boolean; canGoForward: boolean }>(\r\n    'tabs:navigation-state',\r\n    (state) => {\r\n      if (state.tabId === activeId) {\r\n        setCanGoBack(state.canGoBack);\r\n        setCanGoForward(state.canGoForward);\r\n      }\r\n    },\r\n    [activeId]\r\n  );\r\n\r\n  // Update navigation state when active tab changes\r\n  useEffect(() => {\r\n    if (!activeId) {\r\n      setCanGoBack(false);\r\n      setCanGoForward(false);\r\n      return;\r\n    }\r\n    \r\n    // Request navigation state from the backend\r\n    const updateNavigationState = async () => {\r\n      try {\r\n        // The navigation state will be updated via IPC events\r\n        // But we can also try to get it directly if needed\r\n        await ipc.tabs.list();\r\n        // Navigation state is managed by backend and sent via events\r\n      } catch (error) {\r\n        console.error('Failed to update navigation state:', error);\r\n      }\r\n    };\r\n    \r\n    updateNavigationState();\r\n  }, [activeId]);\r\n\r\n  const handleScreenshot = async () => {\r\n    if (!activeId) return;\r\n    try {\r\n      const result = await ipc.tabs.screenshot(activeId);\r\n      if (result?.success) {\r\n        // Screenshot saved, folder opened\r\n        console.log('Screenshot saved:', result.path);\r\n      } else {\r\n        console.error('Screenshot failed:', result?.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to capture screenshot:', error);\r\n    }\r\n  };\r\n\r\n  const handlePIP = async () => {\r\n    if (!activeId) return;\r\n    try {\r\n      const result = await ipc.tabs.pip(activeId, true);\r\n      if (!result?.success) {\r\n        console.warn('PIP request failed:', result?.error || 'No video element found');\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to enter PIP:', error);\r\n    }\r\n  };\r\n\r\n  const handleFindInPage = useCallback(async () => {\r\n    if (!activeId) return;\r\n    try {\r\n      await ipc.tabs.find(activeId);\r\n    } catch (error) {\r\n      console.error('Failed to open find:', error);\r\n    }\r\n  }, [activeId]);\r\n\r\n  const handleToggleDevtools = useCallback(async () => {\r\n    if (!activeId) return;\r\n    try {\r\n      await ipc.tabs.devtools(activeId);\r\n    } catch (error) {\r\n      console.error('Failed to toggle DevTools:', error);\r\n    }\r\n  }, [activeId]);\r\n\r\n  const handleMenuSelect = useCallback(\r\n    (entry: MenuEntry) => {\r\n      if (entry.type !== 'item' || entry.disabled) return;\r\n      const result = entry.onSelect();\r\n      if (result && typeof (result as Promise<void>).then === 'function') {\r\n        (result as Promise<void>)\r\n          .catch((error) => {\r\n            console.error(`Failed to run menu action \"${entry.key}\"`, error);\r\n          })\r\n          .finally(() => closeMenus());\r\n      } else {\r\n        closeMenus();\r\n      }\r\n    },\r\n    [closeMenus]\r\n  );\r\n\r\n  const isMac = typeof navigator !== 'undefined' && navigator.platform?.toUpperCase().includes('MAC');\r\n\r\n  const browseMenuEntries = useMemo<MenuEntry[]>(() => {\r\n    const base: Record<string, MenuEntry & { type: 'item' }> = {\r\n      'knowledge-graph': {\r\n        type: 'item',\r\n        key: 'knowledge-graph',\r\n        icon: Layers,\r\n        label: 'Research Graph',\r\n        onSelect: () => navigate('/'),\r\n      },\r\n      'history-graph': {\r\n        type: 'item',\r\n        key: 'history-graph',\r\n        icon: History,\r\n        label: 'History Graph',\r\n        onSelect: () => navigate('/history'),\r\n      },\r\n      workspaces: {\r\n        type: 'item',\r\n        key: 'workspaces',\r\n        icon: FileText,\r\n        label: 'Workspace Library',\r\n        onSelect: () => navigate('/workspace'),\r\n      },\r\n      playbooks: {\r\n        type: 'item',\r\n        key: 'playbooks',\r\n        icon: Workflow,\r\n        label: 'Auto-Research Playbooks',\r\n        onSelect: () => navigate('/playbooks'),\r\n      },\r\n      'automation-runs': {\r\n        type: 'item',\r\n        key: 'automation-runs',\r\n        icon: Play,\r\n        label: 'Automation Runs',\r\n        onSelect: () => navigate('/runs'),\r\n      },\r\n      consent: {\r\n        type: 'item',\r\n        key: 'consent-ledger',\r\n        icon: Shield,\r\n        label: 'Consent Ledger',\r\n        onSelect: () => void openConsentDashboard(),\r\n      },\r\n      'tab-graph': {\r\n        type: 'item',\r\n        key: 'tab-graph',\r\n        icon: Layers,\r\n        label: 'Tab DNA Overlay',\r\n        onSelect: () => void openTabGraph(),\r\n      },\r\n    };\r\n\r\n    const focusMap: Record<string, { label: string; description: string; keys: string[] }> = {\r\n      Research: {\r\n        label: 'Research Focus',\r\n        description: 'Suggested graph + consent tooling',\r\n        keys: ['knowledge-graph', 'tab-graph', 'consent'],\r\n      },\r\n      Trade: {\r\n        label: 'Trade Focus',\r\n        description: 'Stay ahead of market changes',\r\n        keys: ['history-graph', 'playbooks', 'automation-runs'],\r\n      },\r\n      Games: {\r\n        label: 'Gaming Focus',\r\n        description: 'Keep streams and overlays lean',\r\n        keys: ['tab-graph', 'history-graph'],\r\n      },\r\n      Browse: {\r\n        label: 'Everyday Focus',\r\n        description: 'Quick jump to your spaces',\r\n        keys: ['workspaces', 'history-graph', 'knowledge-graph'],\r\n      },\r\n    };\r\n\r\n    const persona = focusMap[mode] ?? focusMap.Browse;\r\n    const used = new Set<string>();\r\n    const entries: MenuEntry[] = [];\r\n\r\n    entries.push({\r\n      type: 'section',\r\n      key: 'persona-section',\r\n      label: persona.label,\r\n      description: persona.description,\r\n    });\r\n\r\n    persona.keys.forEach((key) => {\r\n      const entry = base[key];\r\n      if (entry && !used.has(key)) {\r\n        entries.push(entry);\r\n        used.add(key);\r\n      }\r\n    });\r\n\r\n    entries.push({ type: 'divider', key: 'persona-divider' });\r\n    entries.push({ type: 'section', key: 'all-tools', label: 'All workspace tools' });\r\n\r\n    Object.entries(base).forEach(([key, entry]) => {\r\n      if (!used.has(key)) {\r\n        entries.push(entry);\r\n        used.add(key);\r\n      }\r\n    });\r\n\r\n    return entries;\r\n  }, [mode, navigate, openConsentDashboard, openTabGraph]);\r\n\r\n  const toolsMenuEntries: MenuEntry[] = [\r\n    {\r\n      type: 'item',\r\n      key: 'find',\r\n      icon: Search,\r\n      label: 'Find in Page',\r\n      shortcut: isMac ? '⌘ F' : 'Ctrl F',\r\n      disabled: !activeId,\r\n      onSelect: handleFindInPage,\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'screenshot',\r\n      icon: Camera,\r\n      label: 'Capture Screenshot',\r\n      disabled: !activeId,\r\n      onSelect: handleScreenshot,\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'pip',\r\n      icon: PictureInPicture,\r\n      label: 'Picture-in-Picture',\r\n      disabled: !activeId,\r\n      onSelect: handlePIP,\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'devtools',\r\n      icon: Code,\r\n      label: 'Toggle DevTools',\r\n      shortcut: isMac ? '⌘ ⇧ I' : 'Ctrl ⇧ I',\r\n      disabled: !activeId,\r\n      onSelect: handleToggleDevtools,\r\n    },\r\n    { type: 'divider', key: 'tools-divider' },\r\n    {\r\n      type: 'item',\r\n      key: 'guided-tour',\r\n      icon: Sparkles,\r\n      label: 'Run Guided Tour',\r\n      onSelect: () => {\r\n        resetOnboarding();\r\n      },\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'watchers',\r\n      icon: Activity,\r\n      label: 'Page Watchers',\r\n      onSelect: () => {\r\n        navigate('/watchers');\r\n      },\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'history',\r\n      icon: History,\r\n      label: 'History',\r\n      onSelect: () => {\r\n        navigate('/history');\r\n      },\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'tab-graph',\r\n      icon: Network,\r\n      label: 'Tab Graph Overlay',\r\n      shortcut: isMac ? '⌘⇧G' : 'Ctrl⇧G',\r\n      onSelect: () => {\r\n        void openTabGraph();\r\n      },\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'consent-dashboard',\r\n      icon: Shield,\r\n      label: 'Consent Playground',\r\n      onSelect: () => {\r\n        void openConsentDashboard();\r\n      },\r\n    },\r\n  ];\r\n\r\n  const aiMenuEntries: MenuEntry[] = [\r\n    {\r\n      type: 'item',\r\n      key: 'agent-console',\r\n      icon: Bot,\r\n      label: 'Open Agent Console',\r\n      shortcut: isMac ? '⌘⇧A' : 'Ctrl+Shift+A',\r\n      onSelect: () => onAgentToggle(),\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'ask-agent',\r\n      icon: Sparkles,\r\n      label: 'Ask Agent',\r\n      shortcut: isMac ? '⌘K' : 'Ctrl+K',\r\n      onSelect: () => onCommandPalette(),\r\n    },\r\n    { type: 'divider', key: 'agent-divider' },\r\n    {\r\n      type: 'item',\r\n      key: 'clip-highlight',\r\n      icon: Highlighter,\r\n      label: 'Clip Highlight',\r\n      shortcut: isMac ? '⌘⇧H' : 'Ctrl+Shift+H',\r\n      onSelect: () => onClipperToggle(),\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'reader-mode',\r\n      icon: FileText,\r\n      label: 'Reader Mode',\r\n      shortcut: isMac ? '⌘⇧R' : 'Ctrl+Shift+R',\r\n      onSelect: () => onReaderToggle(),\r\n    },\r\n  ];\r\n\r\n  const securityMenuEntries: MenuEntry[] = [\r\n    {\r\n      type: 'item',\r\n      key: 'privacy-shields',\r\n      icon: Shield,\r\n      label: 'Privacy Shields',\r\n      onSelect: () => {\r\n        const target = document.querySelector('[data-shields-button]') as HTMLElement | null;\r\n        target?.click();\r\n      },\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'network-controls',\r\n      icon: Wifi,\r\n      label: 'Network Controls',\r\n      onSelect: () => {\r\n        const target = document.querySelector('[data-network-button]') as HTMLElement | null;\r\n        target?.click();\r\n      },\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'tor-toggle',\r\n      icon: Shield,\r\n      label: torStatus.running ? 'Disable Tor' : 'Enable Tor',\r\n      onSelect: () => {\r\n        if (torStatus.running) {\r\n          void stopTor();\r\n        } else {\r\n          void startTor();\r\n        }\r\n      },\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'tor-new-identity',\r\n      icon: RefreshCw,\r\n      label: 'Tor: New Identity',\r\n      disabled: !torStatus.running || Boolean(torStatus.stub),\r\n      onSelect: () => {\r\n        if (torStatus.running && !torStatus.stub) {\r\n          void newTorIdentity();\r\n        }\r\n      },\r\n    },\r\n    {\r\n      type: 'item',\r\n      key: 'vpn-status',\r\n      icon: Wifi,\r\n      label: vpnStatus.connected\r\n        ? `VPN: ${vpnStatus.type ? vpnStatus.type.toUpperCase() : 'Active'}`\r\n        : 'Check VPN Status',\r\n      onSelect: () => {\r\n        void checkVpn();\r\n      },\r\n    },\r\n    { type: 'divider', key: 'security-divider' },\r\n    {\r\n      type: 'item',\r\n      key: 'history-graph',\r\n      icon: History,\r\n      label: 'History Graph',\r\n      onSelect: () => navigate('/history'),\r\n    },\r\n  ];\r\n\r\n  const renderMenuButton = (menuId: MenuId, label: string, entries: MenuEntry[]) => {\r\n    const isOpen = activeMenu === menuId;\r\n    return (\r\n      <div key={menuId} className=\"relative\">\r\n        <motion.button\r\n          type=\"button\"\r\n          onClick={() => toggleMenu(menuId)}\r\n          aria-expanded={isOpen}\r\n          aria-haspopup=\"true\"\r\n          whileHover={{ scale: 1.05 }}\r\n          whileTap={{ scale: 0.95 }}\r\n          className={`button-surface flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm ${\r\n            isOpen ? 'button-surface--active text-primary' : 'text-muted'\r\n          }`}\r\n          title={`${label} menu`}\r\n        >\r\n          <span>{label}</span>\r\n          <ChevronDown size={14} className={`transition-transform ${isOpen ? 'rotate-180' : ''}`} />\r\n        </motion.button>\r\n\r\n        <AnimatePresence>\r\n          {isOpen && (\r\n            <>\r\n              <motion.button\r\n                key={`${menuId}-backdrop`}\r\n                type=\"button\"\r\n                aria-label={`Close ${label} menu`}\r\n                className=\"fixed inset-0 z-40 bg-transparent pointer-events-auto focus:outline-none\"\r\n                onClick={closeMenus}\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n              />\r\n              <motion.div\r\n                key={`${menuId}-menu`}\r\n                initial={{ opacity: 0, y: -8 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -8 }}\r\n                transition={{ duration: 0.15 }}\r\n                className=\"absolute right-0 top-full mt-2 w-60 bg-surface-elevated border border-surface rounded-lg shadow-2xl z-50 py-2\"\r\n              >\r\n                {menuLoading[menuId] ? (\r\n                  <div className=\"space-y-2 px-3 py-2\">\r\n                    {Array.from({ length: 4 }).map((_, index) => (\r\n                      <div\r\n                        key={`skeleton-${menuId}-${index}`}\r\n                        className=\"h-8 rounded-md bg-slate-800/70 animate-pulse\"\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  entries.map((entry) => {\r\n                    if (entry.type === 'divider') {\r\n                      return <div key={entry.key} className=\"h-px my-1 bg-[var(--surface-border)]/60\" />;\r\n                    }\r\n                    if (entry.type === 'section') {\r\n                      return (\r\n                        <div\r\n                          key={entry.key}\r\n                          className=\"px-4 pt-1 pb-2 text-[10px] uppercase tracking-[0.24em] text-muted\"\r\n                        >\r\n                          <div>{entry.label}</div>\r\n                          {entry.description && (\r\n                            <div className=\"mt-1 text-[10px] normal-case tracking-normal text-muted/80\">\r\n                              {entry.description}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      );\r\n                    }\r\n                    return (\r\n                      <button\r\n                        key={entry.key}\r\n                        type=\"button\"\r\n                        disabled={entry.disabled}\r\n                        onClick={() => handleMenuSelect(entry)}\r\n                        className=\"menu-item w-full\"\r\n                      >\r\n                        <entry.icon size={16} className=\"text-muted\" />\r\n                        <span className=\"flex-1 text-left\">{entry.label}</span>\r\n                        {entry.shortcut && (\r\n                          <kbd className=\"text-xs text-muted border border-surface rounded px-1.5 py-0.5\">\r\n                            {entry.shortcut}\r\n                          </kbd>\r\n                        )}\r\n                      </button>\r\n                    );\r\n                  })\r\n                )}\r\n              </motion.div>\r\n            </>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"drag h-14 flex items-center px-4 gap-4 bg-surface-panel border-b border-surface shadow-lg text-primary transition-colors\">\r\n      {/* Left: Mode & Session controls */}\r\n      <div className=\"no-drag flex items-center gap-2\">\r\n        <ModeSwitch />\r\n        <SessionSwitcher />\r\n        <div className=\"hidden xl:flex items-center gap-2\">\r\n          <ProfileQuickSwitcher />\r\n          <ContainerSwitcher />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Browser Navigation Controls */}\r\n      <div className=\"no-drag flex items-center gap-1.5 flex-shrink-0\">\r\n        {/* Home Button */}\r\n        <motion.button\r\n          onClick={() => navigate('/')}\r\n          aria-label=\"Go to home\"\r\n          whileHover={{ scale: 1.05 }}\r\n          whileTap={{ scale: 0.95 }}\r\n          className=\"no-drag p-2.5 rounded-lg button-surface hover:text-primary\"\r\n          title=\"Home (Go to home screen)\"\r\n        >\r\n          <Home size={18} />\r\n        </motion.button>\r\n        \r\n        <motion.button\r\n          onClick={handleBack}\r\n          disabled={!canGoBack || !activeId}\r\n          aria-label=\"Go back\"\r\n          aria-disabled={!canGoBack || !activeId}\r\n          whileHover={{ scale: canGoBack && activeId ? 1.05 : 1 }}\r\n          whileTap={{ scale: canGoBack && activeId ? 0.95 : 1 }}\r\n          className={`no-drag p-2.5 rounded-lg button-surface ${\r\n            canGoBack && activeId ? 'hover:text-primary' : 'opacity-40 cursor-not-allowed'\r\n          }`}\r\n          title=\"Back (Alt+← / ⌘←)\"\r\n        >\r\n          <ArrowLeft size={18} />\r\n        </motion.button>\r\n        <motion.button\r\n          onClick={handleForward}\r\n          disabled={!canGoForward || !activeId}\r\n          aria-label=\"Go forward\"\r\n          aria-disabled={!canGoForward || !activeId}\r\n          whileHover={{ scale: canGoForward && activeId ? 1.05 : 1 }}\r\n          whileTap={{ scale: canGoForward && activeId ? 0.95 : 1 }}\r\n          className={`no-drag p-2.5 rounded-lg button-surface ${\r\n            canGoForward && activeId ? 'hover:text-primary' : 'opacity-40 cursor-not-allowed'\r\n          }`}\r\n          title=\"Forward (Alt+→ / ⌘→)\"\r\n        >\r\n          <ArrowRight size={18} />\r\n        </motion.button>\r\n        <motion.button\r\n          onClick={handleRefresh}\r\n          disabled={!activeId}\r\n          aria-label=\"Refresh page\"\r\n          aria-disabled={!activeId}\r\n          whileHover={{ scale: activeId ? 1.05 : 1 }}\r\n          whileTap={{ scale: activeId ? 0.95 : 1 }}\r\n          className={`no-drag p-2.5 rounded-lg button-surface ${\r\n            activeId ? 'hover:text-primary' : 'opacity-40 cursor-not-allowed'\r\n          }`}\r\n          title=\"Refresh (Ctrl+R / ⌘R)\"\r\n        >\r\n          <motion.div\r\n            animate={{ rotate: isLoading ? 360 : 0 }}\r\n            transition={{ duration: 1, repeat: isLoading ? Infinity : 0, ease: \"linear\" }}\r\n            className=\"flex items-center justify-center\"\r\n          >\r\n            <RefreshCw size={18} />\r\n          </motion.div>\r\n        </motion.button>\r\n      </div>\r\n\r\n      {/* Center: Omnibox with Progress Bar */}\r\n      <div className=\"no-drag flex-1 relative mx-4\" data-onboarding=\"omnibox\">\r\n        <Omnibox onCommandPalette={onCommandPalette} />\r\n        <ProgressBar />\r\n      </div>\r\n\r\n      {/* Right: Actions & Badges */}\r\n      <div className=\"no-drag flex items-center gap-1.5\">\r\n        {renderMenuButton('ai', 'AI', aiMenuEntries)}\r\n        {renderMenuButton('browse', 'Browse', browseMenuEntries)}\r\n        {renderMenuButton('tools', 'Tools', toolsMenuEntries)}\r\n        {renderMenuButton('security', 'Security', securityMenuEntries)}\r\n        <PrivacySentinelBadge />\r\n        <ThemeSwitcher />\r\n        <div className=\"hidden 2xl:flex items-center gap-1.5\">\r\n          <ShieldsButton />\r\n          <NetworkButton />\r\n        </div>\r\n        <motion.button\r\n          onClick={() => {\r\n            navigate('/downloads');\r\n          }}\r\n          aria-label={`Downloads${downloadCount > 0 ? ` (${downloadCount} active)` : ''}`}\r\n          whileHover={{ scale: 1.05 }}\r\n          whileTap={{ scale: 0.95 }}\r\n          className=\"no-drag relative p-2 rounded-lg button-surface hover:text-primary\"\r\n          title={`Downloads${downloadCount > 0 ? ` (${downloadCount} active)` : ''}`}\r\n        >\r\n          <Download size={18} />\r\n          {downloadCount > 0 && (\r\n            <motion.span\r\n              initial={{ scale: 0 }}\r\n              animate={{ scale: 1 }}\r\n              className=\"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-bold\"\r\n              aria-label={`${downloadCount} active download${downloadCount > 1 ? 's' : ''}`}\r\n            >\r\n              {downloadCount > 9 ? '9+' : downloadCount}\r\n            </motion.span>\r\n          )}\r\n        </motion.button>\r\n        <motion.button\r\n          onClick={() => navigate('/settings')}\r\n          aria-label=\"Open settings\"\r\n          whileHover={{ scale: 1.05 }}\r\n          whileTap={{ scale: 0.95 }}\r\n          className=\"no-drag p-2 rounded-lg button-surface hover:text-primary\"\r\n          title=\"Settings\"\r\n        >\r\n          <Settings size={18} />\r\n        </motion.button>\r\n        <motion.button\r\n          onClick={onAgentToggle}\r\n          aria-label={`Agent console${agentActive ? ' (active)' : ''}`}\r\n          whileHover={{ scale: 1.05 }}\r\n          whileTap={{ scale: 0.95 }}\r\n          className={`no-drag p-2 rounded-lg button-surface ${\r\n            agentActive ? 'button-surface--active shadow-[0_0_18px_rgba(59,130,246,0.35)] text-primary' : 'hover:text-primary'\r\n          }`}\r\n          title=\"Agent Console (⌘⇧A)\"\r\n        >\r\n          <Bot size={18} />\r\n          {agentActive && (\r\n            <motion.span\r\n              className=\"absolute -top-1 -right-1 w-2.5 h-2.5 bg-green-400 rounded-full border-2 border-gray-900\"\r\n              animate={{ scale: [1, 1.2, 1], opacity: [1, 0.8, 1] }}\r\n              transition={{ duration: 2, repeat: Infinity }}\r\n              aria-label=\"Agent is active\"\r\n            />\r\n          )}\r\n        </motion.button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":["ArrowLeft","createLucideIcon","Briefcase","Calculator","ChevronDown","CircleAlert","CircleUser","Code","History","House","Layers","Moon","Pen","PictureInPicture","Scissors","User","DeprecatedLayoutGroupContext","createContext","useIsMounted","isMounted","useRef","useIsomorphicLayoutEffect","useForceUpdate","forcedRenderCount","setForcedRenderCount","useState","forceRender","useCallback","frame","notify","node","nodeGroup","nodes","subscriptions","dirtyAll","unsubscribe","shouldInheritGroup","inherit","shouldInheritId","LayoutGroup","children","id","layoutGroupContext","useContext","LayoutGroupContext","deprecatedLayoutGroupContext","key","context","upstreamId","memoizedContext","useMemo","jsx","modes","Brain","TrendingUp","Gamepad2","Zap","ModeSwitch","mode","setMode","useAppStore","navigate","useNavigate","handleModeChange","newMode","currentMode","m","Icon","isActive","jsxs","motion","SEARCH_ENDPOINTS","buildSearchUrl","engine","query","formatCalcResult","expr","result","formatted","evaluateExpression","raw","value","resolveQuickAction","input","trimmed","lower","buildSuggestionFromAction","action","rawInput","RECENTS_STORAGE_KEY","MAX_RECENTS","Omnibox","onCommandPalette","tabs","activeId","useTabsStore","activeContainerId","useContainerStore","state","isElectron","isElectronRuntime","formatTabsForEvent","list","t","url","setUrl","focused","setFocused","suggestions","setSuggestions","selectedIndex","setSelectedIndex","siteInfo","setSiteInfo","progress","setProgress","isLoading","setIsLoading","recentItems","setRecentItems","inputRef","liveResults","setLiveResults","liveStatus","setLiveStatus","liveSessionRef","liveUnsubscribeRef","attachIpcListener","channel","handler","bridge","detachIpcListener","activeTab","useEffect","parsed","item","error","rememberRecent","title","finalUrl","prev","filtered","next","stopLiveSession","handleLiveStep","step","existingIndex","updated","current","startLiveSearch","session","ipc","_event","useIPCEvent","tabList","tab","urlObj","data","searchSuggestions","debounce","normalized","queryLower","results","offline","pushSuggestion","suggestion","front","quickAction","quickSuggestion","defaultPrompts","prompt","index","tabUrl","history","debouncedLiveSearch","searchTerm","base","handleKeyDown","e","modifier","navigateToUrl","targetUrl","options","background","newWindow","titleOverride","openInBackground","normalizedTitle","baseTabs","nextTabs","nextActiveId","newId","ipcEvents","resolve","newTab","createError","executeAction","fallbackInput","engineLabel","resultValue","handleSuggestionActivate","topResult","Lock","AlertCircle","Globe","Shield","Search","AnimatePresence","event","Sparkles","Clock","ProgressBar","interval","SessionSwitcher","IS_DEV","isDevEnv","sessions","setSessions","activeSession","setActiveSession","open","setOpen","creating","setCreating","newSessionName","setNewSessionName","editingId","setEditingId","editName","setEditName","snapshotSummary","setSnapshotSummary","summaryLoading","setSummaryLoading","restoring","setRestoring","restoreFeedback","setRestoreFeedback","previousSessionsRef","loadSessions","allSessions","active","sessionsArray","sessionsKey","s","activeSessionObj","currentActiveId","previousActiveId","timeoutId","cancelled","res","handleCreateSession","handleSwitchSession","sessionId","handleDeleteSession","handleStartEdit","handleSaveEdit","handleRestoreLastSession","restoredCount","isDefaultSession","showLabel","buttonSpacing","Plus","isEditing","Check","Edit2","X","Loader2","formatDistanceToNow","RotateCcw","POLICY_CONFIG","Download","EyeOff","Ghost","Camera","PROFILE_ICON","UserCircle","getProfileIcon","profile","summarizePolicy","policy","restricted","r","sortProfiles","profiles","a","b","systemA","systemB","kindRank","kind","rankDelta","profileAccent","ProfileQuickSwitcher","activeProfileId","policies","loading","setActiveProfile","lastPolicyBlock","markPolicyMessageRead","useProfileStore","newName","setNewName","pendingProfileId","setPendingProfileId","ensureProfilesLoaded","activeProfile","sortedProfiles","handleSelect","profileId","handleCreate","name","isDefaultProfile","v","label","PolicyIcon","allowed","p","PERMISSION_OPTIONS","ContainerSwitcher","containers","setContainers","setActiveContainer","setName","color","setColor","permissionState","setPermissionState","sitePermissionState","setSitePermissionState","fetchPermissions","containerId","response","refreshPermissionState","permissions","refreshSitePermissions","entries","loadContainers","typedList","permissionEntries","container","map","unsubscribeSite","payload","entry","activeContainer","c","activePermissions","sitePermissionEntries","originsForPermission","permission","handleTogglePermission","permissionKey","enabled","handleRemoveOrigin","origin","isDefaultContainer","Boxes","option","STORAGE_KEY","isBrowser","getSystemTheme","applyTheme","preference","resolved","initialPreference","stored","initialResolved","useThemeStore","create","set","get","order","mediaQuery","handleChange","OPTIONS","Monitor","Sun","ThemeSwitcher","setPreference","cyclePreference","POLL_INTERVAL","gradeToColor","grade","gradeToLabel","PrivacySentinelBadge","activeTabId","audit","setAudit","setLoading","runAudit","timer","tooltip","lines","gradeClass","ShieldsButton","counters","setCounters","config","setConfig","totalBlocked","setTotalBlocked","updateConfig","newConfig","Fragment","NetworkButton","status","setStatus","loadStatus","handleNewTorIdentity","hasActiveConnection","Network","CheckCircle","XCircle","RefreshCw","TopNav","onAgentToggle","onClipperToggle","onReaderToggle","toggleTabGraph","useTabGraphStore","openTabGraph","resetOnboarding","useOnboardingStore","openConsentDashboard","useConsentOverlayStore","torStatus","usePrivacyStore","vpnStatus","startTor","stopTor","newTorIdentity","checkVpn","canGoBack","setCanGoBack","canGoForward","setCanGoForward","downloadCount","setDownloadCount","agentActive","setAgentActive","activeMenu","setActiveMenu","menuLoading","setMenuLoading","menuTimersRef","clearMenuTimer","menu","startMenuLoad","closeMenus","toggleMenu","navigationStateRef","refreshTimerRef","handleGraphShortcut","handleEscape","loadDownloads","d","handleBack","handleForward","handleRefresh","currentCanGoBack","currentCanGoForward","altModifier","target","handleScreenshot","handlePIP","handleFindInPage","handleToggleDevtools","handleMenuSelect","isMac","browseMenuEntries","FileText","Workflow","Play","focusMap","persona","used","toolsMenuEntries","Activity","aiMenuEntries","Bot","Highlighter","securityMenuEntries","Wifi","renderMenuButton","menuId","isOpen","_","Home","ArrowRight","Settings"],"mappings":"85DASA,MAAMA,GAAYC,EAAiB,YAAa,CAC9C,CAAC,OAAQ,CAAE,EAAG,iBAAkB,IAAK,QAAQ,CAAE,EAC/C,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,CAC3C,CAAC,ECHD,MAAMC,GAAYD,EAAiB,YAAa,CAC9C,CAAC,OAAQ,CAAE,EAAG,6CAA8C,IAAK,OAAO,CAAE,EAC1E,CAAC,OAAQ,CAAE,MAAO,KAAM,OAAQ,KAAM,EAAG,IAAK,EAAG,IAAK,GAAI,IAAK,IAAK,QAAQ,CAAE,CAChF,CAAC,ECHD,MAAME,GAAaF,EAAiB,aAAc,CAChD,CAAC,OAAQ,CAAE,MAAO,KAAM,OAAQ,KAAM,EAAG,IAAK,EAAG,IAAK,GAAI,IAAK,IAAK,QAAQ,CAAE,EAC9E,CAAC,OAAQ,CAAE,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,IAAK,QAAQ,CAAE,EAC/D,CAAC,OAAQ,CAAE,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,IAAK,QAAQ,CAAE,EAClE,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,EAC3C,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,EAC3C,CAAC,OAAQ,CAAE,EAAG,YAAa,IAAK,QAAQ,CAAE,EAC1C,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,EAC3C,CAAC,OAAQ,CAAE,EAAG,YAAa,IAAK,QAAQ,CAAE,EAC1C,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,EAC3C,CAAC,OAAQ,CAAE,EAAG,YAAa,IAAK,QAAQ,CAAE,CAC5C,CAAC,ECXD,MAAMG,GAAcH,EAAiB,cAAe,CAClD,CAAC,OAAQ,CAAE,EAAG,eAAgB,IAAK,QAAQ,CAAE,CAC/C,CAAC,ECFD,MAAMI,GAAcJ,EAAiB,cAAe,CAClD,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,IAAK,SAAU,EACzD,CAAC,OAAQ,CAAE,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,IAAK,QAAQ,CAAE,EACjE,CAAC,OAAQ,CAAE,GAAI,KAAM,GAAI,QAAS,GAAI,KAAM,GAAI,KAAM,IAAK,QAAQ,CAAE,CACvE,CAAC,ECJD,MAAMK,GAAaL,EAAiB,aAAc,CAChD,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,IAAK,SAAU,EACzD,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,IAAK,IAAK,SAAU,EACxD,CAAC,OAAQ,CAAE,EAAG,mDAAoD,IAAK,QAAQ,CAAE,CACnF,CAAC,ECJD,MAAMM,GAAON,EAAiB,OAAQ,CACpC,CAAC,WAAY,CAAE,OAAQ,mBAAoB,IAAK,QAAQ,CAAE,EAC1D,CAAC,WAAY,CAAE,OAAQ,gBAAiB,IAAK,QAAQ,CAAE,CACzD,CAAC,ECHD,MAAMO,GAAUP,EAAiB,UAAW,CAC1C,CAAC,OAAQ,CAAE,EAAG,oDAAqD,IAAK,QAAQ,CAAE,EAClF,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,cAAe,IAAK,QAAQ,CAAE,CAC9C,CAAC,ECJD,MAAMQ,GAAQR,EAAiB,QAAS,CACtC,CAAC,OAAQ,CAAE,EAAG,6CAA8C,IAAK,QAAQ,CAAE,EAC3E,CACE,OACA,CACE,EAAG,gHACH,IAAK,QACX,CACA,CACA,CAAC,ECTD,MAAMS,GAAST,EAAiB,SAAU,CACxC,CACE,OACA,CACE,EAAG,+GACH,IAAK,QACX,CACA,EACE,CAAC,OAAQ,CAAE,EAAG,+CAAgD,IAAK,QAAQ,CAAE,EAC7E,CAAC,OAAQ,CAAE,EAAG,+CAAgD,IAAK,QAAQ,CAAE,CAC/E,CAAC,ECVD,MAAMU,GAAOV,EAAiB,OAAQ,CACpC,CAAC,OAAQ,CAAE,EAAG,qCAAsC,IAAK,QAAQ,CAAE,CACrE,CAAC,ECFD,MAAMW,GAAMX,EAAiB,MAAO,CAClC,CACE,OACA,CACE,EAAG,mIACH,IAAK,QACX,CACA,CACA,CAAC,ECRD,MAAMY,GAAmBZ,EAAiB,mBAAoB,CAC5D,CACE,OACA,CACE,EAAG,2EACH,IAAK,QACX,CACA,EACE,CAAC,OAAQ,CAAE,MAAO,KAAM,OAAQ,IAAK,EAAG,KAAM,EAAG,OAAQ,GAAI,IAAK,IAAK,QAAQ,CAAE,CACnF,CAAC,ECTD,MAAMa,GAAWb,EAAiB,WAAY,CAC5C,CAAC,SAAU,CAAE,GAAI,IAAK,GAAI,IAAK,EAAG,IAAK,IAAK,SAAU,EACtD,CAAC,OAAQ,CAAE,EAAG,mBAAoB,IAAK,QAAQ,CAAE,EACjD,CAAC,OAAQ,CAAE,EAAG,mBAAoB,IAAK,QAAQ,CAAE,EACjD,CAAC,SAAU,CAAE,GAAI,IAAK,GAAI,KAAM,EAAG,IAAK,IAAK,SAAU,EACvD,CAAC,OAAQ,CAAE,EAAG,mBAAoB,IAAK,QAAQ,CAAE,CACnD,CAAC,ECND,MAAMc,GAAOd,EAAiB,OAAQ,CACpC,CAAC,OAAQ,CAAE,EAAG,4CAA6C,IAAK,QAAQ,CAAE,EAC1E,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,IAAK,EAAG,IAAK,IAAK,QAAQ,CAAE,CACzD,CAAC,ECLKe,GAA+BC,EAAAA,cAAc,IAAI,ECJvD,SAASC,IAAe,CACpB,MAAMC,EAAYC,EAAAA,OAAO,EAAK,EAC9B,OAAAC,GAA0B,KACtBF,EAAU,QAAU,GACb,IAAM,CACTA,EAAU,QAAU,EACxB,GACD,CAAA,CAAE,EACEA,CACX,CCRA,SAASG,IAAiB,CACtB,MAAMH,EAAYD,GAAY,EACxB,CAACK,EAAmBC,CAAoB,EAAIC,EAAAA,SAAS,CAAC,EACtDC,EAAcC,EAAAA,YAAY,IAAM,CAClCR,EAAU,SAAWK,EAAqBD,EAAoB,CAAC,CACnE,EAAG,CAACA,CAAiB,CAAC,EAMtB,MAAO,CADqBI,EAAAA,YAAY,IAAMC,GAAM,WAAWF,CAAW,EAAG,CAACA,CAAW,CAAC,EAC7DH,CAAiB,CAClD,CChBA,MAAMM,GAAUC,GAAS,CAACA,EAAK,eAAiBA,EAAK,WAAW,EAAK,EACrE,SAASC,IAAY,CACjB,MAAMC,EAAQ,IAAI,IACZC,EAAgB,IAAI,QACpBC,EAAW,IAAMF,EAAM,QAAQH,EAAM,EAC3C,MAAO,CACH,IAAMC,GAAS,CACXE,EAAM,IAAIF,CAAI,EACdG,EAAc,IAAIH,EAAMA,EAAK,iBAAiB,aAAcI,CAAQ,CAAC,CACzE,EACA,OAASJ,GAAS,CACdE,EAAM,OAAOF,CAAI,EACjB,MAAMK,EAAcF,EAAc,IAAIH,CAAI,EACtCK,IACAA,EAAW,EACXF,EAAc,OAAOH,CAAI,GAE7BI,EAAQ,CACZ,EACA,MAAOA,CACf,CACA,CCbA,MAAME,GAAsBC,GAAYA,IAAY,GAC9CC,GAAmBD,GAAYD,GAAmBC,IAAY,EAAI,GAAKA,IAAY,KACnFE,GAAc,CAAC,CAAE,SAAAC,EAAU,GAAAC,EAAI,QAAAJ,EAAU,EAAI,IAAO,CACtD,MAAMK,EAAqBC,EAAAA,WAAWC,EAAkB,EAClDC,EAA+BF,EAAAA,WAAW3B,EAA4B,EACtE,CAACU,EAAaoB,CAAG,EAAIxB,GAAc,EACnCyB,EAAU3B,EAAAA,OAAO,IAAI,EACrB4B,EAAaN,EAAmB,IAAMG,EACxCE,EAAQ,UAAY,OAChBT,GAAgBD,CAAO,GAAKW,IAC5BP,EAAKA,EAAKO,EAAa,IAAMP,EAAKO,GAEtCD,EAAQ,QAAU,CACd,GAAAN,EACA,MAAOL,GAAmBC,CAAO,GAC3BK,EAAmB,OAASX,GAAS,CAEvD,GAEI,MAAMkB,EAAkBC,UAAQ,KAAO,CAAE,GAAGH,EAAQ,QAAS,YAAArB,CAAW,GAAK,CAACoB,CAAG,CAAC,EAClF,OAAQK,EAAAA,IAAIP,GAAmB,SAAU,CAAE,MAAOK,EAAiB,SAAUT,EAAU,CAC3F,ECpBMY,GAAQ,CACZ,CAAE,GAAI,WAAY,KAAMC,GAAO,MAAO,WAAY,MAAO,kBAAmB,UAAW,8CAAA,EACvF,CAAE,GAAI,QAAS,KAAMC,GAAY,MAAO,QAAS,MAAO,iBAAkB,UAAW,6CAAA,EACrF,CAAE,GAAI,QAAS,KAAMC,GAAU,MAAO,OAAQ,MAAO,kBAAmB,UAAW,6CAAA,EACnF,CAAE,GAAI,SAAU,KAAMC,GAAK,MAAO,SAAU,MAAO,gBAAiB,UAAW,wCAAA,CACjF,EAEO,SAASC,IAAa,CAC3B,KAAM,CAAE,KAAAC,EAAM,QAAAC,CAAA,EAAYC,GAAA,EACpBC,EAAWC,GAAA,EAEXC,EAAoBC,GAAkC,CAC1DL,EAAQK,EAAQ,EAAS,EAEzBH,EAAS,GAAG,CACd,EAGMI,EAAcP,GAAQ,WAE5B,aACG,MAAA,CAAI,UAAU,4FACZ,SAAAN,GAAM,IAAKc,GAAM,CAChB,MAAMC,EAAOD,EAAE,KACTE,EAAWH,IAAgBC,EAAE,GAEnC,OACEG,EAAAA,KAACC,EAAO,OAAP,CAEC,QAAS,IAAMP,EAAiBG,CAAC,EACjC,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW;AAAA;AAAA;AAAA,gBAGPE,EACE,oBAAoBF,EAAE,SAAS,wBAC/B,wDACJ;AAAA,cAEF,MAAOA,EAAE,MAET,SAAA,CAAAf,MAACgB,GAAK,KAAM,GAAI,UAAWC,EAAW,aAAeF,EAAE,MAAO,EAC9Df,EAAAA,IAAC,OAAA,CAAM,SAAAe,EAAE,KAAA,CAAM,EACdE,GACCjB,EAAAA,IAACmB,EAAO,IAAP,CACC,UAAW,2DAA2DJ,EAAE,SAAS,gBACjF,QAAS,CAAE,OAAQ,CAAA,EACnB,QAAS,CAAE,OAAQ,CAAA,EACnB,WAAY,CAAE,KAAM,SAAU,UAAW,IAAK,QAAS,EAAA,CAAG,CAAA,CAC5D,CAAA,EAtBGA,EAAE,EAAA,CA0Bb,CAAC,CAAA,CACH,CAEJ,CChBA,MAAMK,GAAiD,CACrD,OAAQ,mCACR,WAAY,6BACZ,KAAM,uDACN,QAAS,gDACT,QAAS,+BACX,EAEMC,GAAiB,CAACC,EAAsBC,IAC5C,GAAGH,GAAiBE,CAAM,CAAC,GAAG,mBAAmBC,CAAK,CAAC,GAEnDC,GAAmB,CAACC,EAAcC,IAA0B,CAChE,GAAIA,IAAW,MAAQ,OAAO,MAAMA,CAAM,GAAK,CAAC,OAAO,SAASA,CAAM,EACpE,OAAO,KAET,MAAMC,EACJ,KAAK,IAAID,CAAM,EAAI,KAAa,KAAK,IAAIA,CAAM,EAAI,KAC/CA,EAAO,cAAc,CAAC,EACtB,OAAO,UAAUA,CAAM,EACvBA,EAAO,SAAA,EACPA,EAAO,YAAY,CAAC,EAAE,QAAQ,SAAU,EAAE,EAChD,MAAO,GAAGD,CAAI,MAAME,CAAS,EAC/B,EAEMC,GAAsBC,GAAgB,CAC1C,MAAMJ,EAAOI,EAAI,QAAQ,KAAM,EAAE,EAAE,KAAA,EAMnC,GALI,CAACJ,GAKD,CAAC,uBAAuB,KAAKA,CAAI,EACnC,OAAO,KAGT,GAAI,CACF,MAAMK,EAAQ,SAAS,yBAAyBL,EAAK,QAAQ,MAAO,IAAI,CAAC,GAAG,EAAA,EAC5E,GAAI,OAAOK,GAAU,UAAY,OAAO,SAASA,CAAK,EACpD,OAAOA,CAEX,MAAQ,CACN,OAAO,IACT,CACA,OAAO,IACT,EAEMC,GAAsBC,GAA2C,CACrE,MAAMC,EAAUD,EAAM,KAAA,EACtB,GAAI,CAACC,EACH,OAAO,KAGT,MAAMC,EAAQD,EAAQ,YAAA,EAEtB,GAAIC,EAAM,WAAW,OAAO,EAAG,CAC7B,MAAMT,EAAOQ,EAAQ,MAAM,CAAC,EAAE,KAAA,EACxBP,EAASD,EAAOG,GAAmBH,CAAI,EAAI,KACjD,MAAO,CAAE,KAAM,OAAQ,KAAAA,EAAM,OAAQC,GAAU,MAAA,CACjD,CAEA,OAAIQ,EAAM,WAAW,KAAK,EAEjB,CAAE,KAAM,KAAM,OADND,EAAQ,MAAM,CAAC,EAAE,KAAA,CACX,EAGnBC,EAAM,WAAW,KAAK,EACjB,CAAE,KAAM,SAAU,OAAQ,SAAU,MAAOD,EAAQ,MAAM,CAAC,EAAE,KAAA,CAAK,EAGtEC,EAAM,WAAW,OAAO,EACnB,CAAE,KAAM,SAAU,OAAQ,aAAc,MAAOD,EAAQ,MAAM,CAAC,EAAE,KAAA,CAAK,EAG1EC,EAAM,WAAW,QAAQ,EACpB,CAAE,KAAM,SAAU,OAAQ,OAAQ,MAAOD,EAAQ,MAAM,CAAC,EAAE,KAAA,CAAK,EAGpEC,EAAM,WAAW,MAAM,EAClB,CAAE,KAAM,SAAU,OAAQ,UAAW,MAAOD,EAAQ,MAAM,CAAC,EAAE,KAAA,CAAK,EAGvEC,EAAM,WAAW,KAAK,EACjB,CAAE,KAAM,SAAU,OAAQ,UAAW,MAAOD,EAAQ,MAAM,CAAC,EAAE,KAAA,CAAK,EAGvEA,EAAQ,WAAW,GAAG,EACjB,CAAE,KAAM,QAAS,OAAQA,EAAQ,MAAM,CAAC,EAAE,MAAK,EAGpDC,EAAM,WAAW,MAAM,EAClB,CAAE,KAAM,QAAS,OAAQD,EAAQ,MAAM,CAAC,EAAE,MAAK,EAGpDA,EAAQ,WAAW,GAAG,EACjB,CAAE,KAAM,UAAW,QAASA,EAAQ,MAAM,CAAC,EAAE,MAAK,EAGpD,IACT,EAEME,GAA4B,CAACC,EAA0BC,IAAwC,CACnG,OAAQD,EAAO,KAAA,CACb,IAAK,OAAQ,CACX,GAAI,CAACA,EAAO,KACV,MAAO,CACL,KAAM,UACN,MAAO,aACP,SAAU,kCACV,OAAAA,CAAA,EAGJ,MAAMT,EAAYH,GAAiBY,EAAO,KAAMA,EAAO,QAAU,IAAI,EACrE,MAAO,CACL,KAAM,UACN,MAAO,cAAcA,EAAO,IAAI,GAChC,SAAUT,GAAa,0BACvB,OAAAS,CAAA,CAEJ,CACA,IAAK,KACH,MAAO,CACL,KAAM,UACN,MAAO,mBAAmBA,EAAO,OAAS,KAAKA,EAAO,MAAM,GAAK,EAAE,GACnE,SAAUA,EAAO,OAAS,oBAAsB,+BAChD,OAAAA,CAAA,EAEJ,IAAK,QACH,MAAO,CACL,KAAM,UACN,MAAO,YAAYA,EAAO,OAAS,KAAKA,EAAO,MAAM,GAAK,EAAE,GAC5D,SAAU,iCACV,OAAAA,CAAA,EAEJ,IAAK,SAWH,MAAO,CACL,KAAM,SACN,MAAO,GAXPA,EAAO,SAAW,aACd,aACAA,EAAO,SAAW,OAClB,YACAA,EAAO,SAAW,UAClB,UACAA,EAAO,SAAW,UAClB,YACA,QAGiB,KAAKA,EAAO,OAASC,CAAQ,GAClD,SAAUhB,GAAee,EAAO,OAAQA,EAAO,OAASC,CAAQ,EAChE,OAAAD,CAAA,EAGJ,IAAK,UACH,MAAO,CACL,KAAM,UACN,MAAO,gBAAgBA,EAAO,SAAWC,CAAQ,GACjD,SAAU,6CACV,OAAAD,CAAA,EAEJ,QACE,OAAO,IAAA,CAEb,EAEME,GAAsB,iBACtBC,GAAc,GAEb,SAASC,GAAQ,CAAE,iBAAAC,GAAsD,CAC9E,KAAM,CAAE,KAAAC,EAAM,SAAAC,CAAA,EAAaC,GAAA,EACrBC,EAAoBC,GAAmBC,GAAUA,EAAM,iBAAiB,EACxEC,EAAaC,GAAA,EACbC,EAAsBC,GAC1BA,EAAK,IAAKC,IAAO,CACf,GAAIA,EAAE,GACN,MAAOA,EAAE,OAAS,UAClB,IAAKA,EAAE,KAAO,cACd,OAAQ,EAAQA,EAAE,OAClB,KAAMA,EAAE,KACR,YAAaA,EAAE,YACf,cAAeA,EAAE,cACjB,eAAgBA,EAAE,eAClB,UAAWA,EAAE,UACb,aAAcA,EAAE,aAChB,UAAWA,EAAE,UACb,UAAWA,EAAE,UACb,SAAUA,EAAE,QAAA,EACZ,EACE,CAACC,EAAKC,CAAM,EAAIhF,EAAAA,SAAS,EAAE,EAC3B,CAACiF,EAASC,CAAU,EAAIlF,EAAAA,SAAS,EAAK,EACtC,CAACmF,EAAaC,CAAc,EAAIpF,EAAAA,SAAuB,CAAA,CAAE,EACzD,CAACqF,EAAeC,CAAgB,EAAItF,EAAAA,SAAS,EAAE,EAC/C,CAACuF,EAAUC,CAAW,EAAIxF,EAAAA,SAA2D,IAAI,EACzF,CAACyF,EAAUC,CAAW,EAAI1F,EAAAA,SAAS,CAAC,EACpC,CAAC2F,EAAWC,CAAY,EAAI5F,EAAAA,SAAS,EAAK,EAC1C,CAAC6F,GAAaC,EAAc,EAAI9F,EAAAA,SAAmE,CAAA,CAAE,EACrG+F,EAAWpG,EAAAA,OAAyB,IAAI,EACxC,CAACqG,EAAaC,CAAc,EAAIjG,EAAAA,SAAuB,CAAA,CAAE,EACzD,CAACkG,EAAYC,CAAa,EAAInG,EAAAA,SAAwB,IAAI,EAC1DoG,EAAiBzG,EAAAA,OAAkD,IAAI,EACvE0G,EAAqB1G,EAAAA,OAA4B,IAAI,EACrD2G,GAAoBpG,EAAAA,YAAY,CAACqG,EAAiBC,IAAsC,CAC5F,MAAMC,EAAU,QAAgB,IAChC,GAAKA,EACL,IAAI,OAAOA,EAAO,IAAO,WAAY,CACnCA,EAAO,GAAGF,EAASC,CAAO,EAC1B,MACF,CACI,OAAOC,EAAO,aAAgB,YAChCA,EAAO,YAAYF,EAASC,CAAO,EAEvC,EAAG,CAAA,CAAE,EAECE,GAAoBxG,EAAAA,YAAY,CAACqG,EAAiBC,IAAsC,CAC5F,MAAMC,EAAU,QAAgB,IAChC,GAAKA,EACL,IAAI,OAAOA,EAAO,gBAAmB,WAAY,CAC/CA,EAAO,eAAeF,EAASC,CAAO,EACtC,MACF,CACA,GAAI,OAAOC,EAAO,KAAQ,WAAY,CACpCA,EAAO,IAAIF,EAASC,CAAO,EAC3B,MACF,CACI,OAAOC,EAAO,qBAAwB,YACxCA,EAAO,oBAAoBF,EAASC,CAAO,EAE/C,EAAG,CAAA,CAAE,EAECG,EAAYvC,EAAK,KAAKU,GAAKA,EAAE,KAAOT,CAAQ,EAElDuC,EAAAA,UAAU,IAAM,CACd,GAAI,CACF,MAAMrD,EAAM,aAAa,QAAQS,EAAmB,EACpD,GAAIT,EAAK,CACP,MAAMsD,EAAS,KAAK,MAAMtD,CAAG,EACzB,MAAM,QAAQsD,CAAM,GACtBf,GACEe,EACG,OAAQC,GAAc,OAAOA,GAAM,KAAQ,QAAQ,EACnD,MAAM,EAAG7C,EAAW,CAAA,CAG7B,CACF,OAAS8C,EAAO,CACd,QAAQ,KAAK,qCAAsCA,CAAK,CAC1D,CACF,EAAG,CAAA,CAAE,EAEL,MAAMC,EAAiB9G,EAAAA,YAAY,CAAC+G,EAAeC,IAAqB,CAClE,CAACA,GAAYA,EAAS,WAAW,QAAQ,GAAKA,EAAS,WAAW,OAAO,GAG7EpB,GAAgBqB,GAAS,CACvB,MAAMC,EAAWD,EAAK,OAAQL,GAASA,EAAK,MAAQI,CAAQ,EACtDG,EAAO,CAAC,CAAE,MAAOJ,GAASC,EAAU,IAAKA,EAAU,UAAW,KAAK,IAAA,GAAS,GAAGE,CAAQ,EAAE,MAAM,EAAGnD,EAAW,EACnH,GAAI,CACF,aAAa,QAAQD,GAAqB,KAAK,UAAUqD,CAAI,CAAC,CAChE,OAASN,EAAO,CACd,QAAQ,KAAK,qCAAsCA,CAAK,CAC1D,CACA,OAAOM,CACT,CAAC,CACH,EAAG,CAAA,CAAE,EAECC,EAAkBpH,EAAAA,YAAY,IAAM,CACxC,GAAImG,EAAmB,QAAS,CAC9B,GAAI,CACFA,EAAmB,QAAA,CACrB,MAAQ,CAER,CACAA,EAAmB,QAAU,IAC/B,CACAD,EAAe,QAAU,IAC3B,EAAG,CAAA,CAAE,EAECmB,EAAiBrH,cAAasH,GAAc,CAChD,GAAI,GAACA,GAAQ,OAAOA,GAAS,UAI7B,IAAIA,EAAK,OAAS,SAAU,CAC1BrB,EAAcqB,EAAK,OAAS,IAAI,EAChC,MACF,CAEA,GAAIA,EAAK,OAAS,UAAYA,EAAK,OAAQ,CACzCvB,EAAgBkB,GAAS,CACvB,MAAMM,EAAgBN,EAAK,UAAWL,GAASA,EAAK,MAAQU,EAAK,OAAO,GAAG,EAC3E,GAAIC,GAAiB,EAAG,CACtB,MAAMC,EAAUP,EAAK,MAAA,EACrB,OAAAO,EAAQD,CAAa,EAAI,CAAE,GAAGC,EAAQD,CAAa,EAAG,GAAGD,EAAK,MAAA,EACvDE,CACT,CACA,MAAO,CAAC,GAAGP,EAAMK,EAAK,MAAM,CAC9B,CAAC,EACD,MACF,CAEA,GAAIA,EAAK,OAAS,WAAY,CAC5BrB,EAAewB,GAAYA,GAAW,sBAAsB,EAC5D,MACF,CAEA,GAAIH,EAAK,OAAS,QAAS,CACzBrB,EAAcqB,EAAK,SAAW,oBAAoB,EAClD,MACF,EACF,EAAG,CAAA,CAAE,EAECI,EAAkB1H,EAAAA,YACtB,MAAO+C,GAAkB,CACvB,MAAMU,EAAUV,EAAM,KAAA,EACtB,GAAKU,EAIL,CAAA2D,EAAA,EACArB,EAAe,CAAA,CAAE,EACjBE,EAAc,YAAY,EAE1B,GAAI,CACF,MAAM0B,EAAU,MAAMC,EAAI,WAAW,MAAMnE,EAAS,CAAE,WAAY,GAAI,EACtEyC,EAAe,QAAUyB,EAEzB,MAAMrB,EAAU,CAACuB,EAAaP,IAAc,CAC1CD,EAAeC,CAAI,CACrB,EAEAlB,GAAkBuB,EAAQ,QAASrB,CAAO,EAC1CH,EAAmB,QAAU,IAAMK,GAAkBmB,EAAQ,QAASrB,CAAO,CAC/E,OAASO,EAAO,CACd,QAAQ,MAAM,4BAA6BA,CAAK,EAChDZ,EAAc,oBAAoB,CACpC,EACF,EACA,CAACG,GAAmBI,GAAmBa,EAAgBD,CAAe,CAAA,EAIxEU,GAAyB,eAAiBC,GAAY,CACpD,MAAMC,EAAM,MAAM,QAAQD,CAAO,EAAIA,EAAQ,KAAMnD,GAAWA,EAAE,MAAM,EAAI,KAC1E,GAAIoD,GAAO,CAACjD,EAAS,CACnBD,EAAOkD,EAAI,KAAO,EAAE,EACpB,GAAI,CACF,MAAMC,EAAS,IAAI,IAAID,EAAI,KAAO,aAAa,EAC/C1C,EAAY,CACV,OAAQ2C,EAAO,WAAa,QAAA,CAC7B,CACH,MAAQ,CACN3C,EAAY,IAAI,CAClB,CACF,CACF,EAAG,CAACnB,EAAUY,CAAO,CAAC,EAGtB+C,GAAiD,gBAAkBI,GAAS,CACtEA,EAAK,QAAU/D,IACjBqB,EAAY0C,EAAK,QAAQ,EACzBxC,EAAawC,EAAK,SAAW,KAAOA,EAAK,SAAW,CAAC,EAEzD,EAAG,CAAC/D,CAAQ,CAAC,EAGb,MAAMgE,EAAoBnI,EAAAA,YACxBoI,GAAS,MAAOrF,GAAkB,CAChC,MAAMsF,EAAatF,GAAS,GACtBuF,EAAaD,EAAW,YAAA,EAAc,KAAA,EACtCE,EAAwB,CAAA,EAC9B,GAAID,EAAW,WAAW,OAAO,EAAG,CAClCpD,EAAe,CAAA,CAAE,EACjB,MACF,CACA,MAAMsD,EAAU,OAAO,UAAc,KAAe,UAAU,SAAW,GAEnEC,EAAiB,CAACC,EAAwBC,EAAQ,KAAU,CAChE,GAAI,CAACD,EAAW,MAAO,OACRH,EAAQ,KACpB3B,GACCA,EAAK,QAAU8B,EAAW,OAC1B9B,EAAK,WAAa8B,EAAW,UAC7B9B,EAAK,MAAQ8B,EAAW,KACxB9B,EAAK,OAAS8B,EAAW,IAAA,IAGvBC,EACFJ,EAAQ,QAAQG,CAAU,EAE1BH,EAAQ,KAAKG,CAAU,EAG7B,EAEME,EAAcrF,GAAmB8E,CAAU,EACjD,GAAIO,EAAa,CACf,MAAMC,EAAkBlF,GAA0BiF,EAAaP,CAAU,EACrEQ,GACFJ,EAAeI,CAAe,CAElC,CAEA,MAAMpF,EAAU4E,EAAW,KAAA,EAG3B,GADE5E,EAAQ,OAAS,GAAK,CAACA,EAAQ,WAAW,GAAG,GAAK,CAACA,EAAQ,WAAW,GAAG,GAGzE,EAAEmF,IAAgBA,EAAY,OAAS,SAAWA,EAAY,OAAS,OAEvEH,EACE,CACE,KAAM,UACN,MAAO,eAAehF,CAAO,GAC7B,SAAU,uCACV,OAAQ,CAAE,KAAM,QAAS,OAAQA,CAAA,EACjC,MAAO,SACP,KAAM,UAAA,EAER,EAAA,UAEO,CAACA,EAAS,CACnB,MAAMqF,EAAiB,CACrBrC,GAAW,MAAQ,cAAcA,EAAU,KAAK,IAAM,qBACtD,2BACA,qCAAA,EAEFqC,EACG,MAAA,EACA,QAAA,EACA,QAAQ,CAACC,EAAQC,IAChBP,EACE,CACE,KAAM,UACN,MAAO,eAAeM,CAAM,GAC5B,SAAUC,IAAUF,EAAe,OAAS,EAAI,cAAgB,OAChE,OAAQ,CAAE,KAAM,QAAS,OAAAC,CAAA,EACzB,MAAO,SACP,KAAM,UAAA,EAER,EAAA,CACF,CAEN,CAEIT,EAAW,OAAS,GAAK,CAACA,EAAW,WAAW,MAAM,GAAK,CAACA,EAAW,SAAS,GAAG,KACjF,CAACM,GAAeA,EAAY,OAAS,WACvCH,EAAe,CACb,KAAM,SACN,MAAO,WAAWJ,CAAU,GAC5B,SAAUxF,GAAe,SAAUwF,CAAU,EAC7C,OAAQ,CAAE,KAAM,SAAU,OAAQ,SAAU,MAAOA,CAAA,CAAW,CAC/D,EAEHI,EAAe,CACb,KAAM,SACN,MAAO,eAAeJ,CAAU,GAChC,SAAUxF,GAAe,aAAcwF,CAAU,EACjD,OAAQ,CAAE,KAAM,SAAU,OAAQ,aAAc,MAAOA,CAAA,CAAW,CACnE,GAIHnE,EAAK,QAAQ8D,GAAO,CAClB,MAAMjB,EAAQiB,EAAI,OAAS,WACrBiB,EAASjB,EAAI,KAAO,IACtBjB,EAAM,cAAc,SAASuB,CAAU,GACvCW,EAAO,YAAA,EAAc,SAASX,CAAU,IAC1CG,EAAe,CACb,KAAM,MACN,MAAA1B,EACA,SAAUkC,GAAU,OACpB,OAAQA,EAAS,CAAE,KAAM,MAAO,IAAKA,GAAW,MAAA,CACjD,CAEL,CAAC,EAGD,GAAI,CACF,IAAIC,EAAiB,CAAA,EAChBV,IACCF,EAAW,OAAO,SAAW,GAAKA,EAAW,OAAS,EACxDY,EAAU,MAAMtB,EAAI,QAAQ,OAAO,EAAE,EAErCsB,EAAU,MAAMtB,EAAI,QAAQ,OAAOS,CAAU,GAI7C,MAAM,QAAQa,CAAO,GAAKA,EAAQ,OAAS,GAC7CA,EAAQ,MAAM,EAAG,CAAC,EAAE,QAAStC,GAAc,CACzC6B,EAAe,CACb,KAAM,UACN,MAAO7B,EAAK,OAASA,EAAK,KAAO,WACjC,SAAUA,EAAK,IACf,OAAQA,EAAK,IAAM,CAAE,KAAM,MAAO,IAAKA,EAAK,GAAA,EAAQ,MAAA,CACrD,CACH,CAAC,CAEL,OAASC,EAAO,CACd,QAAQ,KAAK,yBAA0BA,CAAK,CAC9C,CAE2BlB,GACxB,OAAQiB,GAAS,CAAC0B,GAAc1B,EAAK,MAAM,cAAc,SAAS0B,CAAU,GAAK1B,EAAK,IAAI,cAAc,SAAS0B,CAAU,CAAC,EAC5H,MAAM,EAAG,CAAC,EAEM,QAAS1B,GAAS,CACnC6B,EAAe,CACb,KAAM,UACN,MAAO7B,EAAK,MACZ,SAAUA,EAAK,IACf,OAAQ,CAAE,KAAM,MAAO,IAAKA,EAAK,GAAA,CAAI,CACtC,CACH,CAAC,EAED1B,EAAeqD,EAAQ,MAAM,EAAG,CAAC,CAAC,CACpC,EAAG,GAAG,EACN,CAACrE,EAAMyB,GAAac,GAAW,GAAIA,GAAW,KAAK,CAAA,EAG/C0C,EAAsB5H,EAAAA,QAC1B,IACE6G,GAAUgB,GAAuB,CAC/B1B,EAAgB0B,CAAU,CAC5B,EAAG,GAAG,EACR,CAAC1B,CAAe,CAAA,EAGlBhB,EAAAA,UAAU,IAAM,IAAMyC,EAAoB,SAAU,CAACA,CAAmB,CAAC,EAEzEzC,EAAAA,UAAU,IAAM,IAAM,CACpBU,EAAA,CACF,EAAG,CAACA,CAAe,CAAC,EAEpBV,EAAAA,UAAU,IAAM,CACd,MAAMjD,EAAUoB,EAAI,KAAA,EACpB,GAAIpB,EAAQ,YAAA,EAAc,WAAW,OAAO,EAAG,CAC7C,MAAM2F,EAAa3F,EAAQ,QAAQ,cAAe,EAAE,EAAE,KAAA,EACtD,GAAI2F,EAAW,OAAS,EAAG,CACzBD,EAAoB,OAAA,EACpBpD,EAAe,CAAA,CAAE,EACjBE,EAAc,8CAA8C,EAC5DmB,EAAA,EACA,MACF,CACA+B,EAAoBC,CAAU,CAChC,MACED,EAAoB,OAAA,EACpBpD,EAAe,CAAA,CAAE,EACjBE,EAAc,IAAI,EAClBmB,EAAA,CAEJ,EAAG,CAACvC,EAAKsE,EAAqB/B,CAAe,CAAC,EAE9CV,EAAAA,UAAU,IAAM,CACd,MAAMjD,EAAUoB,EAAI,KAAA,EACpB,GAAI,CAACpB,EAAQ,YAAA,EAAc,WAAW,OAAO,EAC3C,OAEF,MAAM2F,EAAa3F,EAAQ,QAAQ,aAAc,EAAE,EAAE,KAAA,EAC/C4F,EAAqB,CACzB,CACE,KAAM,UACN,MAAO,oBAAoBD,EAAa,MAAMA,CAAU,GAAK,EAAE,GAC/D,SACEpD,IACCoD,EAAW,OAAS,EACjB,gDACAtD,EAAY,SAAW,EACvB,qBACA,sBACN,YAAa,GACb,KAAM,UAAA,CACR,EAGFA,EAAY,QAAS5C,GAAW,CAC9BmG,EAAK,KAAK,CACR,KAAM,SACN,MAAOnG,EAAO,OAASA,EAAO,IAC9B,SAAUA,EAAO,SAAWA,EAAO,IACnC,IAAKA,EAAO,IACZ,OAAQ,CAAE,KAAM,MAAO,IAAKA,EAAO,IAAK,MAAOA,EAAO,KAAA,EACtD,KAAM,QAAA,CACP,CACH,CAAC,EAEDgC,EAAemE,CAAI,CACrB,EAAG,CAACxE,EAAKiB,EAAaE,CAAU,CAAC,EAEjCU,EAAAA,UAAU,IAAM,CACV3B,EACFoD,EAAkBtD,CAAG,EAErBK,EAAe,CAAA,CAAE,CAErB,EAAG,CAACL,EAAKE,EAASoD,CAAiB,CAAC,EAEpCzB,EAAAA,UAAU,IAAM,CACdtB,EAAiB,EAAE,CACrB,EAAG,CAACH,EAAY,MAAM,CAAC,EAGvByB,EAAAA,UAAU,IAAM,CACd,MAAM4C,EAAiBC,GAAqB,CAE1C,MAAMC,EADQ,UAAU,SAAS,cAAc,QAAQ,KAAK,GAAK,EACxCD,EAAE,QAAUA,EAAE,QAEnCC,GAAYD,EAAE,MAAQ,MACxBA,EAAE,eAAA,EACF1D,EAAS,SAAS,MAAA,EAClBA,EAAS,SAAS,OAAA,GAEhB2D,GAAYD,EAAE,MAAQ,MACxBA,EAAE,eAAA,EACFtF,EAAA,EAEJ,EACA,cAAO,iBAAiB,UAAWqF,CAAa,EACzC,IAAM,OAAO,oBAAoB,UAAWA,CAAa,CAClE,EAAG,CAACrF,CAAgB,CAAC,EAErB,MAAMwF,EAAgB,MACpBC,EACAC,EAAiF,CAAA,IAC9E,CACH,KAAM,CAAE,WAAAC,EAAa,GAAO,UAAAC,EAAY,GAAO,cAAAC,GAAkBH,EAEjE,IAAI3C,EAAW0C,EAAU,KAAA,EAEzB,GAAI,CAAC1C,EACH,OAIA,CAACA,EAAS,WAAW,SAAS,GAC9B,CAACA,EAAS,WAAW,UAAU,GAC/B,CAACA,EAAS,WAAW,QAAQ,GAC7B,CAACA,EAAS,WAAW,SAAS,GAC9B,CAACA,EAAS,WAAW,OAAO,IAEN,uDACJ,KAAKA,CAAQ,GAAKA,EAAS,SAAS,GAAG,EACvDA,EAAW,WAAWA,CAAQ,GAE9BA,EAAWnE,GAAe,SAAUmE,CAAQ,GAIhD,MAAM+C,EAAmBH,GAAc,CAACC,EAExC,GAAI,CAACrF,EAAY,CACf,MAAMwF,EAAkBF,GAAiB9C,EACnCzC,EAAQH,GAAa,SAAA,EACrB6F,IAAY1F,EAAM,MAAQ,CAAA,GAAI,IAAKyD,IAAS,CAAE,GAAGA,CAAA,EAAM,EAC7D,IAAIkC,EAAWD,GACXE,EAAe5F,EAAM,UAAY,KAErC,GAAI,CAACA,EAAM,UAAY0F,GAAS,SAAW,EAAG,CAC5C,MAAMG,EAAQ,SAAS,KAAK,IAAA,CAAK,GACjCF,EAAWD,GAAS,IAAKjC,IAAS,CAAE,GAAGA,EAAK,OAAQ,EAAA,EAAQ,EAC5DkC,EAAS,KAAK,CACZ,GAAIE,EACJ,MAAOJ,EACP,IAAKhD,EACL,OAAQ,GACR,KAAM,QAAA,CACP,EACDmD,EAAeC,CACjB,SAAWL,EAAkB,CAC3B,MAAMK,EAAQ,SAAS,KAAK,IAAA,CAAK,GACjCF,EAAWD,GAAS,IAAKjC,IAAS,CAAE,GAAGA,GAAM,EAC7CkC,EAAS,KAAK,CACZ,GAAIE,EACJ,MAAOJ,EACP,IAAKhD,EACL,OAAQ,GACR,KAAM,QAAA,CACP,CACH,MACEkD,EAAWD,GAAS,IAAKjC,IAAS,CAChC,GAAGA,EACH,MAAOA,EAAI,KAAOzD,EAAM,SAAWyF,EAAkBhC,EAAI,MACzD,IAAKA,EAAI,KAAOzD,EAAM,SAAWyC,EAAWgB,EAAI,IAChD,OAAQA,EAAI,KAAOzD,EAAM,QAAA,EACzB,EACF4F,EAAe5F,EAAM,SAGvBH,GAAa,SAAS,CAAE,KAAM8F,EAAU,SAAUC,EAAc,EAChEE,GAAU,KAAK,eAAgB3F,EAAmBwF,CAAQ,CAAC,EAE3DlF,EAAW,EAAK,EAChBE,EAAe,CAAA,CAAE,EACZ6E,GACHjF,EAAOkC,CAAQ,EAEjBF,EAAekD,EAAiBhD,CAAQ,EAExC,GAAI,CAEF,OAAO,KAAKA,EADmC,SACjB,qBAAqB,CACrD,OAASH,EAAO,CACd,QAAQ,KAAK,iCAAkCA,CAAK,CACtD,CACA,MACF,CAEA,GAAIgD,EAAW,CACb,GAAI,CACF,MAAMjC,EAAI,QAAQ,aAAa,CAAE,IAAKZ,EAAU,EAChDhC,EAAW,EAAK,EAChBE,EAAe,CAAA,CAAE,EACjB4B,EAAegD,GAAiB9C,EAAUA,CAAQ,CACpD,OAASH,EAAO,CACd,QAAQ,MAAM,4CAA6CA,CAAK,CAClE,CACA,MACF,CAEA,GAAI,EACE,CAAC,OAAO,KAAO,OAAQ,OAAO,IAAY,QAAW,cACvD,QAAQ,KAAK,0CAA0C,EACvD,MAAM,IAAI,QAAQyD,GAAW,WAAWA,EAAS,GAAG,CAAC,GAGlDnG,EAEM4F,EACT,MAAMnC,EAAI,KAAK,OAAO,CAAE,IAAKZ,EAAU,YAAa3C,EAAmB,SAAU,GAAO,EAExF,MAAMuD,EAAI,KAAK,SAASzD,EAAU6C,CAAQ,EAJ1C,MAAMY,EAAI,KAAK,OAAO,CAAE,IAAKZ,EAAU,YAAa3C,EAAmB,SAAU,CAAC0F,CAAA,CAAkB,EAOtG/E,EAAW,EAAK,EAChBE,EAAe,CAAA,CAAE,EACZ6E,GACHjF,EAAOkC,CAAQ,EAEjBF,EAAegD,GAAiB9C,EAAUA,CAAQ,CACpD,OAASH,EAAO,CACd,QAAQ,MAAM,qBAAsBA,CAAK,EACzC,GAAI,EACE,CAAC,OAAO,KAAO,OAAQ,OAAO,IAAY,QAAW,cACvD,QAAQ,KAAK,4CAA4C,EACzD,MAAM,IAAI,QAAQyD,IAAW,WAAWA,GAAS,GAAG,CAAC,GAGvD,MAAMC,EAAS,MAAM3C,EAAI,KAAK,OAAO,CAAE,IAAKZ,EAAU,YAAa3C,EAAmB,SAAU,CAAC0F,EAAkB,EAC/GQ,GAAUA,EAAO,IACnBvF,EAAW,EAAK,EAChBE,EAAe,CAAA,CAAE,EACZ6E,GACHjF,EAAOkC,CAAQ,EAEjBF,EAAegD,GAAiB9C,EAAUA,CAAQ,GAElD,QAAQ,KAAK,wCAAyCuD,CAAM,CAEhE,OAASC,EAAa,CACpB,QAAQ,MAAM,4BAA6BA,CAAW,CACxD,CACF,CACF,EAEMC,GAAgB,MACpB7G,EACA8G,EACAf,EAAiF,CAAA,IAC9E,CACH,GAAI,CAAC/F,EAAQ,CACX,MAAM6F,EAAciB,EAAef,CAAO,EAC1C,MACF,CAEA,OAAQ/F,EAAO,KAAA,CACb,IAAK,MACH,MAAM6F,EAAc7F,EAAO,IAAK,CAAE,GAAG+F,EAAS,cAAe/F,EAAO,OAAS+F,EAAQ,aAAA,CAAe,EACpG,OACF,IAAK,SAAU,CACb,MAAM5G,EAAQa,EAAO,OAAS8G,EAAc,KAAA,EAC5C,GAAI,CAAC3H,EAAO,OACZ,MAAM4H,EACJ/G,EAAO,SAAW,aACd,aACAA,EAAO,SAAW,OAClB,YACAA,EAAO,SAAW,UAClB,UACAA,EAAO,SAAW,UAClB,YACA,SACN,MAAM6F,EAAc5G,GAAee,EAAO,OAAQb,CAAK,EAAG,CACxD,GAAG4G,EACH,cAAe,GAAGgB,CAAW,KAAK5H,CAAK,EAAA,CACxC,EACD,MACF,CACA,IAAK,KAAM,CACT,MAAMgG,EAASnF,EAAO,QAAU8G,EAAc,KAAA,EAC9C,GAAI,CAAC3B,EAAQ,CACX9E,EAAA,EACA,MACF,CACA,GAAI,CACF,MAAMgF,EAASxC,GAAW,IAC1B,MAAMmB,EAAI,MAAM,IAAImB,EAAQE,EAAS,CAAE,IAAKA,GAAW,MAAS,CAClE,OAASpC,EAAO,CACd,QAAQ,MAAM,mBAAoBA,CAAK,CACzC,CACA,MAAM4C,EAAc,gBAAgB,mBAAmBV,CAAM,CAAC,GAAI,CAChE,GAAGY,EACH,cAAe,OAAOZ,CAAM,EAAA,CAC7B,EACD,MACF,CACA,IAAK,QAAS,CACZ,MAAMA,EAASnF,EAAO,QAAU8G,EAAc,KAAA,EAC9C,GAAI,CAAC3B,EAAQ,CACX9E,EAAA,EACA,MACF,CACA,GAAI,CACF,MAAMgF,EAASxC,GAAW,IAC1B,MAAMmB,EAAI,MAAM,IAAImB,EAAQE,EAAS,CAAE,IAAKA,GAAW,MAAS,CAClE,OAASpC,EAAO,CACd,QAAQ,MAAM,eAAgBA,CAAK,CACrC,CACA,MAAM4C,EAAc,gBAAgB,mBAAmBV,CAAM,CAAC,GAAI,CAChE,GAAGY,EACH,cAAe,UAAUZ,CAAM,EAAA,CAChC,EACD,MACF,CACA,IAAK,OAAQ,CACX,MAAM9F,EAAOW,EAAO,MAAQ8G,EAAc,KAAA,EAC1C,GAAI,CAACzH,EAAM,CACT+B,EAAW,EAAI,EACf,MACF,CACA,MAAM4F,EAAchH,EAAO,QAAUR,GAAmBH,CAAI,EACtDE,EAAYF,EAAOD,GAAiBC,EAAM2H,GAAe,IAAI,EAAI,KACvE,GAAIzH,GAIF,GAHA2B,EAAO3B,CAAS,EAChB6B,EAAW,EAAK,EAChBE,EAAe,CAAA,CAAE,EACb,OAAO,UAAc,KAAe,UAAU,WAAW,UAC3D,GAAI,CACF,MAAM,UAAU,UAAU,UAAU/B,CAAS,CAC/C,MAAQ,CAER,OAGF,MAAMsG,EAAc5G,GAAe,SAAUI,CAAI,EAAG,CAClD,GAAG0G,EACH,cAAe,cAAc1G,CAAI,EAAA,CAClC,EAEH,MACF,CACA,IAAK,UACH+B,EAAW,EAAK,EAChBE,EAAe,CAAA,CAAE,EACjBjB,EAAA,EACA,OACF,QACE,MAAMwF,EAAciB,EAAef,CAAO,CAAA,CAEhD,EAEMkB,GAA2B,MAC/BnC,EACAiB,EAAyD,CAAA,IACtD,CACH,GAAIjB,EAAW,cAAgB,GAG/B,IAAIA,EAAW,OAAQ,CACrB,MAAM+B,GAAc/B,EAAW,OAAQA,EAAW,UAAYA,EAAW,KAAO7D,EAAK,CACnF,GAAG8E,EACH,cAAejB,EAAW,KAAA,CAC3B,EACD,MACF,CAEA,GAAIA,EAAW,IAAK,CAClB,MAAMe,EAAcf,EAAW,IAAK,CAAE,GAAGiB,EAAS,cAAejB,EAAW,MAAO,EACnF,MACF,CAEA,MAAMe,EAAc5E,EAAK,CAAE,GAAG8E,EAAS,cAAejB,EAAW,MAAO,EAC1E,EAEMY,GAAgB,MAAOC,GAA6C,CACxE,GAAIA,EAAE,MAAQ,QAAS,CACrBA,EAAE,eAAA,EACF,MAAMK,EAAaL,EAAE,UAAY,CAACA,EAAE,OAC9BM,EAAYN,EAAE,OACpB,GAAIpE,GAAiB,GAAKF,EAAYE,CAAa,EAAG,CACpD,MAAMuD,EAAazD,EAAYE,CAAa,EAC5C,MAAM0F,GAAyBnC,EAAY,CAAE,WAAAkB,EAAY,UAAAC,EAAW,CACtE,KAAO,CACL,GAAIhF,EAAI,KAAA,EAAO,cAAc,WAAW,OAAO,EAAG,CAChD,MAAMiG,EAAYhF,EAAY,CAAC,EAC/B,GAAIgF,GAAW,IAAK,CAClB,MAAMrB,EAAcqB,EAAU,IAAK,CACjC,WAAAlB,EACA,UAAAC,EACA,cAAeiB,EAAU,KAAA,CAC1B,EACD,MACF,CACF,CACA,MAAMlH,EAASL,GAAmBsB,CAAG,EACrC,MAAM4F,GAAc7G,EAAQiB,EAAK,CAAE,WAAA+E,EAAY,UAAAC,EAAW,CAC5D,CACF,MAAWN,EAAE,MAAQ,aACnBA,EAAE,eAAA,EACFnE,EAAiB6B,GAAQ,KAAK,IAAIA,EAAO,EAAGhC,EAAY,OAAS,CAAC,CAAC,GAC1DsE,EAAE,MAAQ,WACnBA,EAAE,eAAA,EACFnE,KAAyB,KAAK,IAAI6B,EAAO,EAAG,EAAE,CAAC,GACtCsC,EAAE,MAAQ,WACnBvE,EAAW,EAAK,EAChBE,EAAe,CAAA,CAAE,EACjBW,EAAS,SAAS,KAAA,EAEtB,EAGAa,OAAAA,EAAAA,UAAU,IAAM,CACV,CAAC3B,GAAW0B,GACd3B,EAAO2B,EAAU,KAAO,EAAE,CAE9B,EAAG,CAACA,EAAW1B,CAAO,CAAC,EAGrBrC,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAlB,EAAAA,IAACmB,EAAO,IAAP,CACC,UAAU,WACV,QAAS,CAAE,MAAOoC,EAAU,KAAO,CAAA,EACnC,WAAY,CAAE,SAAU,EAAA,EAExB,SAAArC,EAAAA,KAAC,MAAA,CAAI,UAAU,6BAEZ,SAAA,CAAA2C,GAAYR,GAAO,CAACE,GACnBrC,OAAC,OAAI,UAAU,mEAAmE,cAAY,OAC3F,SAAA,CAAA2C,EAAS,OACR7D,EAAAA,IAACuJ,GAAA,CAAK,KAAM,GAAI,UAAU,iBAAiB,aAAW,mBAAA,CAAoB,EACxElG,EAAI,WAAW,SAAS,EAC1BrD,MAACwJ,GAAA,CAAY,KAAM,GAAI,UAAU,iBAAiB,aAAW,qBAAA,CAAsB,EAEnFxJ,EAAAA,IAACyJ,GAAA,CAAM,KAAM,GAAI,UAAU,gBAAgB,aAAW,WAAW,EAElE5F,EAAS,cAAgB,QAAaA,EAAS,YAAc,GAC5D3C,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAA0B,aAAY,GAAG2C,EAAS,WAAW,kBAC1E,SAAA,CAAA7D,EAAAA,IAAC0J,GAAA,CAAO,KAAM,GAAI,UAAU,gBAAgB,EAC5C1J,EAAAA,IAAC,OAAA,CAAK,UAAU,wBAAyB,WAAS,WAAA,CAAY,CAAA,CAAA,CAChE,CAAA,EAEJ,EAGFA,EAAAA,IAAC,QAAA,CACC,IAAKqE,EACL,KAAK,OACL,MAAOhB,EACP,SAAW0E,GAAMzE,EAAOyE,EAAE,OAAO,KAAK,EACtC,QAAS,IAAMvE,EAAW,EAAI,EAC9B,OAAQ,IAAM,WAAW,IAAMA,EAAW,EAAK,EAAG,GAAG,EACrD,UAAWsE,GACX,aAAW,oCACX,oBAAkB,OAClB,gBAAevE,GAAWE,EAAY,OAAS,EAC/C,YAAY,sBACZ,UAAW;AAAA,gCACSI,GAAY,CAACN,EAAU,QAAU,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA,aAAA,CAAA,EAS5DU,GAAaF,EAAW,GACvB/D,EAAAA,IAACmB,EAAO,IAAP,CACC,UAAU,kEACV,QAAS,CAAE,OAAQ,CAAA,EACnB,QAAS,CAAE,OAAQ4C,EAAW,GAAA,EAC9B,WAAY,CAAE,SAAU,EAAA,CAAI,CAAA,EAKhC/D,EAAAA,IAAC,MAAA,CAAI,UAAU,8DACb,SAAAA,EAAAA,IAAC2J,IAAO,KAAM,GAAI,UAAU,eAAA,CAAgB,CAAA,CAC9C,CAAA,CAAA,CACF,CAAA,CAAA,EAIF3J,EAAAA,IAAC4J,GAAA,CACE,SAAArG,GAAWE,EAAY,OAAS,GAC/BzD,EAAAA,IAACmB,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,GAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,GAAA,EACvB,UAAU,6IAET,SAAAsC,EAAY,IAAI,CAACyD,EAAYM,IAC5BtG,EAAAA,KAACC,EAAO,OAAP,CAEC,KAAK,SACL,SAAU+F,EAAW,cAAgB,GACrC,YAAa,MAAO2C,GAAU,CAE5B,GADAA,EAAM,eAAA,EACF3C,EAAW,cAAgB,GAAO,OACtC,MAAMkB,EAAayB,EAAM,UAAY,CAACA,EAAM,OACtCxB,EAAYwB,EAAM,OACxB,MAAMR,GAAyBnC,EAAY,CAAE,WAAAkB,EAAY,UAAAC,EAAW,CACtE,EACA,aAAc,IAAMzE,EAAiB4D,CAAK,EAC1C,UAAYO,GAAM,CAChB,GAAIA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,IAAK,CAEtC,GADAA,EAAE,eAAA,EACEb,EAAW,cAAgB,GAAO,OACtC,MAAMkB,EAAaL,EAAE,UAAY,CAACA,EAAE,OAC9BM,EAAYN,EAAE,OACpBsB,GAAyBnC,EAAY,CAAE,WAAAkB,EAAY,UAAAC,CAAA,CAAW,CAChE,CACF,EACA,KAAK,SACL,gBAAe1E,IAAkB6D,EACjC,aAAY,GAAGN,EAAW,IAAI,gBAAgBA,EAAW,KAAK,GAC9D,UAAW;AAAA;AAAA;AAAA,oBAGPvD,IAAkB6D,EAChB,+BACA,oCACJ;AAAA,oBACEN,EAAW,cAAgB,GAAQ,4BAA8B,EAAE;AAAA,kBAGvE,SAAA,CAAAhG,EAAAA,KAAC,MAAA,CAAI,UAAU,yDACZ,SAAA,CAAAgG,EAAW,OAAS,YAAclH,MAAC8J,IAAS,KAAM,GAAI,UAAU,mBAAmB,EACnF5C,EAAW,OAAS,UAAYlH,MAAC2J,IAAO,KAAM,GAAI,UAAU,kBAAkB,EAC9EzC,EAAW,OAAS,WAAalH,MAAC+J,IAAM,KAAM,GAAI,UAAU,gBAAgB,EAC5E,CAAC7C,EAAW,MAAQA,EAAW,QAAQ,OAAS,QAAUlH,MAAChD,GAAA,CAAW,KAAM,GAAI,UAAU,gBAAA,CAAiB,EAC3G,CAACkK,EAAW,MAAQA,EAAW,QAAQ,OAAS,MAAQlH,MAAC8J,GAAA,CAAS,KAAM,GAAI,UAAU,iBAAA,CAAkB,EACxG,CAAC5C,EAAW,MAAQA,EAAW,QAAQ,OAAS,SAAWlH,MAAC8J,GAAA,CAAS,KAAM,GAAI,UAAU,eAAA,CAAgB,EACzG,CAAC5C,EAAW,MAAQA,EAAW,QAAQ,OAAS,UAAYlH,MAAC2J,GAAA,CAAO,KAAM,GAAI,UAAU,iBAAA,CAAkB,EAC1G,CAACzC,EAAW,MAAQA,EAAW,OAAS,OAASlH,EAAAA,IAAC,MAAA,CAAI,UAAU,mCAAmC,EACnG,CAACkH,EAAW,MAAQA,EAAW,OAAS,WAAalH,EAAAA,IAAC+J,GAAA,CAAM,KAAM,GAAI,UAAU,eAAA,CAAgB,EAChG,CAAC7C,EAAW,MAAQ,CAACA,EAAW,QAAUA,EAAW,OAAS,WAAalH,EAAAA,IAAC2J,GAAA,CAAO,KAAM,GAAI,UAAU,gBAAgB,EACvH,CAACzC,EAAW,MAAQ,CAACA,EAAW,QAAUA,EAAW,OAAS,UAAYlH,EAAAA,IAAC2J,GAAA,CAAO,KAAM,GAAI,UAAU,iBAAA,CAAkB,CAAA,EAC3H,EACAzI,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAlB,EAAAA,IAAC,MAAA,CAAI,UAAU,+BAAgC,SAAAkH,EAAW,MAAM,GAC9DA,EAAW,UAAYA,EAAW,MAClClH,EAAAA,IAAC,MAAA,CAAI,UAAU,iCACZ,SAAAkH,EAAW,UAAYA,EAAW,GAAA,CACrC,CAAA,EAEJ,EACCA,EAAW,OACVlH,EAAAA,IAAC,OAAI,UAAU,gKACZ,WAAW,KAAA,CACd,CAAA,CAAA,EAzDGwH,CAAA,CA4DR,CAAA,CAAA,CACH,CAEJ,CAAA,EACF,CAEJ,CC9lCO,SAASwC,IAAc,CAC5B,KAAM,CAACjG,EAAUC,CAAW,EAAI1F,EAAAA,SAAS,CAAC,EACpC,CAAC2F,EAAWC,CAAY,EAAI5F,EAAAA,SAAS,EAAK,EAGhD,OAAAgI,GAAY,qBAAsB,IAAM,CACtCpC,EAAa,EAAI,EACjBF,EAAY,CAAC,CACf,EAAG,CAAA,CAAE,EAELsC,GAAY,wBAA0BI,GAA+B,CACnE1C,EAAY0C,EAAK,UAAY,CAAC,CAChC,EAAG,CAAA,CAAE,EAELJ,GAAY,wBAAyB,IAAM,CACzCpC,EAAa,EAAI,EACjBF,EAAY,GAAG,EACf,WAAW,IAAM,CACfE,EAAa,EAAK,EAClBF,EAAY,CAAC,CACf,EAAG,GAAG,CACR,EAAG,CAAA,CAAE,EAGLkB,EAAAA,UAAU,IAAM,CACd,GAAIjB,GAAaF,EAAW,GAAI,CAC9B,MAAMkG,EAAW,YAAY,IAAM,CACjCjG,EAAYyB,GACNA,GAAQ,IACV,cAAcwE,CAAQ,EACfxE,GAEFA,EAAO,KAAK,OAAA,EAAW,EAC/B,CACH,EAAG,GAAG,EACN,MAAO,IAAM,cAAcwE,CAAQ,CACrC,CACF,EAAG,CAAChG,EAAWF,CAAQ,CAAC,EAGtB/D,EAAAA,IAAC4J,IACE,SAAA3F,GACCjE,EAAAA,IAACmB,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,OAAQ,CAAA,EAC/B,QAAS,CAAE,QAAS,EAAG,OAAQ,CAAA,EAC/B,KAAM,CAAE,QAAS,EAAG,OAAQ,CAAA,EAC5B,UAAU,+GACV,MAAO,CAAE,OAAQ4C,EAAW,GAAA,CAAI,CAAA,EAGtC,CAEJ,CC/CO,SAASmG,IAAkB,CAChC,MAAMC,EAASC,GAAA,EACT,CAACC,EAAUC,CAAW,EAAIhM,EAAAA,SAA2B,CAAA,CAAE,EACvD,CAACiM,EAAeC,CAAgB,EAAIlM,EAAAA,SAAgC,IAAI,EACxE,CAACmM,EAAMC,CAAO,EAAIpM,EAAAA,SAAS,EAAK,EAChC,CAACqM,EAAUC,CAAW,EAAItM,EAAAA,SAAS,EAAK,EACxC,CAACuM,EAAgBC,CAAiB,EAAIxM,EAAAA,SAAS,EAAE,EACjD,CAACyM,EAAWC,CAAY,EAAI1M,EAAAA,SAAwB,IAAI,EACxD,CAAC2M,EAAUC,CAAW,EAAI5M,EAAAA,SAAS,EAAE,EACrC,CAAC6M,EAAiBC,CAAkB,EAAI9M,EAAAA,SAA8E,IAAI,EAC1H,CAAC+M,EAAgBC,CAAiB,EAAIhN,EAAAA,SAAS,EAAK,EACpD,CAACiN,EAAWC,EAAY,EAAIlN,EAAAA,SAAS,EAAK,EAC1C,CAACmN,GAAiBC,CAAkB,EAAIpN,EAAAA,SAAwB,IAAI,EAGpEqN,EAAsB1N,EAAAA,OAAe,EAAE,EAGvC2N,EAAe,SAAY,CAC/B,GAAI,CAEF,GAAI,CAAC,OAAO,KAAO,OAAO,OAAO,IAAI,QAAW,WAAY,CAC1D,WAAWA,EAAc,GAAG,EAC5B,MACF,CAEA,KAAM,CAACC,EAAaC,CAAM,EAAI,MAAM,QAAQ,IAAI,CAC9C1F,EAAI,SAAS,KAAA,EACbA,EAAI,SAAS,UAAA,CAAU,CACxB,EAGD,IAAI2F,EAAgB,MAAM,QAAQF,CAAW,EAAIA,EAAkC,CAAA,EAG/EE,EAAc,SAAW,IAC3BA,EAAgB,CAAC,CACf,GAAI,UACJ,KAAM,UACN,UAAW,UACX,UAAW,KAAK,IAAA,EAChB,SAAU,EACV,MAAO,SAAA,CACR,GAEH,MAAMC,EAAcD,EAAc,IAAIE,IAAKA,GAAE,EAAE,EAAE,OAAO,KAAK,GAAG,EAE5DN,EAAoB,UAAYK,IAClCL,EAAoB,QAAUK,EAC9B1B,EAAYyB,CAAa,GAI3B,IAAIG,EAAmBJ,GAAU,OAAOA,GAAW,SAAWA,EAA2B,KACpFI,IACHA,EAAmBH,EAAc,KAAKE,IAAKA,GAAE,KAAO,SAAS,GAAKF,EAAc,CAAC,GAAK,MAExF,MAAMI,GAAkBD,GAAkB,IAAM,KAC1CE,GAAmB7B,GAAe,IAAM,KAE1C4B,KAAoBC,IACtB5B,EAAiB0B,CAAgB,CAErC,OAAS7G,EAAO,CAGV8E,GAAU9E,aAAiB,OAAS,CAACA,EAAM,QAAQ,SAAS,eAAe,GAC7E,QAAQ,KAAK,2BAA4BA,CAAK,CAElD,CACF,EAEAH,EAAAA,UAAU,IAAM,CAEd,MAAMmH,EAAY,WAAW,IAAM,CACjCT,EAAA,CACF,EAAG,GAAG,EAGA3B,EAAW,YAAY2B,EAAc,GAAI,EAC/C,MAAO,IAAM,CACX,aAAaS,CAAS,EACtB,cAAcpC,CAAQ,CACxB,CACF,EAAG,CAAA,CAAE,EAEL/E,EAAAA,UAAU,IAAM,CACd,GAAI,CAACuF,EAAM,OACX,IAAI6B,EAAY,GAChB,OAAAhB,EAAkB,EAAI,EACtBlF,EAAI,aAAa,QAAA,EACd,KAAMmG,GAAQ,CACTD,GACJlB,EAAmBmB,GAAK,SAAW,IAAI,CACzC,CAAC,EACA,MAAM,IAAM,CACND,GACHlB,EAAmB,IAAI,CAE3B,CAAC,EACA,QAAQ,IAAM,CACRkB,GACHhB,EAAkB,EAAK,CAE3B,CAAC,EACI,IAAM,CACXgB,EAAY,EACd,CACF,EAAG,CAAC7B,CAAI,CAAC,EAET,MAAM+B,EAAsB,SAAY,CACtC,GAAK3B,EAAe,OAEpB,GAAI,CACF,MAAMzE,EAAI,SAAS,OAAO,CAAE,KAAMyE,EAAe,KAAA,EAAQ,EACzDC,EAAkB,EAAE,EACpBF,EAAY,EAAK,EACjB,MAAMgB,EAAA,CACR,OAASvG,EAAO,CACV8E,GAAQ,QAAQ,MAAM,4BAA6B9E,CAAK,CAC9D,CACF,EAEMoH,EAAsB,MAAOC,GAAsB,CACvD,GAAI,CACF,MAAMtG,EAAI,SAAS,UAAU,CAAE,UAAAsG,EAAW,EAC1C,MAAMd,EAAA,EACNlB,EAAQ,EAAK,CACf,OAASrF,EAAO,CACV8E,GAAQ,QAAQ,MAAM,4BAA6B9E,CAAK,CAC9D,CACF,EAEMsH,EAAsB,MAAOD,EAAmB3E,IAAwB,CAE5E,GADAA,EAAE,gBAAA,EACE,EAAC,QAAQ,mBAAmBsC,EAAS,KAAK4B,GAAKA,EAAE,KAAOS,CAAS,GAAG,IAAI,8CAA8C,EAI1H,GAAI,CACF,MAAMtG,EAAI,SAAS,OAAO,CAAE,UAAAsG,EAAW,EACvC,MAAMd,EAAA,CACR,OAASvG,EAAO,CACV8E,GAAQ,QAAQ,MAAM,4BAA6B9E,CAAK,CAC9D,CACF,EAEMuH,EAAmBzG,GAA4B,CACnD6E,EAAa7E,EAAQ,EAAE,EACvB+E,EAAY/E,EAAQ,IAAI,CAC1B,EAEM0G,GAAiB,MAAOH,GAAsB,CAClD,GAAI,CACF,MAAMtG,EAAI,SAAS,OAAO,CAAE,UAAAsG,EAAW,KAAMzB,EAAS,KAAA,EAAQ,EAC9DD,EAAa,IAAI,EACjB,MAAMY,EAAA,CACR,OAASvG,EAAO,CACd,QAAQ,MAAM,4BAA6BA,CAAK,CAClD,CACF,EAEMyH,GAA2B,SAAY,CAC3CtB,GAAa,EAAI,EACjBE,EAAmB,IAAI,EACvB,GAAI,CACF,MAAMhK,EAAS,MAAM0E,EAAI,aAAa,QAAA,EACtC,GAAI1E,GAAQ,SAAU,CACpB,MAAMqL,EAAgBrL,EAAO,UAAY,EACzCgK,EACE,YAAYqB,CAAa,OAAOA,IAAkB,EAAI,GAAK,GAAG,qBAAA,EAEhE,MAAMnB,EAAA,CACR,MAAWlK,GAAQ,MACjBgK,EAAmB,mBAAmBhK,EAAO,KAAK,EAAE,EAEpDgK,EAAmB,2CAA2C,CAElE,OAASrG,EAAO,CACd,QAAQ,MAAM,sCAAuCA,CAAK,EAC1DqG,EAAmB,qCAAqC,CAC1D,QAAA,CACEF,GAAa,EAAK,CACpB,CACF,EAEMwB,EACJ,CAACzC,GACDA,EAAc,KAAO,WACrBA,EAAc,KAAK,YAAA,IAAkB,UAEjC0C,EAAY,CAACD,EAEbE,EAAgBD,EAAY,aAAe,iBAEjD,OACE/L,EAAAA,KAAC,MAAA,CAAI,UAAU,WAEb,SAAA,CAAAA,EAAAA,KAACC,EAAO,OAAP,CACC,QAAS,IAAMuJ,EAAQ,CAACD,CAAI,EAC5B,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW,8BAA8ByC,CAAa,oIACtD,MAAM,wBAEN,SAAA,CAAAlN,EAAAA,IAACpC,GAAA,CAAK,KAAM,EAAA,CAAI,EACfqP,GACCjN,EAAAA,IAAC,OAAA,CAAK,UAAU,sBACb,SAAAuK,GAAe,MAAQ,UAC1B,EAED,CAACyC,GAAoBzC,GAAe,OACnCvK,EAAAA,IAAC,MAAA,CACC,UAAU,8CACV,MAAO,CAAE,gBAAiBuK,EAAc,KAAA,CAAM,CAAA,EAGjD0C,GAAa5C,EAAS,OAAS,GAC9BnJ,EAAAA,KAAC,OAAA,CAAK,UAAU,wBAAwB,SAAA,CAAA,IAAEmJ,EAAS,OAAO,GAAA,CAAA,CAAC,CAAA,CAAA,CAAA,EAK/DrK,EAAAA,IAAC4J,IACE,SAAAa,GACCvJ,EAAAA,KAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,EAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,EAAA,EACvB,UAAU,iIAGV,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,oEACb,SAAA,CAAAlB,EAAAA,IAAC,KAAA,CAAG,UAAU,sCAAsC,SAAA,mBAAgB,EACpEA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb4K,EAAY,EAAI,EAChBE,EAAkB,EAAE,CACtB,EACA,UAAU,yFACV,MAAM,cAEN,SAAA9K,EAAAA,IAACmN,GAAA,CAAK,KAAM,EAAA,CAAI,CAAA,CAAA,CAClB,EACF,EAGAjM,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACZ,SAAA,CAAAyJ,GACCzJ,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACb,SAAA,CAAAlB,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAO6K,EACP,SAAW9C,GAAM+C,EAAkB/C,EAAE,OAAO,KAAK,EACjD,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAASyE,EAAA,EACnBzE,EAAE,MAAQ,WACZ6C,EAAY,EAAK,EACjBE,EAAkB,EAAE,EAExB,EACA,YAAY,kBACZ,UAAS,GACT,UAAU,0IAAA,CAAA,EAEZ5J,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAAlB,EAAAA,IAAC,SAAA,CACC,QAASwM,EACT,UAAU,6FACX,SAAA,QAAA,CAAA,EAGDxM,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb4K,EAAY,EAAK,EACjBE,EAAkB,EAAE,CACtB,EACA,UAAU,6EACX,SAAA,QAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAGDT,EAAS,IAAKlE,GAAY,CACzB,MAAMlF,EAAWsJ,GAAe,KAAOpE,EAAQ,GACzCiH,EAAYrC,IAAc5E,EAAQ,GAExC,OACEnG,EAAAA,IAAC,MAAA,CAEC,QAAS,IAAM,CAACiB,GAAYwL,EAAoBtG,EAAQ,EAAE,EAC1D,UAAW;AAAA;AAAA,wBAEPlF,EACE,oCACA,sBACJ;AAAA,sBAGF,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BAEZ,SAAA,CAAAiF,EAAQ,OACPnG,EAAAA,IAAC,MAAA,CACC,UAAU,4DACV,MAAO,CAAE,gBAAiBmG,EAAQ,KAAA,CAAM,CAAA,EAK5CjF,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACZ,SAAA,CAAAkM,EACClM,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAlB,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAOiL,EACP,SAAWlD,GAAMmD,EAAYnD,EAAE,OAAO,KAAK,EAC3C,UAAYA,GAAM,CACZA,EAAE,MAAQ,SAAS8E,GAAe1G,EAAQ,EAAE,EAC5C4B,EAAE,MAAQ,WACZiD,EAAa,IAAI,EACjBE,EAAY,EAAE,EAElB,EACA,QAAUnD,GAAMA,EAAE,gBAAA,EAClB,UAAS,GACT,UAAU,uIAAA,CAAA,EAEZ/H,EAAAA,IAAC,SAAA,CACC,QAAU+H,GAAM,CACdA,EAAE,gBAAA,EACF8E,GAAe1G,EAAQ,EAAE,CAC3B,EACA,UAAU,0CAEV,SAAAnG,EAAAA,IAACqN,GAAA,CAAM,KAAM,EAAA,CAAI,CAAA,CAAA,CACnB,CAAA,CACF,EAEAnM,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAlB,EAAAA,IAAC,OAAA,CAAK,UAAU,qCACb,SAAAmG,EAAQ,KACX,EACClF,GACCjB,EAAAA,IAAC,OAAA,CAAK,UAAU,oCAAoC,SAAA,QAAA,CAAM,CAAA,EAE9D,EAEFkB,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,wBACb,SAAA,CAAAiF,EAAQ,SAAS,OAAKA,EAAQ,WAAa,EAAI,IAAM,EAAA,EACxD,EACCA,EAAQ,KAAO,iBACb,OAAA,CAAK,UAAU,wBAAwB,SAAA,WAAA,CAAS,CAAA,CAAA,CAErD,CAAA,EACF,EAGC,CAACiH,GACAlM,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAlB,EAAAA,IAAC,SAAA,CACC,QAAU+H,GAAM,CACdA,EAAE,gBAAA,EACF6E,EAAgBzG,CAAO,CACzB,EACA,UAAU,yFACV,MAAM,SAEN,SAAAnG,EAAAA,IAACsN,GAAA,CAAM,KAAM,EAAA,CAAI,CAAA,CAAA,EAElBnH,EAAQ,KAAO,WACdnG,EAAAA,IAAC,SAAA,CACC,QAAU+H,GAAM4E,EAAoBxG,EAAQ,GAAI4B,CAAC,EACjD,UAAU,wFACV,MAAM,SAEN,SAAA/H,EAAAA,IAACuN,GAAA,CAAE,KAAM,EAAA,CAAI,CAAA,CAAA,CACf,CAAA,CAEJ,CAAA,CAAA,CAEJ,CAAA,EA5FKpH,EAAQ,EAAA,CA+FnB,CAAC,CAAA,EACH,EAGAjF,EAAAA,KAAC,MAAA,CAAI,UAAU,2DACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,CAAAlB,EAAAA,IAAC,IAAA,CAAE,UAAU,8DAA8D,SAAA,sBAAmB,EAC9FkB,EAAAA,KAAC,IAAA,CAAE,UAAU,wBACV,SAAA,CAAAmK,GACCnK,EAAAA,KAAC,OAAA,CAAK,UAAU,+CACd,SAAA,CAAAlB,EAAAA,IAACwN,GAAA,CAAQ,UAAU,0BAAA,CAA2B,EAAE,WAAA,EAElD,EAED,CAACnC,GAAkBF,GAClBjK,EAAAA,KAAC,OAAA,CACE,SAAA,CAAAiK,EAAgB,SAAS,OAAKA,EAAgB,WAAa,EAAI,GAAK,IAAI,SAAO,IAC/EsC,GAAoBtC,EAAgB,UAAW,CAAE,UAAW,GAAM,CAAA,EACrE,EAED,CAACE,GAAkB,CAACF,GACnBnL,EAAAA,IAAC,QAAK,SAAA,2BAAA,CAAyB,CAAA,CAAA,CAEnC,CAAA,EACF,EACAkB,EAAAA,KAAC,SAAA,CACC,QAAS4L,GACT,SAAUvB,GAAaF,GAAkB,CAACF,EAC1C,UAAW,sGACTI,GAAaF,GAAkB,CAACF,EAC5B,mDACA,0EACN,GAEC,SAAA,CAAAI,EAAYvL,EAAAA,IAACwN,IAAQ,UAAU,0BAAA,CAA2B,EAAKxN,EAAAA,IAAC0N,GAAA,CAAU,UAAU,aAAA,CAAc,EAAG,SAAA,CAAA,CAAA,CAExG,EACF,EACCjC,IACCzL,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAyB,SAAAyL,GAAgB,EAExDzL,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,iGAAA,CAErC,CAAA,CAAA,CACF,CAAA,CAAA,CAAA,CACF,CAEJ,CAAA,EACF,CAEJ,CC5aA,MAAM2N,GAKD,CACH,CACE,IAAK,iBACL,MAAO,YACP,KAAMC,GACN,YAAa,iCAAA,EAEf,CACE,IAAK,sBACL,MAAO,kBACP,KAAMC,GACN,YAAa,gCAAA,EAEf,CACE,IAAK,iBACL,MAAO,aACP,KAAMC,GACN,YAAa,6BAAA,EAEf,CACE,IAAK,mBACL,MAAO,cACP,KAAMC,GACN,YAAa,6BAAA,EAEf,CACE,IAAK,gBACL,MAAO,YACP,KAAMpQ,GACN,YAAa,uCAAA,CAEjB,EAEMqQ,GAAkD,CACtD,KAAMjR,GACN,SAAU+M,GACV,QAASmE,EACX,EAEA,SAASC,GAAeC,EAAsB,CAC5C,OAAIA,EAAQ,MAAQH,GAAaG,EAAQ,IAAI,EACpCH,GAAaG,EAAQ,IAAI,EAE3BH,GAAa,OACtB,CAEA,SAASI,GAAgBC,EAAwB,CAC/C,GAAI,CAACA,EAAQ,MAAO,iBACpB,MAAMC,EAAaX,GAAc,OAAO,CAAC,CAAE,IAAAhO,KAAU,CAAC0O,EAAO1O,CAAG,CAAC,EACjE,OAAI2O,EAAW,SAAW,EACjB,2BAELA,EAAW,SAAWX,GAAc,OAC/B,sCAEF,eAAeW,EAAW,IAAKC,GAAMA,EAAE,MAAM,YAAA,CAAa,EAAE,KAAK,IAAI,CAAC,EAC/E,CAEA,SAASC,GAAaC,EAAyB,CAC7C,MAAO,CAAC,GAAGA,CAAQ,EAAE,KAAK,CAACC,EAAGC,IAAM,CAClC,MAAMC,EAAU,CAAO,CAAC,CAACF,EAAE,OACrBG,EAAU,CAAO,CAAC,CAACF,EAAE,OAC3B,GAAIC,IAAYC,EAAS,OAAOA,EAAUD,EAC1C,MAAME,EAAYC,GAAkB,CAClC,OAAQA,EAAA,CACN,IAAK,OACH,MAAO,GACT,IAAK,WACH,MAAO,GACT,IAAK,UACH,MAAO,GACT,QACE,MAAO,EAAA,CAEb,EACMC,EAAYF,EAASJ,EAAE,IAAI,EAAII,EAASH,EAAE,IAAI,EACpD,OAAIK,IAAc,EAAUA,EACrBN,EAAE,KAAK,cAAcC,EAAE,IAAI,CACpC,CAAC,CACH,CAEA,SAASM,GAAcd,EAAsB,CAC3C,GAAIA,EAAQ,MACV,OAAOA,EAAQ,MAEjB,OAAQA,EAAQ,KAAA,CACd,IAAK,OACH,MAAO,UACT,IAAK,WACH,MAAO,UACT,QACE,MAAO,SAAA,CAEb,CAEO,SAASe,IAAuB,CACrC,KAAM,CACJ,SAAAT,EACA,gBAAAU,EACA,SAAAC,EACA,QAAAC,EACA,iBAAAC,EACA,gBAAAC,EACA,sBAAAC,CAAA,EACEC,GAAiB1M,IAAW,CAC9B,SAAUA,EAAM,SAChB,gBAAiBA,EAAM,gBACvB,SAAUA,EAAM,SAChB,QAASA,EAAM,QACf,iBAAkBA,EAAM,iBACxB,gBAAiBA,EAAM,gBACvB,sBAAuBA,EAAM,qBAAA,EAC7B,EACI,CAAC0H,EAAMC,CAAO,EAAIpM,EAAAA,SAAS,EAAK,EAChC,CAACqM,EAAUC,CAAW,EAAItM,EAAAA,SAAS,EAAK,EACxC,CAACoR,EAASC,CAAU,EAAIrR,EAAAA,SAAS,EAAE,EACnC,CAACsR,EAAkBC,CAAmB,EAAIvR,EAAAA,SAAwB,IAAI,EAE5E4G,EAAAA,UAAU,IAAM,CACd4K,GAAA,CACF,EAAG,CAAA,CAAE,EAEL5K,EAAAA,UAAU,IAAM,CACV,CAACuF,GAAQE,IACXC,EAAY,EAAK,EACjB+E,EAAW,EAAE,EAEjB,EAAG,CAAClF,EAAME,CAAQ,CAAC,EAEnB,MAAMoF,EAAgBhQ,EAAAA,QAAQ,IACrB0O,EAAS,KAAMN,GAAYA,EAAQ,KAAOgB,CAAe,GAAKV,EAAS,CAAC,EAC9E,CAACA,EAAUU,CAAe,CAAC,EAExBa,EAAiBjQ,EAAAA,QAAQ,IAAMyO,GAAaC,CAAQ,EAAG,CAACA,CAAQ,CAAC,EAEjEwB,EAAe,MAAOC,GAAsB,CAChD,GAAIA,IAAcf,EAAiB,CACjCzE,EAAQ,EAAK,EACb,MACF,CACA,GAAI,CACFmF,EAAoBK,CAAS,EAC7B,MAAMZ,EAAiBY,CAAS,EAChCxF,EAAQ,EAAK,CACf,OAASrF,EAAO,CACd,QAAQ,MAAM,2BAA4BA,CAAK,CACjD,QAAA,CACEwK,EAAoB,IAAI,CAC1B,CACF,EAEMM,EAAe,SAAY,CAC/B,MAAMC,EAAOV,EAAQ,KAAA,EACrB,GAAKU,EACL,GAAI,CACF,MAAMhK,EAAI,SAAS,OAAO,CAAE,KAAAgK,EAAM,EAClC,MAAMX,GAAgB,WAAW,aAAa,EAAI,EAClD7E,EAAY,EAAK,EACjB+E,EAAW,EAAE,CACf,OAAStK,EAAO,CACd,QAAQ,MAAM,2BAA4BA,CAAK,CACjD,CACF,EAEMgL,EACJ,CAACN,GACDA,EAAc,KAAO,WACrBA,EAAc,KAAK,YAAA,IAAkB,UAEjC9C,GAAY,CAACoD,EAEbnD,GAAgBD,GAAY,aAAe,iBAEjD,OACE/L,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAA,EAAAA,KAACC,EAAO,OAAP,CACC,QAAS,IAAMuJ,EAAS4F,GAAM,CAACA,CAAC,EAChC,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW,qBAAqBpD,EAAa,oIAC7C,MAAO6C,EAAgB,GAAGA,EAAc,IAAI,WAAa,WAEvD,SAAA,EAAA,IAAM,CACN,MAAM/O,EAAO+O,EAAgB7B,GAAe6B,CAAa,EAAI9B,GAC7D,OAAOjO,EAAAA,IAACgB,EAAA,CAAK,KAAM,EAAA,CAAI,CACzB,GAAA,EACCiM,UACE,OAAA,CAAK,UAAU,sBACb,SAAA8C,EAAgBA,EAAc,KAAO,UAAA,CACxC,EAED,CAACM,GAAoBN,GACpB/P,EAAAA,IAAC,OAAA,CACC,UAAU,iEACV,MAAO,CAAE,gBAAiBiP,GAAcc,CAAa,CAAA,CAAE,CAAA,EAG1DV,GAAWrP,EAAAA,IAACwN,GAAA,CAAQ,KAAM,GAAI,UAAU,4BAAA,CAA6B,CAAA,CAAA,CAAA,EAGxExN,EAAAA,IAAC4J,IACE,SAAAa,GACCvJ,EAAAA,KAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,CAAA,EACvB,UAAU,kIAEV,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,oEACb,SAAA,CAAAlB,EAAAA,IAAC,OAAA,CAAK,UAAU,gDAAgD,SAAA,WAAQ,EACxEA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM4K,EAAa0F,GAAM,CAACA,CAAC,EACpC,UAAU,4FACV,MAAM,qBAEN,SAAAtQ,EAAAA,IAACmN,GAAA,CAAK,KAAM,EAAA,CAAI,CAAA,CAAA,CAClB,EACF,EAECxC,GACCzJ,EAAAA,KAAC,MAAA,CAAI,UAAU,kDACb,SAAA,CAAAlB,EAAAA,IAAC,QAAA,CACC,MAAO0P,EACP,SAAW3H,GAAM4H,EAAW5H,EAAE,OAAO,KAAK,EAC1C,YAAY,eACZ,UAAU,2IACV,UAAS,GACT,UAAYA,GAAM,CACZA,EAAE,MAAQ,QACZoI,EAAA,EACSpI,EAAE,MAAQ,WACnB6C,EAAY,EAAK,EACjB+E,EAAW,EAAE,EAEjB,CAAA,CAAA,EAEFzO,EAAAA,KAAC,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAlB,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb4K,EAAY,EAAK,EACjB+E,EAAW,EAAE,CACf,EACA,UAAU,4CACX,SAAA,QAAA,CAAA,EAGD3P,EAAAA,IAAC,SAAA,CACC,QAASmQ,EACT,UAAU,sFACX,SAAA,QAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAGFjP,EAAAA,KAAC,MAAA,CAAI,UAAU,uDACZ,SAAA,CAAA8O,EAAe,IAAK7B,GAAY,CAC/B,MAAMnN,EAAOkN,GAAeC,CAAO,EAC7BlN,EAAWkN,EAAQ,KAAOgB,EAC1Bd,EAASe,EAASjB,EAAQ,EAAE,EAC5BG,EAAaD,EACfV,GAAc,OAAO,CAAC,CAAE,IAAAhO,CAAA,IAAU,CAAC0O,EAAO1O,CAAG,CAAC,EAC9C,CAAA,EAEJ,OACEuB,EAAAA,KAAC,SAAA,CAEC,QAAS,IAAM+O,EAAa9B,EAAQ,EAAE,EACtC,UAAW,gDACTlN,EACI,+CACA,oDACN,GAEA,SAAA,CAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,wCACb,SAAA,CAAAlB,EAAAA,IAAC,OAAA,CACC,UAAU,uCACV,MAAO,CAAE,gBAAiBiP,GAAcd,CAAO,CAAA,CAAE,CAAA,EAEnDnO,EAAAA,IAACgB,EAAA,CAAK,KAAM,GAAI,UAAU,gBAAgB,EAC1ChB,EAAAA,IAAC,OAAA,CAAK,UAAU,sCAAuC,WAAQ,KAAK,EACnEiB,GAAYjB,EAAAA,IAACqN,GAAA,CAAM,KAAM,GAAI,UAAU,gBAAgB,EACvDuC,IAAqBzB,EAAQ,IAC5BnO,MAACwN,IAAQ,KAAM,GAAI,UAAU,4BAAA,CAA6B,CAAA,EAE9D,EACAxN,EAAAA,IAAC,OAAI,UAAU,0CACZ,WAAQ,aAAeoO,GAAgBC,CAAM,EAChD,EACAnN,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACZ,SAAA,CAAAyM,GAAc,IAAI,CAAC,CAAE,IAAAhO,EAAK,MAAA4Q,EAAO,KAAMC,MAAiB,CACvD,MAAMC,GAAUpC,EAASA,EAAO1O,CAAG,EAAI,GACvC,OACEuB,EAAAA,KAAC,OAAA,CAEC,UAAW,4EACTuP,GACI,2DACA,qFACN,GACA,MAAO9C,GAAc,KAAM+C,GAAMA,EAAE,MAAQ/Q,CAAG,GAAG,YAEjD,SAAA,CAAAK,EAAAA,IAACwQ,GAAA,CAAW,KAAM,EAAA,CAAI,EACrBD,CAAA,CAAA,EATI,GAAGpC,EAAQ,EAAE,IAAIxO,CAAG,EAAA,CAY/B,CAAC,EACA2O,EAAW,SAAW,GACrBpN,EAAAA,KAAC,OAAA,CAAK,UAAU,oIACd,SAAA,CAAAlB,EAAAA,IAAC0J,GAAA,CAAO,KAAM,EAAA,CAAI,EAAE,WAAA,CAAA,CAEtB,CAAA,CAAA,CAEJ,CAAA,CAAA,EA/CKyE,EAAQ,EAAA,CAkDnB,CAAC,EAEA6B,EAAe,SAAW,SACxB,MAAA,CAAI,UAAU,8CAA8C,SAAA,6CAAA,CAE7D,CAAA,EAEJ,EAECT,GACCrO,EAAAA,KAAC,MAAA,CAAI,UAAU,sGACb,SAAA,CAAAlB,EAAAA,IAAC0J,GAAA,CAAO,KAAM,GAAI,UAAU,SAAS,SACpC,MAAA,CACC,SAAA,CAAA1J,EAAAA,IAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,2BAAwB,EACpEkB,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACZ,SAAA,CAAAqO,EAAgB,OAAO,QAAQ,IAAK,GAAG,EAAE,gCAAA,EAC5C,EACAvP,EAAAA,IAAC,SAAA,CACC,QAASwP,EACT,UAAU,iEACX,SAAA,SAAA,CAAA,CAED,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CAAA,CAEJ,CAEJ,CAAA,EACF,CAEJ,CC7WA,MAAMmB,GAAwF,CAC5F,CACE,IAAK,QACL,MAAO,sBACP,YAAa,8CAAA,EAEf,CACE,IAAK,kBACL,MAAO,iBACP,YAAa,2CAAA,EAEf,CACE,IAAK,gBACL,MAAO,wBACP,YAAa,qDAAA,EAEf,CACE,IAAK,aACL,MAAO,mBACP,YAAa,sDAAA,CAEjB,EAEO,SAASC,IAAoB,CAClC,KAAM,CAAE,WAAAC,EAAY,kBAAAhO,EAAmB,cAAAiO,EAAe,mBAAAC,CAAA,EAAuBjO,GAAA,EACvE,CAAC2H,EAAMC,CAAO,EAAIpM,EAAAA,SAAS,EAAK,EAChC,CAACqM,EAAUC,CAAW,EAAItM,EAAAA,SAAS,EAAK,EACxC,CAAC8R,EAAMY,CAAO,EAAI1S,EAAAA,SAAS,EAAE,EAC7B,CAAC2S,EAAOC,CAAQ,EAAI5S,EAAAA,SAAS,SAAS,EACtC,CAAC6S,EAAiBC,CAAkB,EAAI9S,EAAAA,SAAmC,CAAA,CAAE,EAC7E,CAAC+S,EAAqBC,CAAsB,EAAIhT,EAAAA,SAEpD,CAAA,CAAE,EAEEiT,EAAmB/S,cAAY,MAAOgT,GAA2C,CACrF,GAAI,CACF,MAAMC,EAAW,MAAMrL,EAAI,WAAW,eAAeoL,CAAW,EAChE,OAAO,MAAM,QAAQC,GAAU,WAAW,EAAIA,EAAS,YAAc,CAAA,CACvE,OAASpM,EAAO,CACd,eAAQ,MAAM,yCAA0CA,CAAK,EACtD,CAAA,CACT,CACF,EAAG,CAAA,CAAE,EAECqM,EAAyBlT,cAAY,MAAOgT,GAAwB,CACxE,MAAMG,EAAc,MAAMJ,EAAiBC,CAAW,EACtDJ,EAAoB3L,IAAU,CAC5B,GAAGA,EACH,CAAC+L,CAAW,EAAGG,CAAA,EACf,CACJ,EAAG,CAACJ,CAAgB,CAAC,EAEfK,EAAyBpT,cAAY,MAAOgT,GAAwB,CACxE,GAAI,CACF,MAAMK,EAAU,MAAMzL,EAAI,WAAW,mBAAmBoL,CAAW,EAC/D,MAAM,QAAQK,CAAO,GACvBP,EAAwB7L,IAAU,CAChC,GAAGA,EACH,CAAC+L,CAAW,EAAGK,CAAA,EACf,CAEN,OAASxM,EAAO,CACd,QAAQ,MAAM,mCAAoCA,CAAK,CACzD,CACF,EAAG,CAAA,CAAE,EAECyM,EAAiBtT,EAAAA,YAAY,SAAY,CAC7C,GAAI,CACF,KAAM,CAAC2E,EAAM2I,CAAM,EAAI,MAAM,QAAQ,IAAI,CACvC1F,EAAI,WAAW,KAAA,EACfA,EAAI,WAAW,UAAA,CAAU,CAC1B,EAED,GAAI,MAAM,QAAQjD,CAAI,EAAG,CACvB,MAAM4O,EAAY5O,EAClB2N,EAAciB,CAAS,EACvB,MAAMC,EAAoB,MAAM,QAAQ,IACtCD,EAAU,IAAKE,GAAcV,EAAiBU,EAAU,EAAE,CAAC,CAAA,EAEvDC,EAAgC,CAAA,EACtCH,EAAU,QAAQ,CAACE,EAAWzK,IAAU,CACtC0K,EAAID,EAAU,EAAE,EAAID,EAAkBxK,CAAK,GAAK,CAAA,CAClD,CAAC,EACD4J,EAAmBc,CAAG,CACxB,CAEIpG,IACFiF,EAAmBjF,CAAuB,EAC1C,MAAM4F,EAAuB5F,EAAO,EAAE,EACtC,MAAM8F,EAAuB9F,EAAO,EAAE,EAE1C,OAASzG,EAAO,CACd,QAAQ,MAAM,6BAA8BA,CAAK,CACnD,CACF,EAAG,CAACkM,EAAkBG,EAAwBE,EAAwBb,EAAoBD,CAAa,CAAC,EAExG5L,EAAAA,UAAU,IAAM,CACT4M,EAAA,CACP,EAAG,CAACA,CAAc,CAAC,EAEnB5M,EAAAA,UAAU,IAAM,CACd,MAAMiN,EAAkBtJ,GAAU,GAChC,6BACCuJ,GAAY,CACNA,GAAS,aACdd,EAAwB7L,IAAU,CAChC,GAAGA,EACH,CAAC2M,EAAQ,WAAW,EAAG,CACrB,GAAI3M,EAAK2M,EAAQ,WAAW,GAAG,OAAQC,GAAUA,EAAM,aAAeD,EAAQ,UAAU,GAAK,CAAA,EAC7F,CAAE,WAAYA,EAAQ,WAAY,QAASA,EAAQ,OAAA,CAAQ,CAC7D,EACA,CACJ,CAAA,EAEF,MAAO,IAAM,CACXD,EAAA,CACF,CACF,EAAG,CAAA,CAAE,EAEL,MAAMlC,GAAe,MAAOgC,GAA6B,CACvD,GAAI,CACF,MAAMnG,EAAS,MAAM1F,EAAI,WAAW,UAAU6L,EAAU,EAAE,EAExDlB,EADEjF,GAGiBmG,CAFuB,EAI5C,MAAMP,EAAuBO,EAAU,EAAE,EACzC,MAAML,EAAuBK,EAAU,EAAE,EACzCvH,EAAQ,EAAK,CACf,OAASrF,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,CACxD,CACF,EAEM8K,GAAe,SAAY,CAC/B,GAAKC,EAAK,OACV,GAAI,CACF,MAAM6B,EAAY,MAAM7L,EAAI,WAAW,OAAO,CAAE,KAAMgK,EAAK,OAAQ,MAAAa,EAAO,EACtEgB,IACF,MAAMH,EAAA,EACN,MAAMJ,EAAuBO,EAAU,EAAE,EACzC,MAAML,EAAuBK,EAAU,EAAE,GAE3CjB,EAAQ,EAAE,EACVpG,EAAY,EAAK,EACjBF,EAAQ,EAAK,CACf,OAASrF,EAAO,CACd,QAAQ,MAAM,8BAA+BA,CAAK,CACpD,CACF,EAEMiN,EAAkBzB,EAAW,KAAM0B,GAAMA,EAAE,KAAO1P,CAAiB,EACnE2P,EAAoBF,EAAkBnB,EAAgBmB,EAAgB,EAAE,GAAK,CAAA,EAAK,CAAA,EAClFG,EAAwBH,EAAkBjB,EAAoBiB,EAAgB,EAAE,GAAK,CAAA,EAAK,CAAA,EAC1FI,EAAwBC,GAC5BF,EAAsB,KAAMJ,GAAUA,EAAM,aAAeM,CAAU,GAAG,SAAW,CAAA,EAE/EC,EAAyB,MAAOC,GAAiC,CACrE,GAAI,CAACP,EAAiB,OACtB,MAAMQ,EAAUN,EAAkB,SAASK,CAAa,EACxD,GAAI,CACF,MAAMpB,EAAW,MAAMrL,EAAI,WAAW,cAAckM,EAAgB,GAAIO,EAAe,CAACC,CAAO,EAC/F1B,EAAoB3L,IAAU,CAC5B,GAAGA,EACH,CAAC6M,EAAgB,EAAE,EAAG,MAAM,QAAQb,GAAU,WAAW,EAAIA,EAAS,YAAc,CAAA,CAAC,EACrF,EACF,MAAMG,EAAuBU,EAAgB,EAAE,CACjD,OAASjN,EAAO,CACd,QAAQ,MAAM,yCAA0CA,CAAK,CAC/D,CACF,EAEM0N,EAAqB,MAAOF,EAA8BG,IAAmB,CACjF,GAAKV,EACL,GAAI,CACF,MAAMT,EAAU,MAAMzL,EAAI,WAAW,qBAAqBkM,EAAgB,GAAIO,EAAeG,CAAM,EAC/F,MAAM,QAAQnB,CAAO,GACvBP,EAAwB7L,IAAU,CAChC,GAAGA,EACH,CAAC6M,EAAgB,EAAE,EAAGT,CAAA,EACtB,CAEN,OAASxM,EAAO,CACd,QAAQ,MAAM,oCAAqCA,CAAK,CAC1D,CACF,EAEM4N,EACJ,CAACX,GACDA,EAAgB,KAAO,WACvBA,EAAgB,KAAK,YAAA,IAAkB,UAEnCrF,GAAY,CAACgG,EAEb/F,GAAgBD,GAAY,aAAe,iBAEjD,OACE/L,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAA,EAAAA,KAACC,EAAO,OAAP,CACC,QAAS,IAAMuJ,EAAQ,CAACD,CAAI,EAC5B,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW,8BAA8ByC,EAAa,oIACtD,MAAM,+BAEN,SAAA,CAAAlN,EAAAA,IAACkT,GAAA,CAAM,KAAM,EAAA,CAAI,EAChBjG,IACCjN,EAAAA,IAAC,OAAA,CAAK,UAAU,sBAAuB,SAAAsS,GAAiB,MAAQ,UAAU,EAE3E,CAACW,GAAsBX,GAAiB,OACvCtS,EAAAA,IAAC,MAAA,CACC,UAAU,8CACV,MAAO,CAAE,gBAAiBsS,EAAgB,KAAA,CAAM,CAAA,CAClD,CAAA,CAAA,EAIJtS,EAAAA,IAAC4J,IACE,SAAAa,GACCvJ,EAAAA,KAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,EAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,EAAA,EACvB,UAAU,iIAEV,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,oEACb,SAAA,CAAAlB,EAAAA,IAAC,KAAA,CAAG,UAAU,sCAAsC,SAAA,aAAU,EAC9DA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb4K,EAAY,EAAI,EAChBoG,EAAQ,EAAE,EACVE,EAAS,SAAS,CACpB,EACA,UAAU,yFAEV,SAAAlR,EAAAA,IAACmN,GAAA,CAAK,KAAM,EAAA,CAAI,CAAA,CAAA,CAClB,EACF,EAEAjM,EAAAA,KAAC,MAAA,CAAI,UAAU,2BACZ,SAAA,CAAAyJ,GACCzJ,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACb,SAAA,CAAAlB,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAOoQ,EACP,SAAWrI,GAAMiJ,EAAQjJ,EAAE,OAAO,KAAK,EACvC,YAAY,iBACZ,UAAS,GACT,UAAU,0IAAA,CAAA,EAEZ7G,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAlB,EAAAA,IAAC,QAAA,CAAM,UAAU,wBAAwB,SAAA,QAAK,EAC9CA,EAAAA,IAAC,QAAA,CACC,KAAK,QACL,MAAOiR,EACP,SAAWlJ,GAAMmJ,EAASnJ,EAAE,OAAO,KAAK,EACxC,UAAU,wDAAA,CAAA,CACZ,EACF,EACA7G,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAAlB,EAAAA,IAAC,SAAA,CACC,QAASmQ,GACT,UAAU,6FACX,SAAA,QAAA,CAAA,EAGDnQ,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb4K,EAAY,EAAK,EACjBoG,EAAQ,EAAE,CACZ,EACA,UAAU,6EACX,SAAA,QAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAGDH,EAAW,IAAKoB,GAAc,CAC7B,MAAMhR,EAAWgR,EAAU,KAAOpP,EAClC,OACE3B,EAAAA,KAAC,SAAA,CAEC,QAAS,IAAM+O,GAAagC,CAAS,EACrC,UAAW,oGACThR,EAAW,oCAAsC,sBACnD,GAEA,SAAA,CAAAjB,EAAAA,IAAC,MAAA,CACC,UAAU,8CACV,MAAO,CAAE,gBAAiBiS,EAAU,KAAA,CAAM,CAAA,EAE5C/Q,EAAAA,KAAC,MAAA,CAAI,UAAU,SACb,SAAA,CAAAlB,EAAAA,IAAC,MAAA,CAAI,UAAU,6CAA8C,SAAAiS,EAAU,KAAK,EAC5EjS,MAAC,OAAI,UAAU,iCACZ,WAAU,MAAQ,GAAGiS,EAAU,MAAM,OAAO,CAAC,EAAE,aAAa,GAAGA,EAAU,MAAM,MAAM,CAAC,CAAC,SAAW,eAAA,CACrG,CAAA,EACF,EACChR,GAAYjB,EAAAA,IAAC,OAAA,CAAK,UAAU,wBAAwB,SAAA,QAAA,CAAM,CAAA,CAAA,EAhBtDiS,EAAU,EAAA,CAmBrB,CAAC,EAEApB,EAAW,SAAW,GAAK,CAAClG,GAC3B3K,EAAAA,IAAC,MAAA,CAAI,UAAU,4BAA4B,SAAA,mBAAA,CAAiB,CAAA,EAEhE,EAECsS,GACCpR,EAAAA,KAAC,MAAA,CAAI,UAAU,iDACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,gDAAgD,SAAA,CAAA,mBAC7CoR,EAAgB,IAAA,EACnC,QACC,MAAA,CAAI,UAAU,iBACZ,SAAA3B,GAAmB,IAAKwC,GAAW,CAClC,MAAML,EAAUN,EAAkB,SAASW,EAAO,GAAG,EACrD,OACEjS,EAAAA,KAAC,QAAA,CAEC,UAAU,uJAEV,SAAA,CAAAlB,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,UAAU,qFACV,QAAS8S,EACT,SAAU,IAAMF,EAAuBO,EAAO,GAAG,CAAA,CAAA,EAEnDjS,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAlB,EAAAA,IAAC,MAAA,CAAI,UAAU,oCACZ,SAAAmT,EAAO,MACV,EACAnT,EAAAA,IAAC,IAAA,CAAE,UAAU,qCACV,WAAO,YACV,EACH0S,EAAqBS,EAAO,GAAG,EAAE,OAAS,GACzCjS,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAlB,EAAAA,IAAC,OAAA,CAAK,UAAU,oDAAoD,SAAA,gBAEpE,EACAA,EAAAA,IAAC,MAAA,CAAI,UAAU,uBACZ,SAAA0S,EAAqBS,EAAO,GAAG,EAAE,IAAKH,GACrC9R,EAAAA,KAAC,OAAA,CAEC,UAAU,gIACV,MAAO8R,EAEP,SAAA,CAAAhT,EAAAA,IAAC,QAAK,UAAU,yBAA0B,WAAO,QAAQ,eAAgB,EAAE,EAAE,EAC7EA,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAU+H,GAAM,CACdA,EAAE,eAAA,EACFA,EAAE,gBAAA,EACGgL,EAAmBI,EAAO,IAAKH,CAAM,CAC5C,EACA,UAAU,0GACV,aAAY,UAAUA,CAAM,SAASG,EAAO,KAAK,GAClD,SAAA,GAAA,CAAA,CAED,CAAA,EAhBK,GAAGA,EAAO,GAAG,IAAIH,CAAM,EAAA,CAkB/B,CAAA,CACH,CAAA,CAAA,CACF,CAAA,CAAA,CAEA,CAAA,CAAA,EA9CKG,EAAO,GAAA,CAiDlB,CAAC,CAAA,CACH,CAAA,EACF,EAGFnT,EAAAA,IAAC,OAAI,UAAU,iDACb,eAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,+DAAA,CAErC,CAAA,CACF,CAAA,CAAA,CAAA,CACF,CAEJ,CAAA,EACF,CAEJ,CC9XA,MAAMoT,GAAc,+BACdC,GAAY,OAAO,OAAW,IAE9BC,GAAiB,IACjB,CAACD,IAAa,OAAO,OAAO,YAAe,YAGxC,OAAO,WAAW,8BAA8B,EAAE,QAFhD,OAEmE,QAGxEE,GAAcC,GAAgC,CAClD,GAAI,OAAO,SAAa,IAAa,OACrC,MAAMC,EAAWD,IAAe,SAAWF,GAAA,EAAmBE,EAC9D,SAAS,gBAAgB,QAAQ,MAAQC,EACzC,SAAS,gBAAgB,aAAa,sBAAuBA,CAAQ,CACvE,EAEMC,IAAsC,IAAM,CAChD,GAAI,CAACL,GAAW,MAAO,SACvB,MAAMM,EAAS,OAAO,aAAa,QAAQP,EAAW,EACtD,OAAIO,IAAW,SAAWA,IAAW,QAAUA,IAAW,SACjDA,EAEF,QACT,GAAA,EAEMC,GAAiCF,KAAsB,SAAWJ,GAAA,EAAmBI,GACvF,OAAO,SAAa,KACtBH,GAAWG,EAAiB,EAGvB,MAAMG,GAAgBC,GAAmB,CAACC,EAAKC,KAAS,CAC7D,WAAYN,GACZ,SAAUE,GACV,cAAgBJ,GAAe,CACzBH,IACF,OAAO,aAAa,QAAQD,GAAaI,CAAU,EAErDD,GAAWC,CAAU,EACrB,MAAMC,EAAWD,IAAe,SAAWF,GAAA,EAAmBE,EAC9DO,EAAI,CAAE,WAAAP,EAAY,SAAAC,EAAU,CAC9B,EACA,gBAAiB,IAAM,CACrB,MAAMQ,EAA2B,CAAC,SAAU,QAAS,MAAM,EACrDhO,EAAU+N,IAAM,WAChBrO,EAAOsO,GAAOA,EAAM,QAAQhO,CAAO,EAAI,GAAKgO,EAAM,MAAM,EAC9DD,EAAA,EAAM,cAAcrO,CAAI,CAC1B,CACF,EAAE,EAEF,GAAI0N,IAAa,OAAO,OAAO,YAAe,WAAY,CACxD,MAAMa,EAAa,OAAO,WAAW,8BAA8B,EAC7DC,EAAe,IAAM,CACzB,KAAM,CAAE,WAAAX,CAAA,EAAeK,GAAc,SAAA,EACrC,GAAIL,IAAe,SAAU,CAC3BD,GAAW,QAAQ,EACnB,MAAME,EAAWH,GAAA,EACjBO,GAAc,SAAS,CAAE,SAAAJ,EAAU,CACrC,CACF,EACA,GAAI,CACFS,EAAW,iBAAiB,SAAUC,CAAY,CACpD,MAAQ,CAEND,EAAW,YAAYC,CAAY,CACrC,CACF,CC1EA,MAAMC,GAID,CACH,CAAE,GAAI,SAAU,MAAO,OAAQ,KAAMC,EAAA,EACrC,CAAE,GAAI,QAAS,MAAO,QAAS,KAAMC,EAAA,EACrC,CAAE,GAAI,OAAQ,MAAO,OAAQ,KAAM9W,EAAA,CACrC,EAEO,SAAS+W,IAAgB,CAC9B,MAAMf,EAAaK,GAAe9Q,GAAUA,EAAM,UAAU,EACtD0Q,EAAWI,GAAe9Q,GAAUA,EAAM,QAAQ,EAClDyR,EAAgBX,GAAe9Q,GAAUA,EAAM,aAAa,EAC5D0R,EAAkBZ,GAAe9Q,GAAUA,EAAM,eAAe,EAEtE,OACE/C,EAAAA,IAACZ,GAAA,CAAY,GAAG,iBACd,SAAAY,EAAAA,IAAC,MAAA,CACC,UAAU,oFACV,KAAK,aACL,aAAW,mBACX,MAAO,UAAUwT,IAAe,SAAW,SAASC,CAAQ,IAAMD,CAAU,GAC5E,cAAeiB,EAEd,SAAAL,GAAQ,IAAKjB,GAAW,CACvB,MAAMnS,EAAOmS,EAAO,KACdlS,EAAWuS,IAAeL,EAAO,IAAOK,IAAe,UAAYL,EAAO,KAAOM,EACvF,OACEvS,EAAAA,KAACC,EAAO,OAAP,CAEC,KAAK,SACL,QAAS,IAAMqT,EAAcrB,EAAO,EAAE,EACtC,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW,iPACTlS,EAAW,oBAAsB,YACnC,GACA,KAAK,QACL,eAAcA,EAEd,SAAA,CAAAjB,EAAAA,IAACgB,EAAA,CAAK,KAAM,EAAA,CAAI,EAChBhB,EAAAA,IAAC,OAAA,CAAK,UAAU,mBAAoB,WAAO,MAAM,EAChDiB,GACCjB,EAAAA,IAACmB,EAAO,KAAP,CACC,SAAS,uBACT,UAAU,6EACV,WAAY,CAAE,KAAM,SAAU,UAAW,IAAK,QAAS,EAAA,CAAG,CAAA,CAC5D,CAAA,EAlBGgS,EAAO,EAAA,CAsBlB,CAAC,CAAA,CAAA,EAEL,CAEJ,CCvDA,MAAMuB,GAAgB,KAEtB,SAASC,GAAaC,EAA6C,CACjE,OAAQA,EAAA,CACN,IAAK,OACH,MAAO,2BACT,IAAK,WACH,MAAO,6BACT,QACE,MAAO,8BAAA,CAEb,CAEA,SAASC,GAAaD,EAA6C,CACjE,OAAQA,EAAA,CACN,IAAK,OACH,MAAO,YACT,IAAK,WACH,MAAO,QACT,QACE,MAAO,OAAA,CAEb,CAEO,SAASE,IAAuB,CACrC,MAAMC,EAAcnS,GAAcG,GAAUA,EAAM,QAAQ,EACpD,CAACiS,EAAOC,CAAQ,EAAI3W,EAAAA,SAAqC,IAAI,EAC7D,CAAC+Q,EAAS6F,CAAU,EAAI5W,EAAAA,SAAS,EAAK,EAEtC6W,EAAW3W,EAAAA,YAAY,SAAY,CACvC,GAAI,CAACuW,EAAa,CAChBE,EAAS,IAAI,EACb,MACF,CACAC,EAAW,EAAI,EACf,GAAI,CACF,MAAMxT,EAAS,MAAM0E,EAAI,QAAQ,SAAS,MAAM2O,CAAW,EAC3DE,EAASvT,GAAU,IAAI,CACzB,OAAS2D,EAAO,CACd,QAAQ,KAAK,iCAAkCA,CAAK,CACtD,QAAA,CACE6P,EAAW,EAAK,CAClB,CACF,EAAG,CAACH,CAAW,CAAC,EAEhB7P,EAAAA,UAAU,IAAM,CACdiQ,EAAA,CACF,EAAG,CAACA,CAAQ,CAAC,EAEbjQ,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC6P,EAAa,OAClB,MAAMK,EAAQ,OAAO,YAAYD,EAAUT,EAAa,EACxD,MAAO,IAAM,OAAO,cAAcU,CAAK,CACzC,EAAG,CAACL,EAAaI,CAAQ,CAAC,EAE1B,MAAM5E,EAAQxQ,EAAAA,QAAQ,IAChBsP,EAAgB,YACf2F,EACEH,GAAaG,EAAM,KAAK,EADZ,UAElB,CAACA,EAAO3F,CAAO,CAAC,EAEbgG,EAAUtV,EAAAA,QAAQ,IAAM,CAC5B,GAAI,CAACiV,EAAO,MAAO,iDACnB,MAAMM,EAAQ,CAACN,EAAM,OAAO,EAC5B,OAAIA,EAAM,SAAS,OAAS,GAC1BM,EAAM,KAAK,aAAaN,EAAM,SAAS,MAAM,EAAG,CAAC,EAAE,IAAI5R,GAAKA,EAAE,IAAI,EAAE,KAAK,IAAI,CAAC,EAAE,EAE9E4R,EAAM,gBAAgB,OAAS,GACjCM,EAAM,KAAK,cAAcN,EAAM,gBAAgB,MAAM,EAAG,CAAC,EAAE,IAAI5R,GAAKA,EAAE,IAAI,EAAE,KAAK,IAAI,CAAC,EAAE,EAE1FkS,EAAM,KAAK,GAAGN,EAAM,WAAW,EACxBM,EAAM,KAAK;AAAA,CAAI,CACxB,EAAG,CAACN,CAAK,CAAC,EAEJO,EAAaP,EAAQL,GAAaK,EAAM,KAAK,EAAI,6BAEvD,OACE9T,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,UAAW,gGAAgGqU,CAAU,GACrH,MAAOF,EACP,QAASF,EAET,SAAA,CAAAnV,EAAAA,IAAC,QAAK,UAAU,kDACd,eAAC,OAAA,CAAK,UAAU,kCAAkC,CAAA,CACpD,EACAA,EAAAA,IAAC,QAAM,SAAAuQ,CAAA,CAAM,CAAA,CAAA,CAAA,CAGnB,CC1EO,SAASiF,IAAgB,CAC9B,KAAM,CAAE,SAAA7S,CAAA,EAAaC,GAAA,EACf,CAAC6H,EAAMC,CAAO,EAAIpM,EAAAA,SAAS,EAAK,EAChC,CAACmX,EAAUC,CAAW,EAAIpX,EAAAA,SAAiC,IAAI,EAC/D,CAACqX,EAAQC,CAAS,EAAItX,WAAwB,CAClD,IAAK,GACL,QAAS,KACT,UAAW,GACX,eAAgB,GAChB,QAAS,MACT,OAAQ,EAAA,CACT,EACK,CAACuX,EAAcC,CAAe,EAAIxX,EAAAA,SAAS,CAAC,EAGlDgI,GAA6B,mBAAqBI,GAAS,EAErD,CAACA,EAAK,OAASA,EAAK,QAAU,IAAMA,EAAK,QAAU/D,KACrD+S,EAAYhP,CAAI,EAChBoP,GAAiBpP,EAAK,KAAO,IAAMA,EAAK,UAAY,IAAMA,EAAK,gBAAkB,EAAE,EAEvF,EAAG,CAAC/D,CAAQ,CAAC,EAGbuC,EAAAA,UAAU,IAAM,CAKhB,EAAG,CAACvC,CAAQ,CAAC,EAEb,MAAMoT,EAAe,MAAOpW,EAA0BmC,IAAe,CACnE,MAAMkU,EAAY,CAAE,GAAGL,EAAQ,CAAChW,CAAG,EAAGmC,CAAA,EACtC8T,EAAUI,CAAS,CAGrB,EAEA,OACE9U,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAA,EAAAA,KAACC,EAAO,OAAP,CACC,sBAAmB,GACnB,QAAS,IAAMuJ,EAAQ,CAACD,CAAI,EAC5B,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW;AAAA;AAAA;AAAA;AAAA,UAMX,SAAA,CAAAzK,MAAC0J,IAAO,KAAM,GAAI,UAAWmM,EAAe,EAAI,gBAAkB,gBAAiB,EAClFA,EAAe,GACd7V,EAAAA,IAAC,OAAA,CAAK,UAAU,yEACb,SAAA6V,EACH,EAEF7V,EAAAA,IAAC/C,IAAY,KAAM,GAAI,UAAW,wBAAwBwN,EAAO,aAAe,EAAE,EAAA,CAAI,CAAA,CAAA,CAAA,EAGxFzK,EAAAA,IAAC4J,GAAA,CACE,SAAAa,GACCvJ,OAAA+U,EAAAA,SAAA,CACE,SAAA,CAAAjW,EAAAA,IAACmB,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,CAAA,EACpB,QAAS,CAAE,QAAS,CAAA,EACpB,KAAM,CAAE,QAAS,CAAA,EACjB,UAAU,qBACV,QAAS,IAAMuJ,EAAQ,EAAK,CAAA,CAAA,EAE9BxJ,EAAAA,KAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,GAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,GAAA,EACvB,UAAU,2HAEV,SAAA,CAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAlB,EAAAA,IAAC,KAAA,CAAG,UAAU,sCAAsC,SAAA,UAAO,EAC1DyV,GACCvU,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACZ,SAAA,CAAAuU,EAAS,IAAI,UAAQA,EAAS,SAAS,eAAaA,EAAS,cAAc,WAAA,CAAA,CAC9E,CAAA,EAEJ,EAGCA,GACCvU,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAlB,EAAAA,IAAC,MAAA,CAAI,UAAU,iCAAkC,SAAAyV,EAAS,IAAI,EAC9DzV,EAAAA,IAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,aAAA,CAAW,CAAA,EACpD,EACAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAlB,EAAAA,IAAC,MAAA,CAAI,UAAU,oCAAqC,SAAAyV,EAAS,SAAS,EACtEzV,EAAAA,IAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,UAAA,CAAQ,CAAA,EACjD,EACAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAlB,EAAAA,IAAC,MAAA,CAAI,UAAU,mCAAoC,SAAAyV,EAAS,cAAc,EAC1EzV,EAAAA,IAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,OAAA,CAAK,CAAA,CAAA,CAC9C,CAAA,CAAA,CACF,CAAA,EAEJ,EAGAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACZ,SAAA,CAAA,CACC,CAAE,IAAK,MAAgB,MAAO,uBAAwB,KAAMwI,EAAA,EAC5D,CAAE,IAAK,iBAA2B,MAAO,sBAAuB,KAAMA,EAAA,EACtE,CAAE,IAAK,SAAmB,MAAO,qBAAsB,KAAMA,EAAA,CAAO,EACpE,IAAI,CAAC,CAAE,IAAA/J,EAAK,MAAA4Q,KACZrP,OAAC,MAAA,CAAc,UAAU,oCACvB,SAAA,CAAAlB,EAAAA,IAAC,OAAA,CAAK,UAAU,wBAAyB,SAAAuQ,EAAM,EAC/CvQ,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM+V,EAAapW,EAAK,CAACgW,EAAOhW,CAAG,CAAC,EAC7C,UAAW;AAAA;AAAA,0BAEPgW,EAAOhW,CAAG,EAAI,cAAgB,aAAa;AAAA,wBAG/C,SAAAK,EAAAA,IAACmB,EAAO,IAAP,CACC,UAAU,oEACV,QAAS,CAAE,EAAGwU,EAAOhW,CAAG,EAAI,GAAK,CAAA,EACjC,WAAY,CAAE,KAAM,SAAU,UAAW,IAAK,QAAS,EAAA,CAAG,CAAA,CAC5D,CAAA,CACF,CAAA,EAdQA,CAeV,CACD,EAGDuB,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAlB,EAAAA,IAAC,OAAA,CAAK,UAAU,wBAAwB,SAAA,oBAAiB,EACzDkB,EAAAA,KAAC,SAAA,CACC,MAAOyU,EAAO,QACd,SAAW5N,GAAMgO,EAAa,UAAWhO,EAAE,OAAO,KAAK,EACvD,UAAU,6EAEV,SAAA,CAAA/H,EAAAA,IAAC,SAAA,CAAO,MAAM,MAAM,SAAA,QAAK,EACzBA,EAAAA,IAAC,SAAA,CAAO,MAAM,KAAK,SAAA,WAAQ,EAC3BA,EAAAA,IAAC,SAAA,CAAO,MAAM,OAAO,SAAA,WAAA,CAAS,CAAA,CAAA,CAAA,CAChC,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAEJ,CAAA,EACF,CAEJ,CC/JO,SAASkW,IAAgB,CAC9B,KAAM,CAACzL,EAAMC,CAAO,EAAIpM,EAAAA,SAAS,EAAK,EAChC,CAAC6X,EAAQC,CAAS,EAAI9X,WAAwB,CAClD,IAAK,CAAE,QAAS,GAAO,SAAU,YAAA,CAAa,CAC/C,EAGDgI,GAA2B,aAAeI,GAAS,CACjD0P,EAAU1P,CAAI,CAChB,EAAG,CAAA,CAAE,EAGLxB,EAAAA,UAAU,IAAM,CACd,MAAMmR,EAAa,SAAY,CAE7B,GAAI,CAAC,OAAO,KAAO,OAAO,OAAO,IAAI,QAAW,WAAY,CAE1D,WAAWA,EAAY,GAAG,EAC1B,MACF,CAEA,GAAI,CACF,MAAMpK,EAAI,MAAM7F,EAAI,IAAI,OAAA,EACxBgQ,MAAmB,CAAE,GAAG3Q,EAAM,IAAKwG,GAAW,CAChD,MAAQ,CAER,CACF,EAGA,WAAWoK,EAAY,GAAG,CAC5B,EAAG,CAAA,CAAE,EAEL,MAAMC,EAAuB,SAAY,CACvC,GAAI,CACF,MAAMlQ,EAAI,IAAI,YAAA,CAChB,OAASf,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,CACxD,CACF,EAEMkR,EAAsBJ,EAAO,KAAK,oBAAsBA,EAAO,KAAK,WAAaA,EAAO,OAAO,QAErG,OACEjV,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAA,EAAAA,KAACC,EAAO,OAAP,CACC,sBAAmB,GACnB,QAAS,IAAMuJ,EAAQ,CAACD,CAAI,EAC5B,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW;AAAA;AAAA;AAAA;AAAA,UAMX,SAAA,CAAAzK,MAACwW,IAAQ,KAAM,GAAI,UAAWD,EAAsB,iBAAmB,gBAAiB,EACvFA,GACCvW,EAAAA,IAACmB,EAAO,IAAP,CACC,UAAU,oCACV,QAAS,CAAE,MAAO,CAAC,EAAG,IAAK,CAAC,CAAA,EAC5B,WAAY,CAAE,SAAU,EAAG,OAAQ,GAAA,CAAS,CAAA,EAGhDnB,EAAAA,IAAC/C,IAAY,KAAM,GAAI,UAAW,wBAAwBwN,EAAO,aAAe,EAAE,EAAA,CAAI,CAAA,CAAA,CAAA,EAGxFzK,EAAAA,IAAC4J,GAAA,CACE,SAAAa,GACCvJ,OAAA+U,EAAAA,SAAA,CACE,SAAA,CAAAjW,EAAAA,IAACmB,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,CAAA,EACpB,QAAS,CAAE,QAAS,CAAA,EACpB,KAAM,CAAE,QAAS,CAAA,EACjB,UAAU,qBACV,QAAS,IAAMuJ,EAAQ,EAAK,CAAA,CAAA,EAE9B1K,EAAAA,IAACmB,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,GAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,GAAA,EACvB,UAAU,2HAEV,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBAEZ,SAAA,CAAAiV,EAAO,KACNjV,OAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAlB,EAAAA,IAACwW,GAAA,CAAQ,KAAM,GAAI,UAAU,kBAAkB,EAC/CxW,EAAAA,IAAC,OAAA,CAAK,UAAU,oCAAoC,SAAA,KAAA,CAAG,CAAA,EACzD,EACCmW,EAAO,IAAI,mBACVnW,EAAAA,IAACyW,IAAY,KAAM,GAAI,UAAU,gBAAA,CAAiB,EAElDzW,EAAAA,IAAC0W,GAAA,CAAQ,KAAM,GAAI,UAAU,cAAA,CAAe,CAAA,EAEhD,EACCP,EAAO,IAAI,SAAWA,EAAO,IAAI,oBAChCjV,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,CAAA,aAAWiV,EAAO,IAAI,SAAS,MAAM,EAAG,CAAC,EAAE,KAAA,EAAG,EACrFjV,EAAAA,KAAC,SAAA,CACC,QAASoV,EACT,UAAU,kLAEV,SAAA,CAAAtW,EAAAA,IAAC2W,GAAA,CAAU,KAAM,EAAA,CAAI,EAAE,cAAA,CAAA,CAAA,CAEzB,CAAA,CACF,CAAA,EAEJ,EAIDR,EAAO,KACNjV,OAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAlB,EAAAA,IAACwW,GAAA,CAAQ,KAAM,GAAI,UAAU,gBAAgB,EAC7CxW,EAAAA,IAAC,OAAA,CAAK,UAAU,oCAAoC,SAAA,KAAA,CAAG,CAAA,EACzD,EACCmW,EAAO,IAAI,UACVnW,EAAAA,IAACyW,IAAY,KAAM,GAAI,UAAU,gBAAA,CAAiB,EAElDzW,EAAAA,IAAC0W,GAAA,CAAQ,KAAM,GAAI,UAAU,eAAA,CAAgB,CAAA,EAEjD,EACCP,EAAO,IAAI,UACVjV,EAAAA,KAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,CAAA,aAAWiV,EAAO,IAAI,QAAA,CAAA,CAAS,CAAA,EAE1E,EAIDA,EAAO,OAASA,EAAO,MAAM,SAC5BjV,OAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAlB,EAAAA,IAACwW,GAAA,CAAQ,KAAM,GAAI,UAAU,gBAAgB,EAC7CxW,EAAAA,IAAC,OAAA,CAAK,UAAU,oCAAoC,SAAA,OAAA,CAAK,CAAA,EAC3D,EACAA,EAAAA,IAACyW,GAAA,CAAY,KAAM,GAAI,UAAU,gBAAA,CAAiB,CAAA,EACpD,EACCN,EAAO,MAAM,MACZjV,EAAAA,KAAC,MAAA,CAAI,UAAU,wBAAyB,SAAA,CAAAiV,EAAO,MAAM,KAAK,YAAA,EAAc,KAAGA,EAAO,MAAM,IAAA,CAAA,CAAK,CAAA,EAEjG,EAIDA,EAAO,KACNjV,OAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAlB,EAAAA,IAACwW,GAAA,CAAQ,KAAM,GAAI,UAAU,iBAAiB,EAC9CxW,EAAAA,IAAC,OAAA,CAAK,UAAU,oCAAoC,SAAA,gBAAA,CAAc,CAAA,EACpE,EACCmW,EAAO,IAAI,QACVnW,EAAAA,IAACyW,IAAY,KAAM,GAAI,UAAU,gBAAA,CAAiB,EAElDzW,EAAAA,IAAC0W,GAAA,CAAQ,KAAM,GAAI,UAAU,eAAA,CAAgB,CAAA,EAEjD,EACCP,EAAO,IAAI,SACVjV,EAAAA,KAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,CAAA,aAAWiV,EAAO,IAAI,QAAA,CAAA,CAAS,CAAA,CAAA,CAE1E,CAAA,CAAA,CAEJ,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAEJ,CAAA,EACF,CAEJ,CCvGO,SAASS,GAAO,CAAE,cAAAC,EAAe,iBAAApU,EAAkB,gBAAAqU,EAAiB,eAAAC,GAA+B,CACxG,KAAM,CAAE,SAAApU,CAAA,EAAaC,GAAA,EACfrC,EAAOE,GAAasC,GAAUA,EAAM,IAAI,EACxCrC,EAAWC,GAAA,EACXqW,EAAiBC,GAAkBlU,GAAUA,EAAM,MAAM,EACzDmU,EAAeD,GAAkBlU,GAAUA,EAAM,IAAI,EACrDoU,EAAkBC,GAAoBrU,GAAUA,EAAM,KAAK,EAC3DsU,EAAuBC,GAAwBvU,GAAUA,EAAM,IAAI,EACnEwU,EAAYC,GAAiBzU,GAAUA,EAAM,GAAG,EAChD0U,EAAYD,GAAiBzU,GAAUA,EAAM,GAAG,EAChD2U,EAAWF,GAAiBzU,GAAUA,EAAM,QAAQ,EACpD4U,EAAUH,GAAiBzU,GAAUA,EAAM,OAAO,EAClD6U,EAAiBJ,GAAiBzU,GAAUA,EAAM,cAAc,EAChE8U,EAAWL,GAAiBzU,GAAUA,EAAM,QAAQ,EACpD,CAAC+U,EAAWC,CAAY,EAAIzZ,EAAAA,SAAS,EAAK,EAC1C,CAAC0Z,EAAcC,EAAe,EAAI3Z,EAAAA,SAAS,EAAK,EAChD,CAAC2F,GAAWC,CAAY,EAAI5F,EAAAA,SAAS,EAAK,EAC1C,CAAC4Z,EAAeC,CAAgB,EAAI7Z,EAAAA,SAAS,CAAC,EAC9C,CAAC8Z,EAAaC,CAAc,EAAI/Z,EAAAA,SAAS,EAAK,EAC9C,CAACga,EAAYC,CAAa,EAAIja,EAAAA,SAAwB,IAAI,EAC1D,CAACka,GAAaC,EAAc,EAAIna,EAAAA,SAAkC,CAAE,OAAQ,GAAO,GAAI,GAAO,MAAO,GAAO,SAAU,GAAO,EAC7Hoa,EAAgBza,EAAAA,OAA6D,CAAE,OAAQ,KAAM,GAAI,KAAM,MAAO,KAAM,SAAU,IAAA,CAAM,EAEpI0a,EAAiBna,cAAaoa,GAAiB,CACnD,MAAMxD,EAAQsD,EAAc,QAAQE,CAAI,EACpCxD,IACF,aAAaA,CAAK,EAClBsD,EAAc,QAAQE,CAAI,EAAI,KAElC,EAAG,CAAA,CAAE,EAECC,EAAgBra,cAAaoa,GAAiB,CAClDD,EAAeC,CAAI,EACnBH,GAAe,CAAE,OAAQ,GAAO,GAAI,GAAO,MAAO,GAAO,SAAU,GAAO,EAC1EA,GAAgBhT,IAAU,CAAE,GAAGA,EAAM,CAACmT,CAAI,EAAG,EAAA,EAAO,EACpDF,EAAc,QAAQE,CAAI,EAAI,WAAW,IAAM,CAC7CH,GAAgBhT,IAAU,CAAE,GAAGA,EAAM,CAACmT,CAAI,EAAG,EAAA,EAAQ,EACrDF,EAAc,QAAQE,CAAI,EAAI,IAChC,EAAG,GAAG,CACR,EAAG,CAACD,CAAc,CAAC,EAEbG,EAAata,EAAAA,YAAY,IAAM,CACnC+Z,EAAc,IAAI,EAClBE,GAAe,CAAE,OAAQ,GAAO,GAAI,GAAO,MAAO,GAAO,SAAU,GAAO,EACzE,OAAO,KAAKC,EAAc,OAAO,EAAe,QAASE,GAASD,EAAeC,CAAI,CAAC,CACzF,EAAG,CAACD,CAAc,CAAC,EAEbI,EAAava,EAAAA,YAChBoa,GAAiB,CAChBL,EAAetS,GACTA,IAAY2S,GACdD,EAAeC,CAAI,EACnBH,GAAe,CAAE,OAAQ,GAAO,GAAI,GAAO,MAAO,GAAO,SAAU,GAAO,EACnE,OAETI,EAAcD,CAAI,EACXA,EACR,CACH,EACA,CAACD,EAAgBE,CAAa,CAAA,EAE1BG,EAAqB/a,EAAAA,OAAO,CAChC,SAAU0E,GAAY,KACtB,UAAW,GACX,aAAc,EAAA,CACf,EACKsW,EAAkBhb,EAAAA,OAA6C,IAAI,EAEzEiH,EAAAA,UAAU,IAAM,CACd8T,EAAmB,QAAU,CAC3B,SAAUrW,GAAY,KACtB,UAAAmV,EACA,aAAAE,CAAA,CAEJ,EAAG,CAACrV,EAAUmV,EAAWE,CAAY,CAAC,EAEtC9S,EAAAA,UAAU,IAAM,CACd,MAAMgU,EAAuBrP,GAAyB,EAEjDA,EAAM,SAAWA,EAAM,UAAYA,EAAM,UAAYA,EAAM,IAAI,YAAA,IAAkB,MAElFA,EAAM,eAAA,EACDmN,EAAA,EAET,EACA,cAAO,iBAAiB,UAAWkC,CAAmB,EAC/C,IAAM,OAAO,oBAAoB,UAAWA,CAAmB,CACxE,EAAG,CAAClC,CAAc,CAAC,EAEnB9R,EAAAA,UAAU,IACD,IAAM,CACP+T,EAAgB,UAClB,aAAaA,EAAgB,OAAO,EACpCA,EAAgB,QAAU,MAE3B,OAAO,KAAKP,EAAc,OAAO,EAAe,QAASE,GAASD,EAAeC,CAAI,CAAC,CACzF,EACC,CAACD,CAAc,CAAC,EAEnBzT,EAAAA,UAAU,IAAM,CACd,GAAI,CAACoT,EAAY,OACjB,MAAMa,EAAgBtP,GAAyB,CACzCA,EAAM,MAAQ,UAChBiP,EAAA,CAEJ,EACM3Q,EAAmC,CAAE,QAAS,EAAA,EACpD,cAAO,iBAAiB,UAAWgR,EAAchR,CAAO,EACjD,IAAM,OAAO,oBAAoB,UAAWgR,EAAchR,CAAO,CAC1E,EAAG,CAACmQ,EAAYQ,CAAU,CAAC,EAG3BxS,GAA4B,oBAAqB,IAAM,CACrD6R,EAAiB1S,GAAQA,EAAO,CAAC,CACnC,EAAG,CAAA,CAAE,EAELa,GAA4B,iBAAkB,IAAM,CAClD6R,KAAyB,KAAK,IAAI,EAAG1S,EAAO,CAAC,CAAC,CAChD,EAAG,CAAA,CAAE,EAELa,GAA4B,qBAAsB,IAAM,CAExD,EAAG,CAAA,CAAE,EAGLA,GAAY,aAAc,IAAM,CAC9B+R,EAAe,EAAI,CACrB,EAAG,CAAA,CAAE,EAGLnT,EAAAA,UAAU,IAAM,CACd,MAAMkU,EAAgB,SAAY,CAEhC,GAAI,CAAC,OAAO,KAAO,OAAO,OAAO,IAAI,QAAW,WAAY,CAE1D,WAAWA,EAAe,GAAG,EAC7B,MACF,CAEA,GAAI,CACF,MAAMjW,EAAO,MAAMiD,EAAI,UAAU,KAAA,EAC3B0F,EAAS,MAAM,QAAQ3I,CAAI,EAAIA,EAAK,OAAQkW,GAAWA,EAAE,SAAW,aAAa,EAAE,OAAS,EAClGlB,EAAiBrM,CAAM,CACzB,MAAQ,CAER,CACF,EAGA,WAAWsN,EAAe,GAAG,CAC/B,EAAG,CAAA,CAAE,EAEL,MAAME,EAAa9a,EAAAA,YAAY,SAAY,CACzC,KAAM,CAAE,SAAU2N,CAAA,EAAoB6M,EAAmB,QACzD,GAAK7M,EACL,GAAI,CACF,MAAM/F,EAAI,KAAK,OAAO+F,CAAe,CAEvC,OAAS9G,EAAO,CACd,QAAQ,MAAM,qBAAsBA,CAAK,CAC3C,CACF,EAAG,CAAA,CAAE,EAECkU,GAAgB/a,EAAAA,YAAY,SAAY,CAC5C,KAAM,CAAE,SAAU2N,CAAA,EAAoB6M,EAAmB,QACzD,GAAK7M,EACL,GAAI,CACF,MAAM/F,EAAI,KAAK,UAAU+F,CAAe,CAE1C,OAAS9G,EAAO,CACd,QAAQ,MAAM,wBAAyBA,CAAK,CAC9C,CACF,EAAG,CAAA,CAAE,EAECmU,GAAgBhb,EAAAA,YAAY,SAAY,CAC5C,KAAM,CAAE,SAAU2N,CAAA,EAAoB6M,EAAmB,QACzD,GAAK7M,EACL,CAAI8M,EAAgB,UAClB,aAAaA,EAAgB,OAAO,EACpCA,EAAgB,QAAU,MAE5B/U,EAAa,EAAI,EACjB,GAAI,CACF,MAAMkC,EAAI,KAAK,OAAO+F,CAAe,EAEjC8M,EAAgB,SAClB,aAAaA,EAAgB,OAAO,EAEtCA,EAAgB,QAAU,WAAW,IAAM,CACzC/U,EAAa,EAAK,EAClB+U,EAAgB,QAAU,IAC5B,EAAG,GAAI,CACT,OAAS5T,EAAO,CACd,QAAQ,MAAM,qBAAsBA,CAAK,EACzCnB,EAAa,EAAK,CACpB,EACF,EAAG,CAAA,CAAE,EAGLgB,EAAAA,UAAU,IAAM,CACd,MAAM4C,EAAiBC,GAAqB,CAC1C,KAAM,CAAE,SAAUoE,EAAiB,UAAWsN,EAAkB,aAAcC,GAAwBV,EAAmB,QAEnHhR,GADQ,UAAU,SAAS,cAAc,QAAQ,KAAK,GAAK,EACxCD,EAAE,QAAUA,EAAE,QACjC4R,GAAc5R,EAAE,OAGhB6R,GAAS7R,EAAE,OACjB,GAAI,EAAA6R,GAAO,UAAY,SAAWA,GAAO,UAAY,YAAcA,GAAO,mBAI1E,KAAK5R,IAAY2R,KAAgB5R,EAAE,MAAQ,aAAe,CAACA,EAAE,SAAU,CACjE0R,GAAoBtN,IACtBpE,EAAE,eAAA,EACGuR,EAAA,GAEP,MACF,CAEA,IAAKtR,IAAY2R,KAAgB5R,EAAE,MAAQ,cAAgB,CAACA,EAAE,SAAU,CAClE2R,GAAuBvN,IACzBpE,EAAE,eAAA,EACGwR,GAAA,GAEP,MACF,CAEA,GAAIvR,IAAYD,EAAE,IAAI,YAAA,IAAkB,KAAO,CAACA,EAAE,SAAU,CACtDoE,IACFpE,EAAE,eAAA,EACGyR,GAAA,GAEP,MACF,CAQA,GANIzR,EAAE,MAAQ,MAAQoE,IACpBpE,EAAE,eAAA,EACGyR,GAAA,GAIHxR,KAAaD,EAAE,MAAQ,KAAOA,EAAE,MAAQ,MAAQoE,EAAiB,CACnEpE,EAAE,eAAA,EACF3B,EAAI,KAAK,OAAO+F,CAAe,EAAE,MAAM,QAAQ,KAAK,EACpD,MACF,CAEA,GAAInE,IAAYD,EAAE,MAAQ,KAAOoE,EAAiB,CAChDpE,EAAE,eAAA,EACF3B,EAAI,KAAK,QAAQ+F,CAAe,EAAE,MAAM,QAAQ,KAAK,EACrD,MACF,CAEA,GAAInE,IAAYD,EAAE,MAAQ,KAAOoE,EAAiB,CAChDpE,EAAE,eAAA,EACF3B,EAAI,KAAK,UAAU+F,CAAe,EAAE,MAAM,QAAQ,KAAK,EACvD,MACF,CAGA,GAAIpE,EAAE,MAAQ,OAAUC,IAAYD,EAAE,UAAYA,EAAE,IAAI,YAAA,IAAkB,IAAM,CAC1EoE,IACFpE,EAAE,eAAA,EACF3B,EAAI,KAAK,SAAS+F,CAAe,EAAE,MAAM,QAAQ,KAAK,GAExD,MACF,EACF,EAEA,cAAO,iBAAiB,UAAWrE,CAAa,EACzC,IAAM,OAAO,oBAAoB,UAAWA,CAAa,CAClE,EAAG,CAACwR,EAAYC,GAAeC,EAAa,CAAC,EAG7ClT,GACE,wBACCvD,GAAU,CACLA,EAAM,QAAUJ,IAClBoV,EAAahV,EAAM,SAAS,EAC5BkV,GAAgBlV,EAAM,YAAY,EAEtC,EACA,CAACJ,CAAQ,CAAA,EAIXuC,EAAAA,UAAU,IAAM,CACd,GAAI,CAACvC,EAAU,CACboV,EAAa,EAAK,EAClBE,GAAgB,EAAK,EACrB,MACF,EAG8B,SAAY,CACxC,GAAI,CAGF,MAAM7R,EAAI,KAAK,KAAA,CAEjB,OAASf,EAAO,CACd,QAAQ,MAAM,qCAAsCA,CAAK,CAC3D,CACF,GAEA,CACF,EAAG,CAAC1C,CAAQ,CAAC,EAEb,MAAMkX,GAAmB,SAAY,CACnC,GAAKlX,EACL,GAAI,CACF,MAAMjB,EAAS,MAAM0E,EAAI,KAAK,WAAWzD,CAAQ,EAC7CjB,GAAQ,QAEV,QAAQ,IAAI,oBAAqBA,EAAO,IAAI,EAE5C,QAAQ,MAAM,qBAAsBA,GAAQ,KAAK,CAErD,OAAS2D,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,CACtD,CACF,EAEMyU,EAAY,SAAY,CAC5B,GAAKnX,EACL,GAAI,CACF,MAAMjB,EAAS,MAAM0E,EAAI,KAAK,IAAIzD,EAAU,EAAI,EAC3CjB,GAAQ,SACX,QAAQ,KAAK,sBAAuBA,GAAQ,OAAS,wBAAwB,CAEjF,OAAS2D,EAAO,CACd,QAAQ,MAAM,uBAAwBA,CAAK,CAC7C,CACF,EAEM0U,EAAmBvb,EAAAA,YAAY,SAAY,CAC/C,GAAKmE,EACL,GAAI,CACF,MAAMyD,EAAI,KAAK,KAAKzD,CAAQ,CAC9B,OAAS0C,EAAO,CACd,QAAQ,MAAM,uBAAwBA,CAAK,CAC7C,CACF,EAAG,CAAC1C,CAAQ,CAAC,EAEPqX,EAAuBxb,EAAAA,YAAY,SAAY,CACnD,GAAKmE,EACL,GAAI,CACF,MAAMyD,EAAI,KAAK,SAASzD,CAAQ,CAClC,OAAS0C,EAAO,CACd,QAAQ,MAAM,6BAA8BA,CAAK,CACnD,CACF,EAAG,CAAC1C,CAAQ,CAAC,EAEPsX,EAAmBzb,EAAAA,YACtB6T,GAAqB,CACpB,GAAIA,EAAM,OAAS,QAAUA,EAAM,SAAU,OAC7C,MAAM3Q,EAAS2Q,EAAM,SAAA,EACjB3Q,GAAU,OAAQA,EAAyB,MAAS,WACrDA,EACE,MAAO2D,GAAU,CAChB,QAAQ,MAAM,8BAA8BgN,EAAM,GAAG,IAAKhN,CAAK,CACjE,CAAC,EACA,QAAQ,IAAMyT,GAAY,EAE7BA,EAAA,CAEJ,EACA,CAACA,CAAU,CAAA,EAGPoB,EAAQ,OAAO,UAAc,KAAe,UAAU,UAAU,YAAA,EAAc,SAAS,KAAK,EAE5FC,EAAoBpa,EAAAA,QAAqB,IAAM,CACnD,MAAM8H,EAAqD,CACzD,kBAAmB,CACjB,KAAM,OACN,IAAK,kBACL,KAAMtK,GACN,MAAO,iBACP,SAAU,IAAMmD,EAAS,GAAG,CAAA,EAE9B,gBAAiB,CACf,KAAM,OACN,IAAK,gBACL,KAAMrD,GACN,MAAO,gBACP,SAAU,IAAMqD,EAAS,UAAU,CAAA,EAErC,WAAY,CACV,KAAM,OACN,IAAK,aACL,KAAM0Z,GACN,MAAO,oBACP,SAAU,IAAM1Z,EAAS,YAAY,CAAA,EAEvC,UAAW,CACT,KAAM,OACN,IAAK,YACL,KAAM2Z,GACN,MAAO,0BACP,SAAU,IAAM3Z,EAAS,YAAY,CAAA,EAEvC,kBAAmB,CACjB,KAAM,OACN,IAAK,kBACL,KAAM4Z,GACN,MAAO,kBACP,SAAU,IAAM5Z,EAAS,OAAO,CAAA,EAElC,QAAS,CACP,KAAM,OACN,IAAK,iBACL,KAAMgJ,GACN,MAAO,iBACP,SAAU,IAAM,KAAK2N,EAAA,CAAqB,EAE5C,YAAa,CACX,KAAM,OACN,IAAK,YACL,KAAM9Z,GACN,MAAO,kBACP,SAAU,IAAM,KAAK2Z,EAAA,CAAa,CACpC,EAGIqD,EAAmF,CACvF,SAAU,CACR,MAAO,iBACP,YAAa,oCACb,KAAM,CAAC,kBAAmB,YAAa,SAAS,CAAA,EAElD,MAAO,CACL,MAAO,cACP,YAAa,+BACb,KAAM,CAAC,gBAAiB,YAAa,iBAAiB,CAAA,EAExD,MAAO,CACL,MAAO,eACP,YAAa,iCACb,KAAM,CAAC,YAAa,eAAe,CAAA,EAErC,OAAQ,CACN,MAAO,iBACP,YAAa,4BACb,KAAM,CAAC,aAAc,gBAAiB,iBAAiB,CAAA,CACzD,EAGIC,EAAUD,EAASha,CAAI,GAAKga,EAAS,OACrCE,MAAW,IACX5I,EAAuB,CAAA,EAE7B,OAAAA,EAAQ,KAAK,CACX,KAAM,UACN,IAAK,kBACL,MAAO2I,EAAQ,MACf,YAAaA,EAAQ,WAAA,CACtB,EAEDA,EAAQ,KAAK,QAAS7a,IAAQ,CAC5B,MAAM0S,GAAQxK,EAAKlI,EAAG,EAClB0S,IAAS,CAACoI,EAAK,IAAI9a,EAAG,IACxBkS,EAAQ,KAAKQ,EAAK,EAClBoI,EAAK,IAAI9a,EAAG,EAEhB,CAAC,EAEDkS,EAAQ,KAAK,CAAE,KAAM,UAAW,IAAK,kBAAmB,EACxDA,EAAQ,KAAK,CAAE,KAAM,UAAW,IAAK,YAAa,MAAO,sBAAuB,EAEhF,OAAO,QAAQhK,CAAI,EAAE,QAAQ,CAAC,CAAClI,GAAK0S,EAAK,IAAM,CACxCoI,EAAK,IAAI9a,EAAG,IACfkS,EAAQ,KAAKQ,EAAK,EAClBoI,EAAK,IAAI9a,EAAG,EAEhB,CAAC,EAEMkS,CACT,EAAG,CAACtR,EAAMG,EAAU2W,EAAsBH,CAAY,CAAC,EAEjDwD,EAAgC,CACpC,CACE,KAAM,OACN,IAAK,OACL,KAAM/Q,GACN,MAAO,eACP,SAAUuQ,EAAQ,MAAQ,SAC1B,SAAU,CAACvX,EACX,SAAUoX,CAAA,EAEZ,CACE,KAAM,OACN,IAAK,aACL,KAAMhM,GACN,MAAO,qBACP,SAAU,CAACpL,EACX,SAAUkX,EAAA,EAEZ,CACE,KAAM,OACN,IAAK,MACL,KAAMnc,GACN,MAAO,qBACP,SAAU,CAACiF,EACX,SAAUmX,CAAA,EAEZ,CACE,KAAM,OACN,IAAK,WACL,KAAM1c,GACN,MAAO,kBACP,SAAU8c,EAAQ,QAAU,WAC5B,SAAU,CAACvX,EACX,SAAUqX,CAAA,EAEZ,CAAE,KAAM,UAAW,IAAK,eAAA,EACxB,CACE,KAAM,OACN,IAAK,cACL,KAAMlQ,GACN,MAAO,kBACP,SAAU,IAAM,CACdqN,EAAA,CACF,CAAA,EAEF,CACE,KAAM,OACN,IAAK,WACL,KAAMwD,GACN,MAAO,gBACP,SAAU,IAAM,CACdja,EAAS,WAAW,CACtB,CAAA,EAEF,CACE,KAAM,OACN,IAAK,UACL,KAAMrD,GACN,MAAO,UACP,SAAU,IAAM,CACdqD,EAAS,UAAU,CACrB,CAAA,EAEF,CACE,KAAM,OACN,IAAK,YACL,KAAM8V,GACN,MAAO,oBACP,SAAU0D,EAAQ,MAAQ,SAC1B,SAAU,IAAM,CACThD,EAAA,CACP,CAAA,EAEF,CACE,KAAM,OACN,IAAK,oBACL,KAAMxN,GACN,MAAO,qBACP,SAAU,IAAM,CACT2N,EAAA,CACP,CAAA,CACF,EAGIuD,EAA6B,CACjC,CACE,KAAM,OACN,IAAK,gBACL,KAAMC,GACN,MAAO,qBACP,SAAUX,EAAQ,MAAQ,eAC1B,SAAU,IAAMrD,EAAA,CAAc,EAEhC,CACE,KAAM,OACN,IAAK,YACL,KAAM/M,GACN,MAAO,YACP,SAAUoQ,EAAQ,KAAO,SACzB,SAAU,IAAMzX,EAAA,CAAiB,EAEnC,CAAE,KAAM,UAAW,IAAK,eAAA,EACxB,CACE,KAAM,OACN,IAAK,iBACL,KAAMqY,GACN,MAAO,iBACP,SAAUZ,EAAQ,MAAQ,eAC1B,SAAU,IAAMpD,EAAA,CAAgB,EAElC,CACE,KAAM,OACN,IAAK,cACL,KAAMsD,GACN,MAAO,cACP,SAAUF,EAAQ,MAAQ,eAC1B,SAAU,IAAMnD,EAAA,CAAe,CACjC,EAGIgE,EAAmC,CACvC,CACE,KAAM,OACN,IAAK,kBACL,KAAMrR,GACN,MAAO,kBACP,SAAU,IAAM,CACC,SAAS,cAAc,uBAAuB,GACrD,MAAA,CACV,CAAA,EAEF,CACE,KAAM,OACN,IAAK,mBACL,KAAMsR,GACN,MAAO,mBACP,SAAU,IAAM,CACC,SAAS,cAAc,uBAAuB,GACrD,MAAA,CACV,CAAA,EAEF,CACE,KAAM,OACN,IAAK,aACL,KAAMtR,GACN,MAAO6N,EAAU,QAAU,cAAgB,aAC3C,SAAU,IAAM,CACVA,EAAU,QACPI,EAAA,EAEAD,EAAA,CAET,CAAA,EAEF,CACE,KAAM,OACN,IAAK,mBACL,KAAMf,GACN,MAAO,oBACP,SAAU,CAACY,EAAU,SAAW,EAAQA,EAAU,KAClD,SAAU,IAAM,CACVA,EAAU,SAAW,CAACA,EAAU,MAC7BK,EAAA,CAET,CAAA,EAEF,CACE,KAAM,OACN,IAAK,aACL,KAAMoD,GACN,MAAOvD,EAAU,UACb,QAAQA,EAAU,KAAOA,EAAU,KAAK,YAAA,EAAgB,QAAQ,GAChE,mBACJ,SAAU,IAAM,CACTI,EAAA,CACP,CAAA,EAEF,CAAE,KAAM,UAAW,IAAK,kBAAA,EACxB,CACE,KAAM,OACN,IAAK,gBACL,KAAMxa,GACN,MAAO,gBACP,SAAU,IAAMqD,EAAS,UAAU,CAAA,CACrC,EAGIua,GAAmB,CAACC,EAAgB3K,EAAesB,IAAyB,CAChF,MAAMsJ,EAAS7C,IAAe4C,EAC9B,OACEha,EAAAA,KAAC,MAAA,CAAiB,UAAU,WAC1B,SAAA,CAAAA,EAAAA,KAACC,EAAO,OAAP,CACC,KAAK,SACL,QAAS,IAAM4X,EAAWmC,CAAM,EAChC,gBAAeC,EACf,gBAAc,OACd,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW,yEACTA,EAAS,sCAAwC,YACnD,GACA,MAAO,GAAG5K,CAAK,QAEf,SAAA,CAAAvQ,EAAAA,IAAC,QAAM,SAAAuQ,CAAA,CAAM,EACbvQ,EAAAA,IAAC/C,IAAY,KAAM,GAAI,UAAW,wBAAwBke,EAAS,aAAe,EAAE,EAAA,CAAI,CAAA,CAAA,CAAA,EAG1Fnb,EAAAA,IAAC4J,GAAA,CACE,SAAAuR,GACCja,OAAA+U,EAAAA,SAAA,CACE,SAAA,CAAAjW,EAAAA,IAACmB,EAAO,OAAP,CAEC,KAAK,SACL,aAAY,SAASoP,CAAK,QAC1B,UAAU,2EACV,QAASuI,EACT,QAAS,CAAE,QAAS,CAAA,EACpB,QAAS,CAAE,QAAS,CAAA,EACpB,KAAM,CAAE,QAAS,CAAA,CAAE,EAPd,GAAGoC,CAAM,WAAA,EAShBlb,EAAAA,IAACmB,EAAO,IAAP,CAEC,QAAS,CAAE,QAAS,EAAG,EAAG,EAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,EAAA,EACvB,WAAY,CAAE,SAAU,GAAA,EACxB,UAAU,gHAET,YAAY+Z,CAAM,EACjBlb,EAAAA,IAAC,MAAA,CAAI,UAAU,sBACZ,SAAA,MAAM,KAAK,CAAE,OAAQ,CAAA,CAAG,EAAE,IAAI,CAACob,EAAG5T,KACjCxH,EAAAA,IAAC,MAAA,CAEC,UAAU,8CAAA,EADL,YAAYkb,CAAM,IAAI1T,EAAK,EAAA,CAGnC,CAAA,CACH,EAEAqK,EAAQ,IAAKQ,GACPA,EAAM,OAAS,UACVrS,EAAAA,IAAC,MAAA,CAAoB,UAAU,yCAAA,EAArBqS,EAAM,GAAyD,EAE9EA,EAAM,OAAS,UAEfnR,EAAAA,KAAC,MAAA,CAEC,UAAU,oEAEV,SAAA,CAAAlB,EAAAA,IAAC,MAAA,CAAK,WAAM,KAAA,CAAM,EACjBqS,EAAM,aACLrS,EAAAA,IAAC,OAAI,UAAU,6DACZ,WAAM,WAAA,CACT,CAAA,CAAA,EAPGqS,EAAM,GAAA,EAafnR,EAAAA,KAAC,SAAA,CAEC,KAAK,SACL,SAAUmR,EAAM,SAChB,QAAS,IAAM4H,EAAiB5H,CAAK,EACrC,UAAU,mBAEV,SAAA,CAAArS,EAAAA,IAACqS,EAAM,KAAN,CAAW,KAAM,GAAI,UAAU,aAAa,EAC7CrS,EAAAA,IAAC,OAAA,CAAK,UAAU,mBAAoB,WAAM,MAAM,EAC/CqS,EAAM,UACLrS,EAAAA,IAAC,OAAI,UAAU,iEACZ,WAAM,QAAA,CACT,CAAA,CAAA,EAXGqS,EAAM,GAAA,CAehB,CAAA,EArDE,GAAG6I,CAAM,OAAA,CAuDhB,CAAA,CACF,CAAA,CAEJ,CAAA,CAAA,EAzFQA,CA0FV,CAEJ,EAEA,OACEha,EAAAA,KAAC,MAAA,CAAI,UAAU,2HAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACb,SAAA,CAAAlB,EAAAA,IAACM,GAAA,EAAW,QACX4J,GAAA,EAAgB,EACjBhJ,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAlB,EAAAA,IAACkP,GAAA,EAAqB,QACrB0B,GAAA,CAAA,CAAkB,CAAA,CAAA,CACrB,CAAA,EACF,EAGA1P,EAAAA,KAAC,MAAA,CAAI,UAAU,kDAEb,SAAA,CAAAlB,EAAAA,IAACmB,EAAO,OAAP,CACC,QAAS,IAAMT,EAAS,GAAG,EAC3B,aAAW,aACX,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAU,6DACV,MAAM,2BAEN,SAAAV,EAAAA,IAACqb,GAAA,CAAK,KAAM,EAAA,CAAI,CAAA,CAAA,EAGlBrb,EAAAA,IAACmB,EAAO,OAAP,CACC,QAASmY,EACT,SAAU,CAACxB,GAAa,CAACnV,EACzB,aAAW,UACX,gBAAe,CAACmV,GAAa,CAACnV,EAC9B,WAAY,CAAE,MAAOmV,GAAanV,EAAW,KAAO,CAAA,EACpD,SAAU,CAAE,MAAOmV,GAAanV,EAAW,IAAO,CAAA,EAClD,UAAW,2CACTmV,GAAanV,EAAW,qBAAuB,+BACjD,GACA,MAAM,oBAEN,SAAA3C,EAAAA,IAACnD,GAAA,CAAU,KAAM,EAAA,CAAI,CAAA,CAAA,EAEvBmD,EAAAA,IAACmB,EAAO,OAAP,CACC,QAASoY,GACT,SAAU,CAACvB,GAAgB,CAACrV,EAC5B,aAAW,aACX,gBAAe,CAACqV,GAAgB,CAACrV,EACjC,WAAY,CAAE,MAAOqV,GAAgBrV,EAAW,KAAO,CAAA,EACvD,SAAU,CAAE,MAAOqV,GAAgBrV,EAAW,IAAO,CAAA,EACrD,UAAW,2CACTqV,GAAgBrV,EAAW,qBAAuB,+BACpD,GACA,MAAM,uBAEN,SAAA3C,EAAAA,IAACsb,GAAA,CAAW,KAAM,EAAA,CAAI,CAAA,CAAA,EAExBtb,EAAAA,IAACmB,EAAO,OAAP,CACC,QAASqY,GACT,SAAU,CAAC7W,EACX,aAAW,eACX,gBAAe,CAACA,EAChB,WAAY,CAAE,MAAOA,EAAW,KAAO,CAAA,EACvC,SAAU,CAAE,MAAOA,EAAW,IAAO,CAAA,EACrC,UAAW,2CACTA,EAAW,qBAAuB,+BACpC,GACA,MAAM,wBAEN,SAAA3C,EAAAA,IAACmB,EAAO,IAAP,CACC,QAAS,CAAE,OAAQ8C,GAAY,IAAM,CAAA,EACrC,WAAY,CAAE,SAAU,EAAG,OAAQA,GAAY,IAAW,EAAG,KAAM,QAAA,EACnE,UAAU,mCAEV,SAAAjE,EAAAA,IAAC2W,GAAA,CAAU,KAAM,EAAA,CAAI,CAAA,CAAA,CACvB,CAAA,CACF,EACF,EAGAzV,EAAAA,KAAC,MAAA,CAAI,UAAU,+BAA+B,kBAAgB,UAC5D,SAAA,CAAAlB,MAACwC,IAAQ,iBAAAC,EAAoC,QAC5CuH,GAAA,CAAA,CAAY,CAAA,EACf,EAGA9I,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACZ,SAAA,CAAA+Z,GAAiB,KAAM,KAAML,CAAa,EAC1CK,GAAiB,SAAU,SAAUd,CAAiB,EACtDc,GAAiB,QAAS,QAASP,CAAgB,EACnDO,GAAiB,WAAY,WAAYF,CAAmB,QAC5DjG,GAAA,EAAqB,QACrBP,GAAA,EAAc,EACfrT,EAAAA,KAAC,MAAA,CAAI,UAAU,uCACb,SAAA,CAAAlB,EAAAA,IAACwV,GAAA,EAAc,QACdU,GAAA,CAAA,CAAc,CAAA,EACjB,EACAhV,EAAAA,KAACC,EAAO,OAAP,CACC,QAAS,IAAM,CACbT,EAAS,YAAY,CACvB,EACA,aAAY,YAAYwX,EAAgB,EAAI,KAAKA,CAAa,WAAa,EAAE,GAC7E,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAU,oEACV,MAAO,YAAYA,EAAgB,EAAI,KAAKA,CAAa,WAAa,EAAE,GAExE,SAAA,CAAAlY,EAAAA,IAAC4N,GAAA,CAAS,KAAM,EAAA,CAAI,EACnBsK,EAAgB,GACflY,EAAAA,IAACmB,EAAO,KAAP,CACC,QAAS,CAAE,MAAO,CAAA,EAClB,QAAS,CAAE,MAAO,CAAA,EAClB,UAAU,0HACV,aAAY,GAAG+W,CAAa,mBAAmBA,EAAgB,EAAI,IAAM,EAAE,GAE1E,SAAAA,EAAgB,EAAI,KAAOA,CAAA,CAAA,CAC9B,CAAA,CAAA,EAGJlY,EAAAA,IAACmB,EAAO,OAAP,CACC,QAAS,IAAMT,EAAS,WAAW,EACnC,aAAW,gBACX,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAU,2DACV,MAAM,WAEN,SAAAV,EAAAA,IAACub,GAAA,CAAS,KAAM,EAAA,CAAI,CAAA,CAAA,EAEtBra,EAAAA,KAACC,EAAO,OAAP,CACC,QAAS0V,EACT,aAAY,gBAAgBuB,EAAc,YAAc,EAAE,GAC1D,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,UAAW,yCACTA,EAAc,8EAAgF,oBAChG,GACA,MAAM,sBAEN,SAAA,CAAApY,EAAAA,IAAC6a,GAAA,CAAI,KAAM,EAAA,CAAI,EACdzC,GACCpY,EAAAA,IAACmB,EAAO,KAAP,CACC,UAAU,0FACV,QAAS,CAAE,MAAO,CAAC,EAAG,IAAK,CAAC,EAAG,QAAS,CAAC,EAAG,GAAK,CAAC,CAAA,EAClD,WAAY,CAAE,SAAU,EAAG,OAAQ,GAAA,EACnC,aAAW,iBAAA,CAAA,CACb,CAAA,CAAA,CAEJ,CAAA,CACF,CAAA,EACF,CAEJ","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]}
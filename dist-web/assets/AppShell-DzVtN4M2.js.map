{"version":3,"mappings":"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","names":["MicOff","createLucideIcon","Mic","useTabGraphStore","create","set","get","payload","ipc","error","tabId","INTERNAL_PROTOCOLS","isInternalUrl","url","prefix","TabContentSurface","tab","overlayActive","containerRef","useRef","webviewRef","iframeRef","isElectron","isElectronRuntime","loading","setLoading","useState","failedMessage","setFailedMessage","blockedExternal","setBlockedExternal","loadingTimeoutRef","retryCountRef","targetUrl","useMemo","useEffect","webviewElement","LOADING_TIMEOUT_MS","handleDidStartLoading","handleDidStopLoading","handleDomReady","handleFailLoad","event","errorCode","errorDescription","message","iframe","timeoutId","handleLoad","handleError","launchExternal","useCallback","panelId","labelledById","isInactive","jsxs","motion","jsx","AnimatePresence","Loader2","ExternalLink","OmniDesk","VoiceTips","isListening","setIsListening","tips","setTips","currentTip","setCurrentTip","isMuted","setIsMuted","generateTip","tipPool","tip","interval","newTip","prev","timer","handleVoiceCommand","command","lower","useTrustDashboardStore","__vitePreload","useConsentOverlayStore","consentOverlayStore","startListening","Recognition","recognition","transcript","Fragment","Sparkles","t","X","Volume2","STORAGE_KEY","onboardingStorage","useOnboardingStore","fetchRecords","filter","list","filtered","record","a","b","records","partial","state","consentId","ErrorBoundary","React","props","__publicField","result","errorInfo","AlertTriangle","isDevEnv","TopNav","m","TabStrip","RightPanel","BottomStatus","CommandPalette","PermissionPrompt","ConsentPrompt","AgentOverlay","ClipperOverlay","ReaderOverlay","TabGraphOverlay","ConsentDashboard","TrustEthicsDashboard","OnboardingTour","AppShell","rightPanelOpen","setRightPanelOpen","commandPaletteOpen","setCommandPaletteOpen","permissionRequest","setPermissionRequest","consentRequest","setConsentRequest","isFullscreen","setIsFullscreen","checkFullscreen","isCurrentlyFullscreen","clipperActive","setClipperActive","readerActive","setReaderActive","onboardingVisible","startOnboarding","graphDropHint","setGraphDropHint","dragCounter","isGraphDrag","types","handleDragEnter","handleDragOver","handleDragLeave","handleDragEnd","handleDrop","handleCustomDragEnd","consentVisible","trustDashboardVisible","tabsState","useTabsStore","activeTab","contentSplit","setContentSplit","isResizingContent","setIsResizingContent","activeTabUrl","showWebContent","handleResizeStart","handlePointerMove","ratio","handlePointerUp","restoreSummary","setRestoreSummary","restoreDismissed","setRestoreDismissed","restoreStatus","setRestoreStatus","restoreToast","setRestoreToast","restoreRelativeTime","formatDistanceToNow","cancelled","res","summary","useIPCEvent","request","approved","handleFullscreen","data","ipcEvents","handleKeyDown","e","modifier","handleCreateHighlight","highlight","existing","notes","highlights","handleRestoreSession","restoredCount","handleDismissRestore","Suspense","RotateCcw","Outlet","Portal"],"ignoreList":[0,1],"sources":["../../node_modules/lucide-react/dist/esm/icons/mic-off.js","../../node_modules/lucide-react/dist/esm/icons/mic.js","../../src/state/tabGraphStore.ts","../../src/components/layout/TabContentSurface.tsx","../../src/components/voice/VoiceTips.tsx","../../src/state/onboardingStore.ts","../../src/state/consentOverlayStore.ts","../../src/components/layout/AppShell.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst MicOff = createLucideIcon(\"MicOff\", [\n  [\"line\", { x1: \"2\", x2: \"22\", y1: \"2\", y2: \"22\", key: \"a6p6uj\" }],\n  [\"path\", { d: \"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2\", key: \"80xlxr\" }],\n  [\"path\", { d: \"M5 10v2a7 7 0 0 0 12 5\", key: \"p2k8kg\" }],\n  [\"path\", { d: \"M15 9.34V5a3 3 0 0 0-5.68-1.33\", key: \"1gzdoj\" }],\n  [\"path\", { d: \"M9 9v3a3 3 0 0 0 5.12 2.12\", key: \"r2i35w\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"19\", y2: \"22\", key: \"x3vr5v\" }]\n]);\n\nexport { MicOff as default };\n//# sourceMappingURL=mic-off.js.map\n","/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Mic = createLucideIcon(\"Mic\", [\n  [\"path\", { d: \"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z\", key: \"131961\" }],\n  [\"path\", { d: \"M19 10v2a7 7 0 0 1-14 0v-2\", key: \"1vc78b\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"19\", y2: \"22\", key: \"x3vr5v\" }]\n]);\n\nexport { Mic as default };\n//# sourceMappingURL=mic.js.map\n","import { create } from 'zustand';\r\nimport { ipc } from '../lib/ipc-typed';\r\n\r\nexport type TabGraphNode = {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  domain: string;\r\n  containerId?: string;\r\n  containerName?: string;\r\n  containerColor?: string;\r\n  mode?: 'normal' | 'ghost' | 'private';\r\n  active: boolean;\r\n  createdAt?: number;\r\n  lastActiveAt?: number;\r\n};\r\n\r\nexport type TabGraphEdge = {\r\n  id: string;\r\n  source: string;\r\n  target: string;\r\n  weight: number;\r\n  reasons: string[];\r\n};\r\n\r\nexport type TabGraphSummary = {\r\n  totalTabs: number;\r\n  activeTabs: number;\r\n  domains: number;\r\n  containers: number;\r\n};\r\n\r\nexport type TabGraphData = {\r\n  nodes: TabGraphNode[];\r\n  edges: TabGraphEdge[];\r\n  summary: TabGraphSummary;\r\n  updatedAt: number;\r\n  clusters?: Array<{ id: string; label: string; tabIds: string[]; domain?: string; strength: number }>;\r\n};\r\n\r\ninterface TabGraphState {\r\n  visible: boolean;\r\n  loading: boolean;\r\n  error: string | null;\r\n  data: TabGraphData | null;\r\n  focusedTabId: string | null;\r\n  open: () => Promise<void>;\r\n  close: () => void;\r\n  toggle: () => Promise<void>;\r\n  refresh: () => Promise<void>;\r\n  setFocusedTab: (tabId: string | null) => void;\r\n  focusTab: (tabId: string) => Promise<void>;\r\n}\r\n\r\nexport const useTabGraphStore = create<TabGraphState>((set, get) => ({\r\n  visible: false,\r\n  loading: false,\r\n  error: null,\r\n  data: null,\r\n  focusedTabId: null,\r\n  async open() {\r\n    if (!get().visible) {\r\n      set({ visible: true });\r\n    }\r\n    await get().refresh();\r\n  },\r\n  close() {\r\n    set({ visible: false, focusedTabId: null });\r\n  },\r\n  async toggle() {\r\n    if (get().visible) {\r\n      set({ visible: false, focusedTabId: null });\r\n    } else {\r\n      set({ visible: true });\r\n      await get().refresh();\r\n    }\r\n  },\r\n  async refresh() {\r\n    set({ loading: true, error: null });\r\n    try {\r\n      const payload = await ipc.graph.tabs();\r\n      if (!payload || typeof payload !== 'object') {\r\n        throw new Error('Graph data unavailable');\r\n      }\r\n      set({ data: payload as TabGraphData, loading: false, error: null });\r\n    } catch (error) {\r\n      set({ loading: false, error: error instanceof Error ? error.message : String(error) });\r\n    }\r\n  },\r\n  setFocusedTab(tabId) {\r\n    set({ focusedTabId: tabId });\r\n  },\r\n  async focusTab(tabId) {\r\n    set({ visible: true, focusedTabId: tabId });\r\n    await get().refresh();\r\n  },\r\n}));\r\n","// @ts-nocheck\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { ExternalLink, Loader2 } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport type { Tab } from '../../state/tabsStore';\nimport { isElectronRuntime } from '../../lib/env';\nimport { OmniDesk } from '../OmniDesk';\n\ninterface TabContentSurfaceProps {\n  tab: Tab | undefined;\n  overlayActive?: boolean;\n}\n\nconst INTERNAL_PROTOCOLS = ['ob://', 'about:', 'chrome://', 'edge://', 'app://', 'omnibrowser://'];\n\nfunction isInternalUrl(url?: string | null): boolean {\n  if (!url) return true;\n  return INTERNAL_PROTOCOLS.some((prefix) => url.startsWith(prefix));\n}\n\nexport function TabContentSurface({ tab, overlayActive }: TabContentSurfaceProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const webviewRef = useRef<any>(null);\n  const iframeRef = useRef<HTMLIFrameElement | null>(null);\n  const isElectron = isElectronRuntime();\n  const [loading, setLoading] = useState(false);\n  const [failedMessage, setFailedMessage] = useState<string | null>(null);\n  const [blockedExternal, setBlockedExternal] = useState(false);\n  const loadingTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const retryCountRef = useRef(0);\n\n  const targetUrl = useMemo(() => {\n    const url = tab?.url;\n    // For about:blank or empty URLs, show OmniDesk (search page) instead of webview\n    if (!url || url === 'about:blank' || isInternalUrl(url)) {\n      return null;\n    }\n    return url;\n  }, [tab?.url]);\n\n  useEffect(() => {\n    if (!isElectron || !webviewRef.current || !targetUrl) {\n      return;\n    }\n\n    const webviewElement = webviewRef.current as Electron.WebviewTag;\n    const LOADING_TIMEOUT_MS = 30000; // 30 seconds\n    // const MAX_RETRIES = 2; // Reserved for future use\n\n    const handleDidStartLoading = () => {\n      setLoading(true);\n      setFailedMessage(null);\n      retryCountRef.current = 0;\n      \n      // Clear any existing timeout\n      if (loadingTimeoutRef.current) {\n        clearTimeout(loadingTimeoutRef.current);\n      }\n      \n      // Set timeout for loading\n      loadingTimeoutRef.current = setTimeout(() => {\n        setLoading(false);\n        setFailedMessage('This page is taking too long to load. Check your connection or try refreshing.');\n      }, LOADING_TIMEOUT_MS);\n    };\n\n    const handleDidStopLoading = () => {\n      if (loadingTimeoutRef.current) {\n        clearTimeout(loadingTimeoutRef.current);\n        loadingTimeoutRef.current = null;\n      }\n      setLoading(false);\n    };\n\n    const handleDomReady = () => {\n      if (loadingTimeoutRef.current) {\n        clearTimeout(loadingTimeoutRef.current);\n        loadingTimeoutRef.current = null;\n      }\n      setLoading(false);\n      setFailedMessage(null);\n      retryCountRef.current = 0;\n    };\n\n    const handleFailLoad = (event: any) => {\n      if (loadingTimeoutRef.current) {\n        clearTimeout(loadingTimeoutRef.current);\n        loadingTimeoutRef.current = null;\n      }\n      setLoading(false);\n      \n      const errorCode = event?.errorCode ?? -1;\n      const errorDescription = event?.errorDescription ?? 'Unknown error';\n      \n      let message = 'Failed to load this page.';\n      if (errorCode === -105 || errorDescription.includes('ERR_NAME_NOT_RESOLVED')) {\n        message = 'Could not resolve the website address. Check your internet connection.';\n      } else if (errorCode === -106 || errorDescription.includes('ERR_INTERNET_DISCONNECTED')) {\n        message = 'No internet connection. Please check your network settings.';\n      } else if (errorCode === -118 || errorDescription.includes('ERR_CONNECTION_TIMED_OUT')) {\n        message = 'Connection timed out. The server may be slow or unreachable.';\n      } else if (errorDescription.includes('ERR_BLOCKED_BY_RESPONSE')) {\n        message = 'This site cannot be embedded for security reasons.';\n      } else {\n        message = `Failed to load: ${errorDescription || 'Unknown error'}`;\n      }\n      \n      setFailedMessage(message);\n    };\n\n    webviewElement.addEventListener('did-start-loading', handleDidStartLoading);\n    webviewElement.addEventListener('did-stop-loading', handleDidStopLoading);\n    webviewElement.addEventListener('dom-ready', handleDomReady);\n    webviewElement.addEventListener('did-fail-load', handleFailLoad);\n\n    return () => {\n      if (loadingTimeoutRef.current) {\n        clearTimeout(loadingTimeoutRef.current);\n        loadingTimeoutRef.current = null;\n      }\n      webviewElement.removeEventListener('did-start-loading', handleDidStartLoading);\n      webviewElement.removeEventListener('did-stop-loading', handleDidStopLoading);\n      webviewElement.removeEventListener('dom-ready', handleDomReady);\n      webviewElement.removeEventListener('did-fail-load', handleFailLoad);\n    };\n  }, [isElectron, targetUrl]);\n\n  useEffect(() => {\n    if (isElectron || !iframeRef.current || !targetUrl) {\n      return;\n    }\n\n    const iframe = iframeRef.current;\n    const LOADING_TIMEOUT_MS = 30000; // 30 seconds\n    let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n    const handleLoad = () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n        timeoutId = null;\n      }\n      setLoading(false);\n      setFailedMessage(null);\n      if (!iframeRef.current) return;\n      try {\n        const doc = iframeRef.current.contentDocument;\n        void doc?.title;\n        setBlockedExternal(false);\n      } catch (error) {\n        if (import.meta.env.DEV) {\n          console.info('[TabContentSurface] cross-origin frame detected', error);\n        }\n        setBlockedExternal(true);\n      }\n    };\n\n    const handleError = () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n        timeoutId = null;\n      }\n      setLoading(false);\n      setFailedMessage('Failed to load this page. Please check the URL or your connection.');\n      setBlockedExternal(true);\n    };\n\n    // Set loading timeout\n    timeoutId = setTimeout(() => {\n      setLoading(false);\n      setFailedMessage('This page is taking too long to load. Check your connection or try refreshing.');\n      timeoutId = null;\n    }, LOADING_TIMEOUT_MS);\n\n    iframe.addEventListener('load', handleLoad);\n    iframe.addEventListener('error', handleError);\n\n    return () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n        timeoutId = null;\n      }\n      iframe.removeEventListener('load', handleLoad);\n      iframe.removeEventListener('error', handleError);\n    };\n  }, [isElectron, targetUrl]);\n\n  const launchExternal = useCallback(() => {\n    if (!targetUrl) return;\n    try {\n      window.open(targetUrl, '_blank', 'noopener,noreferrer');\n    } catch (error) {\n      console.warn('[TabContentSurface] failed to open external window', error);\n    }\n  }, [targetUrl]);\n\n  useEffect(() => {\n    if (!targetUrl) {\n      setLoading(false);\n      setFailedMessage(null);\n      setBlockedExternal(false);\n      return;\n    }\n\n    if (isElectron) {\n      const webviewElement = webviewRef.current as Electron.WebviewTag | null;\n      if (!webviewElement) return;\n      try {\n        const currentUrl = webviewElement.getURL?.();\n        if (currentUrl !== targetUrl) {\n          setLoading(true);\n          webviewElement.setAttribute('src', targetUrl);\n        }\n      } catch (error) {\n        console.warn('[TabContentSurface] Failed to update webview src', error);\n      }\n    } else {\n      const iframe = iframeRef.current;\n      if (!iframe) return;\n      if (iframe.src !== targetUrl) {\n        setLoading(true);\n        iframe.src = targetUrl;\n      }\n      setBlockedExternal(false);\n    }\n  }, [isElectron, targetUrl]);\n\n  const panelId = tab?.id ? `tabpanel-${tab.id}` : 'tabpanel-empty';\n  const labelledById = tab?.id ? `tab-${tab.id}` : undefined;\n  const isInactive = !tab || !tab.active;\n\n  // Show OmniDesk (search page) for about:blank or internal URLs\n  if (!targetUrl) {\n    return (\n      <motion.div\n        id={panelId}\n        role=\"tabpanel\"\n        aria-labelledby={labelledById}\n        aria-hidden={isInactive}\n        className=\"h-full w-full overflow-hidden bg-[#1A1D28]\"\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        transition={{ duration: 0.2 }}\n        style={{ \n          position: 'absolute',\n          inset: 0,\n          zIndex: isInactive ? 0 : 1,\n          pointerEvents: 'auto',\n        }}\n      >\n        <OmniDesk variant=\"split\" forceShow />\n      </motion.div>\n    );\n  }\n\n  return (\n    <motion.div\n      ref={containerRef}\n      className={`relative h-full w-full bg-slate-950 ${overlayActive ? 'pointer-events-none' : ''}`}\n      key={targetUrl}\n      id={panelId}\n      role=\"tabpanel\"\n      aria-labelledby={labelledById}\n      aria-hidden={isInactive}\n      initial={{ opacity: 0.4 }}\n      animate={{ opacity: 1 }}\n      transition={{ duration: 0.35, ease: 'easeOut' }}\n      style={{\n        position: 'absolute',\n        inset: 0,\n        zIndex: isInactive ? 0 : 1,\n      }}\n    >\n      {isElectron ? (\n        <webview\n          ref={webviewRef}\n          className=\"h-full w-full\"\n          style={{ width: '100%', height: '100%', display: isInactive ? 'none' : 'block' }}\n          src={targetUrl}\n          allowpopups=\"true\"\n          autosize=\"on\"\n          disablewebsecurity=\"false\"\n          aria-label={tab?.title ? `Content for ${tab.title}` : 'Tab content'}\n        />\n      ) : (\n        <iframe\n          ref={iframeRef}\n          className=\"h-full w-full\"\n          style={{ width: '100%', height: '100%' }}\n          src={targetUrl ?? 'about:blank'}\n          sandbox=\"allow-scripts allow-same-origin allow-forms allow-popups\"\n          allow=\"fullscreen\"\n          title={tab?.title ?? 'Tab content'}\n          aria-label={tab?.title ? `Content for ${tab.title}` : 'Tab content'}\n        />\n      )}\n\n      <AnimatePresence>\n        {loading && (\n          <motion.div\n            className=\"pointer-events-none absolute inset-0 z-10 flex items-center justify-center bg-slate-950/55 backdrop-blur-sm\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            role=\"status\"\n            aria-live=\"polite\"\n            aria-label=\"Loading page content\"\n          >\n            <motion.div\n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.95, opacity: 0 }}\n              transition={{ duration: 0.2 }}\n              className=\"flex flex-col items-center gap-4 rounded-2xl border border-slate-700/60 bg-slate-900/90 px-6 py-5 text-sm text-slate-200 shadow-lg shadow-black/40\"\n            >\n              <motion.div\n                animate={{ rotate: 360 }}\n                transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}\n              >\n                <Loader2 className=\"h-6 w-6 text-emerald-300\" aria-hidden=\"true\" />\n              </motion.div>\n              <div className=\"text-center w-full max-w-xs\">\n                <div className=\"font-medium mb-2\">Loading {new URL(targetUrl).hostname}â€¦</div>\n                <div className=\"mt-1 text-xs text-slate-400 mb-3\">This may take a moment</div>\n                <div className=\"w-full\">\n                  <div className=\"h-1 w-full overflow-hidden rounded-full bg-slate-800/60\">\n                    <motion.div\n                      className=\"h-full bg-gradient-to-r from-emerald-500 via-cyan-500 to-emerald-500\"\n                      initial={{ x: '-100%', width: '40%' }}\n                      animate={{\n                        x: ['-100%', '100%'],\n                      }}\n                      transition={{\n                        duration: 1.5,\n                        repeat: Infinity,\n                        ease: 'easeInOut',\n                      }}\n                    />\n                  </div>\n                </div>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      <AnimatePresence>\n        {failedMessage && (\n          <motion.div\n            className=\"pointer-events-auto absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            role=\"alert\"\n            aria-live=\"assertive\"\n          >\n            <motion.div\n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.9, opacity: 0 }}\n              transition={{ duration: 0.18 }}\n              className=\"max-w-md space-y-3 rounded-2xl border border-amber-400/40 bg-amber-500/15 px-5 py-4 text-center text-sm text-amber-100 shadow-lg shadow-black/50\"\n            >\n              <div className=\"font-medium\">{failedMessage}</div>\n              <div className=\"flex items-center justify-center gap-2\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    if (targetUrl && isElectron && webviewRef.current) {\n                      const webviewElement = webviewRef.current as Electron.WebviewTag;\n                      setFailedMessage(null);\n                      setLoading(true);\n                      webviewElement.reload();\n                    } else if (targetUrl && !isElectron && iframeRef.current) {\n                      setFailedMessage(null);\n                      setLoading(true);\n                      iframeRef.current.src = targetUrl;\n                    }\n                  }}\n                  className=\"rounded-lg border border-amber-400/60 bg-amber-500/20 px-3 py-1.5 text-xs font-medium text-amber-50 transition-colors hover:bg-amber-500/30\"\n                >\n                  Retry\n                </button>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      <AnimatePresence>\n        {!isElectron && blockedExternal && (\n          <motion.div\n            className=\"absolute inset-0 z-20 flex items-center justify-center bg-slate-950/85 px-6\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n          >\n            <motion.div\n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.92, opacity: 0 }}\n              transition={{ duration: 0.22 }}\n              className=\"max-w-lg space-y-4 rounded-3xl border border-emerald-500/40 bg-emerald-500/15 p-6 text-center text-sm text-emerald-100 shadow-2xl shadow-black/50\"\n            >\n              <div className=\"text-lg font-semibold text-emerald-50\">\n                {new URL(targetUrl).hostname} works best in its own tab\n              </div>\n              <p className=\"text-emerald-100/70\">\n                This site blocks embedded views for security. Open it in a dedicated tab or use the\n                Electron build for a fully integrated webview.\n              </p>\n              <button\n                type=\"button\"\n                onClick={launchExternal}\n                className=\"inline-flex items-center gap-2 rounded-xl border border-emerald-400/60 bg-emerald-500/20 px-4 py-2 text-sm font-medium text-emerald-50 transition hover:border-emerald-300/70 hover:bg-emerald-500/30\"\n              >\n                <ExternalLink size={16} />\n                Open {new URL(targetUrl).hostname}\n              </button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n","/**\r\n * Regen Whisper - AI voice tips for hands-free navigation\r\n * Unique feature: Proactive voice guidance > Opera's passive voice\r\n */\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Mic, MicOff, Volume2, X, Sparkles } from 'lucide-react';\r\nimport { ipc } from '../../lib/ipc-typed';\r\n\r\ninterface VoiceTip {\r\n  id: string;\r\n  message: string;\r\n  action?: () => void;\r\n  priority: 'low' | 'medium' | 'high';\r\n  timestamp: number;\r\n}\r\n\r\nexport function VoiceTips() {\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [tips, setTips] = useState<VoiceTip[]>([]);\r\n  const [currentTip, setCurrentTip] = useState<VoiceTip | null>(null);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Generate contextual tips based on user activity\r\n    const generateTip = (): VoiceTip | null => {\r\n      const tipPool: Omit<VoiceTip, 'id' | 'timestamp'>[] = [\r\n        {\r\n          message: 'Say \"new tab\" to open a fresh browsing session',\r\n          priority: 'low',\r\n        },\r\n        {\r\n          message: 'Try \"search for regenerative design\" to start research',\r\n          priority: 'medium',\r\n        },\r\n        {\r\n          message: 'Voice command: \"switch to research mode\"',\r\n          priority: 'low',\r\n        },\r\n        {\r\n          message: 'Ask \"what trackers are blocked?\" for privacy status',\r\n          priority: 'medium',\r\n        },\r\n        {\r\n          message: 'Say \"show consent timeline\" to review privacy decisions',\r\n          priority: 'high',\r\n        },\r\n      ];\r\n\r\n      const tip = tipPool[Math.floor(Math.random() * tipPool.length)];\r\n      if (!tip) return null;\r\n\r\n      return {\r\n        ...tip,\r\n        id: `tip-${Date.now()}`,\r\n        timestamp: Date.now(),\r\n      };\r\n    };\r\n\r\n    // Show a tip every 30-60 seconds when not actively browsing\r\n    const interval = setInterval(() => {\r\n      if (!isMuted && tips.length < 3) {\r\n        const newTip = generateTip();\r\n        if (newTip) {\r\n          setTips((prev) => [...prev, newTip].slice(-3));\r\n        }\r\n      }\r\n    }, 45000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [isMuted, tips.length]);\r\n\r\n  useEffect(() => {\r\n    // Show the most recent tip\r\n    if (tips.length > 0) {\r\n      setCurrentTip(tips[tips.length - 1]);\r\n      const timer = setTimeout(() => {\r\n        setCurrentTip(null);\r\n        setTips((prev) => prev.slice(1));\r\n      }, 8000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [tips]);\r\n\r\n  const handleVoiceCommand = useCallback(async (command: string) => {\r\n    const lower = command.toLowerCase().trim();\r\n\r\n    if (lower.includes('new tab') || lower.includes('open tab')) {\r\n      await ipc.tabs.create('about:blank');\r\n      return { success: true, message: 'Opened new tab' };\r\n    }\r\n\r\n    if (lower.includes('research mode') || lower.includes('switch to research')) {\r\n      // Navigate to research mode\r\n      window.location.hash = '#/';\r\n      return { success: true, message: 'Switched to research mode' };\r\n    }\r\n\r\n    if (lower.includes('trackers') || lower.includes('privacy')) {\r\n      // Open trust dashboard\r\n      const { useTrustDashboardStore } = await import('../../state/trustDashboardStore');\r\n      useTrustDashboardStore.getState().open();\r\n      return { success: true, message: 'Opened privacy dashboard' };\r\n    }\r\n\r\n    if (lower.includes('consent timeline')) {\r\n      const { useConsentOverlayStore } = await import('../../state/consentOverlayStore');\r\n      useConsentOverlayStore.getState().open();\r\n      return { success: true, message: 'Opened consent timeline' };\r\n    }\r\n\r\n    return { success: false, message: 'Command not recognized' };\r\n  }, []);\r\n\r\n  const startListening = useCallback(async () => {\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      console.warn('[VoiceTips] Speech recognition not available');\r\n      return;\r\n    }\r\n\r\n    setIsListening(true);\r\n    const Recognition = (window as any).webkitSpeechRecognition || (window as any).SpeechRecognition;\r\n    const recognition = new Recognition();\r\n    recognition.continuous = false;\r\n    recognition.interimResults = false;\r\n    recognition.lang = 'en-US';\r\n\r\n    recognition.onresult = (event: any) => {\r\n      const transcript = event.results[0][0].transcript;\r\n      void handleVoiceCommand(transcript);\r\n      setIsListening(false);\r\n    };\r\n\r\n    recognition.onerror = () => {\r\n      setIsListening(false);\r\n    };\r\n\r\n    recognition.onend = () => {\r\n      setIsListening(false);\r\n    };\r\n\r\n    recognition.start();\r\n  }, [handleVoiceCommand]);\r\n\r\n  if (isMuted) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <AnimatePresence>\r\n        {currentTip && (\r\n          <motion.div\r\n            initial={{ opacity: 0, y: 20, scale: 0.95 }}\r\n            animate={{ opacity: 1, y: 0, scale: 1 }}\r\n            exit={{ opacity: 0, y: -10, scale: 0.95 }}\r\n            className=\"fixed bottom-24 left-1/2 z-50 -translate-x-1/2\"\r\n          >\r\n            <div className=\"flex items-center gap-3 rounded-2xl border border-blue-500/40 bg-blue-500/15 px-4 py-3 text-sm text-blue-100 shadow-lg backdrop-blur-sm\">\r\n              <Sparkles size={16} className=\"text-blue-300\" />\r\n              <span>{currentTip.message}</span>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  setCurrentTip(null);\r\n                  setTips((prev) => prev.filter((t) => t.id !== currentTip.id));\r\n                }}\r\n                className=\"ml-2 rounded-lg p-1 hover:bg-blue-500/20\"\r\n                aria-label=\"Dismiss tip\"\r\n              >\r\n                <X size={14} />\r\n              </button>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      <div className=\"fixed bottom-4 right-4 z-50\">\r\n        <div className=\"flex flex-col items-end gap-2\">\r\n          <motion.button\r\n            type=\"button\"\r\n            onClick={() => setIsMuted(!isMuted)}\r\n            className=\"flex items-center justify-center rounded-full border border-slate-700/60 bg-slate-900/90 p-2.5 text-slate-200 shadow-lg backdrop-blur-sm hover:bg-slate-800/90\"\r\n            whileHover={{ scale: 1.05 }}\r\n            whileTap={{ scale: 0.95 }}\r\n            aria-label={isMuted ? 'Unmute voice tips' : 'Mute voice tips'}\r\n          >\r\n            {isMuted ? <Volume2 size={18} /> : <MicOff size={18} />}\r\n          </motion.button>\r\n\r\n          {!isMuted && (\r\n            <motion.button\r\n              type=\"button\"\r\n              onClick={startListening}\r\n              disabled={isListening}\r\n              className={`flex items-center justify-center rounded-full border p-3 shadow-lg backdrop-blur-sm transition-all ${\r\n                isListening\r\n                  ? 'border-emerald-500/60 bg-emerald-500/20 text-emerald-200'\r\n                  : 'border-blue-500/60 bg-blue-500/20 text-blue-200 hover:bg-blue-500/30'\r\n              }`}\r\n              whileHover={{ scale: 1.05 }}\r\n              whileTap={{ scale: 0.95 }}\r\n              animate={isListening ? { scale: [1, 1.1, 1] } : {}}\r\n              transition={{ duration: 1.5, repeat: isListening ? Infinity : 0 }}\r\n              aria-label=\"Start voice command\"\r\n            >\r\n              <Mic size={20} />\r\n            </motion.button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\n","import { create } from 'zustand';\r\n\r\ninterface OnboardingState {\r\n  visible: boolean;\r\n  start: () => void;\r\n  finish: () => void;\r\n  reset: () => void;\r\n}\r\n\r\nconst STORAGE_KEY = 'omnibrowser:onboarding:completed';\r\n\r\nexport const onboardingStorage = {\r\n  isCompleted(): boolean {\r\n    try {\r\n      return window.localStorage.getItem(STORAGE_KEY) === '1';\r\n    } catch {\r\n      return false;\r\n    }\r\n  },\r\n  setCompleted(): void {\r\n    try {\r\n      window.localStorage.setItem(STORAGE_KEY, '1');\r\n    } catch {\r\n      /* ignore */\r\n    }\r\n  },\r\n  clear(): void {\r\n    try {\r\n      window.localStorage.removeItem(STORAGE_KEY);\r\n    } catch {\r\n      /* ignore */\r\n    }\r\n  },\r\n};\r\n\r\nexport const useOnboardingStore = create<OnboardingState>((set) => ({\r\n  visible: false,\r\n  start: () => {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[OnboardingStore] start() called');\r\n    }\r\n    set({ visible: true });\r\n  },\r\n  finish: () => {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[OnboardingStore] finish() called');\r\n    }\r\n    onboardingStorage.setCompleted();\r\n    set({ visible: false });\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[OnboardingStore] visible set to false');\r\n    }\r\n  },\r\n  reset: () => {\r\n    onboardingStorage.clear();\r\n    set({ visible: true });\r\n  },\r\n}));\r\n\r\nif (typeof window !== 'undefined') {\r\n  (window as typeof window & { __STORE?: Record<string, unknown> }).__STORE = {\r\n    ...(window as typeof window & { __STORE?: Record<string, unknown> }).__STORE,\r\n    onboarding: useOnboardingStore,\r\n  };\r\n}","import { create } from 'zustand';\r\nimport { ipc } from '../lib/ipc-typed';\r\nimport type { ConsentRecord, ConsentActionType } from '../types/consent';\r\n\r\ninterface ConsentOverlayState {\r\n  visible: boolean;\r\n  loading: boolean;\r\n  error: string | null;\r\n  filter: {\r\n    type?: ConsentActionType | 'all';\r\n    status?: 'all' | 'pending' | 'approved' | 'revoked';\r\n  };\r\n  records: ConsentRecord[];\r\n  open: () => Promise<void>;\r\n  close: () => void;\r\n  toggle: () => Promise<void>;\r\n  refresh: () => Promise<void>;\r\n  setFilter: (filter: Partial<ConsentOverlayState['filter']>) => Promise<void>;\r\n  approve: (consentId: string) => Promise<void>;\r\n  revoke: (consentId: string) => Promise<void>;\r\n}\r\n\r\nasync function fetchRecords(filter: ConsentOverlayState['filter']): Promise<ConsentRecord[]> {\r\n  const payload: { type?: ConsentActionType; approved?: boolean } = {};\r\n  if (filter.type && filter.type !== 'all') {\r\n    payload.type = filter.type;\r\n  }\r\n  if (filter.status && filter.status !== 'all') {\r\n    if (filter.status === 'pending') {\r\n      payload.approved = false;\r\n    } else if (filter.status === 'approved' || filter.status === 'revoked') {\r\n      payload.approved = true;\r\n    }\r\n  }\r\n  const list = await ipc.consent.list(Object.keys(payload).length > 0 ? payload : undefined);\r\n  if (!Array.isArray(list)) {\r\n    return [];\r\n  }\r\n  let filtered = list;\r\n  if (filter.status === 'pending') {\r\n    filtered = filtered.filter((record) => !record.approved);\r\n  } else if (filter.status === 'approved') {\r\n    filtered = filtered.filter((record) => record.approved && !record.revokedAt);\r\n  } else if (filter.status === 'revoked') {\r\n    filtered = filtered.filter((record) => Boolean(record.revokedAt));\r\n  }\r\n  return filtered.sort((a, b) => b.timestamp - a.timestamp);\r\n}\r\n\r\nexport const useConsentOverlayStore = create<ConsentOverlayState>((set, get) => ({\r\n  visible: false,\r\n  loading: false,\r\n  error: null,\r\n  filter: { type: 'all', status: 'all' },\r\n  records: [],\r\n  async open() {\r\n    if (!get().visible) {\r\n      set({ visible: true });\r\n    }\r\n    await get().refresh();\r\n  },\r\n  close() {\r\n    set({ visible: false });\r\n  },\r\n  async toggle() {\r\n    if (get().visible) {\r\n      set({ visible: false });\r\n    } else {\r\n      set({ visible: true });\r\n      await get().refresh();\r\n    }\r\n  },\r\n  async refresh() {\r\n    set({ loading: true, error: null });\r\n    try {\r\n      const records = await fetchRecords(get().filter);\r\n      set({ records, loading: false, error: null });\r\n    } catch (error) {\r\n      set({\r\n        loading: false,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n    }\r\n  },\r\n  async setFilter(partial) {\r\n    set((state) => ({ filter: { ...state.filter, ...partial } }));\r\n    await get().refresh();\r\n  },\r\n  async approve(consentId) {\r\n    await ipc.consent.approve(consentId);\r\n    await get().refresh();\r\n  },\r\n  async revoke(consentId) {\r\n    await ipc.consent.revoke(consentId);\r\n    await get().refresh();\r\n  },\r\n}));\r\n","/**\r\n * AppShell - Main layout container with all components wired\r\n */\r\n\r\nimport React, { useState, useEffect, Suspense, useMemo, useCallback } from 'react';\r\nimport { AlertTriangle, RotateCcw, Loader2 } from 'lucide-react';\r\nimport { Outlet } from 'react-router-dom';\r\nimport { PermissionRequest, ConsentRequest, ipcEvents } from '../../lib/ipc-events';\r\nimport { useIPCEvent } from '../../lib/use-ipc-event';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { ResearchHighlight } from '../../types/research';\r\nimport { Portal } from '../common/Portal';\r\nimport { formatDistanceToNow } from 'date-fns';\r\nimport { useTabGraphStore } from '../../state/tabGraphStore';\r\nimport { isDevEnv } from '../../lib/env';\r\nimport { TabContentSurface } from './TabContentSurface';\r\nimport { VoiceTips } from '../voice/VoiceTips';\r\n\r\ntype ErrorBoundaryState = {\r\n  hasError: boolean;\r\n  error?: Error;\r\n  errorInfo?: string;\r\n  copyStatus: 'success' | 'error' | null;\r\n  copyMessage?: string;\r\n  copying: boolean;\r\n};\r\n\r\nclass ErrorBoundary extends React.Component<\r\n  { children: React.ReactNode; fallback?: React.ReactNode; componentName?: string },\r\n  ErrorBoundaryState\r\n> {\r\n  constructor(props: { children: React.ReactNode; fallback?: React.ReactNode; componentName?: string }) {\r\n    super(props);\r\n    this.state = { hasError: false, copyStatus: null, copying: false };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error) {\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n    console.error(\r\n      `ErrorBoundary caught error${this.props.componentName ? ` in ${this.props.componentName}` : ''}:`,\r\n      error,\r\n      errorInfo,\r\n    );\r\n    this.setState({ error, errorInfo: errorInfo.componentStack ?? undefined });\r\n    \r\n    // Optional: Send to error tracking service (e.g., Sentry)\r\n    if (process.env.NODE_ENV === 'production') {\r\n      // Example: Sentry.captureException(error, { contexts: { react: errorInfo } });\r\n    }\r\n  }\r\n\r\n  private handleReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  private handleOpenLogs = async () => {\r\n    try {\r\n      const result = await ipc.diagnostics.openLogs();\r\n      this.setState({\r\n        copyStatus: result?.success ? 'success' : 'error',\r\n        copyMessage: result?.success ? 'Logs folder opened.' : 'Unable to open logs folder.',\r\n        copying: false,\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to open logs folder from error boundary:', error);\r\n      this.setState({\r\n        copyStatus: 'error',\r\n        copyMessage: 'Failed to open logs folder.',\r\n        copying: false,\r\n      });\r\n    }\r\n  };\r\n\r\n  private handleCopyDiagnostics = async () => {\r\n    if (this.state.copying) return;\r\n    this.setState({ copying: true, copyStatus: null, copyMessage: undefined });\r\n    try {\r\n      const result = await ipc.diagnostics.copyDiagnostics();\r\n      if (result?.diagnostics && navigator?.clipboard?.writeText) {\r\n        await navigator.clipboard.writeText(result.diagnostics);\r\n        this.setState({\r\n          copyStatus: 'success',\r\n          copyMessage: 'Diagnostics copied to clipboard.',\r\n          copying: false,\r\n        });\r\n      } else {\r\n        this.setState({\r\n          copyStatus: 'error',\r\n          copyMessage: 'Clipboard unavailable. Diagnostics logged to console.',\r\n          copying: false,\r\n        });\r\n        console.info('[Diagnostics] Summary:', result?.diagnostics);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to copy diagnostics from error boundary:', error);\r\n      this.setState({\r\n        copyStatus: 'error',\r\n        copyMessage: 'Failed to copy diagnostics.',\r\n        copying: false,\r\n      });\r\n    }\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      return (\r\n        <div className=\"flex min-h-screen w-full items-center justify-center bg-slate-950 px-6 py-12 text-gray-100\">\r\n          <div className=\"w-full max-w-xl space-y-5 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 shadow-lg\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <div className=\"rounded-full bg-red-500/20 p-2 text-red-200\">\r\n                <AlertTriangle className=\"h-5 w-5\" />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-lg font-semibold text-red-200\">\r\n                  Something went wrong{this.props.componentName ? ` inside ${this.props.componentName}` : ''}.\r\n                </h1>\r\n                {this.state.error?.message && (\r\n                  <p className=\"mt-2 text-sm text-red-100/80\">{this.state.error.message}</p>\r\n                )}\r\n                <p className=\"mt-2 text-sm text-gray-400\">\r\n                  Try reloading the interface. You can also copy diagnostics or inspect the latest logs to share with the\r\n                  team.\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex flex-wrap gap-3\">\r\n              <button\r\n                onClick={this.handleReload}\r\n                className=\"rounded-lg border border-blue-500/50 bg-blue-500/10 px-4 py-2 text-sm font-medium text-blue-100 hover:border-blue-500/70 transition-colors\"\r\n              >\r\n                Reload app\r\n              </button>\r\n              <button\r\n                onClick={this.handleCopyDiagnostics}\r\n                disabled={this.state.copying}\r\n                className={`rounded-lg border px-4 py-2 text-sm font-medium transition-colors ${\r\n                  this.state.copying\r\n                    ? 'border-indigo-500/30 bg-indigo-500/10 text-indigo-200/60 cursor-wait'\r\n                    : 'border-indigo-500/50 bg-indigo-500/10 text-indigo-100 hover:border-indigo-500/70'\r\n                }`}\r\n              >\r\n                {this.state.copying ? 'Copyingâ€¦' : 'Copy diagnostics'}\r\n              </button>\r\n              <button\r\n                onClick={this.handleOpenLogs}\r\n                className=\"rounded-lg border border-emerald-500/50 bg-emerald-500/10 px-4 py-2 text-sm font-medium text-emerald-100 hover:border-emerald-500/70 transition-colors\"\r\n              >\r\n                Open logs folder\r\n              </button>\r\n            </div>\r\n\r\n            {this.state.copyMessage && (\r\n              <div\r\n                className={`text-sm ${\r\n                  this.state.copyStatus === 'success' ? 'text-emerald-300' : 'text-red-300'\r\n                }`}\r\n              >\r\n                {this.state.copyMessage}\r\n              </div>\r\n            )}\r\n\r\n            {isDevEnv() && this.state.errorInfo && (\r\n              <details className=\"text-xs text-gray-400\">\r\n                <summary className=\"cursor-pointer text-gray-300\">Stack trace</summary>\r\n                <pre className=\"mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded bg-black/40 p-3\">\r\n                  {this.state.errorInfo}\r\n                </pre>\r\n              </details>\r\n            )}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\n// Lazy load heavy components\r\nconst TopNav = React.lazy(() => import('./TopNav').then(m => ({ default: m.TopNav })));\r\nconst TabStrip = React.lazy(() => import('./TabStrip').then(m => ({ default: m.TabStrip })));\r\nconst RightPanel = React.lazy(() => import('./RightPanel').then(m => ({ default: m.RightPanel })));\r\nconst BottomStatus = React.lazy(() => import('./BottomStatus').then(m => ({ default: m.BottomStatus })));\r\nconst CommandPalette = React.lazy(() => import('./CommandPalette').then(m => ({ default: m.CommandPalette })));\r\nconst PermissionPrompt = React.lazy(() => import('../Overlays/PermissionPrompt').then(m => ({ default: m.PermissionPrompt })));\r\nconst ConsentPrompt = React.lazy(() => import('../Overlays/ConsentPrompt').then(m => ({ default: m.ConsentPrompt })));\r\nconst AgentOverlay = React.lazy(() => import('../AgentOverlay').then(m => ({ default: m.AgentOverlay })));\r\nconst ClipperOverlay = React.lazy(() => import('../Overlays/ClipperOverlay').then(m => ({ default: m.ClipperOverlay })));\r\nconst ReaderOverlay = React.lazy(() => import('../Overlays/ReaderOverlay').then(m => ({ default: m.ReaderOverlay })));\r\nconst TabGraphOverlay = React.lazy(() => import('./TabGraphOverlay').then(m => ({ default: m.TabGraphOverlay })));\r\nconst ConsentDashboard = React.lazy(() => import('../Consent/ConsentDashboard').then(m => ({ default: m.ConsentDashboard })));\r\nconst TrustEthicsDashboard = React.lazy(() => import('../trust/TrustEthicsDashboard').then(m => ({ default: m.TrustEthicsDashboard })));\r\nconst OnboardingTour = React.lazy(() => import('../Onboarding/OnboardingTour').then(m => ({ default: m.OnboardingTour })));\r\n\r\nimport { useOnboardingStore, onboardingStorage } from '../../state/onboardingStore';\r\nimport { useConsentOverlayStore } from '../../state/consentOverlayStore';\r\nimport { useTrustDashboardStore } from '../../state/trustDashboardStore';\r\n\r\nexport function AppShell() {\r\n  const [rightPanelOpen, setRightPanelOpen] = useState(false);\r\n  const [commandPaletteOpen, setCommandPaletteOpen] = useState(false);\r\n  const [permissionRequest, setPermissionRequest] = useState<PermissionRequest | null>(null);\r\n  const [consentRequest, setConsentRequest] = useState<ConsentRequest | null>(null);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  \r\n  // Initialize fullscreen state on mount - ensure it starts as false\r\n  useEffect(() => {\r\n    // Force initial state to false (window should not start in fullscreen)\r\n    setIsFullscreen(false);\r\n    \r\n    // Check initial fullscreen state after a brief delay to ensure window is ready\r\n    const checkFullscreen = () => {\r\n      const isCurrentlyFullscreen = !!(document.fullscreenElement || (window as any).webkitFullscreenElement || (window as any).mozFullScreenElement);\r\n      if (isCurrentlyFullscreen !== isFullscreen) {\r\n        setIsFullscreen(isCurrentlyFullscreen);\r\n      }\r\n    };\r\n    \r\n    // Check after a brief delay to ensure window is ready\r\n    const timeoutId = setTimeout(checkFullscreen, 100);\r\n    \r\n    // Listen for fullscreen changes\r\n    document.addEventListener('fullscreenchange', checkFullscreen);\r\n    document.addEventListener('webkitfullscreenchange', checkFullscreen);\r\n    document.addEventListener('mozfullscreenchange', checkFullscreen);\r\n    \r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      document.removeEventListener('fullscreenchange', checkFullscreen);\r\n      document.removeEventListener('webkitfullscreenchange', checkFullscreen);\r\n      document.removeEventListener('mozfullscreenchange', checkFullscreen);\r\n    };\r\n  }, []);\r\n  const [clipperActive, setClipperActive] = useState(false);\r\n  const [readerActive, setReaderActive] = useState(false);\r\n  const onboardingVisible = useOnboardingStore((state) => state.visible);\r\n  const startOnboarding = useOnboardingStore((state) => state.start);\r\n  const _finishOnboarding = useOnboardingStore((state) => state.finish);\r\n  \r\n  // Debug: log visibility changes\r\n  useEffect(() => {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[AppShell] onboardingVisible changed:', onboardingVisible);\r\n    }\r\n  }, [onboardingVisible]);\r\n  const [graphDropHint, setGraphDropHint] = useState(false);\r\n  useEffect(() => {\r\n    let dragCounter = 0;\r\n\r\n    const isGraphDrag = (event: DragEvent) => {\r\n      const types = event.dataTransfer?.types;\r\n      if (!types) return false;\r\n      return Array.from(types).includes('application/x-omnibrowser-tab-id');\r\n    };\r\n\r\n    const handleDragEnter = (event: DragEvent) => {\r\n      if (!isGraphDrag(event)) return;\r\n      event.preventDefault();\r\n      dragCounter += 1;\r\n      setGraphDropHint(true);\r\n    };\r\n\r\n    const handleDragOver = (event: DragEvent) => {\r\n      if (!isGraphDrag(event)) return;\r\n      event.preventDefault();\r\n      if (event.dataTransfer) {\r\n        event.dataTransfer.dropEffect = 'copy';\r\n      }\r\n    };\r\n\r\n    const handleDragLeave = (event: DragEvent) => {\r\n      if (!isGraphDrag(event)) return;\r\n      dragCounter = Math.max(0, dragCounter - 1);\r\n      if (dragCounter === 0) {\r\n        setGraphDropHint(false);\r\n      }\r\n    };\r\n\r\n    const handleDragEnd = () => {\r\n      dragCounter = 0;\r\n      setGraphDropHint(false);\r\n    };\r\n\r\n    const handleDrop = (event: DragEvent) => {\r\n      if (!isGraphDrag(event)) return;\r\n      event.preventDefault();\r\n      dragCounter = 0;\r\n      setGraphDropHint(false);\r\n      const tabId = event.dataTransfer?.getData('application/x-omnibrowser-tab-id');\r\n      if (tabId) {\r\n        try {\r\n          void useTabGraphStore.getState().focusTab(tabId);\r\n        } catch (error) {\r\n          if (isDevEnv()) {\r\n            console.warn('[AppShell] Failed to focus tab graph from drop', error);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleCustomDragEnd = () => {\r\n      dragCounter = 0;\r\n      setGraphDropHint(false);\r\n    };\r\n\r\n    document.addEventListener('dragenter', handleDragEnter);\r\n    document.addEventListener('dragover', handleDragOver);\r\n    document.addEventListener('dragleave', handleDragLeave);\r\n    document.addEventListener('dragend', handleDragEnd);\r\n    document.addEventListener('drop', handleDrop);\r\n    window.addEventListener('tabgraph:dragend', handleCustomDragEnd as EventListener);\r\n\r\n    return () => {\r\n      document.removeEventListener('dragenter', handleDragEnter);\r\n      document.removeEventListener('dragover', handleDragOver);\r\n      document.removeEventListener('dragleave', handleDragLeave);\r\n      document.removeEventListener('dragend', handleDragEnd);\r\n      document.removeEventListener('drop', handleDrop);\r\n      window.removeEventListener('tabgraph:dragend', handleCustomDragEnd as EventListener);\r\n    };\r\n  }, []);\r\n  const consentVisible = useConsentOverlayStore((state) => state.visible);\r\n  const trustDashboardVisible = useTrustDashboardStore((state) => state.visible);\r\n  const tabsState = useTabsStore();\r\n  const activeTab = tabsState.tabs.find(tab => tab.id === tabsState.activeId);\r\n  const [contentSplit, setContentSplit] = useState(0.62);\r\n  const [isResizingContent, setIsResizingContent] = useState(false);\r\n  const overlayActive =\r\n    commandPaletteOpen ||\r\n    Boolean(permissionRequest) ||\r\n    Boolean(consentRequest) ||\r\n    clipperActive ||\r\n    readerActive;\r\n  const activeTabUrl = activeTab?.url ?? '';\r\n  const showWebContent =\r\n    Boolean(activeTabUrl) &&\r\n    !activeTabUrl.startsWith('ob://') &&\r\n    !activeTabUrl.startsWith('about:') &&\r\n    !activeTabUrl.startsWith('chrome://') &&\r\n    !activeTabUrl.startsWith('edge://') &&\r\n    !activeTabUrl.startsWith('app://');\r\n  const handleResizeStart = useCallback(() => {\r\n    if (!showWebContent) return;\r\n    setIsResizingContent(true);\r\n  }, [showWebContent]);\r\n\r\n  useEffect(() => {\r\n    if (!isResizingContent) return;\r\n\r\n    const handlePointerMove = (event: MouseEvent) => {\r\n      setContentSplit((prev) => {\r\n        const ratio = event.clientX / window.innerWidth;\r\n        if (Number.isNaN(ratio)) return prev;\r\n        return Math.min(0.85, Math.max(0.25, ratio));\r\n      });\r\n    };\r\n\r\n    const handlePointerUp = () => {\r\n      setIsResizingContent(false);\r\n    };\r\n\r\n    window.addEventListener('mousemove', handlePointerMove);\r\n    window.addEventListener('mouseup', handlePointerUp);\r\n\r\n    return () => {\r\n      window.removeEventListener('mousemove', handlePointerMove);\r\n      window.removeEventListener('mouseup', handlePointerUp);\r\n    };\r\n  }, [isResizingContent]);\r\n\r\n  const [restoreSummary, setRestoreSummary] = useState<{ updatedAt: number; windowCount: number; tabCount: number } | null>(null);\r\n  const [restoreDismissed, setRestoreDismissed] = useState(false);\r\n  const [restoreStatus, setRestoreStatus] = useState<'idle' | 'restoring'>('idle');\r\n  const [restoreToast, setRestoreToast] = useState<{ message: string; variant: 'success' | 'error' } | null>(null);\r\n  const restoreRelativeTime = useMemo(() => {\r\n    if (!restoreSummary) return null;\r\n    try {\r\n      return formatDistanceToNow(new Date(restoreSummary.updatedAt), { addSuffix: true });\r\n    } catch {\r\n      return null;\r\n    }\r\n  }, [restoreSummary]);\r\n\r\n  // Auto-start onboarding for new users (with a small delay to let UI settle)\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    const timer = setTimeout(() => {\r\n      if (!onboardingStorage.isCompleted() && !onboardingVisible) {\r\n        startOnboarding();\r\n      }\r\n    }, 800); // Delay to let UI render first\r\n    return () => clearTimeout(timer);\r\n  }, [onboardingVisible, startOnboarding]);\r\n\r\n  useEffect(() => {\r\n    if (restoreDismissed) return;\r\n    let cancelled = false;\r\n    ipc.sessionState\r\n      .summary()\r\n      .then((res) => {\r\n        if (cancelled) return;\r\n        const summary = res?.summary;\r\n        if (summary && summary.tabCount > 0) {\r\n          setRestoreSummary(summary);\r\n        }\r\n      })\r\n      .catch(() => {\r\n        if (!cancelled) {\r\n          setRestoreSummary(null);\r\n        }\r\n      });\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [restoreDismissed]);\r\n\r\n  useEffect(() => {\r\n    if (!restoreToast) return;\r\n    const timeoutId = window.setTimeout(() => {\r\n      setRestoreToast(null);\r\n    }, 6000);\r\n    return () => {\r\n      window.clearTimeout(timeoutId);\r\n    };\r\n  }, [restoreToast]);\r\n\r\n  // Listen for permission requests\r\n  useIPCEvent<PermissionRequest>('permissions:request', (request) => {\r\n    setPermissionRequest(request);\r\n  }, []);\r\n\r\n  // Listen for consent requests\r\n  useIPCEvent<any>(\r\n    'agent:consent:request',\r\n    (payload) => {\r\n      if (!payload || !payload.id || !payload.action) return;\r\n      const request: ConsentRequest = {\r\n        id: payload.id,\r\n        action: {\r\n          type: payload.action.type,\r\n          description: payload.action.description,\r\n          risk: payload.action.risk ?? 'medium',\r\n        },\r\n        callback: async (approved: boolean) => {\r\n          try {\r\n            if (approved) {\r\n              await ipc.consent.approve(payload.id);\r\n            } else {\r\n              await ipc.consent.revoke(payload.id);\r\n            }\r\n          } catch (error) {\r\n            console.error('Failed to resolve consent:', error);\r\n          } finally {\r\n            setConsentRequest(null);\r\n          }\r\n        },\r\n      };\r\n      setConsentRequest(request);\r\n    },\r\n    [],\r\n  );\r\n\r\n  // Listen for fullscreen changes from Electron IPC\r\n  useEffect(() => {\r\n    const handleFullscreen = (data: { fullscreen: boolean }) => {\r\n      setIsFullscreen(data.fullscreen);\r\n    };\r\n    \r\n    // Use the IPC event bus\r\n    const unsubscribe = ipcEvents.on<{ fullscreen: boolean }>('app:fullscreen-changed', handleFullscreen);\r\n    \r\n    return unsubscribe;\r\n  }, []);\r\n\r\n  // Global keyboard shortcuts (Windows/Linux: Ctrl, macOS: Cmd)\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\r\n      const modifier = isMac ? e.metaKey : e.ctrlKey;\r\n\r\n      // âŒ˜K / Ctrl+K: Command Palette\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'k') {\r\n        e.preventDefault();\r\n        setCommandPaletteOpen(true);\r\n        return;\r\n      }\r\n\r\n      // âŒ˜L / Ctrl+L: Focus URL bar (handled in Omnibox, but ensure it works)\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'l') {\r\n        // Let Omnibox handle this, but don't prevent default if it's already handled\r\n        return;\r\n      }\r\n\r\n      // âŒ˜T / Ctrl+T: New Tab\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 't') {\r\n        e.preventDefault();\r\n        ipc.tabs.create('about:blank').catch(console.error);\r\n        return;\r\n      }\r\n\r\n      // âŒ˜W / Ctrl+W: Close Tab\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'w') {\r\n        e.preventDefault();\r\n        const state = useTabsStore.getState();\r\n        if (state.activeId) {\r\n          ipc.tabs.close({ id: state.activeId }).catch(console.error);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // âŒ˜â‡§T / Ctrl+Shift+T: Reopen Closed Tab\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 't') {\r\n        e.preventDefault();\r\n        // Would reopen last closed tab - need to implement closed tab history\r\n        return;\r\n      }\r\n\r\n      // âŒ˜â‡§A / Ctrl+Shift+A: Toggle Agent Console\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 'a') {\r\n        e.preventDefault();\r\n        setRightPanelOpen(prev => !prev);\r\n        return;\r\n      }\r\n\r\n      // âŒ˜â‡§H / Ctrl+Shift+H: Highlight clipper\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 'h') {\r\n        e.preventDefault();\r\n        if (useTabsStore.getState().activeId) {\r\n          setClipperActive(true);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // âŒ¥âŒ˜P / Alt+Ctrl+P: Proxy Menu (opens NetworkButton menu)\r\n      if (modifier && e.altKey && e.key.toLowerCase() === 'p') {\r\n        e.preventDefault();\r\n        // Trigger NetworkButton click via data attribute\r\n        const networkButton = document.querySelector('[data-network-button]') as HTMLElement;\r\n        networkButton?.click();\r\n        return;\r\n      }\r\n\r\n      // âŒ¥âŒ˜S / Alt+Ctrl+S: Shields Menu (opens ShieldsButton menu)\r\n      if (modifier && e.altKey && e.key.toLowerCase() === 's') {\r\n        e.preventDefault();\r\n        // Trigger ShieldsButton click via data attribute\r\n        const shieldsButton = document.querySelector('[data-shields-button]') as HTMLElement;\r\n        shieldsButton?.click();\r\n        return;\r\n      }\r\n\r\n      // âŒ˜F / Ctrl+F: Find in Page (handled by browser)\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'f') {\r\n        return;\r\n      }\r\n\r\n      // Alt+â† / âŒ˜â†: Go back (handled by TopNav)\r\n      // Alt+â†’ / âŒ˜â†’: Go forward (handled by TopNav)\r\n      // Ctrl+R / âŒ˜R: Refresh (handled by TopNav)\r\n\r\n      // Esc: Close modals\r\n      if (e.key === 'Escape') {\r\n        if (clipperActive) {\r\n          setClipperActive(false);\r\n        } else if (commandPaletteOpen) {\r\n          setCommandPaletteOpen(false);\r\n        } else if (permissionRequest) {\r\n          setPermissionRequest(null);\r\n        } else if (consentRequest) {\r\n          setConsentRequest(null);\r\n        } else if (rightPanelOpen) {\r\n          setRightPanelOpen(false);\r\n        }\r\n        return;\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [commandPaletteOpen, permissionRequest, consentRequest, rightPanelOpen, clipperActive]);\r\n\r\n  const handleCreateHighlight = async (highlight: ResearchHighlight) => {\r\n    if (!activeTab?.url) {\r\n      setClipperActive(false);\r\n      return;\r\n    }\r\n    try {\r\n      const existing = await ipc.research.getNotes(activeTab.url);\r\n      const notes = existing?.notes ?? '';\r\n      const highlights = Array.isArray(existing?.highlights) ? existing.highlights : [];\r\n      await ipc.research.saveNotes(activeTab.url, notes, [...highlights, highlight]);\r\n      ipcEvents.emit('research:highlight-added', { url: activeTab.url, highlight });\r\n    } catch (error) {\r\n      console.error('Failed to save highlight:', error);\r\n    } finally {\r\n      setClipperActive(false);\r\n    }\r\n  };\r\n\r\n  const handleRestoreSession = async () => {\r\n    if (!restoreSummary || restoreStatus === 'restoring') return;\r\n    setRestoreStatus('restoring');\r\n    try {\r\n      const result = await ipc.sessionState.restore();\r\n      if (result?.restored) {\r\n        const restoredCount = result.tabCount ?? restoreSummary.tabCount ?? 0;\r\n        setRestoreToast({\r\n          message: `Restored ${restoredCount} tab${restoredCount === 1 ? '' : 's'} from last session.`,\r\n          variant: 'success',\r\n        });\r\n        setRestoreSummary(null);\r\n        setRestoreDismissed(true);\r\n      } else if (result?.error) {\r\n        setRestoreToast({\r\n          message: `Restore failed: ${result.error}`,\r\n          variant: 'error',\r\n        });\r\n      } else {\r\n        setRestoreToast({\r\n          message: 'No saved session snapshot available to restore.',\r\n          variant: 'error',\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to restore session snapshot:', error);\r\n      setRestoreToast({\r\n        message: 'Failed to restore session snapshot.',\r\n        variant: 'error',\r\n      });\r\n    } finally {\r\n      setRestoreStatus('idle');\r\n    }\r\n  };\r\n\r\n  const handleDismissRestore = () => {\r\n    setRestoreDismissed(true);\r\n    setRestoreSummary(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative flex h-screen w-screen flex-col overflow-hidden bg-[#1A1D28] text-gray-100\">\r\n      {/* Top Navigation - Hidden in fullscreen */}\r\n      {!isFullscreen && (\r\n        <div className=\"flex-none\">\r\n          <Suspense fallback={<div style={{ height: '40px', backgroundColor: '#0f172a' }} />}>\r\n            <ErrorBoundary\r\n              componentName=\"TopNav\"\r\n              fallback={\r\n                <div style={{ height: '40px', backgroundColor: '#0f172a', padding: '8px', color: '#94a3b8' }}>\r\n                  Navigation Error\r\n                </div>\r\n              }\r\n            >\r\n              <TopNav\r\n                onAgentToggle={() => setRightPanelOpen(!rightPanelOpen)}\r\n                onCommandPalette={() => setCommandPaletteOpen(true)}\r\n                onClipperToggle={() => {\r\n                  if (tabsState.activeId) {\r\n                    setClipperActive(true);\r\n                  }\r\n                }}\r\n                onReaderToggle={() => {\r\n                  if (tabsState.activeId) {\r\n                    setReaderActive(true);\r\n                  }\r\n                }}\r\n              />\r\n            </ErrorBoundary>\r\n          </Suspense>\r\n        </div>\r\n      )}\r\n\r\n      {/* Main Layout - Full Width (No Sidebar) */}\r\n      <div className=\"flex flex-1 min-h-0 w-full overflow-hidden\">\r\n        {/* Center Content - Full Width */}\r\n        <div className=\"flex min-w-0 flex-1 flex-col overflow-hidden\">\r\n          {!isFullscreen && restoreSummary && !restoreDismissed && (\r\n            <div className=\"px-4 pt-3\">\r\n              <div className=\"flex flex-col gap-3 rounded-xl border border-blue-500/40 bg-blue-500/10 px-4 py-3 sm:flex-row sm:items-center sm:justify-between\">\r\n                <div className=\"space-y-1\">\r\n                  <p className=\"text-sm font-semibold text-blue-100\">Restore your last browsing session?</p>\r\n                  <p className=\"text-xs text-blue-200\">\r\n                    Last saved {restoreRelativeTime ?? 'recently'} â€¢ {restoreSummary.windowCount} window\r\n                    {restoreSummary.windowCount === 1 ? '' : 's'}, {restoreSummary.tabCount} tab\r\n                    {restoreSummary.tabCount === 1 ? '' : 's'}\r\n                  </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleRestoreSession}\r\n                    disabled={restoreStatus === 'restoring'}\r\n                    className=\"inline-flex items-center rounded-lg border border-blue-500/60 bg-blue-600/20 px-3 py-1.5 text-sm font-medium text-blue-100 transition-colors hover:bg-blue-600/30 disabled:cursor-not-allowed disabled:opacity-60\"\r\n                  >\r\n                    {restoreStatus === 'restoring' ? (\r\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                    ) : (\r\n                      <RotateCcw className=\"mr-2 h-4 w-4\" />\r\n                    )}\r\n                    Restore\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleDismissRestore}\r\n                    className=\"rounded-lg border border-slate-700 bg-slate-800/60 px-3 py-1.5 text-sm text-slate-300 transition-colors hover:bg-slate-700/80\"\r\n                  >\r\n                    Dismiss\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          {/* Tab Strip - Hidden in fullscreen */}\r\n          {!isFullscreen && (\r\n        <Suspense fallback={null}>\r\n          <ErrorBoundary componentName=\"TabStrip\">\r\n            <TabStrip />\r\n          </ErrorBoundary>\r\n        </Suspense>\r\n          )}\r\n\r\n          {/* Route/Web Content */}\r\n          {showWebContent ? (\r\n            <div className=\"flex flex-1 min-h-0 min-w-0 overflow-hidden\">\r\n              <div\r\n                className=\"min-h-0 min-w-[320px] flex-shrink-0 flex-grow-0\"\r\n                style={{ width: `${Math.round(contentSplit * 100)}%` }}\r\n              >\r\n                <TabContentSurface tab={activeTab} overlayActive={overlayActive} />\r\n              </div>\r\n              <div\r\n                onMouseDown={handleResizeStart}\r\n                className=\"z-20 flex h-full w-[6px] cursor-col-resize items-center justify-center bg-slate-900/50 transition-colors hover:bg-slate-800\"\r\n              >\r\n                <div className=\"h-24 w-[2px] rounded-full bg-slate-700/80\" />\r\n              </div>\r\n              <div\r\n                className=\"relative min-h-0 min-w-[260px] flex-1 overflow-hidden\"\r\n                style={{ width: `${Math.round((1 - contentSplit) * 100)}%` }}\r\n              >\r\n                <div className={`h-full min-h-0 overflow-auto border-l border-slate-800/60 bg-slate-950/40`}>\r\n                  <Outlet />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className={`relative flex-1 min-h-0 min-w-0 overflow-hidden ${isFullscreen ? 'absolute inset-0' : ''}`}>\r\n              <div className={`h-full min-h-0 overflow-auto ${overlayActive ? 'webview--masked' : ''}`}>\r\n                <Outlet />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Right Panel (Agent Console) - Hidden in fullscreen */}\r\n        {!isFullscreen && (\r\n        <Suspense fallback={null}>\r\n          <ErrorBoundary componentName=\"RightPanel\">\r\n            <div className=\"h-full min-h-0 w-[340px] max-w-[380px] overflow-y-auto border-l border-slate-800/60\">\r\n              <RightPanel \r\n                open={rightPanelOpen}\r\n                onClose={() => setRightPanelOpen(false)}\r\n              />\r\n            </div>\r\n          </ErrorBoundary>\r\n        </Suspense>\r\n        )}\r\n      </div>\r\n\r\n      {/* Bottom Status Bar - Hidden in fullscreen */}\r\n      {!isFullscreen && (\r\n        <div className=\"flex-none\">\r\n          <Suspense fallback={null}>\r\n            <ErrorBoundary componentName=\"BottomStatus\">\r\n              <BottomStatus />\r\n            </ErrorBoundary>\r\n          </Suspense>\r\n        </div>\r\n      )}\r\n\r\n      {/* Agent Overlay */}\r\n      <Suspense fallback={null}>\r\n        <Portal>\r\n          <ErrorBoundary componentName=\"AgentOverlay\">\r\n            <AgentOverlay />\r\n          </ErrorBoundary>\r\n        </Portal>\r\n      </Suspense>\r\n\r\n      <Suspense fallback={null}>\r\n        <Portal>\r\n          <ErrorBoundary componentName=\"ClipperOverlay\">\r\n            <ClipperOverlay\r\n              active={clipperActive}\r\n              onCancel={() => setClipperActive(false)}\r\n              onCreateHighlight={handleCreateHighlight}\r\n            />\r\n          </ErrorBoundary>\r\n        </Portal>\r\n      </Suspense>\r\n\r\n      <Suspense fallback={null}>\r\n        <Portal>\r\n          <ErrorBoundary componentName=\"ReaderOverlay\">\r\n            <ReaderOverlay\r\n              active={readerActive}\r\n              onClose={() => setReaderActive(false)}\r\n              tabId={tabsState.activeId}\r\n              url={activeTab?.url}\r\n            />\r\n          </ErrorBoundary>\r\n        </Portal>\r\n      </Suspense>\r\n\r\n      {graphDropHint && (\r\n        <Portal>\r\n          <div className=\"pointer-events-none fixed inset-0 z-tour flex items-center justify-center\">\r\n            <div className=\"rounded-3xl border border-purple-500/40 bg-purple-900/50 px-8 py-6 text-center shadow-[0_0_60px_rgba(168,85,247,0.35)] backdrop-blur-sm\">\r\n              <div className=\"text-[11px] uppercase tracking-[0.3em] text-purple-200/70\">Tab graph</div>\r\n              <div className=\"mt-2 text-lg font-semibold text-purple-100\">Drop to map this tab&apos;s DNA</div>\r\n              <div className=\"mt-1 text-xs text-purple-200/80\">Release anywhere to open the graph overlay.</div>\r\n            </div>\r\n          </div>\r\n        </Portal>\r\n      )}\r\n\r\n      <Suspense fallback={null}>\r\n        <Portal>\r\n          <ErrorBoundary componentName=\"TabGraphOverlay\">\r\n            <TabGraphOverlay />\r\n          </ErrorBoundary>\r\n        </Portal>\r\n      </Suspense>\r\n\r\n      {/* Regen Whisper - Voice Tips */}\r\n      {!isFullscreen && (\r\n        <Suspense fallback={null}>\r\n          <ErrorBoundary componentName=\"VoiceTips\">\r\n            <VoiceTips />\r\n          </ErrorBoundary>\r\n        </Suspense>\r\n      )}\r\n\r\n      {consentVisible && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"ConsentDashboard\">\r\n              <ConsentDashboard />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {trustDashboardVisible && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"TrustEthicsDashboard\">\r\n              <TrustEthicsDashboard />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {onboardingVisible && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"OnboardingTour\">\r\n              <OnboardingTour\r\n                onClose={() => {\r\n                  // Component already calls finishOnboarding() before onClose()\r\n                  // This callback is just for cleanup if needed\r\n                }}\r\n              />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {/* Overlays */}\r\n      {commandPaletteOpen && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"CommandPalette\">\r\n              <CommandPalette onClose={() => setCommandPaletteOpen(false)} />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {permissionRequest && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"PermissionPrompt\">\r\n              <PermissionPrompt \r\n                request={permissionRequest}\r\n                onClose={() => setPermissionRequest(null)}\r\n              />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {consentRequest && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"ConsentPrompt\">\r\n              <ConsentPrompt \r\n                request={consentRequest}\r\n                onClose={() => setConsentRequest(null)}\r\n              />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n      {restoreToast && (\r\n        <Portal>\r\n          <div className=\"fixed bottom-6 right-6 z-50\">\r\n            <div\r\n              className={`rounded-xl border px-4 py-3 text-sm shadow-xl shadow-black/40 ${\r\n                restoreToast.variant === 'success'\r\n                  ? 'border-emerald-400/40 bg-emerald-500/15 text-emerald-100'\r\n                  : 'border-amber-400/40 bg-amber-500/15 text-amber-100'\r\n              }`}\r\n            >\r\n              {restoreToast.message}\r\n            </div>\r\n          </div>\r\n        </Portal>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"file":"AppShell-DzVtN4M2.js"}
import{R as je,r as c,u as pe,j as r,c as Ie,k as Ne,i as T,d as Ce,b as J,a as Se}from"./index-dj7m1cGj.js";import{A as ue}from"./index-D3V9pHtR.js";import{c as he,m as F}from"./proxy-C7NQ8sMs.js";import{u as Pe}from"./profileStore-yzAJ5kKU.js";import{E as ve}from"./eye-K0nBXFUq.js";import{C as Ee}from"./copy-r_Uv8dWa.js";import{G as Re,S as De,B as ge}from"./sun-gjWoxaw5.js";import{C as Me}from"./clock-C2CbMN6U.js";import{M as Fe}from"./moon-star-BoTlVUZg.js";import{P as He}from"./Portal-Cws6ez_F.js";import{u as $e}from"./AppShell-DzVtN4M2.js";import{C as ze}from"./circle-play-C6hzx54j.js";import{S as _e}from"./sparkles-BXvEuSDZ.js";import{X as Le}from"./x-kCWGjBIF.js";import{P as Ge}from"./plus-BA3m4G4e.js";import"./use-ipc-event-Mlq2GWsh.js";import"./OmniDesk-XqA-NCuc.js";import"./loader-circle-B2cekLv2.js";import"./agentStreamStore-DATaLJlE.js";import"./cloud-RM87ovcD.js";import"./search-DY2JFyPs.js";import"./formatDistanceToNow-Ctx6mZEP.js";import"./refresh-cw-81QnrOuz.js";import"./circle-check-J1xVWsPI.js";import"./external-link-uxSLXU_6.js";import"./trustDashboardStore-CE7KmIta.js";import"./triangle-alert-CX1V0b5r.js";const Be=he("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);const Oe=he("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),ye=je.forwardRef(({tabId:s,children:i},l)=>{const[o,h]=c.useState(!1),[k,H]=c.useState(null),$=pe(E=>E.tabs).find(E=>E.id===s);return c.useEffect(()=>{o&&$&&H({title:$.title||"New Tab",url:$.url||"about:blank"})},[o,$]),r.jsxs("div",{ref:l,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),className:"relative",style:{pointerEvents:"auto"},onClick:E=>{E.target===E.currentTarget&&E.stopPropagation()},children:[i,r.jsx(ue,{children:o&&k&&r.jsxs(F.div,{initial:{opacity:0,scale:.95,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:10},className:"absolute bottom-full left-0 mb-2 bg-gray-800 border border-gray-700 rounded-lg shadow-2xl z-[40] w-80 p-4",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:E=>E.stopPropagation(),onMouseDown:E=>E.stopPropagation(),style:{pointerEvents:"auto"},children:[k.thumbnail&&r.jsx("img",{src:k.thumbnail,alt:k.title,className:"w-full h-32 object-cover rounded mb-2"}),r.jsx("div",{className:"text-sm font-medium text-gray-200 mb-1 truncate",children:k.title}),r.jsx("div",{className:"text-xs text-gray-400 truncate",children:k.url})]})})]})});ye.displayName="TabHoverCard";const Ue=ye,de=Ie((s,i)=>({visible:!1,tab:null,open:l=>s({visible:!0,tab:l}),close:()=>s({visible:!1,tab:null}),sync:l=>{const o=i().tab;o?.id===l.id&&s({tab:{...o,...l}})}}));function Ke({tabId:s,url:i,containerId:l,containerName:o,containerColor:h,mode:k,sleeping:H,onClose:S}){const[$,E]=c.useState({x:0,y:0}),U=c.useRef(null),B=Pe(n=>n.policies[n.activeProfileId]),Z=B?!B.allowGhostTabs:!1,ne=B?!B.allowPrivateWindows:!1,{containers:K,setContainers:oe}=Ne(n=>({containers:n.containers,setContainers:n.setContainers})),R=pe(n=>n.tabs.find(C=>C.id===s)),ae=de(n=>n.open),ee=H??R?.sleeping??!1;c.useEffect(()=>{const n=C=>{U.current&&!U.current.contains(C.target)&&S()};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[S]),c.useEffect(()=>{const n=window.__lastContextMenuPos||{x:0,y:0};E({x:n.x,y:n.y})},[]),c.useEffect(()=>{K.length===0&&T.containers.list().then(n=>{Array.isArray(n)&&oe(n)}).catch(n=>{console.error("Failed to load containers for context menu:",n)})},[K.length,oe]);const z=()=>({id:R?.id??s,title:R?.title??R?.url??i??"New Tab",url:R?.url??i??"about:blank",containerId:R?.containerId??l,containerName:R?.containerName??o,containerColor:R?.containerColor??h,mode:R?.mode??k,createdAt:R?.createdAt,lastActiveAt:R?.lastActiveAt,sessionId:R?.sessionId,profileId:R?.profileId,sleeping:R?.sleeping??H??!1}),se=async()=>{if(!Z)try{await T.private.createGhostTab({url:i}),S()}catch(n){console.error("Failed to open as ghost:",n)}},O=async()=>{try{confirm("Burn this tab? All data will be permanently deleted.")&&(await T.tabs.burn(s),S())}catch(n){console.error("Failed to burn tab:",n)}},W=async()=>{if(ne)return;const n=prompt("Auto-close after (minutes):","10");if(n)try{const C=parseInt(n)*60*1e3;await T.private.createWindow({url:i,autoCloseAfter:C}),S()}catch(C){console.error("Failed to start timer:",C)}},te=async(n,C=!0)=>{try{await T.tabs.create({url:i||"about:blank",containerId:n??l,activate:C}),S()}catch(re){console.error("Failed to duplicate tab:",re)}},_=async n=>{if(!n||n===l){S();return}try{const C=await T.tabs.setContainer(s,n);C?.success||console.warn("Failed to switch container:",C?.error)}catch(C){console.error("Failed to switch tab container:",C)}finally{S()}},D=()=>{ae(z()),S()},A=async()=>{try{await T.tabs.wake(s),S()}catch(n){console.error("Failed to wake tab:",n)}},X=k==="ghost",G=k==="private",x=[{icon:ve,label:"Peek preview",action:D},{icon:Ee,label:"Duplicate Tab",action:()=>te(l,!0),disabled:X||G},{icon:Re,label:"Open as Ghost",action:se,hide:X,disabled:Z,disabledReason:"Disabled by profile policy"},{icon:Be,label:"Burn Tab",action:O,danger:!0},{icon:Me,label:"Start 10-min Timer",action:W,disabled:ne,disabledReason:"Disabled by profile policy"},{icon:De,label:"Wake tab",action:A,hide:!ee}].filter(n=>!n.hide),ce=!X&&!G?K.filter(n=>n.id!==l):[],q=K.filter(n=>n.id!==l);return r.jsx(ue,{children:r.jsxs(F.div,{ref:U,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},className:"fixed z-50 bg-surface-elevated text-foreground border border-subtle rounded-lg shadow-elevated py-1 min-w-[200px]",style:{left:`${$.x}px`,top:`${$.y}px`},children:[ee&&r.jsxs("div",{className:"px-3 py-2 text-xs text-amber-500 bg-amber-500/10 border-b border-subtle flex items-center gap-2",children:[r.jsx(Fe,{size:14}),r.jsx("span",{children:"Tab is hibernating"})]}),(l||o)&&r.jsxs("div",{className:"px-3 py-2 text-xs text-muted border-b border-subtle flex items-center gap-2",children:[r.jsx("div",{className:"w-2.5 h-2.5 rounded-full border border-gray-500/30",style:{backgroundColor:h||"#6366f1"}}),r.jsx("span",{children:o||(l==="default"?"Default container":l)})]}),x.map((n,C)=>{const re=n.icon;return r.jsxs(F.button,{whileHover:n.disabled?void 0:{scale:1.01},onClick:n.action,className:`w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors ${n.danger?"text-red-500 hover:bg-red-500/10":n.disabled?"text-muted cursor-not-allowed":"text-foreground hover:bg-[color:var(--surface-muted)]/45"}`,disabled:n.disabled,title:n.disabled?n.disabledReason||"Disabled by profile policy":void 0,children:[r.jsx(re,{size:16}),r.jsx("span",{children:n.label})]},C)}),q.length>0&&r.jsxs("div",{className:"mt-1 border-t border-subtle pt-1.5",children:[r.jsxs("div",{className:"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2",children:[r.jsx(ge,{size:12}),"Open copy in container"]}),r.jsx("div",{className:"flex flex-col",children:q.map(n=>r.jsxs(F.button,{whileHover:{scale:1.01},onClick:()=>te(n.id,!0),className:"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full border border-gray-500/30",style:{backgroundColor:n.color||"#6366f1"}}),r.jsx("span",{className:"truncate",children:n.name})]},`open-${n.id}`))})]}),ce.length>0&&r.jsxs("div",{className:"mt-1 border-t border-subtle pt-1.5",children:[r.jsxs("div",{className:"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2",children:[r.jsx(ge,{size:12}),"Move to container"]}),r.jsx("div",{className:"flex flex-col",children:ce.map(n=>r.jsxs(F.button,{whileHover:{scale:1.01},onClick:()=>_(n.id),className:"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors",children:[r.jsx("span",{className:"w-2.5 h-2.5 rounded-full border border-gray-500/30",style:{backgroundColor:n.color||"#6366f1"}}),r.jsx("span",{className:"truncate",children:n.name})]},n.id))})]})]})})}function We({clusters:s,summary:i,onApply:l}){const[o,h]=c.useState(0);if(c.useEffect(()=>{s.length?o>=s.length&&h(0):h(0)},[s,o]),!s.length)return null;const k=s[o],H=typeof k.confidence=="number"?Math.round(k.confidence*100):null;return r.jsxs(F.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"no-drag flex items-center gap-2 mr-3",children:[r.jsxs("button",{type:"button",onClick:()=>l(k.id),className:"flex items-center gap-1.5 rounded-full border border-blue-500/40 bg-blue-500/15 px-3 py-1.5 text-xs text-blue-100 transition-colors hover:bg-blue-500/25",title:i??"Redix suggests regrouping these tabs into a focused workspace.",children:[r.jsx(ze,{size:12}),r.jsxs("span",{className:"font-semibold",children:["Regroup ",k.label]}),H!==null&&r.jsxs("span",{className:"text-[11px] text-blue-200/80",children:[H,"%"]})]}),s.length>1&&r.jsx("button",{type:"button",onClick:()=>h(S=>(S+1)%s.length),className:"rounded-full border border-slate-700/60 p-1.5 text-[10px] text-slate-300 transition-colors hover:text-slate-100","aria-label":"Next suggested cluster",children:"â—"})]})}function qe({entry:s,onOpen:i}){if(!s)return null;let l=s.url;try{l=new URL(s.url).hostname.replace(/^www\./,"")}catch{}const o=typeof s.confidence=="number"?Math.round(s.confidence*100):null;return r.jsx(F.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},className:"no-drag flex items-center gap-2 mr-3",children:r.jsxs("button",{type:"button",onClick:()=>i(s),className:"flex items-center gap-1.5 rounded-full border border-emerald-500/40 bg-emerald-500/15 px-3 py-1.5 text-xs text-emerald-100 transition-colors hover:bg-emerald-500/25",title:s.reason,children:[r.jsx(Oe,{size:12}),r.jsxs("span",{className:"font-semibold",children:["Scout ",l]}),o!==null&&r.jsxs("span",{className:"text-[11px] text-emerald-200/80",children:[o,"%"]})]})})}const xe=typeof navigator<"u"&&"xr"in navigator,Xe="https://unpkg.com/aframe@1.5.0/dist/aframe.min.js";async function Ve(){return typeof window>"u"?!1:window.AFRAME?!0:new Promise(s=>{const i=document.querySelector('script[data-hologram="aframe"]');if(i){i.addEventListener("load",()=>s(!0),{once:!0}),i.addEventListener("error",()=>s(!1),{once:!0});return}const l=document.createElement("script");l.src=Xe,l.async=!0,l.crossOrigin="anonymous",l.dataset.hologram="aframe",l.addEventListener("load",()=>s(!0),{once:!0}),l.addEventListener("error",()=>s(!1),{once:!0}),document.head.appendChild(l)})}function Ye({visible:s,tabId:i,url:l,title:o,onClose:h}){const k=c.useRef(null),[H,S]=c.useState(xe);return c.useEffect(()=>{let $=!1;if(!(!s||!k.current)){if(!xe){S(!1);return}return(async()=>{const E=await Ve();$||(E?S(!0):(console.warn("[Hologram] Failed to load A-Frame runtime from CDN"),S(!1)))})(),()=>{$=!0}}},[s]),!s||!i?null:r.jsx(ue,{children:r.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-md",children:r.jsxs(F.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"relative w-[720px] max-w-[92vw] rounded-3xl border border-cyan-500/40 bg-cyan-950/90 p-6 shadow-[0_20px_80px_rgba(8,145,178,0.25)]",children:[r.jsxs("div",{className:"flex items-start justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-xs uppercase tracking-wide text-cyan-200/80",children:"Holographic Preview"}),r.jsx("div",{className:"text-lg font-semibold text-cyan-100",children:o||"Live Tab"}),r.jsx("div",{className:"text-xs text-cyan-100/70 break-all",children:l})]}),r.jsx("button",{type:"button",onClick:h,className:"rounded-full border border-cyan-400/30 bg-cyan-500/10 px-3 py-1 text-xs text-cyan-100 hover:bg-cyan-500/20",children:"Close"})]}),r.jsxs("div",{className:"mt-4 overflow-hidden rounded-2xl border border-cyan-500/30 bg-cyan-900/60 p-4",children:[!H&&r.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-16 text-center text-sm text-cyan-100/80",children:[r.jsx("p",{children:"WebXR holograms require a compatible browser/device."}),r.jsx("p",{className:"text-xs text-cyan-200/60",children:"Fallback: switch tabs to view this content directly."})]}),H&&r.jsx("div",{ref:k,className:"relative h-[360px] w-full",children:r.jsx("iframe",{src:`/hologram.html?tabId=${encodeURIComponent(i)}`,className:"h-full w-full rounded-xl border-none",allow:"xr-spatial-tracking; vr; webxr",title:`Holographic preview for tab ${i}`})})]})]})})})}const Je="application/x-omnibrowser-tab-id",y=Ce(),Q=Se(),M=s=>s.map(i=>({id:i.id,title:i.title,active:i.active,url:i.url,mode:i.mode,containerId:i.containerId,containerColor:i.containerColor,containerName:i.containerName,createdAt:i.createdAt,lastActiveAt:i.lastActiveAt,sessionId:i.sessionId,profileId:i.profileId,sleeping:i.sleeping}));function jt(){const{setAll:s,setActive:i,activeId:l}=pe(),[o,h]=c.useState([]),[k,H]=c.useState([]),[S,$]=c.useState([]),[E,U]=c.useState(null),[B,Z]=c.useState(null),[ne,K]=c.useState(null),[oe,R]=c.useState(null),[ae,ee]=c.useState({platform:"desktop",lastSentAt:null}),[z,se]=c.useState(null),[O,W]=c.useState(!1),te=c.useRef(!1),_=c.useRef(!1),D=c.useRef(""),A=c.useRef(null),X=c.useRef(null),G=c.useRef(null),x=c.useRef(o),ce=de(e=>e.open),q=c.useRef(null),n=c.useRef(""),C=c.useRef();c.useEffect(()=>{A.current=l},[l]);const re=c.useCallback(async e=>{if(!Q){e?.force&&(H([]),$([]),U(null));return}if(q.current&&!e?.force)return q.current;const a=x.current.map(u=>`${u.id}:${u.lastActiveAt??0}`).sort().join("|");if(!e?.force&&a&&a===n.current&&k.length>0)return;const g=(async()=>{try{const u=await T.tabs.predictiveGroups(e?.force?{force:!0}:{});if(n.current=a,!u){H([]),$([]),U(null);return}H(Array.isArray(u.groups)?u.groups:[]),$(Array.isArray(u.prefetch)?u.prefetch:[]),U(u.summary?.explanation??null)}catch(u){y&&console.warn("[TabStrip] Predictive suggestions failed",u),e?.force&&(H([]),$([]),U(null))}finally{q.current===g&&(q.current=null)}})();return q.current=g,g},[k.length]);c.useEffect(()=>{C.current=re},[re]),c.useEffect(()=>{O&&C.current?.({force:!0})},[O]);const ie=c.useCallback(async()=>{if(Q)try{const e=await T.tabs.list();if(!Array.isArray(e)){y&&console.warn("[TabStrip] refreshTabsFromMain: Invalid tab list",e);return}y&&console.log("[TabStrip] refreshTabsFromMain: Got",e.length,"tabs");const a=e.map(t=>({id:t.id,title:t.title||"New Tab",url:t.url||"about:blank",active:t.active||!1,mode:t.mode||"normal",containerId:t.containerId,containerName:t.containerName,containerColor:t.containerColor,createdAt:t.createdAt,lastActiveAt:t.lastActiveAt,sessionId:t.sessionId,profileId:t.profileId,sleeping:!!t.sleeping})),g=a.map(t=>t.id).sort().join(",");D.current=g,h(a),x.current=a,s(M(a));const u=a.find(t=>t.active);if(u)i(u.id),A.current=u.id;else if(a.length>0){const t=a[0];if(t){i(t.id),A.current=t.id;try{await T.tabs.activate({id:t.id})}catch{}}}else i(null),A.current=null;C.current?.()}catch(e){y&&console.error("[TabStrip] Failed to refresh tabs from main process:",e)}},[i,s]);c.useEffect(()=>{(()=>{const a=typeof navigator<"u"&&"xr"in navigator;R(a),a&&ee(g=>({...g,platform:"xr-ready"}))})()},[]),c.useEffect(()=>{ae.lastSentAt&&T.crossReality.sendHandoffStatus(ae)},[ae]),c.useEffect(()=>{if(!Q){let p=!0;const w=L=>{if(!p)return;const P=L.length?L:[{id:"local-initial",title:"Welcome",url:"about:blank",active:!0,mode:"normal"}];h(P),x.current=P,D.current=P.map(d=>d.id).sort().join(","),s(M(P));const N=P.find(d=>d.active)??P[0];i(N?N.id:null),A.current=N?N.id:null,W(!0)};w(x.current.length>0?x.current:o);const m=J.on("tabs:updated",L=>{if(!p)return;if(!Array.isArray(L)||L.length===0){w([]);return}const P=L.map(N=>({id:N.id,title:N.title||"New Tab",url:N.url||"about:blank",active:!!N.active,mode:N.mode||"normal",containerId:N.containerId,containerName:N.containerName,containerColor:N.containerColor,createdAt:N.createdAt,lastActiveAt:N.lastActiveAt,sessionId:N.sessionId,profileId:N.profileId,sleeping:N.sleeping}));w(P)});return()=>{p=!1,m()}}let e=!0,a=!1;const g=()=>new Promise(p=>{if(window.ipc&&typeof window.ipc.invoke=="function"){a=!0,p();return}const w=()=>{window.ipc&&typeof window.ipc.invoke=="function"&&(a=!0,p())};window.addEventListener("ipc:ready",w,{once:!0});const m=setInterval(()=>{window.ipc&&typeof window.ipc.invoke=="function"&&(clearInterval(m),a=!0,p())},100);setTimeout(()=>{clearInterval(m),a||(console.warn("IPC not ready after 5 seconds, proceeding anyway"),p())},5e3)}),u=async(p=!1)=>{if(e&&!(_.current&&!p)&&(a||await g(),!!e))try{const w=await T.tabs.list();if(!e)return;if(Array.isArray(w)&&w.length>0){const m=w.map(d=>({id:d.id,title:d.title||"New Tab",url:d.url||"about:blank",active:d.active||!1,mode:d.mode||"normal",containerId:d.containerId,containerName:d.containerName,containerColor:d.containerColor,createdAt:d.createdAt,lastActiveAt:d.lastActiveAt,sessionId:d.sessionId,profileId:d.profileId})),L=m.map(d=>d.id).sort().join(",");D.current!==L&&(D.current=L,h(m),s(M(m)));const P=m.find(d=>d.active),N=A.current;P&&P.id!==N?i(P.id):m.length>0&&!P&&m[0]&&m[0].id!==N&&(await T.tabs.activate({id:m[0].id}),i(m[0].id)),p&&W(!0)}else p&&!O&&!te.current&&!_.current?setTimeout(async()=>{if(!(!e||O||te.current||_.current)){try{const m=await T.tabs.list();if(Array.isArray(m)&&m.length>0){W(!0);return}}catch{}_.current=!0,W(!0);try{(!window.ipc||typeof window.ipc.invoke!="function")&&await new Promise(L=>setTimeout(L,200));const m=await T.tabs.create("about:blank");m&&m.id&&y&&console.log("[TabStrip] Initial tab created after wait:",m.id)}catch(m){y&&console.error("[TabStrip] Failed to create initial tab:",m)}finally{setTimeout(()=>{_.current=!1},1e3)}}},300):e&&(h([]),s([]),i(null),O||W(!0))}catch{p&&e&&!O&&W(!0)}},t=p=>{e&&(te.current=p)},v=J.on("session:restoring",t),f=async p=>{if(!(!e||_.current)){_.current=!0;try{await T.tabs.create({url:p.url||"about:blank",containerId:p.containerId,mode:p.mode,profileId:p.profileId,tabId:p.id,activate:!!p.activate,createdAt:p.createdAt,lastActiveAt:p.lastActiveAt,sessionId:p.sessionId,fromSessionRestore:!0})}catch(w){y&&console.error("Failed to restore tab from session:",w)}finally{setTimeout(()=>{_.current=!1},500)}}},I=J.on("session:restore-tab",f),b=setTimeout(()=>{u(!0)},100),j=p=>{if(!e){y&&console.warn("[TabStrip] handleTabUpdate: Component unmounted");return}if(!Array.isArray(p)){y&&console.warn("[TabStrip] handleTabUpdate: Invalid data",{tabList:p});return}y&&console.log("[TabStrip] handleTabUpdate received:",p.length,"tabs",p.map(d=>({id:d.id,active:d.active,title:d.title})));const w=p.map(d=>({id:d.id,title:d.title||"New Tab",url:d.url||"about:blank",active:d.active||!1,containerId:d.containerId,containerName:d.containerName,containerColor:d.containerColor,mode:d.mode,createdAt:d.createdAt,lastActiveAt:d.lastActiveAt,sessionId:d.sessionId,profileId:d.profileId,sleeping:!!d.sleeping})),m=de.getState();if(m.visible&&m.tab){const d=w.find(Ae=>Ae.id===m.tab?.id);d&&de.getState().sync(d)}const P=w.find(d=>d.active)?.id||null,N=w.map(d=>d.id).sort().join(",");if(D.current,h(w),x.current=w,s(M(w)),D.current=N,P)i(P),A.current=P;else if(w.length>0){const d=w[0].id;i(d),A.current=d,Q&&T.tabs.activate({id:d}).catch(()=>{})}else i(null),A.current=null},fe=J.on("tabs:updated",j),Y=setInterval(()=>{e&&a&&O&&(_.current||u(!1).catch(()=>{}))},2e3);return()=>{e=!1,fe(),v(),I(),clearInterval(Y),clearTimeout(b)}},[]);const me=async()=>{if(!Q){const e=(x.current.length>0?x.current:o).map(u=>({...u,active:!1})),a={id:`local-${Date.now()}`,title:"New Tab",url:"about:blank",active:!0,mode:"normal"},g=[...e,a];h(g),x.current=g,D.current=g.map(u=>u.id).sort().join(","),s(M(g)),i(a.id),A.current=a.id,J.emit("tabs:updated",M(g));return}if(_.current){y&&console.log("[TabStrip] Tab creation already in progress, skipping");return}_.current=!0;try{let e=!1;for(let g=0;g<3;g++){if(window.ipc&&typeof window.ipc.invoke=="function"){e=!0;break}await new Promise(u=>setTimeout(u,200))}e||y&&console.warn("[TabStrip] IPC not ready after retries, but attempting tab creation anyway");const a=await T.tabs.create("about:blank");a&&a.id?(y&&console.log("[TabStrip] Tab created via addTab:",a.id),setTimeout(async()=>{try{await ie()}catch{}},100)):y&&console.warn("[TabStrip] Tab creation returned no ID:",a)}catch(e){y&&console.error("Failed to create tab:",e)}finally{setTimeout(()=>{_.current=!1},200)}},le=async e=>{if(!Q){const b=x.current.length>0?x.current:o,j=b.findIndex(m=>m.id===e);if(j===-1)return;const fe=b[j]?.active,Y=b.filter(m=>m.id!==e);let p=Y;if(Y.length===0)p=[{id:`local-${Date.now()}`,title:"New Tab",url:"about:blank",active:!0,mode:"normal"}];else if(fe){let m=j;m>=Y.length&&(m=Y.length-1),p=Y.map((L,P)=>({...L,active:P===m}))}const w=p.find(m=>m.active)??p[0];h(p),x.current=p,D.current=p.map(m=>m.id).sort().join(","),s(M(p)),i(w?w.id:null),A.current=w?w.id:null,J.emit("tabs:updated",M(p));return}if(_.current)return;const a=x.current.length>0?x.current:o,g=a.find(b=>b.id===e);if(!g)return;const u=g.active,t=a.findIndex(b=>b.id===e),v=a.filter(b=>b.id!==e),f=a.map(b=>({...b})),I=A.current;if(h(v),x.current=v,D.current=v.map(b=>b.id).sort().join(","),s(M(v)),u&&v.length>0){let b=t;b>=v.length&&(b=v.length-1);const j=v[b];j&&(i(j.id),A.current=j.id)}else v.length===0&&(i(null),A.current=null);y&&console.log("[TabStrip] Closing tab (optimistic):",e,"previous active:",I);try{const b=await Promise.race([T.tabs.close({id:e}),new Promise(j=>setTimeout(()=>j({success:!1,error:"Timeout"}),2e3))]);y&&console.log("[TabStrip] tabs.close result:",b),(!b||!b.success)&&(y&&console.warn("[TabStrip] Tab close failed or timed out, reverting:",e,b?.error),h(f),x.current=f,D.current=f.map(j=>j.id).sort().join(","),s(M(f)),I&&(i(I),A.current=I),await ie())}catch(b){y&&console.error("[TabStrip] Exception during tab close, reverting:",b),h(f),x.current=f,D.current=f.map(j=>j.id).sort().join(","),s(M(f)),I&&(i(I),A.current=I),await ie()}},V=async e=>{if(!Q){const f=x.current.length>0?x.current:o;if(!f.find(j=>j.id===e))return;const b=f.map(j=>({...j,active:j.id===e}));h(b),x.current=b,D.current=b.map(j=>j.id).sort().join(","),s(M(b)),i(e),A.current=e,J.emit("tabs:updated",M(b));return}if(X.current===e||A.current===e&&l===e)return;const a=x.current.length>0?x.current:o;if(!a.find(f=>f.id===e)){y&&console.warn("[TabStrip] Tab not found for activation:",e,"Available tabs:",a.map(f=>f.id));return}X.current=e;const u=A.current,t=a.map(f=>({...f}));i(e),A.current=e;const v=a.map(f=>({...f,active:f.id===e}));h(v),x.current=v,s(M(v)),y&&console.log("[TabStrip] Activating tab (optimistic):",e,"previous:",u);try{const f=await Promise.race([T.tabs.activate({id:e}),new Promise(I=>setTimeout(()=>I({success:!1,error:"Timeout"}),2e3))]);y&&console.log("[TabStrip] tabs.activate result:",f),!f||!f.success?(y&&console.warn("[TabStrip] Tab activation failed or timed out, reverting:",e,f?.error),h(t),x.current=t,D.current=t.map(I=>I.id).sort().join(","),s(M(t)),u&&(i(u),A.current=u),await ie()):y&&console.log("[TabStrip] Tab activation acknowledged by IPC:",e)}catch(f){y&&console.error("[TabStrip] Exception during tab activation, reverting:",f),h(t),x.current=t,D.current=t.map(I=>I.id).sort().join(","),s(M(t)),u&&(i(u),A.current=u),await ie()}finally{X.current=null}},we=c.useCallback(e=>{const a=k.find(f=>f.id===e);if(!a||!a.tabIds.length)return;const u=x.current.filter(f=>a.tabIds.includes(f.id));if(u.length<=1)return;let t="workspace";try{u[0]?.url&&(t=new URL(u[0].url).hostname.replace(/^www\./,"")||"workspace")}catch{t="workspace"}const v=u.length>=3?`${t} cluster`:a.label;T.tabs.create({url:"about:blank",containerId:t,activate:!0}).then(async f=>{if(f?.id){for(const I of u)try{await T.tabs.moveToWorkspace({tabId:I.id,workspaceId:f.id,label:v})}catch(b){y&&console.warn("[TabStrip] Failed to regroup tab",b)}setTimeout(()=>{$e.getState().refresh()},300),C.current?.({force:!0})}})},[k]),Te=c.useCallback(e=>{e?.url&&T.tabs.create({url:e.url,activate:!0}).then(()=>{C.current?.({force:!0})})},[]);c.useEffect(()=>{if(!(!l||!G.current))try{G.current.querySelector(`[data-tab="${CSS.escape(l)}"]`)?.scrollIntoView?.({block:"nearest",inline:"nearest",behavior:"smooth"})}catch{}},[l]);const be=c.useRef(l);c.useEffect(()=>{x.current=o,be.current=l},[o,l]),c.useEffect(()=>{if(!G.current||!l)return;G.current.querySelector(`[data-tab="${CSS.escape(l)}"]`)?.scrollIntoView({block:"nearest",inline:"nearest"})},[l,o.length]),c.useEffect(()=>{if(!G.current||!l)return;const e=G.current.querySelector(`[data-tab="${CSS.escape(l)}"]`);e&&document.activeElement!==e&&e.focus({preventScroll:!0})},[l,o.length]);const ke=c.useCallback(e=>{if(!["ArrowLeft","ArrowRight","Home","End"].includes(e.key))return;const a=o.findIndex(t=>t.id===l);if(a===-1)return;e.preventDefault();let g=a;switch(e.key){case"Home":g=0;break;case"End":g=o.length-1;break;case"ArrowLeft":g=(a-1+o.length)%o.length;break;case"ArrowRight":g=(a+1)%o.length;break}const u=o[g];u&&V(u.id)},[o,l,V]);return c.useEffect(()=>{const e=a=>{if(!(navigator.platform.toUpperCase().includes("MAC")?a.metaKey:a.ctrlKey)||a.key!=="Tab")return;const t=x.current,v=be.current;if(!t.length||!v)return;a.preventDefault();const f=t.findIndex(j=>j.id===v);if(f===-1)return;const I=a.shiftKey?(f-1+t.length)%t.length:(f+1)%t.length,b=t[I];b&&V(b.id)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[V]),r.jsxs(r.Fragment,{children:[r.jsxs("div",{ref:G,role:"tablist","aria-label":"Browser tabs",className:"no-drag flex items-center gap-1 px-3 py-2 bg-[#1A1D28] border-b border-gray-700/30 overflow-x-auto scrollbar-hide",style:{pointerEvents:"auto"},onKeyDown:ke,"data-onboarding":"tabstrip",children:[r.jsx(qe,{entry:S[0]??null,onOpen:Te}),r.jsx(We,{clusters:k,onApply:we,summary:E}),r.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",style:{pointerEvents:"auto"},children:[r.jsx(ue,{mode:"popLayout",children:o&&Array.isArray(o)&&o.length>0?o.map(e=>{const a=`tab-${e.id}`,g=`tabpanel-${e.id}`,u=S.find(t=>t.tabId===e.id);return r.jsx(Ue,{tabId:e.id,children:r.jsxs(F.div,{id:a,"data-tab":e.id,role:"tab","aria-selected":e.active,"aria-controls":g,"aria-label":`Tab: ${e.title}${e.mode==="ghost"?" (Ghost tab)":e.mode==="private"?" (Private tab)":""}${e.sleeping?" (Hibernating)":""}`,tabIndex:e.active?0:-1,layout:!0,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:`
                      relative flex items-center gap-2 px-4 py-2 rounded-lg
                      min-w-[100px] max-w-[220px] cursor-pointer group
                      transition-all duration-200
                      focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
                      ${e.active?"bg-purple-600/20 border border-purple-500/40 shadow-lg shadow-purple-500/20":"bg-gray-800/30 hover:bg-gray-800/50 border border-transparent"}
                      ${e.mode==="ghost"?"ring-1 ring-purple-500/40":""}
                      ${e.mode==="private"?"ring-1 ring-emerald-500/40":""}
                      ${e.sleeping?"ring-1 ring-amber-400/40":""}
                    `,style:{pointerEvents:"auto",zIndex:1,userSelect:"none"},draggable:!0,onDragStart:t=>{try{t.dataTransfer?.setData(Je,e.id),e.title&&t.dataTransfer?.setData("text/plain",e.title),t.dataTransfer&&(t.dataTransfer.effectAllowed="copy")}catch(v){y&&console.warn("[TabStrip] Drag start failed",v)}},onDragEnd:()=>{window.dispatchEvent(new CustomEvent("tabgraph:dragend"))},onClick:t=>{t.preventDefault(),t.stopPropagation(),V(e.id)},onKeyDown:t=>{if(t.key==="Enter"||t.key===" "){t.preventDefault(),t.stopPropagation(),V(e.id);return}if(["ArrowLeft","ArrowRight","Home","End"].includes(t.key)){t.preventDefault(),t.stopPropagation();const v=o.findIndex(b=>b.id===e.id);if(v===-1)return;let f=v;switch(t.key){case"Home":f=0;break;case"End":f=o.length-1;break;case"ArrowLeft":f=(v-1+o.length)%o.length;break;case"ArrowRight":f=(v+1)%o.length;break}const I=o[f];I&&V(I.id)}},onAuxClick:t=>{t.preventDefault(),t.stopPropagation(),t.button===1&&le(e.id)},onContextMenu:t=>{t.preventDefault(),window.__lastContextMenuPos={x:t.clientX,y:t.clientY},se({tabId:e.id,url:e.url,containerId:e.containerId,containerName:e.containerName,containerColor:e.containerColor,mode:e.mode,sleeping:e.sleeping,x:t.clientX,y:t.clientY})},onMouseEnter:()=>{e===o[o.length-1]&&(Z(e.id),K({url:e.url,title:e.title}))},onMouseLeave:()=>{B===e.id&&(Z(null),K(null))},children:[u&&r.jsx("span",{className:"absolute top-1 right-2 text-emerald-300 text-[11px] font-semibold",title:`Suggested follow-up: ${u.reason}`,children:"âš¡"}),oe!==!1&&B===e.id&&r.jsxs(F.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},className:"absolute -bottom-9 left-1/2 flex -translate-x-1/2 items-center gap-2",children:[r.jsxs(F.button,{type:"button",className:"flex items-center gap-1 rounded-full border border-cyan-400/40 bg-cyan-500/15 px-3 py-1 text-[10px] text-cyan-100 shadow-lg backdrop-blur transition-colors hover:bg-cyan-500/25",onClick:t=>{t.preventDefault(),t.stopPropagation(),ee({platform:"xr",lastSentAt:Date.now()}),window.dispatchEvent(new CustomEvent("tab:holographic-preview",{detail:{tabId:e.id}})),T.crossReality.handoff(e.id,"xr")},children:[r.jsx(_e,{size:12})," XR Hologram"]}),r.jsxs(F.button,{type:"button",className:"flex items-center gap-1 rounded-full border border-amber-400/40 bg-amber-500/15 px-2.5 py-1 text-[10px] text-amber-100 shadow-lg backdrop-blur transition-colors hover:bg-amber-500/25",onClick:t=>{t.preventDefault(),t.stopPropagation(),ee({platform:"mobile",lastSentAt:Date.now()}),T.crossReality.handoff(e.id,"mobile")},children:[r.jsx("span",{role:"img","aria-label":"mobile",children:"ðŸ“±"})," Send"]})]}),r.jsx("div",{className:"flex-shrink-0 w-4 h-4 bg-gray-600 rounded-full flex items-center justify-center",children:e.favicon?r.jsx("img",{src:e.favicon,alt:"",className:"w-full h-full rounded-full"}):r.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})}),e.mode&&e.mode!=="normal"&&r.jsx("span",{className:`px-1.5 py-0.5 rounded-md text-[10px] font-medium border ${e.mode==="ghost"?"bg-purple-500/20 text-purple-200 border-purple-400/40":"bg-emerald-500/20 text-emerald-200 border-emerald-400/40"}`,children:e.mode==="ghost"?"Ghost":"Private"}),e.containerId&&e.containerId!=="default"&&r.jsx("div",{className:"w-2.5 h-2.5 rounded-full border border-gray-700/60",style:{backgroundColor:e.containerColor||"#6366f1"},title:`${e.containerName||"Custom"} container`}),e.sleeping&&r.jsx("span",{className:"flex items-center",title:"Tab is hibernating",children:r.jsx(F.span,{className:"w-2 h-2 rounded-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.55)]",animate:{scale:[1,1.25,1],opacity:[.7,1,.7]},transition:{repeat:1/0,duration:1.8,ease:"easeInOut"}})}),r.jsx("span",{className:`flex-1 text-sm truncate ${e.active?"text-gray-100":"text-gray-400"}`,children:e.title}),r.jsx(F.button,{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),ce(e)},"aria-label":`Peek preview: ${e.title}`,className:"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-gray-700/50 transition-opacity text-gray-400 hover:text-gray-100 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag ml-1",style:{pointerEvents:"auto",zIndex:2},whileHover:{scale:1.05},whileTap:{scale:.96},title:"Peek preview",children:r.jsx(ve,{size:14})}),r.jsx(F.button,{type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),le(e.id)},onAuxClick:t=>{t.button===1&&(t.preventDefault(),t.stopPropagation(),le(e.id))},onMouseDown:t=>{t.stopPropagation()},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),le(e.id))},"aria-label":`Close tab: ${e.title}`,className:"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-gray-700/50 transition-opacity ml-1 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag",style:{pointerEvents:"auto",zIndex:2},whileHover:{scale:1.1},whileTap:{scale:.9},title:"Close tab (Middle click)",children:r.jsx(Le,{size:14,className:"text-gray-400"})})]})},e.id)}):null}),r.jsx(F.button,{onClick:me,onKeyDown:e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),me())},"aria-label":"New tab",className:"flex-shrink-0 p-2 rounded-lg hover:bg-gray-800/50 border border-transparent hover:border-gray-700/30 text-gray-400 hover:text-gray-200 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",whileHover:{scale:1.05},whileTap:{scale:.95},title:"New Tab (Ctrl+T / âŒ˜T)",children:r.jsx(Ge,{size:18})})]}),z&&r.jsx(He,{children:r.jsx(Ke,{tabId:z.tabId,url:z.url,containerId:z.containerId??o.find(e=>e.id===z.tabId)?.containerId,containerName:z.containerName??o.find(e=>e.id===z.tabId)?.containerName,containerColor:z.containerColor??o.find(e=>e.id===z.tabId)?.containerColor,mode:z.mode??o.find(e=>e.id===z.tabId)?.mode,sleeping:z.sleeping??o.find(e=>e.id===z.tabId)?.sleeping,onClose:()=>se(null)})})]}),r.jsx(Ye,{visible:!!B,tabId:B,url:ne?.url,title:ne?.title,onClose:()=>{Z(null),K(null)}})]})}export{jt as TabStrip};
//# sourceMappingURL=TabStrip-DVXyCuB-.js.map

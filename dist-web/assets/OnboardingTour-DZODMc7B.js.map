{"version":3,"file":"OnboardingTour-DZODMc7B.js","sources":["../../src/components/Onboarding/OnboardingTour.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\nimport { X, Brain, TrendingUp, Gamepad2, Zap } from 'lucide-react';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { useOnboardingStore } from '../../state/onboardingStore';\r\n\r\ninterface OnboardingStep {\r\n  id: string;\r\n  title: string;\r\n  description?: string;\r\n  target?: string;\r\n  type?: 'persona' | 'default';\r\n}\r\n\r\ntype PersonaOption = {\r\n  id: 'Research' | 'Trade' | 'Games' | 'Browse';\r\n  title: string;\r\n  subtitle: string;\r\n  icon: typeof Brain;\r\n  hint: string;\r\n};\r\n\r\nconst PERSONAS: PersonaOption[] = [\r\n  {\r\n    id: 'Research',\r\n    title: 'Researcher',\r\n    subtitle: 'Deep dives & synthesis',\r\n    icon: Brain,\r\n    hint: 'Focuses on live graphs, consent checks, and @redix recall.',\r\n  },\r\n  {\r\n    id: 'Trade',\r\n    title: 'Trader',\r\n    subtitle: 'Market intelligence',\r\n    icon: TrendingUp,\r\n    hint: 'Highlights history graphs, playbooks, and automation runs.',\r\n  },\r\n  {\r\n    id: 'Games',\r\n    title: 'Creator',\r\n    subtitle: 'Streams & overlays',\r\n    icon: Gamepad2,\r\n    hint: 'Keeps overlays light and tabs organised for content flow.',\r\n  },\r\n  {\r\n    id: 'Browse',\r\n    title: 'Everyday',\r\n    subtitle: 'Balanced defaults',\r\n    icon: Zap,\r\n    hint: 'A little of everything—perfect for daily browsing.',\r\n  },\r\n];\r\n\r\nconst STEPS: OnboardingStep[] = [\r\n  {\r\n    id: 'persona',\r\n    title: 'Choose your focus',\r\n    description: 'Tell Redix how you work. We’ll tailor shortcuts, menus, and defaults instantly.',\r\n    type: 'persona',\r\n  },\r\n  {\r\n    id: 'welcome',\r\n    title: 'Welcome to OmniBrowser × Redix',\r\n    description:\r\n      'This browser is built for agentic research. Let’s take a 30-second tour of the core controls and regenerative superpowers.',\r\n  },\r\n  {\r\n    id: 'omnibox',\r\n    title: 'Omnibox with @live AI',\r\n    description:\r\n      'Press ⌘/Ctrl + L to focus the omnibox. Try typing “@live quantum trends” to stream Redix results and graphs in real time.',\r\n    target: '[data-onboarding=\"omnibox\"]',\r\n  },\r\n  {\r\n    id: 'tabstrip',\r\n    title: 'Smart Tab Strip',\r\n    description:\r\n      'Tabs show peek previews, mode badges, and hibernation state. Scroll horizontally or hit Ctrl+Tab to jump quickly.',\r\n    target: '[data-onboarding=\"tabstrip\"]',\r\n  },\r\n  {\r\n    id: 'regen',\r\n    title: 'Regenerative Efficiency',\r\n    description:\r\n      'When the battery dips, Redix predicts remaining time, throttles background tabs, and offers +1.8 hr boost actions.',\r\n    target: '[data-onboarding=\"status-bar\"]',\r\n  },\r\n  {\r\n    id: 'graph',\r\n    title: 'Tab DNA Graph',\r\n    description:\r\n      'Press ⌘/Ctrl + Shift + G to open the live tab graph. You’ll see domains, containers, and session affinity mapped instantly.',\r\n  },\r\n  {\r\n    id: 'consent',\r\n    title: 'Ethical Control',\r\n    description:\r\n      'Every AI action requests consent in the ledger. Review what Redix can remember, approve, or revoke at any time.',\r\n  },\r\n];\r\ninterface Spotlight {\r\n  top: number;\r\n  left: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport function OnboardingTour({ onClose }: { onClose: () => void }) {\r\n  const { mode, setMode } = useAppStore();\r\n  const finishOnboarding = useOnboardingStore((state) => state.finish);\r\n  const [spotlight, setSpotlight] = useState<Spotlight | null>(null);\r\n  const [stepIndex, setStepIndex] = useState(0);\r\n  const personaFromMode = useMemo<PersonaOption['id']>(() => {\r\n    const fallback: PersonaOption['id'] = 'Browse';\r\n    return PERSONAS.find((p) => p.id === mode) ? (mode as PersonaOption['id']) : fallback;\r\n  }, [mode]);\r\n  const initialPersonaRef = useRef<PersonaOption['id']>(personaFromMode);\r\n  const [selectedPersona, setSelectedPersona] = useState<PersonaOption['id'] | null>(initialPersonaRef.current);\r\n\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      (window as typeof window & { __tourDebug?: { stepIndex: number; persona: PersonaOption['id'] | null } }).__tourDebug =\r\n        { stepIndex, persona: selectedPersona };\r\n    }\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[Onboarding] Render', { stepIndex, selectedPersona });\r\n    }\r\n  }, [stepIndex, selectedPersona]);\r\n\r\n  useEffect(() => {\r\n    if (stepIndex === 0 && !selectedPersona) {\r\n      initialPersonaRef.current = personaFromMode;\r\n      setSelectedPersona(personaFromMode);\r\n    }\r\n  }, [personaFromMode, selectedPersona, stepIndex]);\r\n\r\n  const step = useMemo(() => STEPS[stepIndex] ?? STEPS[0], [stepIndex]);\r\n\r\n  useEffect(() => {\r\n    if (!step?.target || step.type === 'persona') {\r\n      setSpotlight(null);\r\n      return;\r\n    }\r\n    const element = document.querySelector(step.target) as HTMLElement | null;\r\n    if (!element) {\r\n      setSpotlight(null);\r\n      return;\r\n    }\r\n    const rect = element.getBoundingClientRect();\r\n    setSpotlight({\r\n      top: rect.top + window.scrollY,\r\n      left: rect.left + window.scrollX,\r\n      width: rect.width,\r\n      height: rect.height,\r\n    });\r\n  }, [step]);\r\n\r\n  const handlePersonaSelect = (persona: PersonaOption['id']) => {\r\n    initialPersonaRef.current = persona;\r\n    setSelectedPersona(persona);\r\n    if (mode !== persona) {\r\n      setMode(persona);\r\n    }\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[Onboarding] Persona selected', persona);\r\n    }\r\n  };\r\n\r\n  const goNext = () => {\r\n    if (step?.type === 'persona' && !selectedPersona) {\r\n      return;\r\n    }\r\n    if (step?.type === 'persona' && selectedPersona && mode !== selectedPersona) {\r\n      setMode(selectedPersona);\r\n    }\r\n    if (stepIndex >= STEPS.length - 1) {\r\n      finishOnboarding();\r\n      onClose();\r\n      return;\r\n    }\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[Onboarding] Next from step', stepIndex);\r\n    }\r\n    setStepIndex((current) => Math.min(current + 1, STEPS.length - 1));\r\n  };\r\n\r\n  const goBack = () => {\r\n    if (stepIndex === 0) {\r\n      return;\r\n    }\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[Onboarding] Back from step', stepIndex);\r\n    }\r\n    setStepIndex((current) => Math.max(current - 1, 0));\r\n  };\r\n\r\n  const handleSkip = () => {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.debug('[Onboarding] Skip pressed at step', stepIndex);\r\n    }\r\n    finishOnboarding();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        key=\"onboarding-overlay\"\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        exit={{ opacity: 0 }}\r\n        transition={{ duration: 0.2 }}\r\n        className=\"fixed inset-0 z-[1000] flex items-center justify-center bg-black/70 backdrop-blur-sm\"\r\n      >\r\n        {spotlight && (\r\n          <div\r\n            className=\"pointer-events-none absolute rounded-2xl border-2 border-emerald-400/80 shadow-[0_0_20px_rgba(16,185,129,0.35)]\"\r\n            style={{\r\n              top: spotlight.top - 8,\r\n              left: spotlight.left - 8,\r\n              width: spotlight.width + 16,\r\n              height: spotlight.height + 16,\r\n              transition: 'all 0.25s ease',\r\n            }}\r\n          />\r\n        )}\r\n\r\n        <motion.div\r\n          key={step.id}\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          exit={{ opacity: 0, y: 20 }}\r\n          transition={{ duration: 0.2 }}\r\n          className=\"relative w-[min(520px,90vw)] rounded-3xl border border-slate-700/70 bg-slate-950/95 p-6 text-gray-100 shadow-2xl\"\r\n        >\r\n          <button\r\n            className=\"absolute right-5 top-5 rounded-full border border-slate-700/60 bg-slate-900/70 p-1.5 text-gray-400 hover:text-gray-200\"\r\n            onClick={onClose}\r\n            aria-label=\"Skip onboarding\"\r\n          >\r\n            <X size={16} />\r\n          </button>\r\n\r\n          <div className=\"text-xs uppercase tracking-wide text-emerald-300/80\" data-tour-step-indicator>Step {stepIndex + 1} of {STEPS.length}</div>\r\n          <h2 className=\"mt-2 text-xl font-semibold text-white\">{step.title}</h2>\r\n          {step.description && (\r\n            <p className=\"mt-3 text-sm leading-relaxed text-gray-300\">{step.description}</p>\r\n          )}\r\n\r\n          {step.type === 'persona' ? (\r\n            <div className=\"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2\">\r\n              {PERSONAS.map((persona) => {\r\n                const Icon = persona.icon;\r\n                const isActive = selectedPersona === persona.id;\r\n                return (\r\n                  <motion.button\r\n                    key={persona.id}\r\n                    type=\"button\"\r\n                    onClick={() => handlePersonaSelect(persona.id)}\r\n                    whileHover={{ scale: 1.02 }}\r\n                    whileTap={{ scale: 0.98 }}\r\n                    className={`flex h-full flex-col items-start gap-2 rounded-2xl border p-4 text-left transition-all ${\r\n                      isActive\r\n                        ? 'border-emerald-400/60 bg-emerald-500/10 text-emerald-100 shadow-[0_0_25px_rgba(34,197,94,0.25)]'\r\n                        : 'border-slate-700/60 bg-slate-900/70 text-gray-200 hover:border-slate-500/80 hover:bg-slate-900/90'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Icon size={20} />\r\n                      <div>\r\n                        <div className=\"text-sm font-semibold\">{persona.title}</div>\r\n                        <div className=\"text-xs text-gray-400\">{persona.subtitle}</div>\r\n                      </div>\r\n                    </div>\r\n                    <p className=\"text-xs text-gray-300 leading-relaxed\">{persona.hint}</p>\r\n                  </motion.button>\r\n                );\r\n              })}\r\n            </div>\r\n          ) : null}\r\n\r\n          <div className=\"mt-6 flex items-center justify-between text-sm\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={goBack}\r\n              disabled={stepIndex === 0}\r\n              className=\"rounded-lg border border-slate-700/60 px-3 py-2 text-gray-300 hover:border-slate-500/80 disabled:opacity-40 disabled:cursor-not-allowed\"\r\n            >\r\n              Back\r\n            </button>\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleSkip}\r\n                className=\"rounded-lg border border-slate-700/60 px-3 py-2 text-gray-400 hover:text-gray-200\"\r\n              >\r\n                Skip\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={goNext}\r\n                disabled={step.type === 'persona' && !selectedPersona}\r\n                className=\"rounded-lg border border-emerald-500/60 bg-emerald-500/10 px-4 py-2 font-medium text-emerald-100 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-40\"\r\n              >\r\n                {stepIndex === STEPS.length - 1 ? 'Finish' : 'Next'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n"],"names":["PERSONAS","Brain","TrendingUp","Gamepad2","Zap","STEPS","OnboardingTour","onClose","mode","setMode","useAppStore","finishOnboarding","useOnboardingStore","state","spotlight","setSpotlight","useState","stepIndex","setStepIndex","personaFromMode","useMemo","p","initialPersonaRef","useRef","selectedPersona","setSelectedPersona","useEffect","step","element","rect","handlePersonaSelect","persona","goNext","current","goBack","handleSkip","AnimatePresence","jsxs","motion","jsx","X","Icon","isActive"],"mappings":"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"}